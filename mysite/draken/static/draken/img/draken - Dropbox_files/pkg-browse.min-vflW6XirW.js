define("external/spectrum/icon_mode",["external/spectrum/tslib","external/react","external/spectrum/icon_template_stateless"],function(e,t,r){return(function(e){function t(o){if(r[o])return r[o].exports;var s=r[o]={exports:{},id:o,loaded:!1};return e[o].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)})({0:function(e,t,r){"use strict";function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),o(r(67))},3:function(t,r){t.exports=e},5:function(e,r){e.exports=t},46:function(e,t,r){"use strict";function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),o(r(47))},47:function(e,t,r){"use strict";function o(e,t){return function(r){var o=r.name,i=t[o](),a={};return r["aria-label"]||r["aria-labelledby"]||(a={"aria-hidden":!0}),n.createElement(e,s.__assign({icon:i},a,r))}}Object.defineProperty(t,"__esModule",{value:!0});var s=r(3),n=r(5);t.iconComponent=o},48:function(e,t){e.exports=r},67:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(46),s=r(48),n=r(68);t.ICONS=n.ICONS,t.IconMode=o.iconComponent(s.IconTemplateStateless,n.ICONS),t.IconMode.displayName="IconMode"},68:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(5);t.ICONS={list:function(){return o.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("title",null,"mode-list"),o.createElement("g",{fill:"#637282",fillRule:"evenodd"},o.createElement("path",{d:"M6 15h2v2H6zM10 15h8v2h-8zM6 11h2v2H6zM10 11h8v2h-8zM6 7h2v2H6zM10 7h8v2h-8z"})))},tiles:function(){return o.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("title",null,"mode-tiles"),o.createElement("g",{fill:"#637282",fillRule:"evenodd"},o.createElement("path",{d:"M7 7h4v4H7zM13 7h4v4h-4zM13 13h4v4h-4zM7 13h4v4H7z"})))}}}})}),function(){define("modules/clean/base64",[],function(){var e,t,r;return r=function(e){var t,r,o,s,n,i;for(i=[],n=0,t=0,r=0,o=0,s=0,e+="";n<e.length;)r=e.charCodeAt(n),r<128?(i[t++]=String.fromCharCode(r),n++):r>191&&r<224?(o=e.charCodeAt(n+1),i[t++]=String.fromCharCode((31&r)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),s=e.charCodeAt(n+2),i[t++]=String.fromCharCode((15&r)<<12|(63&o)<<6|63&s),n+=3);return i.join("")},t=function(e){var t,r,o,s,n,i,a,l,c,d,u,p,h,m;if(r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=void 0,u=void 0,p=void 0,n=void 0,i=void 0,a=void 0,l=void 0,o=void 0,c=0,t=0,s="",m=[],!e)return e;for(;;)if(d=e.charCodeAt(c++),u=e.charCodeAt(c++),p=e.charCodeAt(c++),o=d<<16|u<<8|p,n=o>>18&63,i=o>>12&63,a=o>>6&63,l=63&o,m[t++]=r.charAt(n)+r.charAt(i)+r.charAt(a)+r.charAt(l),!(c<e.length))break;return s=m.join(""),h=e.length%3,(h?s.slice(0,h-3):s)+"===".slice(h||3)},e=function(e,t){var o,s,n,i,a,l,c,d,u,p,h,m,f,_,g;if(h=function(e){return e},a=t?h:r,"function"==typeof window.atob)return a(window.atob(e));if(s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p=0,o=0,g=[],!e)return e;for(e+="";;)if(l=s.indexOf(e.charAt(p++)),c=s.indexOf(e.charAt(p++)),d=s.indexOf(e.charAt(p++)),u=s.indexOf(e.charAt(p++)),n=l<<18|c<<12|d<<6|u,m=n>>16&255,f=n>>8&255,_=255&n,g[o++]=64===d?String.fromCharCode(m):64===u?String.fromCharCode(m,f):String.fromCharCode(m,f,_),!(p<e.length))break;return i=g.join(""),i=a(i)},{encode:t,decode:e}})}.call(this),function(){var e=function(e,r){function o(){this.constructor=e}for(var s in r)t.call(r,s)&&(e[s]=r[s]);return o.prototype=r.prototype,e.prototype=new o,e.__super__=r.prototype,e},t={}.hasOwnProperty;define("modules/clean/bolt",["jquery","external/underscore","modules/clean/bolt_nodeps","modules/core/exception"],function(t,r,o,s){var n,i;return n=(function(o){function n(e,o,i){n.__super__.constructor.call(this,e,o,i,"bolt.dropbox.com",t.ajax,r,s)}return e(n,o),n})(o.BoltClient),i=(function(o){function n(e,o,i){n.__super__.constructor.call(this,e,o,i,"thunder.dropbox.com",t.ajax,r,s)}return e(n,o),n})(o.ThunderClient),{BoltClient:n,ThunderClient:i,ChannelId:o.ChannelId,SignedChannelState:o.SignedChannelState,Payload:o.Payload,ChannelPayloads:o.ChannelPayloads}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var s in t)r.call(t,s)&&(e[s]=t[s]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},r={}.hasOwnProperty;define("modules/clean/bolt_nodeps",[],function(){var r,o,s,n,i,a,l,c,d,u,p;return r=1e3,o=3e5,l="/2/notify/subscribe",c="/2/payloads/subscribe",i=(function(){function e(e,t){this.app_id=e,this.unique_id=t}return e})(),u=(function(){function e(e,t,r,o){this.app_id=e,this.unique_id=t,this.revision=r,this.token=o}return e})(),d=(function(){function e(e,t){this.revision=e,this.payload=t}return e})(),a=(function(){function e(e,t){this.channel_state=e,this.payloads=t}return e})(),s=(function(){function t(t,o,s,n,i,a,l){this._update_callback=o,this._refresh_callback=s,this._hostname=n,this._ajax=i,this._u=a,this._exclog=null!=l?l:null,this._handle_poll_error=e(this._handle_poll_error,this),this._handle_poll_success=e(this._handle_poll_success,this),this._must_find_state=e(this._must_find_state,this),this._long_poll=e(this._long_poll,this),this._find_state=e(this._find_state,this),this._signed_channel_states=[],this._started=!1,this._sequence_num=0,this._backoff_window=r,this._additional_headers={},this._timeout_id=null,this.update_states(t)}return t.prototype._encode_channel_state=function(e){return{channel_id:{app_id:e.app_id,unique_id:e.unique_id},revision:e.revision,token:e.token}},t.prototype._decode_channel_state=function(e){return new u(e.channel_id.app_id,e.channel_id.unique_id,e.revision,e.token)},t.prototype._decode_channel_id=function(e){return new i(e.app_id,e.unique_id)},t.prototype._compare_revisions=function(e,t){var r,o,s;return r=Math.max(e.length,t.length),o=Array(r-e.length+1).join("0")+e,s=Array(r-t.length+1).join("0")+t,o<s?-1:o>s?1:0},t.prototype._find_state=function(e){return this._u.find(this._signed_channel_states,(function(t){return function(r){return t._u.isEqual(e,r.channel_id)}})(this))},t.prototype.update_states=function(e){var t,r,o,s,n;for(n=[],t=0,r=e.length;t<r;t++)s=e[t],s=this._encode_channel_state(s),o=this._find_state(s.channel_id),null==o?n.push(this._signed_channel_states.push(s)):this._compare_revisions(s.revision,o.revision)>=0?(o.revision=s.revision,n.push(o.token=s.token)):n.push(void 0);return n},t.prototype.start=function(){if(!this._started)return this._started=!0,this._long_poll()},t.prototype.unsubscribe=function(){return this._started=!1,null!=this._long_poll_xhr&&this._long_poll_xhr.abort(),this._long_poll_xhr=null,window.clearTimeout(this._timeout_id),this._timeout_id=null},t.prototype._long_poll=function(){var e;return this._sequence_num++,e=this._sequence_num,this._long_poll_xhr=this._ajax({url:this._subscribe_url(),type:"POST",data:JSON.stringify({channel_states:this._signed_channel_states}),contentType:"application/json; charset=utf-8",headers:this._additional_headers,dataType:"json",timeout:12e4,success:(function(t){return function(r,o,s){return t._handle_poll_success(e,r,o,s)}})(this),error:(function(t){return function(r,o){return t._handle_poll_error(e,r,o)}})(this),xhrFields:{withCredentials:!0}})},t.prototype._must_find_state=function(e){var t,r,o;return r=this._find_state(e),null==r&&(t="Bolt returned unknown channel id "+e,null!=(o=this._exclog)&&o.reportStack(t)),r},t.prototype._handle_poll_data=function(){var e,t;return e="Method must be implemented.",null!=(t=this._exclog)?t.reportStack(e):void 0},t.prototype._subscribe_url=function(){return"https://"+this._hostname+this._subscribe_endpoint()},t.prototype._subscribe_endpoint=function(){var e,t;return e="Method must be implemented.",null!=(t=this._exclog)?t.reportStack(e):void 0},t.prototype._handle_poll_success=function(e,t,o,s){var n,i,a;if(e===this._sequence_num&&(this._long_poll_xhr=null,this._started))return a=this._handle_poll_data(t,o,s),a.length>0&&this._u.defer(this._update_callback,a),(null!=(i=t.invalid_channels)?i.length:void 0)>0?void this._u.defer(this._refresh_callback,function(){var e,r,o,s;for(o=t.invalid_channels,s=[],e=0,r=o.length;e<r;e++)n=o[e],s.push(this._decode_channel_id(n));return s}.call(this)):(this._backoff_window=r,this._timeout_id=window.setTimeout(this._long_poll,0))},t.prototype._handle_poll_error=function(e,t,r){var s;if(e===this._sequence_num&&(this._long_poll_xhr=null,this._started))return s=Math.random()*this._backoff_window,this._backoff_window=Math.min(2*this._backoff_window,o),window.setTimeout(this._long_poll,s)},t})(),n=(function(r){function o(t,r,s,n,i,a,l){null==l&&(l=null),this._handle_poll_data=e(this._handle_poll_data,this),o.__super__.constructor.call(this,t,r,s,n,i,a,l)}return t(o,r),o.prototype._subscribe_endpoint=function(){return l},o.prototype._handle_poll_data=function(e,t,r){var o,s,n,i,a,l;if(l=[],null!=e.channel_states)for(a=e.channel_states,o=0,s=a.length;o<s;o++)i=a[o],n=this._must_find_state(i.channel_id),this._compare_revisions(i.revision,n.revision)>0&&(n.revision=i.revision,n.token=i.token,l.push(this._decode_channel_state(i)));return l},o})(s),p=(function(r){function o(t,r,s,n,i,a,l){null==l&&(l=null),this._handle_poll_data=e(this._handle_poll_data,this),o.__super__.constructor.call(this,t,r,s,n,i,a,l)}var s;return t(o,r),s="X-Bolt-Session",o.prototype.unsubscribe=function(){return this._additional_headers[s]=null,o.__super__.unsubscribe.call(this)},o.prototype._subscribe_endpoint=function(){return c},o.prototype._handle_poll_data=function(e,t,r){var o,n,i,l,c,u,p,h,m,f,_,g,S;if(S=[],this._additional_headers={},this._additional_headers[s]=r.getResponseHeader(s),null!=e.channel_payloads)for(_=e.channel_payloads,i=0,c=_.length;i<c;i++){for(o=_[i],h=o.channel_state,p=this._must_find_state(h.channel_id),n=this._decode_channel_state(o.channel_state),f=[],g=o.payloads,l=0,u=g.length;l<u;l++)m=g[l],this._compare_revisions(m.revision,p.revision)>0&&f.push(new d(m.revision,m.payload));f.length>0&&S.push(new a(n,f)),this._compare_revisions(h.revision,p.revision)>0&&(p.revision=h.revision,p.token=h.token)}return S},o})(s),{BoltClient:n,ThunderClient:p,ChannelId:i,SignedChannelState:u,Payload:d,ChannelPayloads:a}})}.call(this),define("modules/clean/browse/browse_bolt_client",["require","exports","modules/clean/bolt","modules/clean/react/browse/constants"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){var t=e.userId,s=e.boltData,n=this;this.startLiveUpdate=function(e){void 0===e&&(e=null),e&&(n.handleUpdate=e),n.updateBoltClient(),n.status=o.BrowseBoltClientStatus.Live},this.onBoltRefresh=function(){n.updateBoltClient(),n.status=o.BrowseBoltClientStatus.Live},this.onBoltUpdate=function(){n.handleUpdate&&n.handleUpdate()},this.updateBoltClient=function(){var e=n.boltData.map(function(e){return new r.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)});n.boltClient?n.boltClient.update_states(e):(n.boltClient=new r.BoltClient(e,n.onBoltUpdate,n.onBoltRefresh),n.boltClient.start())},this.userId=t,this.boltData=s,this.status=o.BrowseBoltClientStatus.NotLive}return e.prototype.handleUpdateBoltClient=function(e){this.boltData=e,this.updateBoltClient()},e.prototype.getNsMap=function(){var e={};return this.boltData.forEach(function(t){e[t.bolt_unique_id]=parseInt(t.latest_sjid,10)}),e},e.prototype.stopLiveUpdate=function(){this.status=o.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()},e})();t.BrowseBoltClient=s}),define("modules/clean/file_actions",["require","exports","modules/constants/starred"],function(e,t,r){"use strict";function o(t){var o=t.file,s=t.isStarred,n=t.user;e(["modules/clean/react/starred/browse_exports"],function(e){e.StarredActions.update(n.role,o.file_id,r.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,s)})}Object.defineProperty(t,"__esModule",{value:!0}),t.changeFileStarStatus=o}),define("modules/clean/file_operations/notifications",["require","exports","external/underscore","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,n,i,a,l,c,d){"use strict";function u(e,t,r,o,s){var n=function(){return i.rollbackChangeSets({changesets:r,userId:t.id,progressText:c._("Undoing…"),rollbackHints:o?o:void 0,onSuccess:function(){d.success(c._("Undo complete.")),s&&s()}})};a.notifyWithUndo(e,r,n)}function p(e,t){var i=o.browse_uri_for_fq_path(t,e),a=s.em_snippet(n.filename(e),40);return{href:i,text:r.escape(a)}}function h(e,t,r,o,s,n){var i;if(o){var a=p(o,t);i=c.ungettext('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:a.href,dest_name:a.text}),i=new l(i)}else i=c.ungettext("Copied %(num_items)d item.","Copied %(num_items)d items.",e).format({num_items:e});u(i,t,r,s,n)}function m(e,t,r,o,s,n){var i;if(o){var a=p(o,t);i=c.ungettext('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:a.href,dest_name:a.text}),i=new l(i)}else i=c.ungettext("Moved %(num_items)d item.","Moved %(num_items)d items.",e).format({num_items:e});u(i,t,r,s,n)}function f(e,t,r,o,s){u(c.ungettext("Deleted %(num_items)d item.","Deleted %(num_items)d items.",e).format({num_items:e}),t,r,o,s)}function _(e,t,r,o){u(c._("Rename complete."),e,t,r,o)}function g(e,t,r){u(c._("Created folder %(folder_name)s.").format({folder_name:e}),t,r)}function S(e){var t=c.ungettext("Permanently deleted %(num)s item.","Permanently deleted %(num)s items.",e).format({num:e});d.success(t)}function w(e){var t,o=e.length;if(1===o){var s=r.escape(n.filename(e[0].fq_path));t=c._("Restored <strong>%(filename)s</strong>.").format({filename:s}),t=new l(t)}else t=c.ungettext("Restored %(num)s file.","Restored %(num)s files.",o).format({num:o});d.success(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.notifyCopySuccess=h,t.notifyMoveSuccess=m,t.notifyDeleteSuccess=f,t.notifyRenameSuccess=_,t.notifyFolderCreationSuccess=g,t.notifyPurgeSuccess=S,t.notifyRestoreSuccess=w}),define("modules/clean/pagination_manager",["require","exports","tslib","modules/clean/ajax","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){this.hasMoreItems=!0},e.prototype.addDataToAjax=function(e){},e})(),a=(function(){function e(e){this.ajaxURL=e.ajaxURL,this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items)}return e.prototype.areAllItemsReady=function(){return this.mode.areAllItemsReady()},e.prototype.addPage=function(e){for(var t=[],r=[],o=0,i=e;o<i.length;o++){var a=i[o],l=a[this.keyName];if(null==l)return void n.warning(s._("Invalid server response"));null==this.items[l]&&(this.items[l]=a,r.push(a),t.push(l))}this.pages.push(t),this.newDataCallback(this,r)},e.prototype.startAutoFetching=function(){this.autoFetching=!0,this.fetchNext()},e.prototype.stopAutoFetching=function(){this.autoFetching=!1},e.prototype.reSync=function(e){void 0===e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);var t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()},e.prototype.fetchNext=function(){var e=this;if(!this.mode.areAllItemsReady()){var t={};this.nextRequestVoucher&&(t.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(t),o.WebRequest({url:this.ajaxURL,data:t,subject_user:this.userID,success:function(t){var r=JSON.parse(t);e.nextRequestVoucher=r.next_request_voucher,e.mode.hasMoreItems=r.has_more_items,e.autoFetching&&e.fetchNext();for(var o=0,s=r.items;o<s.length;o++){var n=s[o];n.fq_path=e.fqPathPrefix+n.fq_path}e.addPage(r.items)},error:function(){n.error(s._("There was a problem completing this request."))}})}},e.prototype.loadedPageCount=function(){return this.pages.length},e.prototype.getLoadedPage=function(e){var t=this,r=this.pages[e];return null==r?null:r.map(function(e){return t.items[e]})},e.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},e})();t.BasePaginationManager=a;var l=(function(e){function t(t){return e.call(this,r.__assign({},t,{mode:new i(t.firstPage.has_more_items)}))||this}return r.__extends(t,e),t.create=function(e){return new t(e)},t})(a);t.PaginationManager=l}),define("modules/clean/react/async_file_modal_controller",["require","exports"],function(e,t){"use strict";function r(t){e(["modules/clean/react/file_modal_controller"],t)}function o(e,t,o){r(function(r){return(0,r.showCopy)(e,t,o)})}function s(e,t,o,s){r(function(r){return(0,r.showMove)(e,t,o,s)})}function n(){r(function(e){return(0,e.showOverquota)()})}function i(e,t,o){r(function(r){return(0,r.showRestore)(e,t,o)})}function a(e,t,o){r(function(r){return(0,r.showPermanentlyDelete)(e,t,o)})}function l(e,t,o,s,n,i){void 0===n&&(n=!1),void 0===i&&(i=null),r(function(r){(0,r.showDelete)(e,t,o,s,n,i)})}function c(e,t,o){r(function(r){return(0,r.showNoAccess)(e,t,o)})}function d(e,t,o){r(function(r){return(0,r.showContentManagerBridge)(e,t,o)})}function u(e){r(function(t){return(0,t.showConfirmOwnershipTransferModal)(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showCopy=o,t.showMove=s,t.showOverquota=n,t.showRestore=i,t.showPermanentlyDelete=a,t.showDelete=l,t.showNoAccess=c,t.showContentManagerBridge=d,t.showConfirmOwnershipTransferModal=u}),define("modules/clean/react/browse/action_logger",["require","exports","modules/clean/react/browse/store","modules/clean/web_user_action_logger"],function(e,t,r,o){"use strict";function s(){var e=r.browseStore.selectedFiles().toArray(),t=e.filter(function(e){return e.is_dir}).length;return{num_files:e.filter(function(e){return!e.is_dir}).length,num_dirs:t}}function n(e,t,r){var n=s(),i=n.num_files,a=n.num_dirs;o.WebUserActionLog.log(e,r,{num_files_selected:i,num_folders_selected:a,source:t})}function i(e){var t=e.uid,r=e.entity_type;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.SELECT_ROW,{entity_type:r})}function a(e){var t=e.uid,r=e.entity_type,s=e.source;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.OPEN_ROW,{entity_type:r,source:s})}function l(e){var t=e.uid,r=e.num_files,s=e.num_dirs,n=e.uploader_type,i=e.upload_method;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.UPLOAD_FILE,{num_files:r,num_dirs:s,uploader_type:n,upload_method:i})}function c(e){var t=e.uid;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.CREATE_FOLDER,{})}function d(e){var t=e.uid,r=e.modal_session_id;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.VIEW_SHARE_MODEL,{modal_session_id:r})}function u(e){var t=e.uid,r=e.show_deleted_files;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.TOGGLE_DELETED_FILES,{show_deleted_files:r})}function p(e){var t=e.uid,r=e.sort_by,s=e.sort_direction;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.SORT_RECORDS,{sort_by:r,sort_direction:s})}function h(e){var t=e.uid;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.SWITCH_TO_GRID_VIEW,{})}function m(e){var t=e.uid;o.WebUserActionLog.log(t,o.WebUserActionLogEvents.SWITCH_TO_LIST_VIEW,{})}function f(e){n(e.uid,e.source,o.WebUserActionLogEvents.VERSIONS)}function _(e){n(e.uid,e.source,o.WebUserActionLogEvents.OPEN_MOVE_MODAL)}function g(e){n(e.uid,e.source,o.WebUserActionLogEvents.MOVE)}function S(e){n(e.uid,e.source,o.WebUserActionLogEvents.RENAME)}function w(e){n(e.uid,e.source,o.WebUserActionLogEvents.ADD_COMMENT)}function b(e){n(e.uid,e.source,o.WebUserActionLogEvents.DOWNLOAD)}function v(e){n(e.uid,e.source,o.WebUserActionLogEvents.OPEN_COPY_MODAL)}function y(e){n(e.uid,e.source,o.WebUserActionLogEvents.COPY)}function T(e){n(e.uid,e.source,o.WebUserActionLogEvents.DELETE)}function F(e){n(e.uid,e.source,o.WebUserActionLogEvents.PERMANENT_DELETE)}Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseLogEventSources={MAESTRO_RIGHT_SIDEBAR:"MAESTRO_RIGHT_SIDEBAR",MAESTRO_PHOTOS_RIGHT_SIDEBAR:"MAESTRO_PHOTOS_RIGHT_SIDEBAR",LEGACY_HEADER_ACTIONS:"LEGACY_HEADER_ACTIONS",DRAG:"DRAG"},t.logSelectRow=i,t.logOpenRow=a,t.logUploadFile=l,t.logCreateFolder=c,t.logViewShareModel=d,t.logToggleDeletedFiles=u,t.logSortRecords=p,t.logSwitchToGridView=h,t.logSwitchToListView=m,t.logVersions=f,t.logOpenMoveModal=_,t.logMoveFiles=g,t.logRenameFiles=S,t.logAddComment=w,t.logDownload=b,t.logOpenCopyModal=v,t.logCopyFiles=y,t.logDeleteFiles=T,t.logPermanentDeleteFiles=F}),define("modules/clean/react/browse/actions",["require","exports","tslib","jquery","external/underscore","modules/clean/browse_interface","modules/clean/downloads","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/react/browse/dispatcher","modules/clean/history","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/store","modules/constants/python","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/search/constants","modules/clean/react/browse/action_logger","modules/clean/search/search_results/dispatcher"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S,w,b,v,y,T,F){"use strict";function E(){return e("modules/clean/react/file_viewer/controller")}function C(){return e.defined("modules/clean/react/file_viewer/controller")}function I(t){var r=t.files,n=t.indexOfPreviewFile,i=t.user,a=t.shouldFocusComment,l=t.updateBrowserLocation,c=void 0===l||l,d=t.onCloseViewer,u=void 0===d?s.noop:d,p=t.onViewerUnmount,m=void 0===p?s.noop:p,f=t.fileViewAction,_=void 0===f?g.FileViewActionType.CLICK:f,S=t.fileViewOrigin,w=void 0===S?g.FileViewOriginType.BROWSE:S;e(["modules/clean/react/file_viewer/controller"],function(e){return e.open(r,n,i,h.REACT_FILE_VIEWER_ELEMENT_ID,{fileViewTarget:g.FileViewTargetType.PRIVATE,fileViewOrigin:w,fileViewAction:_,shouldFocusCommentInput:a,disableRouting:!c,onCloseViewer:u,onComponentDidMount:function(){return o(A).hide()},onComponentWillUnmount:function(){o(A).show(),m()}})})}Object.defineProperty(t,"__esModule",{value:!0});var A=[".maestro-chrome","#maestro-nav","#page-footer","#page-header","#page-sidebar","#browse-box",".growth-onboarding-progress-bar__container",".team-progress-bar-experience","#flash-upload-container"].join(),D=(function(){function e(e){this.dataApi=e}return e.prototype.initializeEverything=function(e){var t=e.user,r=e.path,o=e.files,s=e.urlPrefix,n=e.context,i=e.mountPoints,a=e.shouldShowDeletedFiles,l=e.fqPathsToSelect,d=e.loadingState,u=e.teamFolders;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.INITIALIZE_EVERYTHING,data:{user:t,path:r,files:o,urlPrefix:s,context:n,mountPoints:i,shouldShowDeletedFiles:a,fqPathsToSelect:l,loadingState:d,teamFolders:u}})},e.prototype.load=function(e){var t=e.path,r=e.files,o=e.context;f.browseNavActions.load({path:t,files:r,context:o})},e.prototype.add=function(e){var t=e.path,r=e.files;f.browseNavActions.add({path:t,files:r})},e.prototype.setLoadingState=function(e){var t=e.loadingState,r=e.path;f.browseNavActions.setLoadingState({loadingState:t,path:r})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,o=e.files;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.ADD_FILES_AND_SET_LOADING_STATE,data:{path:t,loadingState:r,files:o}})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;f.browseNavActions.setMountPoints({mountPoints:t})},e.prototype.setTeamFolders=function(e){var t=e.teamFolders;f.browseNavActions.setTeamFolders({teamFolders:t})},e.prototype.setPath=function(e){var t=e.path,r=e.onPathLoaded,o=e.nsId,s=e.logFetchedDataRequiredForTTI,n=void 0!==s&&s;f.browseNavActions.setPath({path:t,onPathLoaded:r,nsId:o,logFetchedDataRequiredForTTI:n})},e.prototype.reloadCurrentPath=function(){this.setPath({path:_.browseStore.path()})},e.prototype.setUser=function(e){var t=e.user;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_USER,data:{user:t}})},e.prototype.updatePreview=function(e){var t=e.files;C()&&E().updateFiles(t)},e.prototype.closeFileViewer=function(){C()&&E().close()},e.prototype.setUrlPrefix=function(e){var t=e.prefix;f.browseNavActions.setUrlPrefix({prefix:t})},e.prototype.setUrl=function(e){var t=e.path,r=e.qargs;f.browseNavActions.setUrl({path:t,qargs:r})},e.prototype.copyFilesToClipboard=function(e){if(e.length){if(e.some(function(e){return e.isDeleted}))return void v.error(b._("Deleted files cannot be added to the clipboard"));if(e.some(m.File.isTeamSharedFolder))return void v.error(b._("Team Folders can’t be copied."));var t=b.ungettext("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",e.length).format({num_items:e.length});v.success(t),c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.COPY_FILES_TO_CLIPBOARD,data:{files:e}})}},e.prototype.pasteClipboardFilesToCurrentPath=function(){this.copyFiles({files:_.browseStore.clipboardFiles(),newPath:_.browseStore.path()})},e.prototype.selectRowsFromBoltClient=function(e){void 0===e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},e.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t=e.fqPathsToSelect;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},e.prototype.copyFiles=function(e){var t=this,r=e.files,o=e.newPath,s=_.browseStore.user();this.dataApi.copyFiles({files:r,newPath:o,userId:s.id,onSuccess:function(e){var n=e.files,i=e.changesets,l=e.rollbackHints;a.notifyCopySuccess(r.length,s,i,o,l,function(){t.selectRowsFromBoltClient(r)}),t.selectRowsFromBoltClient(n)}})},e.prototype.moveFiles=function(e){var t=this,r=e.path,o=e.files,s=e.newPath,n=_.browseStore.user(),i=function(e){var r=(e.path,e.changesets),i=e.rollbackHints;a.notifyMoveSuccess(o.length,n,r,s,i,function(){t.selectRowsFromBoltClient(o)})},l=function(e){"This will result in losing ownership of these folders."===e&&(v.clear(),u.showConfirmOwnershipTransferModal(function(){t.dataApi.moveFiles({path:r,files:o,newPath:s,userId:n.id,onSuccess:i,allowOwnershipTransfer:!0})}))};this.dataApi.moveFiles({path:r,files:o,newPath:s,userId:n.id,onSuccess:i,onError:l,allowOwnershipTransfer:!1})},e.prototype.showFileRename=function(e){var t=e.file;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.REQUEST_NEW_FILE_NAME,data:{file:t}})},e.prototype.cancelFileRename=function(e){var t=e.file;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.CANCEL_FILE_RENAME,data:{file:t}})},e.prototype.renameFile=function(e){var t=this,r=e.file,o=e.newName,s=e.isSearchMode;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_FILE_RENAME_PENDING,data:{file:r}});var n=_.browseStore.user();this.dataApi.renameFile({file:r,newName:o,userId:n.id,onSuccess:function(e){var o=e.renamedFile,i=e.changesets,l=e.rollbackHints;a.notifyRenameSuccess(n,i,l,function(){t.selectRowsFromBoltClient([r])}),s&&F.SearchResultsDispatcher.dispatch({type:y.CHANGE_FILES_ACTION,data:{fileDeltas:[{before:r.fq_path,after:r.is_dir?o.set("icon",r.icon):o}]}}),t.selectRowsFromBoltClient([o])},onError:function(){t.cancelFileRename({file:r})}})},e.prototype.applyFileDeltas=function(e){var t=e.path,r=e.fileDeltas;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.CHANGE_FILES,data:{path:t,fileDeltas:r}})},e.prototype.getMountPointUpdateForCurrentPath=function(e){var t,r,o=_.browseStore.path(),n=_.browseStore.mountPoints(),i=n?n.toJS():{},a=function(e){return e===o},l=parseInt(s.findKey(i,a),10);if(l)t=e[l]||null,r=i[l]||null;else{r=null;t=!!s.findKey(e,a)?o:null}return[r,t]},e.prototype.getPathForNewMountPoint=function(e,t){return e&&!t?_.browseStore.path():e&&t?l.paths_are_equal(e,t)?null:t:!e&&t?_.browseStore.path():null},e.prototype.showUserNotificationForPathChange=function(e,t){function r(e){return s.escape(l.filename(e))}function o(e){v.success(new w(e))}function i(e){v.error(new w(e))}var a=t.old_fq_path,c=n.get_browse_root(e)+t.new_fq_path,d=!t.is_changing_view,u=null!=t.change_type?t.change_type.toLowerCase():null;if("moved"===u)if(d)o(b._("This folder has been moved"));else{var p=b._('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>').format({folder_name:r(a),href:s.escape(c)});i(p)}else if("renamed"===u)if(d){var p=b._("This folder has been renamed to ‘%(folder_name)s’").format({folder_name:r(t.change_to_fq_path)});o(p)}else{var p=b._('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>').format({folder_name:r(a),href:s.escape(c)});i(p)}else if("deleted"===u){var p=b._("The folder ‘%(folder_name)s’ has been deleted").format({folder_name:r(a)});i(p)}},e.prototype.computeAndApplyDeltasFromBoltClient=function(e){var t=e.path,r=e.payload,o=e.currentNSId,s=r.added,n=r.moved,i=r.removed,a=r.mount_points,l=r.parent_changes;if(l&&l.change_to_fq_path){var c=_.browseStore.user();return this.showUserNotificationForPathChange(c,l),void this.setUrl({path:l.change_to_fq_path})}var d=this.getMountPointUpdateForCurrentPath(a),u=d[0],p=d[1];u&&!p&&v.success(b._("The folder was unshared."));var h=this.getPathForNewMountPoint(u,p);if(h)return void this.setPath({path:h,nsId:o});this.setMountPoints({mountPoints:a});for(var f=_.browseStore.filesMap(),g=[],S=0,w=s;S<w.length;S++){var y=w[S],T=null,F=m.File.fromServerObject(y);g.push({before:T,after:F})}for(var E=0,C=n;E<C.length;E++){var I=C[E],A=I[0],y=I[1],T=f.get(A,null),F=m.File.fromServerObject(y);g.push({before:T,after:F})}for(var D=0,R=i;D<R.length;D++){var N=R[D],T=f.get(N,null),F=null;g.push({before:T,after:F})}this.applyFileDeltas({path:t,fileDeltas:g})},e.prototype.setSelection=function(e){var t=e.selection;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_SELECTION,data:{selection:t}})},e.prototype.selectFilesAfterUpload=function(e){var t=e.fqPathsToSelect;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SELECT_FILES_AFTER_UPLOAD,data:{fqPathsToSelect:t}})},e.prototype.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},e.prototype.setActiveTab=function(e){var t=e.tabName;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_ACTIVE_TAB,data:{tabName:t}})},e.prototype.navigateToFileOrFolder=function(e){var t=e.file,r=e.shouldFocusComment,o=void 0!==r&&r,s=e.onFileViewerUnmount,n=e.fileViewAction,i=void 0===n?g.FileViewActionType.CLICK:n,a=e.fileViewOrigin,l=void 0===a?g.FileViewOriginType.BROWSE:a;if(!_.browseStore.context().isNonUserRelativeContext||t.is_dir)if(t.is_dir)m.File.isNoAccessSharedFolder(t)?u.showNoAccess(_.browseStore.user(),t,_.browseStore.context()):this.setUrl({path:t.fq_path});else{var c=_.browseStore.getIndexOfFile(t),d=c<0?[t]:_.browseStore.files().toArray();c<0&&(c=0),t.isDeleted?u.showRestore(_.browseStore.user(),[t]):"download"===t.preview_type?S.unsafe_open_tab(t.href):"cloud_content"===t.preview_type&&t.preview_url?S.unsafe_open_tab(t.preview_url):I({files:d,indexOfPreviewFile:c,shouldFocusComment:o,user:_.browseStore.user(),onViewerUnmount:s,fileViewAction:i,fileViewOrigin:l})}},
e.prototype.openPreviewForFile=function(e){var t=e.file,r=e.onCloseViewer;I({files:[t],indexOfPreviewFile:0,user:_.browseStore.user(),updateBrowserLocation:!1,onCloseViewer:r})},e.prototype.openPreviewForFiles=function(e){var t=e.files,r=e.fileViewOrigin,o=e.index,s=e.onFileViewerUnmount;I({files:t,indexOfPreviewFile:o,user:_.browseStore.user(),updateBrowserLocation:!1,onViewerUnmount:s,fileViewAction:g.FileViewActionType.CLICK,fileViewOrigin:r})},e.prototype.navigateToParentFolder=function(){var e=l.parent_dir(_.browseStore.path());this.setUrl({path:e})},e.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles,r=e.shouldReloadFolder,o=void 0===r||r;t?d.update_query_param("d","1"):d.remove_query_param("d"),c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:t}}),o&&(_.browseStore.context().isNonUserRelativeContext?this.setPath({path:_.browseStore.path(),nsId:_.browseStore.context().rootNSID}):this.reloadCurrentPath())},e.prototype.sortFiles=function(e){var t=e.sortField,r=e.sortDirection;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SORT_FILES,data:{sortField:t,sortDirection:r}})},e.prototype.setViewType=function(e){var t=e.viewType,r=_.browseStore.user();if(r){var o=r.id;switch(t){case h.ViewTypes.List:T.logSwitchToListView({uid:o});break;case h.ViewTypes.Grid:T.logSwitchToGridView({uid:o})}}c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_VIEW_TYPE,data:{viewType:t}})},e.prototype.setCopyMode=function(e){var t=e.copyMode;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_COPY_MODE,data:{copyMode:t}})},e.prototype.downloadFiles=function(e){var t=e.files,r=e.context,o=e.user;if(1!==t.count()||t.first().is_dir){if(r.blockHash)if(r.isNonUserRelativeContext)i.zip_batch_by_ns_id({parent_ns_id:r.rootNSID,parent_ns_path:r.currentFQPath,files:t.toArray(),subject_uid:o.id,block_hash:r.blockHash});else{var s=r.currentFQPath,n=t.toArray().map(function(e){return e.fq_path});i.get_zip({fq_paths:n,subject_uid:o.id,block_hash:r.blockHash,parent_path:s})}}else if(r.isNonUserRelativeContext){var a=t.first(),c=a.direct_blockserver_link,d=r.rootNSID,u=l.filename(a.fq_path),p="/"===r.currentFQPath?"/"+u:r.currentFQPath+"/"+u;i.get_blockserver_link({url:c,ns_id:d,ns_path:p,inside_admin_console:!0})}else i.get_blockserver_link({url:t.first().direct_blockserver_link})},e.prototype.nameNewFolder=function(){c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.REQUEST_FOLDER_NAME})},e.prototype.createFolder=function(e){var t=this,r=e.pathName,o=e.folderName,s=e.nsId,n=void 0===s?null:s;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.CREATE_FOLDER_PENDING});var i=_.browseStore.user();this.dataApi.createNewFolder({pathName:r,folderName:o,nsId:n,userId:i.id,onSuccess:function(e){var r=e.changesets,s=e.createdFolder;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.CREATE_FOLDER_COMPLETE}),a.notifyFolderCreationSuccess(o,i,r),t.selectRowsFromBoltClient([s])},onError:function(){c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.CANCEL_CREATE_FOLDER})}})},e.prototype.cancelCreateFolder=function(){c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.CANCEL_CREATE_FOLDER})},e.prototype.createCloudContent=function(e){var t=e.pathName,r=e.title,o=e.documentType,n=_.browseStore.user().id;this.dataApi.createCloudContent({pathName:t,title:r,documentType:o,userId:n,onSuccess:s.noop,onError:s.noop})},e.prototype.addCommentStatusBatch=function(e){var t=e.commentStatusByFqPath;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.ADD_COMMENT_STATUS_BATCH,data:{commentStatusByFqPath:t}})},e.prototype.setDropTarget=function(e){var t=e.target;c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.SET_DROP_TARGET,data:{target:t}})},e.prototype.setDataApi=function(e){this.dataApi=e,f.browseNavActions.setDataApi(e)},e.prototype.fetchFolderSizes=function(e){var t=e.file;return r.__awaiter(this,void 0,void 0,function(){var e,o,s,n,i,a,l,d,u;return r.__generator(this,function(r){switch(r.label){case 0:e=_.browseStore.user(),o=h.MAX_FOLDER_SIZE_ITERATIONS,r.label=1;case 1:return r.trys.push([1,7,,8]),c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.REQUEST_FETCH_FOLDER_SIZES,data:{fqPath:t.fq_path}}),[4,this.dataApi.fetchSharedFolderSizes({userId:e.id,fq_path:t.fq_path})];case 2:return s=r.sent(),c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:s}}),n=[],[4,this.fetchAndSetSameNamespaceFolderSize({userId:e.id,fq_path:t.fq_path,folder_limit:h.MAX_FOLDERS_PER_CALL})];case 3:i=r.sent(),i.queue&&(n=n.concat(i.queue)),r.label=4;case 4:return n.length>0&&o>0?(o--,a=Math.min(h.MAX_FOLDER_SIZE_QUEUE_SIZE,n.length),l=n.splice(0,a),[4,this.fetchAndSetSameNamespaceFolderSize({userId:e.id,fq_path:t.fq_path,folder_limit:h.MAX_FOLDERS_PER_CALL,queue:l})]):[3,6];case 5:return i=r.sent(),i.queue&&n&&(n=n.concat(i.queue)),[3,4];case 6:return d=0!==o&&i.queue&&0===i.queue.length?h.FetchFolderSizeStates.COMPLETE:h.FetchFolderSizeStates.ERROR,c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.COMPLETE_FETCH_FOLDER_SIZES,data:{state:d}}),[3,8];case 7:return u=r.sent(),c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.COMPLETE_FETCH_FOLDER_SIZES,data:{state:h.FetchFolderSizeStates.ERROR}}),[3,8];case 8:return[2]}})})},e.prototype.fetchAndSetSameNamespaceFolderSize=function(e){return r.__awaiter(this,void 0,void 0,function(){var t,o;return r.__generator(this,function(r){switch(r.label){case 0:return t=e.fq_path,[4,this.dataApi.fetchSameNamespaceFolderSizes(e)];case 1:return o=r.sent(),c.BrowseDispatcher.dispatch({type:h.BrowseActionTypes.FETCHED_FOLDER_SIZES,data:{fqPath:t,resp:o}}),[2,o]}})})},e})();t.browseActions=new D(p)}),define("modules/clean/react/browse/api",["require","exports","external/underscore","modules/clean/ajax","modules/clean/react/browse/models","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/api_v2/client"],function(e,t,r,o,s,n,i,a,l){"use strict";function c(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function d(e){var t=e.path,r=e.userId,s=e.onSuccess,n=e.includeDeletedFiles,i=void 0!==n&&n,a=e.sortFoldersFirst,l=void 0===a||a,d=e.onError;return o.WebRequest({data:{show_deleted:i||"",sort_folders_first:l,path2:t},url:"/browse",subject_user:r,success:function(e){var r=c(e);r&&s({path:t,data:r})},error:function(e,t,r){d&&d(e,t,r)}})}function u(e){var t=e.files,a=e.newPath,l=e.userId,c=e.onSuccess,d=t.map(function(e){return e.fq_path});return d.includes(a)?(i.error(n._("You can’t copy a folder into itself.")),null):o.WebProgressRequest({url:"/cmd/copy",data:{files:d,to_path:a},subject_user:l,progress_text:n._("Copying files..."),success:function(e){try{var t=r.isString(e)?JSON.parse(e):e;c({files:t.new_browse_files.map(s.File.fromServerObject),destinationPath:a,changesets:t.changesets,rollbackHints:t.rollback_hints})}catch(e){}}})}function p(e){var t=e.files,s=e.userId,i=e.onSuccess,a=t.map(function(e){return e.fq_path});return o.WebProgressRequest({url:"/cmd/delete",data:{files:a},subject_user:s,progress_text:n._("Deleting files..."),success:function(e){try{var o=r.isString(e)?JSON.parse(e):e;i({fileDeltas:t.map(function(e){return{before:e,after:null}}),changesets:o.changesets,rollbackHints:o.rollback_hints})}catch(e){}}})}function h(e){var t=e.path,a=e.files,l=e.newPath,c=e.userId,d=e.onSuccess,u=e.allowOwnershipTransfer;if(t===l)return i.error(n._("Those files already exist in that folder.")),null;var p=a.map(function(e){return e.fq_path});return p.includes(l)?(i.error(n._("You can’t move a folder into itself.")),null):o.WebProgressRequest({url:"/cmd/move",data:{files:p,to_path:l,allow_ownership_transfer:u},subject_user:c,progress_text:n._("Moving files..."),skipNotifyError:!u,success:function(e){try{var o=r.isString(e)?JSON.parse(e):e;d({path:t,destinationPath:l,newFiles:o.new_browse_files.map(s.File.fromServerObject),changesets:o.changesets,rollbackHints:o.rollback_hints})}catch(e){}},error:function(t,r,o){i.error(o),e.onError&&e.onError(o)}})}function m(e){var t=e.file,r=e.newName,s=e.userId,n=e.onSuccess,i=e.onError;return o.WebRequest({url:new a({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:s,data:{to_path:r},success:function(e,r,o){var s=c(e);if(s){var a=t.merge(s.new_browse_files[0]);n({changesets:s.changesets,renamedFile:a,rollbackHints:s.rollback_hints})}else i&&i()},error:i})}function f(e){var t=e.files,r=e.userId,s=e.onSuccess;return o.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(function(e){return e.fq_path})},subject_user:r,dataType:"json",progress_text:n._("Restoring…"),success:function(){s()}})}function _(e){var t=e.files,r=e.userId,s=e.onSuccess,i=e.progressText,a=void 0===i?n._("Deleting…"):i;return o.WebProgressRequest({url:"/cmd/purge",data:{files:t.map(function(e){return e.fq_path})},subject_user:r,dataType:"text",progress_text:a,success:function(e){var t=c(e);t&&"success"===t.status&&s()}})}function g(e){var t=e.userId,r=e.changesets,s=void 0===r?null:r,n=e.progressText,i=e.rollbackHints,a=void 0===i?{}:i,l=e.onSuccess;return o.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(s),rollback_hints:JSON.stringify(a)},subject_user:t,progress_text:n,success:function(){l()}})}function S(e){var t=e.pathName,r=e.folderName,n=e.userId,i=e.onSuccess,l=e.onError;return o.WebProgressRequest({url:new a({path:"/cmd/new"+t}).toString(),data:{to_path:r,folder:"yes"},subject_user:n,success:function(e){var t=c(e);if(t){var r=s.File.fromServerObject(t.new_browse_files[0]);i({changesets:t.changesets,createdFolder:r})}},error:function(){l()}})}function w(e){var t=e.pathName,r=e.title,n=e.documentType,i=e.userId,l=e.onSuccess,d=e.onError,u=(t+"/"+r+"."+n).replace("//","/");return o.WebProgressRequest({url:new a({path:"/cmd/create_cloud_content"}).toString(),subject_user:i,data:{to_path:u,title:r},success:function(e){var t=c(e);if(t){l({changesets:null,createdFile:s.File.fromServerObject(t.new_browse_files[0])})}},error:function(){d()}})}function b(e){var t=e.path,s=e.userId,n=e.namespaceToJournalIdMap,i=e.onSuccess,a=e.includeDeletedFiles,l=e.isNonUserRelativeContext,d="/"===t?"":t,u={fq_dir:d,ns_map:r.map(n,function(e,t){return t+"_"+e}).join(","),show_deleted:!!a,admin_console:!!l};return o.WebRequest({url:"/update/list_dir",subject_user:s,data:u,dataType:"text",success:function(e){var t=c(e);t&&i(t)}})}function v(e){var t=e.userId,r=e.fq_path;return(new l.ApiV2Client).rpc(t,"folders/get_shared_subfolder_sizes",{fq_path:r})}function y(e){var t=e.userId,r=e.fq_path,o=e.folder_limit,s=e.queue;return(new l.ApiV2Client).rpc(t,"folders/get_subfolder_sizes_in_same_namespace",{fq_path:r,folder_limit:o,queue:s})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadPath=d,t.copyFiles=u,t.deleteFiles=p,t.moveFiles=h,t.renameFile=m,t.restoreFiles=f,t.purgeFiles=_,t.rollbackChangeSets=g,t.createNewFolder=S,t.createCloudContent=w,t.getChangesForDirectory=b,t.fetchSharedFolderSizes=v,t.fetchSameNamespaceFolderSizes=y}),define("modules/clean/react/browse/async_onboarding_new_folder_modal_util",["require","exports"],function(e,t){"use strict";function r(t,r){e(["modules/clean/react/browse/onboarding_new_folder_modal"],function(e){e.showOnboardingNewFolderModal(t,r)})}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowOnboardingNewFolderModal=r}),define("modules/clean/react/browse/browse",["require","exports","tslib","external/react","external/react-dom","external/underscore","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/js_client_stopwatch","modules/clean/pagination_manager","modules/constants/browse","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/browse_view","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/browse/browse_bolt_client","modules/clean/react/file_uploader/file_uploader","modules/clean/react/file_uploader/store","modules/clean/search/search_bar/actions","modules/clean/search/search_bar/api_actions","modules/clean/search/search_results/actions","modules/clean/search/search_bar/store","modules/clean/search/search_results/store","modules/clean/sharing/browse_exports","modules/clean/viewer","modules/clean/pagelet_logger","modules/clean/web_timing_logger","modules/core/framework_args","modules/core/i18n","modules/core/notify","modules/core/uri","modules/pagelet_config","modules/clean/filepath","modules/constants/search","modules/clean/search/search_helpers"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S,w,b,v,y,T,F,E,C,I,A,D,R,N,P,L,x,O,M,U,k,B){"use strict";function q(){return!K&&(!!e.defined("modules/clean/react/file_viewer/controller")&&e("modules/clean/react/file_viewer/controller").isShown())}function H(e){void 0===e&&(e={}),!e.preview&&q()&&m.browseActions.closeFileViewer()}function V(e){void 0===e&&(e={});var t=q();if(e.preview&&!t){var r=w.browseStore.getFileByFilename(e.preview);r&&m.browseActions.navigateToFileOrFolder({file:r})}else t&&!e.preview&&m.browseActions.closeFileViewer()}function G(){var e=document.getElementById(g.REACT_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=g.REACT_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))}function z(){var e=document.getElementById(g.REACT_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)}function W(e){var t=l.parent_dir(e);"/"!==t&&x.success(L._("Folder is in %(path)s").format({path:a.em_snippet(t,22)}))}function j(e){var t=c.deconstruct_url().qargs;c.replace_state(e,n.pick.apply(n,[t,"d","select","preview"].concat(P.FRAMEWORK_ARGS)))}Object.defineProperty(t,"__esModule",{value:!0});var K="undefined"!=typeof RUNNING_IN_REACTSERVER,Q=(function(t){function P(e){var o=t.call(this,e)||this;return o.logOnceFetchedDataRequiredForTTI=n.once(function(){return N.log_js_modules_fetched_data_required_for_tti()}),o.receiveStateFromStores=function(){o.setState(o.getStateFromStores())},o.handleComponentTTI=function(e){o.browseLogger&&(o.browseLogger.componentReady(e),o.searchResultsWebTimer&&o.browseLogger.ttiLogged&&o.searchResultsWebTimer.markTimeToInteractive())},o.getIsFileJumping=function(){return w.browseStore.isFileJumping()},o.setBrowseViewRef=function(e){o.browseViewRef=e},o.handleFileLocationChange=function(e,t){e=K?o.state.path:"/"+O.decode(e),V(t),e!==o.previousHistoryCallbackPath&&(o.previousHistoryCallbackPath=e,w.browseStore.isPathEqualsTo(e)||o.navigateToPath({path:e}))},o.handleSearchLocationChange=function(e,t){if(t){var r=t.query||t.query_unnormalized;e=t.path||t.last_fq_path||"/";var s=t.qsid;if(r&&(!U.paths_are_equal(e,o.state.path)||r!==o.state.latestQuery)){var n=o.state.user||D.get_viewer().get_user_by_id(o.props["user-id"]);o.previousHistoryCallbackPath=e,w.browseStore.isPathEqualsTo(e)||m.browseActions.setPath({path:e}),F.searchBarApiActions.setSearchQuery({path:e,query:r,user:n,qsid:s}),E.searchResultsActions.runSearch({user:n,path:e,query:r,qsid:s,webTimer:o.searchResultsWebTimer,logOnceFetchedDataRequiredForTTI:o.logOnceFetchedDataRequiredForTTI})}}},o.handleFileListUpdated=function(){if(q())o.state.files.isEmpty()?m.browseActions.closeFileViewer():m.browseActions.updatePreview({files:o.state.files.toJS()});else{V(c.deconstruct_url().qargs)}},o.handleDelete=function(e){var t=o.state,r=t.context,s=t.user,n=e.some(S.File.isTeamSharedFolder),i=e.some(function(e){return e.read_only});!r.isCurrentPathWriteable()||n||i?n?x.error(L._("Team folders can’t be deleted.")):x.warning(L._("You don’t have permission to delete files in this folder.")):h.showDelete(s,e,r,function(){return m.browseActions.selectRowsFromBoltClient(e)},!!o.props["exp-subgrowth-biz-web-client-oq-delete"])},o.handleRestore=function(e){var t=o.state.user;h.showRestore(t,e)},o.handlePermanentDelete=function(e){var t=o.state.user;h.showPermanentlyDelete(t,e,function(){return m.browseActions.reloadCurrentPath()})},o.handleShowRename=function(e){m.browseActions.showFileRename({file:e})},o.actionHandlers={onDelete:o.handleDelete,onRestore:o.handleRestore,onPermanentDelete:o.handlePermanentDelete,onShowRename:o.handleShowRename},o.handleSearch=function(e,t,r){var s=B.buildSearchURL({user:o.state.user,currentPath:t,normalizedQuery:e,searchSessionID:r?C.searchBarStore.searchSessionID():I.searchResultsStore.searchSessionID(),searchToken:k.SEARCH_TOKEN_CONSTANT});o.searchResultsWebTimer?o.searchResultsWebTimer.restart():(o.searchResultsWebTimer=N.get_timer("search_results"),o.searchResultsWebTimer.initialize({requireTTI:!0,requireTTV:!1})),c.push_state(s.getPath(),s.getQuery())},o.state=r.__assign({},o.getStateFromStores()),o}return r.__extends(P,t),P.prototype.componentWillMount=function(){N.log_js_modules_application_code_start();var e;e=this.props["search-query"]?["FilesViewController"]:["FilesViewController","AppActionsView"],this.browseLogger=new R.PageletLogger("browse",e,!0,{view_type:this.state.viewType.toLowerCase(),responsive_browse:p.RESPONSIVE_BROWSE});var t=D.get_viewer().get_user_by_id(this.props["user-id"]),r=i.get_browse_root(t),o=this.props["init-fq-path"]||"/",s=!!this.props["should-show-deleted-files"],n=this.props["init-data"];if(n){N.log_js_modules_fetched_data_required_for_tti();var a=void 0,l=void 0;if(n.paginated?(l=g.LoadingStates.LOADING_REMAINING_PAGES,a=[]):(l=g.LoadingStates.LOADED,a=n.file_info),m.browseActions.initializeEverything({user:t,path:o,files:a,urlPrefix:r,context:S.BrowseContext.fromServerObject(n),mountPoints:n.ns_id_to_mount_point,fqPathsToSelect:this.props["select-fq-paths"],loadingState:l,shouldShowDeletedFiles:s,teamFolders:n.team_folders_js_info}),n.paginated){var d=new u.PaginationManager({firstPage:n.first_page,keyName:"sjid",ajaxURL:"/browse_get_next",userID:t.id,newDataAvailableCallback:function(e,t){e.areAllItemsReady()?(m.browseActions.addFilesAndSetLoadingState({path:o,files:t,loadingState:g.LoadingStates.LOADED}),e.stopAutoFetching()):m.browseActions.add({path:o,files:t})}});K||d.startAutoFetching()}}else m.browseActions.setUrlPrefix({prefix:r}),m.browseActions.setUser({user:t}),m.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:s,shouldReloadFolder:!1}),m.browseActions.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:this.props["select-fq-paths"]}),this.props["search-query"]||this.navigateToPath({path:o,logFetchedDataRequiredForTTI:!0});var h=!this.props["search-query"];c.add_callback(r,this.handleFileLocationChange,!0),c.add_callback("/search",this.handleSearchLocationChange,h),c.add_exit_callback("/search",T.searchBarActions.clearSearch),c.add_exit_callback("/search",E.searchResultsActions.clearSearch),this.receiveStateFromStores()},P.prototype.componentDidMount=function(){var t=this;this.mounted=!0,w.browseStore.add_change_listener(this.receiveStateFromStores),I.searchResultsStore.add_change_listener(this.receiveStateFromStores),y.UploaderStore.add_change_listener(this.receiveStateFromStores),this.receiveStateFromStores();var r=c.deconstruct_url().qargs,o=this.state,i=o.path,u=o.user;if(r.from_scl_sync_modal&&(u.is_cdm_member?W(i):x.success(L._("%(file_name)s added to your Dropbox.").format({file_name:l.filename(i)}))),!this.props["search-query"]){var p=this.props["share-link"],h=!!this.props["preview-file-info"];if(!p&&!h){j(this.getUrlForFQPath(i))}p&&!h&&u.is_cdm_member&&W(i)}d.JSStopwatch.create_stopwatch_if_not_exist("maestro_tracing"),d.JSStopwatch.recordTrace("new_markPageletRendered",{stopwatchName:"maestro_tracing",traceTime:N.time_since_start()});var f=window.ensemble;f&&(f.markPageletRenderedByDOMNode?f.markPageletRenderedByDOMNode(s.findDOMNode(this)):f.markPageletRendered&&f.markPageletRendered(M.REQUIREJS_CONFIG.context)),(this.props["init-data"]||this.props["search-query"])&&(this.hasTTVBeenLogged||(N.mark_time_to_view(),this.hasTTVBeenLogged=!0)),G();var _=!!this.props["show-share-modal"],g=this.props["share-prefill-email"],b=this.props["preview-file-info"];if(this.props["loaded-with-explicit-preview"]&&!b){var v=c.deconstruct_url(),T=v.path,F=v.qargs;delete F.preview,c.replace_state(T,F)}if(N.waitForTTI().then(function(){t.props["search-query"]||t.setupFileEventListener(u.id),e(["modules/clean/react/file_viewer/controller","modules/clean/react/browse/shared_with","modules/clean/react/starred/browse_exports","modules/clean/react/file_modal_controller","modules/clean/sharing/share_modal_util","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/sharing/wizard/wizard_modals","modules/clean/contacts/bloodhound_contacts_v2","modules/clean/react/browse/comment_status","modules/clean/account/email","modules/clean/unity_browse_interface","modules/clean/unity/features","modules/clean/unity/check_file_cache"],function(e,o,s,i,a,l,c,d,u,p,h,m,f,_){var g=o.SharedWithStore,S=s.checkForMissingStarredData,b=s.StarredStore,v=u.BloodhoundContactsV2,y=h.EmailVerification;if(t.mounted){var T=t.state,F=T.user,E=T.path,C=T.files,I=C.toArray();g.initializeWith({path:E,files:I}),S({files:I,user:F});var A=b.addListener(function(){t.setState({starredState:b.getLoadingStates()})}),D=function(){return n.defer(function(){S({files:t.state.files.toArray(),user:F})})};w.browseStore.add_change_listener(D),t.removeStarredStoreListener=function(){A(),w.browseStore.remove_change_listener(D)},v.getOrCreateForUser(F),p.setup(),t.setState({isSharedWithLoaded:!0,isStarredLoaded:!0,isUnityLoaded:!0}),r.email_just_verified?y.getForRole(F.role).show_verified_modal():r.email_just_verified_and_changed?y.getForRole(F.role).show_verified_and_changed_modal():t.props["send-verification-email"]&&y.getForRole(F.role).show_sent_modal()}})}),b){var E=S.File.fromServerObject(b);m.browseActions.openPreviewForFile({file:E,onCloseViewer:function(){var e=t.browseViewRef;(e=e.getFilesViewControllerRef())&&(e=e.getBrowseTileGridRef())&&(e=e.getTileGridRef())&&e.getAndUpdateTileLayout(),t.restoreUrlAfterFileViewClose()}}),_&&N.waitForTTI().then(function(){t.mounted&&A.asyncShowPrefilledShareModal({user:u,sharePrefillEmail:g,content:E})})}else _&&N.waitForTTI().then(function(){if(t.mounted){var e=t.props["ns-id"],r=t.props["ns-path"];A.asyncShowPrefilledShareModal({user:u,sharePrefillEmail:g,content:{fqPath:i,isFolder:!0,nsId:e&&r?e:null,targetNsId:e&&!r?e:null}})}});var C=this.props["notify-path-is-deleted"],D=this.props["notify-path-does-not-exist"];null!=C?x.error(L._("The folder ‘%(folder_name)s’ is deleted.").format({folder_name:a.em_snippet(C,15)})):null!=D&&x.error(L._("The folder ‘%(folder_name)s’ doesn’t exist.").format({folder_name:a.em_snippet(D,15)})),d.JSStopwatch.create_stopwatch_if_not_exist("maestro_tracing"),d.JSStopwatch.recordTrace("old_markPageletRendered",{stopwatchName:"maestro_tracing",traceTime:N.time_since_start()})},P.prototype.componentWillUpdate=function(e,t){t.isSearchMode&&!this.state.isSearchMode?this.browseBoltClient&&this.browseBoltClient.stopLiveUpdate():!t.isSearchMode&&this.state.isSearchMode&&this.setupFileEventListener(this.state.user.id),t.files.equals(this.state.files)||setTimeout(this.handleFileListUpdated,0)},P.prototype.componentWillUnmount=function(){e.defined("modules/clean/react/browse/comment_status")&&e("modules/clean/react/browse/comment_status").teardown(),this.removeStarredStoreListener&&this.removeStarredStoreListener(),z(),w.browseStore.remove_change_listener(this.receiveStateFromStores),I.searchResultsStore.remove_change_listener(this.receiveStateFromStores),y.UploaderStore.remove_change_listener(this.receiveStateFromStores),this.mounted=!1},P.prototype.getStateFromStores=function(){var e=w.browseStore.path(),t=I.searchResultsStore.latestQuery();return{context:w.browseStore.context(),files:w.browseStore.files(),filesWithoutTeamFolders:w.browseStore.filesWithoutTeamFolders(),teamFolders:w.browseStore.teamFolders(),loadingState:w.browseStore.loadingState(),path:e,selection:w.browseStore.selection(),selectedFiles:w.browseStore.selectedFiles(),fileRename:w.browseStore.fileRename(),user:w.browseStore.user(),shouldShowDeletedFiles:w.browseStore.shouldShowDeletedFiles(),isDraggingInternalFiles:v.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:v.FileUploaderController.isDraggingExternalFiles(),activeDropTarget:w.browseStore.activeDropTarget(),isUploadModalOpen:v.FileUploaderController.isUploadModalOpen(),isTextSelectable:!!w.browseStore.fileRename(),createNewFolderState:w.browseStore.newFolderCreationState(),isSearchMode:!!t,currentSort:w.browseStore.currentSort(),viewType:w.browseStore.viewType(),urlPrefix:w.browseStore.urlPrefix(),latestQuery:t,isQueryingFolderSizes:w.browseStore.isQueryingFolderSizes()}},P.prototype.restoreUrlAfterFileViewClose=function(){var e,t=this.getUrlForFQPath(this.state.path);e=this.props["loaded-with-explicit-preview"]?n.omit(c.deconstruct_url().qargs,"preview","select"):{},c.replace_state(t,e)},P.prototype.getUrlForFQPath=function(e){var t="/"===e?"":O.encode_parts(e);return this.state.urlPrefix+t},P.prototype.setupFileEventListener=function(e){var t=this;if(!this.browseBoltClient){var r=[];this.props["bolt-data"]&&(r=this.props["bolt-data"]),this.browseBoltClient=new b.BrowseBoltClient({userId:e,boltData:r})}this.browseBoltClient.startLiveUpdate(function(){null!=t.getChangesRequest&&t.getChangesRequest.abort();var r=t.state,o=r.context,s=r.path,n=r.shouldShowDeletedFiles;t.getChangesRequest=f.getChangesForDirectory({path:s,userId:e,namespaceToJournalIdMap:t.browseBoltClient.getNsMap(),includeDeletedFiles:n,isNonUserRelativeContext:o.isNonUserRelativeContext,onSuccess:function(e){t.getChangesRequest=null,m.browseActions.computeAndApplyDeltasFromBoltClient({payload:e,path:s}),t.browseBoltClient.handleUpdateBoltClient(e.bolt_data)}})})},P.prototype.navigateToPath=function(e){var t=this,r=e.path,o=e.logFetchedDataRequiredForTTI,s=void 0!==o&&o;m.browseActions.setPath({path:r,logFetchedDataRequiredForTTI:s,onPathLoaded:function(){t.hasTTVBeenLogged||(N.mark_time_to_view(),t.hasTTVBeenLogged=!0)}})},P.prototype.render=function(){var e;if(this.state.loadingState===g.LoadingStates.LOADED)e=this.state.files.size;else{var t=this.props["init-data"];e=t&&t.first_page&&t.first_page.total_num_items||this.state.files.size}var r=this.state,s=r.activeDropTarget,n=r.context,i=r.user,a=r.path,l=r.createNewFolderState,c=r.currentSort,d=r.shouldShowDeletedFiles,u=r.isUploadModalOpen,p=r.selection,h=r.fileRename,m=r.files,f=r.teamFolders,S=r.isTextSelectable,w=r.loadingState,b=r.selectedFiles,v=r.isSearchMode,y=r.viewType,T=r.starredState,F=r.filesWithoutTeamFolders,E=r.isSharedWithLoaded,C=r.isStarredLoaded,I=r.isUnityLoaded,A=r.isDraggingExternalFiles,D=r.isDraggingInternalFiles,R=r.isQueryingFolderSizes;return o.createElement(_.BrowseView,{ref:this.setBrowseViewRef,actionHandlers:this.actionHandlers,activeDropTarget:s,context:n,createNewFolderState:l,currentSort:c,ensureFileViewerClosedIfNotPreviewing:H,fileRename:h,files:m,filesWithoutTeamFolders:F,getIsFileJumping:this.getIsFileJumping,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:A,isDraggingInternalFiles:D,isFileViewerShown:q,isSearchMode:v,isTextSelectable:S,isUploadModalOpen:u,loadingState:w,onSearch:this.handleSearch,path:a,selectedFiles:b,selection:p,shouldOpenUploadModal:this.props["should-open-upload-modal"],shouldShowDeletedFiles:d,starredState:T,teamFolders:f,totalNumItems:e,user:i,viewType:y,isSharedWithLoaded:E,isStarredLoaded:C,isUnityLoaded:I,isNoComment:this.props["is-no-comment"],isOverFreeQuota:this.props["is-over-free-quota"],isQueryingFolderSizes:R,expBizFoldersEmptyStateAdmin:this.props["exp-subgrowth-biz-folders-empty-state-admin"],expBizFoldersEmptyStateUser:this.props["exp-subgrowth-biz-folders-empty-state-user"],expBizOnboardingTriggerFolderRwl:this.props["exp-subgrowth-biz-onboarding-trigger-folder-rwl"],expSubgrowthBizTeamHomeContent:this.props["exp-subgrowth-biz-team-home-content"],expSubgrowthProNearquotaUploadModal:this.props["exp-subgrowth-pro-nearquota-upload-modal"],expRetrievalSearchGridEnabled:this.props["exp-retrieval-search-grid-enabled"]})},P})(o.Component);t.BrowseApp=Q}),define("modules/clean/react/browse/browse_drag_and_drop",["require","exports","jquery","modules/clean/react/browse/models"],function(e,t,r,o){"use strict";function s(e,t,o,s,n,i,a){r(document).on("dragenter."+e,function(e){(t()||o())&&!r(e.target).closest(n).length&&i()&&(a(null),s())})}function n(e){r(document).off("dragenter."+e)}function i(e,t,r,s,n,i,a,l){if(t||r){if(e.is_dir&&!(s&&r)){if(n)return;var c=i.isCurrentPathWriteable()&&!o.File.isReadOnlySharedFolder(e);a(e),l({path:e.fq_path,hasPermissionToUploadToFolder:c})}else a(null),l()}}Object.defineProperty(t,"__esModule",{value:!0}),t.setupExternalDragHandler=s,t.cleanupExternalDragHandler=n,t.onFileDragEnterItem=i}),define("modules/clean/react/browse/browse_location",["require","exports","tslib","external/classnames","external/immutable","external/spectrum/icon_arrow","external/react","external/react-dom","jquery","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/actions","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/sharing/browse_exports","modules/clean/user_education/user_education_client","modules/clean/viewer","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S,w){"use strict";function b(e,t){return t?_.GoldenGate.hasContentManagerCdm(e.id)?w._("Content"):w._("Team folders"):u.filename("",S.get_root_name(e))}function v(e,t){return 20-(t?2.625:new d(e).length)}function y(e,t,r){for(var o=b(e,r),s=t.split("/").filter(Boolean),n=[{path:"",folderName:o,icon:"work"===e.role?"work_icon":"personal_icon",alt:"work"===e.role?w._("Work"):w._("Personal")}],i=0;i<s.length;i++)t="/"+s.slice(0,i+1).join("/"),n.push({path:t,folderName:u.filename(t),icon:"folder_32",alt:w._("Folder")});if(n.length<3)return{dropdownCrumbs:[],inlineCrumbs:n,root:n[0]};for(var a=n[0]&&n[0].folderName||"",l=v(a,!1),c=n.map(function(e){return new d(e.folderName||"").length}),p=1,h=c[n.length-1],i=n.length-2;i>=1&&(h+=1.64,h+=c[i],!(h>l));i--)p+=1;n.length===p+1&&(p+=1);var m=n.length-p;return{dropdownCrumbs:n.slice(0,m),inlineCrumbs:n.slice(m),root:n[0]}}Object.defineProperty(t,"__esModule",{value:!0});t.generateBreadcrumbData=y;var T=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.path,o=this.props,s=o.user,n=o.isBrowseInContentManager,a=this.props,l=a.isDraggingInternalFiles,c=a.shouldHighlightDropTargets,d=a.setFileUploaderPath,p=y(s,t,n),h=p.dropdownCrumbs,m=p.inlineCrumbs,f=p.root,_=v(f&&f.folderName||"",h.length>0),g="page-header-text u-l-fl";return m.length>1||h.length>0?i.createElement("span",null,i.createElement("h1",{className:"ax-visually-hidden"},u.filename(t)),i.createElement("nav",{className:g,id:"browse-location","aria-label":w._("Folder hierarchy"),role:"navigation"},h.length>0&&i.createElement(I,{crumbs:h,currentPath:t,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:l,shouldHighlightDropTargets:c,setFileUploaderPath:d}),m.map(function(o,n){return i.createElement(E,r.__assign({},o,{key:encodeURI(o.path),user:s,isOnlyCrumb:0===n&&1===m.length&&0===h.length,isLastCrumb:n===m.length-1,maxWidth:_,currentPath:t,selectedFiles:e.props.selectedFiles,isDraggingInternalFiles:l,isHighlightedDropTarget:c,setFileUploaderPath:d}))}))):i.createElement("h1",{className:g},b(s,n))},t})(i.PureComponent);T.defaultProps={path:"/",selectedFiles:s.OrderedMap(),isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1,isBrowseInContentManager:!1,setFileUploaderPath:function(){}},t.BrowseLocation=T;var F=function(){return i.createElement("span",null,i.createElement(m,{group:"web",name:"chevron",
className:"breadcrumb__spacer",alt:""}))},E=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isDraggedOver:!1},t.handleMouseEnter=function(){t.props.isDraggingInternalFiles&&t.setState({isDraggedOver:!0})},t.handleMouseLeave=function(){t.state.isDraggedOver&&t.setState({isDraggedOver:!1})},t.handleMouseUp=function(){t.state.isDraggedOver&&t.setState({isDraggedOver:!1})},t.navigateToFolder=function(e){var r=t.props.path;g.UEClient.sendEvent("BreadCrumbSegment","linkClicked",{path:r}),e.preventDefault(),p.browseActions.setUrl({path:r})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this,t=0,r=null;l(a.findDOMNode(this)).on("dragenter.breadcrumb",function(o){o.preventDefault(),o.target!==r&&(r=o.target,t+=1,e.setState({isDraggedOver:!0}),e.props.isLastCrumb||e.props.setFileUploaderPath({path:e.props.path}))}).on("dragleave.breadcrumb",function(o){o.preventDefault(),r=null,t-=1,t<1&&(t=0,e.state.isDraggedOver&&(e.props.setFileUploaderPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})))}).on("drop.breadcrumb",function(){e.setState({isDraggedOver:!1})}).on("dragover.breadcrumb",function(e){e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumb",this.handleMouseEnter).on("mouseleave.breadcrumb",this.handleMouseLeave).on("mouseup.breadcrumb",this.handleMouseUp)},t.prototype.componentWillUnmount=function(){l(a.findDOMNode(this)).off(".breadcrumb")},t.prototype.render=function(){var e=this.props,t=e.user,r=e.path,s=e.isOnlyCrumb,a=e.maxWidth,l=e.isLastCrumb,u=e.isHighlightedDropTarget,p=s?this.props.folderName:d.em_snippet(this.props.folderName,a),h={"breadcrumb-segment":!0,"breadcrumb-segment--is-drop-target":!l&&u,"breadcrumb-segment--file-dragged-over":!l&&this.state.isDraggedOver};return l?i.createElement("span",null,p):i.createElement("span",{className:"breadcrumb-segment__wrapper"},i.createElement(g.UserEducationEffect,{containerName:"BreadCrumbSegment",name:"link-"+r,useSpan:!0},i.createElement("a",{href:c.browse_uri_for_fq_path(t,r).toString(),onClick:this.navigateToFolder,className:o(h)},p)),i.createElement(n.IconArrow,{name:"right"}))},t})(i.Component);E.defaultProps={isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,selectedFiles:s.OrderedMap()};var C=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isDraggedOver:!1},t.handleMouseEnter=function(){t.props.isDraggingInternalFiles&&t.setState({isDraggedOver:!0})},t.handleMouseLeave=function(){t.state.isDraggedOver&&t.setState({isDraggedOver:!1})},t.handleMouseUp=function(){t.state.isDraggedOver&&t.setState({isDraggedOver:!1}),t.props.isDraggingInternalFiles&&!t.props.isLastCrumb&&t.props.closeFunc()},t.handleCrumbClick=function(e){e.preventDefault(),p.browseActions.setUrl({path:t.props.path})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this,t=0,r=null;l(a.findDOMNode(this)).on("dragenter.breadcrumbMenuItem",function(o){o.preventDefault(),o.target!==r&&(r=o.target,t+=1,e.setState({isDraggedOver:!0}),e.props.setFileUploaderPath({path:e.props.path}))}).on("dragleave.breadcrumbMenuItem",function(o){o.preventDefault(),r=null,t-=1,t<1&&(t=0,e.state.isDraggedOver&&(e.props.setFileUploaderPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})))}).on("drop.breadcrumbMenuItem",function(t){e.setState({isDraggedOver:!1})}).on("dragover.breadcrumbMenuItem",function(e){e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumbMenuItem",this.handleMouseEnter).on("mouseleave.breadcrumbMenuItem",this.handleMouseLeave).on("mouseup.breadcrumbMenuItem",this.handleMouseUp)},t.prototype.componentWillUnmount=function(){l(a.findDOMNode(this)).off(".breadcrumbMenuItem")},t.prototype.render=function(){var e=this.props,t=e.closeFunc,r=e.icon,s=e.alt,n=e.folderName,a={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver};return i.createElement(h.BubbleMenuItem,{onClick:this.handleCrumbClick,closeFunc:t,className:o(a)},i.createElement("span",{className:"force-no-break"},i.createElement(f,{group:"web",name:r,alt:s,text:d.em_snippet(n,37)})))},t})(i.Component);C.defaultProps={isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,selectedFiles:s.OrderedMap()};var I=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;l(a.findDOMNode(this)).on("dragenter.breadcrumbDropdown",function(t){t.preventDefault(),e.refs.bubbleMenu.showMenu()}).on("mouseenter.breadcrumbDropdown",function(t){e.props.isDraggingInternalFiles&&(t.preventDefault(),e.refs.bubbleMenu.showMenu())})},t.prototype.componentWillUnmount=function(){l(a.findDOMNode(this)).off(".breadcrumbDropdown")},t.prototype.render=function(){var e=this.props.crumbs.slice().reverse(),t=this.props,r=t.currentPath,o=t.shouldHighlightDropTargets,s=t.isDraggingInternalFiles,n=t.selectedFiles,a=t.setFileUploaderPath;return i.createElement("span",{className:"breadcrumb-dropdown-container"},i.createElement(h.BubbleMenu,{ref:"bubbleMenu",position:h.BubbleMenu.POSITIONS.BOTTOM_RIGHT,targetButton:i.createElement("button",{className:"u-unbutton breadcrumb-overflow-button u-l-fl"},i.createElement(m,{group:"web",name:"folder_arrow_32",alt:w._("Show parent folders (descending)")})),items:e.map(function(e){return i.createElement(C,{key:encodeURI(e.path),path:e.path,icon:e.icon,alt:e.alt,folderName:e.folderName,currentPath:r,isHighlightedDropTarget:o,isDraggingInternalFiles:s,selectedFiles:n,setFileUploaderPath:a})}),targetFixed:!0}),i.createElement(F,null))},t})(i.Component);I.defaultProps={shouldHighlightDropTargets:!1,selectedFiles:s.OrderedMap(),isDraggingInternalFiles:!1}}),define("modules/clean/react/browse/browse_view",["require","exports","tslib","external/immutable","external/react","modules/clean/react/app_actions_view","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/browse_location","modules/clean/react/browse/constants","modules/clean/react/browse/file_actions","modules/clean/react/browse/global_actions","modules/clean/react/browse/files_view/controller","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/browse/util","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader","modules/clean/react/maestro/layout","modules/clean/search/search_helpers","modules/clean/search/search_results/controller","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/constants/python","modules/constants/subgrowth_experiments","modules/core/browser","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S,w,b,v,y,T,F,E,C,I,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var D=i.BrowseLogEventSources,R=[y.NameSpaceAccess.ACCESS_NO_ACCESS,y.NameSpaceAccess.ACCESS_READER,y.NameSpaceAccess.ACCESS_READER_NO_COMMENT],N=(function(t){function o(e){var o=t.call(this,e)||this;return o.handleShowFileUploader=function(){g.FileUploaderController.setPath(o.props.path),g.FileUploaderController.showModal()},o.handleSelectionChange=function(e){var t=m.browseStore.getFileByFullPath(e.selected.first());t&&i.logSelectRow({uid:o.props.user.id,entity_type:t.is_dir?"folder":"file"}),a.browseActions.setSelection({selection:e})},o.handleFileListSortChange=function(e,t){i.logSortRecords({uid:o.props.user.id,sort_by:e,sort_direction:t}),a.browseActions.sortFiles({sortField:e,sortDirection:t})},o.handleSearchFromSearchBar=function(e){e?o.props.onSearch(e,o.props.path,!0):o.handleCancelSearch()},o.handleCancelSearch=function(){a.browseActions.setUrl({path:o.props.path})},o.handleSearchResultOpen=function(e){e instanceof h.File?e.is_unmounted?v.asyncShowSharedContentLinkSyncModal(o.props.user,e):(w.logSearchAction({result:e,user:o.props.user,action_type:e.is_dir?"folder_open":"file_view",viewport:"dropdown-view"}),a.browseActions.navigateToFileOrFolder({file:e,fileViewAction:E.FileViewActionType.SEARCH})):e instanceof h.Paper&&(w.logSearchAction({result:e,user:o.props.user,action_type:"paper_open",viewport:"dropdown-view"}),I.open_tab(e.url))},o.setFilesViewControllerRef=function(e){o.filesViewControllerRef=e},o.handleFullSearch=function(e){o.props.onSearch(e,"/",!1)},o.handleAllFileUploadsComplete=function(e){e.find(function(e){return e.errorType===_.UploadErrorTypes.OVER_QUOTA_ERROR})&&g.FileUploaderController.showModal("out-of-quota")},o.renderSideBar=function(e){return s.createElement("div",{className:"maestro-browse-action-sidebar"},o.maybeRenderBrowseFileUploader(),s.createElement(n.AppActionsView,r.__assign({},o.state.appActionsProps,{responsive:e})))},o.renderAppContent=function(e){return s.createElement("div",{className:"maestro-browse-app-content"},o.renderBrowseItemList(e))},o.state={currentMultiColumnSortField:c.BrowseSortFields.SHARED_WITH,appActionsProps:o.getCurrentAppActionsProps(o.props),viewType:null,expHasSeenNewFolderModal:null},o}return r.__extends(o,t),o.prototype.componentWillReceiveProps=function(e){e.selectedFiles===this.props.selectedFiles&&e.context===this.props.context&&e.user===this.props.user&&e.shouldShowDeletedFiles===this.props.shouldShowDeletedFiles&&e.isNoComment===this.props.isNoComment&&e.isSharedWithLoaded===this.props.isSharedWithLoaded&&e.viewType===this.props.viewType&&e.starredState===this.props.starredState&&e.isSearchMode===this.props.isSearchMode||this.setState({appActionsProps:this.getCurrentAppActionsProps(e)})},o.prototype.componentDidMount=function(){var e=this;F.waitForTTI().then(function(){e.defineFileUploader(),e.maybeOpenUploaderOnMount()}),T.UEClient.sendEvent("BrowseView","componentDidMount",this.props.context.toJSON())},o.prototype.componentDidUpdate=function(){this.props.loadingState===c.LoadingStates.LOADED&&T.UEClient.sendEvent("BrowseView","componentDidUpdate",this.props.context.toJSON())},o.prototype.maybeOpenUploaderOnMount=function(){this.props.shouldOpenUploadModal&&this.handleShowFileUploader()},o.prototype.getCurrentDropTargetHighlightMode=function(){var e=this.props.selectedFiles,t=this.props.context;return t.isInsideSharedFolder&&R.includes(t.currentSharedFolderPermissionRole)?c.DropTargetHighlightMode.NONE:this.props.isDraggingInternalFiles?e.some(function(e){return e.isDeleted||e.type===c.FileTypes.TEAM_SHARED_FOLDER})?c.DropTargetHighlightMode.NONE:e.some(function(e){return e.type===c.FileTypes.SHARED_FOLDER})?t.currentNSAllowsNesting?c.DropTargetHighlightMode.NONSELECTED_FOLDERS:c.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:c.DropTargetHighlightMode.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?c.DropTargetHighlightMode.ALL_FOLDERS:c.DropTargetHighlightMode.NONE},o.prototype.getCurrentAppActionsProps=function(t){var r,o=this,n=t.selectedFiles,i=f.getSelectedFilesText(n,t.context),a=n.count(),l=s.createElement("div",null);if(a>0)r=d.getActionsForFileCollection({files:n,context:t.context,user:t.user,skipSharing:!1,actionHandlers:t.actionHandlers,source:D.MAESTRO_RIGHT_SIDEBAR,isUnityLoaded:t.isUnityLoaded,isSearchMode:t.isSearchMode,isStarredLoaded:t.isStarredLoaded,isOverFreeQuota:t.isOverFreeQuota,isQueryingFolderSizes:t.isQueryingFolderSizes}),1===a&&(l=this.renderSingleSelectionAudienceBox(t));else{var c;if(t.expBizOnboardingTriggerFolderRwl&&this.state&&null===this.state.expHasSeenNewFolderModal&&(this.setState({expHasSeenNewFolderModal:!1}),c={isActive:t.expBizOnboardingTriggerFolderRwl,hasSeenNewFolderModal:!1,hasSeenNewFolderModalCallback:function(){o.setState({expHasSeenNewFolderModal:!0}),c&&(c.hasSeenNewFolderModal=!0)}}),r=u.getGlobalActions({context:t.context,user:t.user,showDeletedFiles:t.shouldShowDeletedFiles,onFileUpload:this.handleShowFileUploader,isContextMenu:!1,isNoComment:this.props.isNoComment,experiments:{expBizOnboardingTriggerFolderRwl:c}}),t.isSharedWithLoaded){var p=e("modules/clean/react/browse/shared_with").SharedWithController;l=s.createElement(p,{browseContext:t.context,tabIndex:-1,isInAudienceBox:!0})}}var h=r.map(function(e){return{displayName:e.label,iconName:e.iconName,spriteName:e.iconName?null:e.spriteName,handleClick:e.performAction,disabled:e.disabled,className:e.className}});return t.isNoComment&&(l=s.createElement("div",null)),{headerText:i,popoverTriggerLabel:A._("Actions"),primaryMenuItem:h[0],primarySubnode:l,secondaryMenuItems:h.slice(1),handleComponentTTI:t.handleComponentTTI}},o.prototype.getFilesViewControllerRef=function(){return this.filesViewControllerRef},o.prototype.shouldShowPinnedTeamFolder=function(){if(this.isSubgrowthPinnedExp()&&("/"!==this.props.path||this.props.viewType!==c.ViewTypes.List))return!1;var e=this.props.loadingState===c.LoadingStates.LOADED;return this.props.context.showPinnedTeamFolder&&!this.props.teamFolders.isEmpty()&&e},o.prototype.isSubgrowthPinnedExp=function(){return"ON"===C.SUBGROWTH_BIZ_TRIAL_ONBOARDING_EXP1||["V1","V2"].includes(C.SUBGROWTH_BIZ_TRIAL_ONBOARDING_EXP2)},o.prototype.renderBrowseItemList=function(e){var t=this.shouldShowPinnedTeamFolder(),r=t?this.props.filesWithoutTeamFolders:this.props.files;return s.createElement(p.FilesViewController,{actionHandlers:this.props.actionHandlers,activeDropTarget:this.props.activeDropTarget,context:this.props.context,createNewFolderState:this.props.createNewFolderState,currentSort:this.props.currentSort,dropTargetHighlightMode:this.getCurrentDropTargetHighlightMode(),fileRename:this.props.fileRename,files:r,responsive:e,expBizFoldersEmptyStateAdmin:this.props.expBizFoldersEmptyStateAdmin,expBizFoldersEmptyStateUser:this.props.expBizFoldersEmptyStateUser,getIsFileJumping:this.props.getIsFileJumping,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isFileViewerShown:this.props.isFileViewerShown,isOverFreeQuota:this.props.isOverFreeQuota,isSubgrowthPinnedExp:t&&this.isSubgrowthPinnedExp(),numTeamFolders:this.props.teamFolders.size,isSharedWithLoaded:this.props.isSharedWithLoaded,isStarredLoaded:this.props.isStarredLoaded,isTextSelectable:this.props.isTextSelectable,isUnityLoaded:this.props.isUnityLoaded,loadingState:this.props.loadingState,onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.handleSelectionChange,onSortChange:this.handleFileListSortChange,path:this.props.path,ref:this.setFilesViewControllerRef,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:g.FileUploaderController.setPathAndPermissions,shouldShowPinnedTeamFolders:t,showFileUploaderModal:this.handleShowFileUploader,teamFolders:this.props.teamFolders,totalNumFiles:this.props.totalNumItems,user:this.props.user,viewType:this.props.viewType,isQueryingFolderSizes:this.props.isQueryingFolderSizes,isViewTypeSwitchingEnabled:!0})},o.prototype.defineFileUploader=function(){g.FileUploaderController.loadCoreComponent()},o.prototype.maybeRenderBrowseFileUploader=function(){var e=this.props,t=e.user,r=e.context;return t&&null!=r.currentFQPath?s.createElement(g.FileUploaderController,{key:"file-uploader-controller",ref:"fileUploader",loadOnRender:!1,needToSetStoreValues:!1,onAllFileUploadsComplete:this.handleAllFileUploadsComplete,expSubgrowthProNearquotaUploadModal:this.props.expSubgrowthProNearquotaUploadModal}):null},o.prototype.renderSingleSelectionAudienceBox=function(e){var t=e.selectedFiles.first();return e.isSharedWithLoaded?this.renderAudienceBox(e,t):null},o.prototype.renderAudienceBox=function(t,r){var o=e("modules/clean/react/browse/shared_with").SharedWithController;return s.createElement(o,{file:r,browseContext:t.context,tabIndex:-1,isInAudienceBox:!0})},o.prototype.renderBrowseLocation=function(){var e=this.props.path;if(e){var t=e.split("/"),r=t.length;document.title="/"!==e?A._("%(folder_name)s - Dropbox").format({folder_name:e.split("/")[r-1]}):A._("Files - Dropbox")}var o=this.props,n=o.isDraggingInternalFiles,i=o.isDraggingExternalFiles,a=o.isUploadModalOpen;return s.createElement(l.BrowseLocation,{path:this.props.path,user:this.props.user,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:n,setFileUploaderPath:g.FileUploaderController.setPathAndPermissions,shouldHighlightDropTargets:n||i&&!a})},o.prototype.renderBrowse=function(){var e=this.props.user;return s.createElement(S.MaestroChrome,{user:e,titleRegion:this.renderBrowseLocation(),embeddedAppRegion:this.renderAppContent,actionSidebarRegion:this.renderSideBar,searchBarProps:this.getSearchBarProps()})},o.prototype.renderSearchResults=function(){var e=this.props,t=e.actionHandlers,r=e.fileRename,o=e.path,n=e.user,i=e.handleComponentTTI,a=e.isFileViewerShown,l=e.ensureFileViewerClosedIfNotPreviewing;return s.createElement(b.SearchResultsController,{actionHandlers:t,path:o,user:n,onFullSearch:this.handleFullSearch,setFileUploaderPath:g.FileUploaderController.setPathAndPermissions,maestroSearchBarProps:this.getSearchBarProps(),handleComponentTTI:i,ensureFileViewerClosedIfNotPreviewing:l,getIsFileJumping:this.props.getIsFileJumping,isFileViewerShown:a,fileRename:r,isStarredLoaded:this.props.isStarredLoaded,expRetrievalSearchGridEnabled:this.props.expRetrievalSearchGridEnabled})},o.prototype.getSearchBarProps=function(){return{showSearchBar:!0,currentPath:this.props.path,onSearch:this.handleSearchFromSearchBar,onCancelSearch:this.handleCancelSearch,onSearchResultOpen:this.handleSearchResultOpen,isSearchBarExpanded:this.props.isSearchMode}},o.prototype.render=function(){return this.props.isSearchMode?this.renderSearchResults():this.renderBrowse()},o})(s.PureComponent);N.defaultProps={selectedFiles:o.OrderedMap(),viewType:c.ViewTypes.List},t.BrowseView=N}),define("modules/clean/react/browse/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseDispatcher=r}),define("modules/clean/react/browse/empty_folder_display_props",["require","exports","external/classnames","modules/clean/static_urls","modules/constants/python","modules/core/i18n"],function(e,t,r,o,s,n){"use strict";function i(e){return r({"exp-subgrowth-biz-folders-empty-state-admin":e.expBizFoldersEmptyStateAdmin,"exp-subgrowth-biz-folders-empty-state-user":e.expBizFoldersEmptyStateUser})}function a(e){if(e.expBizFoldersEmptyStateUser||e.expBizFoldersEmptyStateAdmin)return e.isInsideTeamFolderTree?"/help/986":e.isInsideSharedFolder?"/help/19":"/help/140"}function l(e){if(e.expBizFoldersEmptyStateUser||e.expBizFoldersEmptyStateAdmin)return e.isInsideTeamFolderTree?n._("team folder."):e.isInsideSharedFolder?n._("shared folder."):n._("private folder.")}function c(e){if(e.expBizFoldersEmptyStateUser||e.expBizFoldersEmptyStateAdmin){if(!e.isInsideTeamFolderTree)return e.isInsideSharedFolder?o.static_url("/static/images/empty_states/shared_folder-vfluMX_ZB.svg"):o.static_url("/static/images/empty_states/private_folder-vfl9oQu0u.svg");if(e.expBizFoldersEmptyStateUser)return o.static_url("/static/images/empty_states/team_folder_users-vfl43jKCj.svg");if(e.expBizFoldersEmptyStateAdmin)return o.static_url("/static/images/empty_states/team_folder_admins-vflvhP--E.svg")}}function d(e){if(e.expBizFoldersEmptyStateUser||e.expBizFoldersEmptyStateAdmin)return c(e)}function u(e){if(e.expBizFoldersEmptyStateUser||e.expBizFoldersEmptyStateAdmin){if(!e.isInsideTeamFolderTree)return e.isInsideSharedFolder?n._("Changes to the contents of a shared folder are synced to everyone who has access to the shared folder. People with access can edit, view and comment on files. To add contents to this folder, drag and drop files onto this window."):n._("Private folders are not shared with anybody; only you can see the contents in a private folder. To add contents to this folder, drag and drop files onto this window.");if(e.expBizFoldersEmptyStateUser)return n._("Contents added to this team folder will be synced to everyone who has been granted permission to access it. Team folder permissions and settings are managed by your %(trademark_business)s team admin.").format({trademark_business:s.TRADEMARK_BUSINESS});if(e.expBizFoldersEmptyStateAdmin)return n._("Contents added to this team folder will be synced to everyone who has been granted permission to access it. You can manage permissions for this team folder in the Team Folder tab in the Admin Console.")}}function p(e){if(e.expBizFoldersEmptyStateUser||e.expBizFoldersEmptyStateAdmin)return e.isInsideTeamFolderTree?n._("This is a team folder."):e.isInsideSharedFolder?n._("This is a shared folder."):n._("This is a private folder.")}function h(e){return{className:i(e),helpLink:a(e),imgAlt:l(e),imgSrc:c(e),imgSrcHiRes:d(e),folderInfo:u(e),tagline:p(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.getEmptyFolderDisplayProps=h}),define("modules/clean/react/browse/file_actions",["require","exports","tslib","external/underscore","modules/clean/ajax","modules/clean/analytics","modules/clean/browse_interface","modules/clean/filepath","modules/clean/file_actions","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/home/home_access/home_access_util","modules/clean/search/search_helpers","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/react/browse/professional_collection_actions","modules/clean/user_education/user_education_client","modules/clean/viewer","modules/constants/browse","modules/clean/react/browse/store","modules/constants/python","modules/constants/starred","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S,w,b,v,y,T,F,E,C,I){"use strict";function A(e,t){return t?e.isDeleted||e.is_unmounted:e.isDeleted}function D(e){var t=e.toArray().map(function(e){return e.fq_path});return a.inSameDirectory(t)}function R(e){var t=e.user,o=e.context,s=e.files,n=e.isPhotosPage,i=void 0!==n&&n,a=e.isSearchMode,l=void 0!==a&&a,c=e.isUnityLoaded,d=void 0!==c&&c,u=e.isStarredLoaded,p=void 0!==u&&u,h=e.isQueryingFolderSizes,m=r.__assign({},U);if(o.isInsideArchivedTeamFolder)return m.showDownload=!0,m;var f=!o.isNonUserRelativeContext,_=s.every(function(e){return!A(e,f)}),g=!_&&s.every(function(e){return A(e,f)});return _?N({actions:m,files:s,context:o,user:t,isPhotosPage:i,isUnityLoaded:d,isStarredLoaded:p,isSearchMode:l,isQueryingFolderSizes:h}):g?P({actions:m,files:s,context:o,user:t}):m}function N(t){var r,o=t.actions,s=t.files,n=t.context,i=t.user,a=t.isPhotosPage,l=void 0!==a&&a,c=t.isUnityLoaded,d=void 0!==c&&c,u=t.isStarredLoaded,h=void 0!==u&&u,f=t.isQueryingFolderSizes,g=t.isSearchMode,S=void 0!==g&&g,w=1===s.count(),b=w&&!s.first().is_dir,y=w&&s.first().is_dir,T=s.every(function(e){return e.type===p.FileTypes.FILE}),E=s.some(function(e){return e.type===p.FileTypes.TEAM_SHARED_FOLDER}),C=s.some(function(e){return e.type===p.FileTypes.TEAM_SHARED_FOLDER&&"archived"===e.team_folder_status}),I=s.some(function(e){return e.type===p.FileTypes.TEAM_SHARED_FOLDER&&"archive_in_progress"===e.team_folder_status}),A=s.some(function(e){return e.type===p.FileTypes.TEAM_MEMBER_FOLDER}),R=!1;if(o.showCopy=!E&&!A&&!l,E||A||(o.showDelete=!l,o.showRename=w&&!l,o.showMove=!l),E&&y&&i&&_.GoldenGate.hasContentManagerAndSuperAdmin(i.id)&&(o.showRenameTeamFolder=!0,o.showArchive=!0),i&&i.is_team_admin&&_.GoldenGate.hasContentManagerAndSuperAdmin(i.id)&&w&&E&&(C&&(o.showUnarchive=!0,o.showRenameArchivedTeamFolder=!0,o.showPermanentDeleteTeamFolder=!0),I&&(o.showArchiveInProgress=!0)),i&&_.GoldenGate.hasContentManagerAndSuperAdmin(i.id)&&_.GoldenGate.hasNewOwnershipModel(i.id)&&n.isInsideTeamFolderTree&&!n.isNonUserRelativeContext&&(o.showManageAsAdmin=!0),w){var N=s.first();if(r=_.shouldUsePublicFolderSharing(n.config,N.fq_path),r||A||n.isNonUserRelativeContext&&(I||C)||(o.showTiburonShare=!0),d){var P=e("modules/clean/unity/features"),L=e("modules/clean/unity/check_file_cache");R=null!=P&&null!=L&&L.is_cached_and_locally_available(N.ns_id,N.ns_path),R&&(o.showOpen=!0)}}if(o.showShowInFolder=(l||S)&&D(s),b&&(n.isNonUserRelativeContext?o.showActivity=!0:o.showComment=!0,o.showVersions=!0,n.isInFolderMode?o.showCopyPublicFolderFileLink=!!r:o.showCopyPublicFolderFileLink=!1),R||E&&n.isNonUserRelativeContext||(o.showDownload=n.isInFolderMode||b||l||S),T&&n.isCurrentPathWriteable()&&v.PROFESSIONAL_COLLECTION_MAESTRO.forEach(function(e){e.uid===i.id&&e.rule&&(o.showProfessionalCollectionShare=!0)}),w&&!n.isNonUserRelativeContext){var x=s.first().type;x!==p.FileTypes.SHARED_FOLDER&&x!==p.FileTypes.TEAM_SHARED_FOLDER||n.isNonUserRelativeContext&&(I||C)||(o.showSharedFolderEvents=!0),v.BROWSE_GET_FOLDER_SIZES&&y&&!l&&null==s.first().fetchFolderSizesStatus&&!f&&(o.showCalculateFolderSize=!0)}if(w&&m.isHomeEnabled()&&h){var O=e("modules/clean/react/starred/browse_exports").StarredStore,M={id:s.first().file_id,type:F.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID},U=O.getIsLoading(M),k=O.getIsStarred(M);o.showStar=k===!1,o.showUnstar=k===!0,o.showLoadingStar=U}return o}function P(e){var t=e.actions,r=e.files,o=e.context,s=e.user;if(r.some(function(e){return e.is_unmounted}))return t;var n,i,a=1===r.count()&&r.first().is_dir;a?(i=r.first(),n=!!o.inactiveNSIDByFQPath[i.fq_path.toLowerCase()]):n=!1,n?t.showReadd=!0:t.showRestore=!0;var l;if(o.isNonUserRelativeContext)l=!1;else if(o.isInFolderMode)l=o.permanentDeletionDisabledStateByNSID[o.currentNSID];else{var c=r.map(function(e){return e.ns_id});l=c.some(function(e){return o.permanentDeletionDisabledStateByNSID[e]})}return s&&_.GoldenGate.hasContentManagerAndSuperAdmin(s.id)&&_.GoldenGate.hasNewOwnershipModel(s.id)&&o.isInsideTeamFolderTree&&!o.isNonUserRelativeContext&&(t.showManageAsAdmin=!0),l||(n?t.showRemoveAccess=!0:t.showPermanentDelete=!0),o.isNonUserRelativeContext&&(t.showRemoveAccess=!1,t.showReadd=!1,(r.count()>1||a)&&(t.showRestore=!1),r.count()>1&&(t.showPermanentDelete=!1)),t}function L(e,t){var r=t.user,o=t.context,n=t.actionHandlers,i=t.firstFile,l=t.isSearchMode;if(o.isNonUserRelativeContext)n.onManage&&n.onManage(i);else if(l&&f.logSearchAction({result:i,user:r,action_type:"share",view_type:y.browseStore.viewType()}),e.autoShareLink){var c=new I({path:"/sm/create"+a.normalize(i.fq_path)});c.updateQuery("_subject_uid",r.id.toString()),c.updateQuery("redirect","0");var d=function(e){E.redirect(e)};s.WebRequest({url:c.toString(),type:"POST",success:d})}else _.asyncShowShareModal(r,i,{browseContext:o,origin:g.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS})}function x(e){var t=e.files,r=e.context,o=e.user,s=e.actionHandlers,n=e.skipSharing,i=void 0!==n&&n,a=e.source,l=e.isOverFreeQuota,c=void 0!==l&&l,d=e.isPhotosPage,u=void 0!==d&&d,p=e.isSearchMode,m=void 0!==p&&p,f=e.isUnityLoaded,_=void 0!==f&&f,g=e.isStarredLoaded,S=void 0!==g&&g,w=e.isQueryingFolderSizes,b=t.first(),v=!r.isCurrentPathWriteable()||t.some(function(e){return e.read_only}),y=v,T=v,F=v,E=v,I=t.some(function(e){return!h.File.canViewFileMembers(e,r)}),A=I,D=I,N=t.every(h.File.isNoAccessSharedFolder),P=N,L=N,x=N,O=R({files:t,context:r,user:o,isUnityLoaded:_,isPhotosPage:u,isQueryingFolderSizes:w,isSearchMode:m,isStarredLoaded:S}),M=[],U={user:o,context:r,actionHandlers:s,files:t,firstFile:b,isSearchMode:m,source:a};if(!i&&O.showTiburonShare){var pe=A;M.push({label:r.isNonUserRelativeContext?C._("Manage"):C._("Share"),spriteName:"s_rainbow",iconName:"link",performAction:B(U),disabled:pe,className:"action-share"}),r.isNonUserRelativeContext||M.push({label:C._("Share link"),performAction:q(U),disabled:pe,className:"action-share-link",iconName:"link"})}if(O.showCopyPublicFolderFileLink&&M.push({label:C._("Copy public link"),spriteName:"world_link",className:"action-world-link",performAction:V(U)}),O.showOpen&&M.push({label:C._("Open"),performAction:G(U),iconName:"open-in-app",className:"action-open-in-app"}),O.showShowInFolder&&M.push({label:C._("Show in folder"),performAction:k(U),iconName:"open-in-app",className:"action-show-in-folder"}),O.showDownload&&M.push({label:C._("Download"),performAction:z(U),disabled:P,iconName:"download",className:"action-download"}),O.showProfessionalCollectionShare&&M.push({label:C._("Add to collection"),iconName:"add-to-collection",performAction:H(U),className:"action-add-to-collection"}),O.showComment&&M.push({label:C._("Add comment"),performAction:W(U),iconName:"add-comment",className:"action-add-comment"}),O.showStar&&M.push({label:C._("Star",{comment:'Verb describing the "starring" action, not the noun.'}),performAction:j({isStarred:!0,args:U}),disabled:O.showLoadingStar,iconName:"star",className:"action-star"}),O.showUnstar&&M.push({label:C._("Unstar",{comment:'Verb describing the "unstarring" action.'}),performAction:j({isStarred:!1,args:U}),disabled:O.showLoadingStar,iconName:"unstar",className:"action-unstar"}),O.showVersions&&M.push({label:C._("Version history"),performAction:ne(U),iconName:"view-version-history",className:"action-view-version-history"}),O.showUnarchive&&M.push({label:C._("Restore"),spriteName:"restore",className:"action-restore",performAction:Z(U)}),O.showPermanentDeleteTeamFolder&&M.push({label:C._("Permanently delete"),spriteName:"cancel",className:"action-cancel",performAction:X(U)}),O.showArchiveInProgress&&M.push({label:C._("Archive in progress"),performAction:$(U)}),O.showRename&&M.push({label:C._("Rename"),performAction:K(U),iconName:"rename",className:"action-rename",disabled:T}),O.showRenameTeamFolder&&M.push({label:C._("Rename"),performAction:Q(U),iconName:"rename",className:"action-rename"}),O.showRenameArchivedTeamFolder&&M.push({label:C._("Rename"),performAction:J(U),iconName:"rename",className:"action-rename"}),O.showArchive&&M.push({label:C._("Archive"),performAction:Y(U),iconName:"delete",className:"action-delete"}),O.showMove){var he=c?re():ee(U);M.push({label:C._("Move"),performAction:he,disabled:F,iconName:"move",className:"action-move"})}if(O.showCopy){var me=c?re():te(U);M.push({label:C._("Copy"),performAction:me,disabled:L,iconName:"copy",className:"action-copy"})}return O.showDelete&&M.push({label:C._("Delete"),performAction:ae(U),disabled:y,iconName:"delete",className:"action-delete"}),O.showRestore&&M.push({label:C._("Restore"),spriteName:"restore",className:"action-restore",performAction:oe(U),disabled:E}),O.showReadd&&M.push({label:C._("Re-add shared folder"),spriteName:"restore",className:"action-re-add",performAction:se(U),disabled:E}),O.showPermanentDelete&&M.push({label:C._("Permanently delete"),iconName:"delete",className:"action-permanently-delete",performAction:le(U)}),O.showActivity&&M.push({label:C._("View activity"),performAction:ie(U),iconName:"view-version-history",className:"action-view-version-history"}),O.showSharedFolderEvents&&M.push({label:C._("Events"),performAction:ce(U),disabled:D,iconName:"events",className:"action-events"}),O.showCalculateFolderSize&&M.push({label:C._("Calculate size"),performAction:de(U),disabled:x,iconName:"calculate",className:"action-calculate-folder-size"}),O.showManageAsAdmin&&M.push({label:C._("Manage as admin"),performAction:ue(U),iconName:"settings-gear"}),M}function O(e){var t=e.event,r=e.user,s=e.files,n=e.index,i=e.onFileViewerUnmount,a=e.source;d.logOpenRow({uid:r.id,entity_type:"file",source:a}),t.button>0||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey||(t.preventDefault(),t.stopPropagation(),u.browseActions.openPreviewForFiles({files:s,index:n,onFileViewerUnmount:i||o.noop,fileViewOrigin:T.FileViewOriginType.PHOTOS}))}function M(e){var t=e.event,r=e.user,o=e.file,s=e.isSearchMode,i=e.constructorDisplayName,a=e.onFileViewerUnmount,l=e.source;if(d.logOpenRow({uid:r.id,entity_type:o.is_dir?"folder":"file",source:l}),
!(t.button>0||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey))if(t.preventDefault(),t.stopPropagation(),o.type===p.FileTypes.TEAM_SHARED_FOLDER&&(w.UEClient.sendEvent(i,"TeamFolderClicked"),n.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:b.get_viewer().team_id})),s&&o.is_unmounted)f.logSearchAction({result:o,user:r,action_type:"unmounted_view",view_type:y.browseStore.viewType()}),_.asyncShowSharedContentLinkSyncModal(r,o);else{var c=T.FileViewActionType.CLICK;s&&(f.logSearchAction({result:o,user:r,action_type:o.is_dir?"folder_open":"file_view",view_type:y.browseStore.viewType()}),c=T.FileViewActionType.SEARCH),u.browseActions.navigateToFileOrFolder({file:o,onFileViewerUnmount:a,fileViewAction:c})}}Object.defineProperty(t,"__esModule",{value:!0});var U={showProfessionalCollectionShare:!1,showTiburonShare:!1,showCopyPublicFolderFileLink:!1,showOpen:!1,showDownload:!1,showComment:!1,showDelete:!1,showArchive:!1,showUnarchive:!1,showArchiveInProgress:!1,showRemove:!1,showRename:!1,showRenameTeamFolder:!1,showRenameArchivedTeamFolder:!1,showMove:!1,showCopy:!1,showVersions:!1,showRestore:!1,showReadd:!1,showPermanentDelete:!1,showPermanentDeleteTeamFolder:!1,showRemoveAccess:!1,showActivity:!1,showShowInFolder:!1,showStar:!1,showUnstar:!1,showLoadingStar:!1,showSharedFolderEvents:!1,showCalculateFolderSize:!1,showManageAsAdmin:!1},k=function(e){var t=e.user,r=e.files,o=e.isSearchMode,s=r.map(function(e){return e.fq_path}).toArray();return function(){var e=s.map(function(e){return a.filename(e)}),n=a.parent_dir(s[0]),l=i.browse_uri_for_fq_path(t,n);e.length>1?l.updateQuery({select_multi:JSON.stringify(e)}):l.updateQuery({select:e[0]}),o&&f.logSearchAction({result:r.first(),user:t,action_type:"show_in_folder",view_type:y.browseStore.viewType()}),window.open(l.toString(),"_blank")}},B=function(e){return function(){L({autoShareLink:!1},e)}},q=function(e){return function(){L({autoShareLink:!0},e)}},H=function(e){return function(){var t=e.user,r=e.files;if(r.count()>=1){var o=r.map(function(e){return{ns_id:e.ns_id,ns_path:e.ns_path}}).toArray();S.showAddToCollectionModal(o,t)}}},V=function(e){return function(){var t=e.user,r=e.context,o=e.firstFile;if(r.config&&o&&o.fq_path){var s=_.makePublicFolderLink(t.id,r.config,o.fq_path,o.is_dir);s&&_.showPublicFolderLinkModal(s)}}},G=function(t){return function(){var r=t.user,o=t.firstFile;t.isSearchMode&&f.logSearchAction({result:o,user:r,action_type:"open",view_type:y.browseStore.viewType()}),e(["modules/clean/unity/features"],function(e){return e.open_file(o.ns_id,o.ns_path,r.id,e.standard_open_file_handler,function(){return e.standard_open_file_handler(!1)})})}},z=function(e){return function(){var t=e.user,r=e.context,o=e.files,s=e.firstFile,n=e.isSearchMode,i=e.source;n&&f.logSearchAction({result:s,user:t,action_type:"download",view_type:y.browseStore.viewType()}),d.logDownload({uid:t.id,source:i}),u.browseActions.downloadFiles({files:o,context:r,user:t})}},W=function(e){return function(){var t=e.user,r=e.firstFile,o=e.isSearchMode,s=e.source;o&&f.logSearchAction({result:r,user:t,action_type:"comment",view_type:y.browseStore.viewType()}),d.logAddComment({uid:t.id,source:s}),u.browseActions.navigateToFileOrFolder({file:r,shouldFocusComment:!0,fileViewOrigin:T.FileViewOriginType.BROWSE})}},j=function(t){var r=t.isStarred,o=t.args;return function(){var t=o.user,s=o.firstFile,n=o.isSearchMode;e.defined("modules/clean/react/starred/browse_exports")&&(n&&f.logSearchAction({result:s,user:t,action_type:"star",view_type:y.browseStore.viewType()}),l.changeFileStarStatus({file:s,isStarred:r,user:t}))}},K=function(e){return function(){var t=e.user,r=e.actionHandlers,o=e.firstFile,s=e.isSearchMode,n=e.source;s&&f.logSearchAction({result:o,user:t,action_type:"rename",view_type:y.browseStore.viewType()}),d.logRenameFiles({uid:t.id,source:n}),r.onShowRename(o)}},Q=function(e){return function(){var t=e.user,r=e.context,o=e.actionHandlers,s=e.files,n=e.firstFile,i=e.isSearchMode;r.isNonUserRelativeContext?o.onRenameTeamFolder&&o.onRenameTeamFolder(n):(i&&f.logSearchAction({result:n,user:t,action_type:"rename",view_type:y.browseStore.viewType()}),c.showContentManagerBridge(s.toArray(),"rename",b.get_viewer().team_is_limited))}},J=function(e){return function(){var t=e.context,r=e.actionHandlers,o=e.firstFile;t.isNonUserRelativeContext&&r.onRenameTeamFolderArchived&&r.onRenameTeamFolderArchived(o)}},Y=function(e){return function(){var t=e.user,r=e.context,o=e.actionHandlers,s=e.files,n=e.firstFile,i=e.isSearchMode;r.isNonUserRelativeContext?o.onArchive&&o.onArchive(n):(i&&f.logSearchAction({result:n,user:t,action_type:"archive",view_type:y.browseStore.viewType()}),c.showContentManagerBridge(s.toArray(),"archive",b.get_viewer().team_is_limited))}},Z=function(e){return function(){var t=e.context,r=e.actionHandlers,o=e.firstFile;t.isNonUserRelativeContext&&r.onUnarchive&&r.onUnarchive(o)}},X=function(e){return function(){var t=e.context,r=e.actionHandlers,o=e.firstFile;t.isNonUserRelativeContext&&r.onPermanentDeleteArchived&&r.onPermanentDeleteArchived(o)}},$=function(e){return function(){var t=e.context,r=e.actionHandlers;t.isNonUserRelativeContext&&r.onArchiveInProgress&&r.onArchiveInProgress()}},ee=function(e){return function(){var t=e.user,r=e.context,o=e.files,s=e.firstFile,n=e.source;e.isSearchMode&&f.logSearchAction({result:s,user:t,action_type:"move",view_type:y.browseStore.viewType()}),d.logOpenMoveModal({uid:t.id,source:n}),c.showMove(t,o.toArray(),r.currentFQPath,{onSuccess:function(){d.logMoveFiles({uid:t.id,source:n})},onUndo:function(){u.browseActions.selectRowsFromBoltClient(o.toArray())},onRequestNotSent:function(){u.browseActions.selectFilesByFqPath({fqPathsToSelect:o.toArray().map(function(e){return e.fq_path})})}})}},te=function(e){return function(){var t=e.user,r=e.files,o=e.firstFile,s=e.isSearchMode,n=e.source;s&&f.logSearchAction({result:o,user:t,action_type:"copy",view_type:y.browseStore.viewType()}),d.logOpenCopyModal({uid:t.id,source:n}),c.showCopy(t,r.toArray(),{onSuccess:function(e){var r=e.files;d.logCopyFiles({uid:t.id,source:n}),u.browseActions.selectRowsFromBoltClient(r)},onUndo:function(){u.browseActions.selectRowsFromBoltClient(r.toArray())},onRequestNotSent:function(){u.browseActions.selectFilesByFqPath({fqPathsToSelect:r.toArray().map(function(e){return e.fq_path})})}})}},re=function(){return function(){c.showOverquota()}},oe=function(e){return function(){var t=e.user,r=e.context,o=e.actionHandlers,s=e.files,n=e.firstFile,a=e.isSearchMode;if(r.isNonUserRelativeContext)return void(o.onRestore&&o.onRestore(s.toArray()));if(a&&f.logSearchAction({result:n,user:t,action_type:"restore",view_type:y.browseStore.viewType()}),1===s.size&&n.is_dir&&!r.isNonUserRelativeContext){var l=i.getRestoreFileUrl({fqPath:n.fq_path,userId:t.id});E.redirect(l)}else o.onRestore(s.toArray())}},se=function(e){return function(){var t=e.user,r=e.context,o=e.firstFile,s=o.fq_path.toLowerCase(),n=r.inactiveNSIDByFQPath[s];n&&_.asyncMountSharedFolder(n,t.role,g.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,!1,null,!0)}},ne=function(e){return function(){var t=e.user,r=e.context,o=e.actionHandlers,s=e.firstFile,n=e.isSearchMode,a=e.source;if(r.isNonUserRelativeContext)return void(o.onShowVersions&&o.onShowVersions(s));n&&f.logSearchAction({result:s,user:t,action_type:"revisions",view_type:y.browseStore.viewType()}),d.logVersions({uid:t.id,source:a});var l=i.getFileHistoryUrl({fqPath:s.fq_path,userId:t.id});E.redirect(l)}},ie=function(e){return function(){var t=e.actionHandlers,r=e.firstFile;t.onViewActivity&&t.onViewActivity(r)}},ae=function(e){return function(){var t=e.user,r=e.context,o=e.actionHandlers,s=e.firstFile,n=e.files,i=e.isSearchMode,a=e.source;if(r.isNonUserRelativeContext)return void(o.onDelete&&o.onDelete(n.toArray()));i&&f.logSearchAction({result:s,user:t,action_type:"delete",view_type:y.browseStore.viewType()}),d.logDeleteFiles({uid:t.id,source:a}),o.onDelete(n.toArray())}},le=function(e){return function(){var t=e.user,r=e.context,o=e.actionHandlers,s=e.files,n=e.firstFile,i=e.isSearchMode,a=e.source;if(r.isNonUserRelativeContext)return void(o.onPermanentDelete&&o.onPermanentDelete(s.toArray()));i&&f.logSearchAction({result:n,user:t,action_type:"purge",view_type:y.browseStore.viewType()}),d.logPermanentDeleteFiles({uid:t.id,source:a}),o.onPermanentDelete(s.toArray())}},ce=function(e){return function(){var t=e.user,r=e.firstFile,o=e.isSearchMode,s=r;o&&f.logSearchAction({result:s,user:t,action_type:"events",view_type:y.browseStore.viewType()}),E.redirect("/events?ns="+s.target_ns)}},de=function(e){return function(){var t=e.firstFile;u.browseActions.fetchFolderSizes({file:t})}},ue=function(e){return function(){var t=e.user,r=e.context;_.asyncGoToContentManagerForPath({isLimitedTeam:b.get_viewer().team_is_limited,containingFolder:r.currentFQPath,isCDM:t.is_cdm_member})}};t.getActionsForFileCollection=x,t.doOpenPhoto=O,t.doOpenFile=M}),define("modules/clean/react/browse/file_grouper",["require","exports","modules/core/i18n","modules/clean/datetime","modules/clean/react/browse/constants","modules/clean/react/browse/models"],function(e,t,r,o,s,n){"use strict";function i(e,t,i){var c=[],d=[],u=null;if(t===s.BrowseSortFields.CATEGORY)e.forEach(function(e,t){if(e){var r=n.File.getCategoryDescription(e,!0);r!==u&&(c.push(r),d.push(t),u=r)}});else if(t===s.BrowseSortFields.EXTENSION)e.forEach(function(e,t){if(e){var r=e.is_dir?s.FileTypeCapitalizedCategoryTranslations.FOLDER:n.File.getExtension(e).toUpperCase();if(r!==u){var o=r;""===r&&(o=a),c.push(o),d.push(t),u=r}}});else if(t===s.BrowseSortFields.MODIFIED)if(i===s.SortDirections.DESCENDING){var p=o.getTimeBands(Date.now());e.forEach(function(e,t){if(e){var o,s=e.ts?1e3*e.ts:0;o=s>=p.today?r._("Today"):s>=p.yesterday?r._("Yesterday"):s>=p.thisWeek?r._("This week"):s>=p.lastWeek?r._("Last week"):s>=p.thisMonth?r._("This month"):s>=p.lastMonth?r._("Last month"):s>=p.lastThreeMonths?r._("Three months ago"):r._("Older"),o!==u&&(c.push(o),d.push(t),u=o)}})}else e.forEach(function(e,t){if(e){var r;if(e.ts){var s=new Date(1e3*e.ts),n=s.getMonth(),i=s.getFullYear();r=o.month_with_year(n,i)}else r=l;r!==u&&(c.push(r),d.push(t),u=r)}});return{sectionLabels:c,sectionStartIndices:d}}Object.defineProperty(t,"__esModule",{value:!0});var a=r._("Extensionless",{comment:"Label for files without extensions like .txt or .png"}),l=r._("Missing dates",{comment:"label for group of files without dates marking when they are created or modified"});t.getSections=i}),define("modules/clean/react/browse/file_jump",["require","exports","modules/clean/keycode","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/core/dom"],function(e,t,r,o,s,n){"use strict";function i(e,t){var i=null!=e.which?e.which:e.keyCode,c=String.fromCharCode(i);i<r.KeyCode.SPACE||a.includes(c)||n.focus_in_input()||e.metaKey||e.altKey||e.altGraphKey||e.ctrlKey||i===r.KeyCode.SPACE&&!t()||(i===r.KeyCode.SPACE&&t()&&e.preventDefault(),s.BrowseDispatcher.dispatch({type:o.BrowseActionTypes.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:c}}),null!=l&&clearTimeout(l),l=setTimeout(function(){s.BrowseDispatcher.dispatch({type:o.BrowseActionTypes.RESET_FILE_JUMP})},1e3))}Object.defineProperty(t,"__esModule",{value:!0});var a=["/","\\",":","?","*","<",">","|"],l=null;t.handleKeyPress=i}),define("modules/clean/react/browse/file_list_empty_folder_table",["require","exports","tslib","external/react","external/spectrum/media_table","external/spectrum/table"],function(e,t,r,o,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._renderTitle=function(){return o.createElement("h3",{className:"u-font-strong empty-folder-table-title"},this.props.title)},t.prototype._renderSubtitle=function(){var e=this.props,t=e.subtitle,r=e.subtitleLink,s=e.subtitleOnClick;return t&&r?o.createElement("a",{className:"empty-folder-table-subtitle empty-folder-table-link",href:r,onClick:s},t):t?o.createElement("span",{className:"empty-folder-table-subtitle"},t):void 0},t.prototype.render=function(){for(var e=[],t=0;t<2;t++)e.push(o.createElement(s.MediaRow,null));for(var r=[],t=0;t<11;t++)r.push(o.createElement(s.MediaRow,null));return o.createElement(n.Table,{className:"empty-folder-table"},o.createElement(n.TableHead,null),o.createElement(n.TableBody,null,e,o.createElement(s.MediaRow,null,o.createElement(s.MediaCell,{className:"empty-folder-table-cell",title:this._renderTitle(),subtitle:this._renderSubtitle()})),r))},t})(o.PureComponent);t.EmptyFolderTable=i}),define("modules/clean/react/browse/file_list_empty_folder_with_image",["require","exports","tslib","external/classnames","external/react","modules/clean/analytics","modules/clean/react/button","modules/clean/react/image","modules/clean/static_urls","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=[c.NameSpaceAccess.ACCESS_READER,c.NameSpaceAccess.ACCESS_READER_NO_COMMENT],p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleOpenFileUploader=function(){t.props.showFileUploaderModal(),t.logTeamAction("upload_files_clicked")},t}return r.__extends(t,e),t.prototype.logEmptyFolderView=function(){var e;e=this.props.isInsideTeamFolderTree?"view_team_folder":this.props.isInsideSharedFolder?"view_shared_folder":"view_normal_folder",this.logTeamAction(e)},t.prototype.logTeamAction=function(e){n.TeamsWebActionsLogger.log(e,void 0,void 0,this.props.userId,!1,n.TeamsWebActionsLogger.LOG_CATEGORY.TEAM_INFO)},t.prototype.getImgSrc=function(){var e=this.props.imgSrc;return e?e:this.props.isViewingTeamFolder?l.static_url("/static/images/empty_states/team-folder-vflZkv0TQ.png"):l.static_url("/static/images/empty_states/files-vflsVPyeo.png")},t.prototype.getImgSrcHiRes=function(){var e=this.props.imgSrcHiRes;return e?e:this.props.isViewingTeamFolder?l.static_url("/static/images/empty_states/team-folder@2x-vfloC8f3o.png"):l.static_url("/static/images/empty_states/files@2x-vflvkuH8g.png")},t.prototype.getImgAlt=function(){var e=this.props.imgAlt;return e?e:this.props.isViewingTeamFolder?d._("empty team folder"):d._("empty folder")},t.prototype.getTagLine=function(){return s.createElement("h2",{className:"empty-folder__tagline"},this.props.tagline)},t.prototype.getTeamFolderInfo=function(){var e=d._("Upload files"),t=d._("This team folder is empty. Upload files to this folder to share with your team.");return s.createElement("div",{className:"o-grid"},s.createElement("div",{className:"o-grid__col--centered u-pad-top-m o-grid__col--1-of-3"},s.createElement("div",null,t),s.createElement(i.button,{onClick:this.handleOpenFileUploader},e)))},t.prototype.getFolderInfo=function(){if(this.props.isBrowseInContentManager)return s.createElement("div",null);var e=this.props.folderInfo;return e?e:this.props.isViewingTeamFolder?this.getTeamFolderInfo():s.createElement("div",null,d._("Drag and drop files onto this window to upload."))},t.prototype.getHelpLink=function(){var e=this.props.helpLink;if(e)return s.createElement("a",{className:"empty-folder__help-link",href:e,target:"_blank"},d._("Learn More"))},t.prototype.render=function(){var e,t=this.props,r=t.isBrowseInContentManager,n=t.isInsideSharedFolder,c=t.currentSharedFolderPermissionRole,p=t.className,h=t.isSearchState,m=t.isViewingTeamFolder;p&&(e=p.split(" ").map(function(e){return"empty-folder--"+e}).join(" "));var f=o("u-font-center u-pad-top-xl","empty-folder",e,{"empty-folder-placeholder":!r});if(h)return s.createElement("div",{className:f},s.createElement(a,{src:l.static_url("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:l.static_url("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),s.createElement("h2",{className:"u-pad-top-l"},d._("No results found")),s.createElement("div",null,d._("Please update your search and try again")));if(r){if(this.props.isArchiveState)return s.createElement("div",{className:o(f,"u-font-meta")},d._("No archived team folders"));if(this.props.isViewingTeamFolder)return s.createElement("div",{className:f,id:"cm-empty-state"},s.createElement(a,{src:l.static_url("/static/images/empty_states/collaboration-team-folder-vflapVQHo.png"),srcHiRes:l.static_url("/static/images/empty_states/collaboration-team-folder@2x-vflsqkNUB.png"),alt:""}),s.createElement("div",{className:"u-font-center u-font-meta content-manager__empty-state"},d._("Team folders let you share with your entire department or team.")," ",s.createElement("a",{href:"/help/9263",target:"_blank"},d._("Learn how"))),s.createElement(i.button,{onClick:this.props.onCreateTeamFolder},d._("Create team folder")),this.props.enableDataMigrationTool&&s.createElement("div",{className:"u-font-center u-font-meta content-manager__data-migration-tool-empty-state"},d._("Need help migrating files to Dropbox?"),s.createElement("button",{className:"dmt-link button-as-link",onClick:this.props.onShowDataMigrationToolModal},d._("Dropbox Migration Assistant"))))}this.logEmptyFolderView(),m&&this.logTeamAction("upload_files_displayed");var _=n&&u.includes(c);return s.createElement("div",{className:f},s.createElement(a,{src:this.getImgSrc(),srcHiRes:this.getImgSrcHiRes(),alt:this.getImgAlt(),className:"empty-folder__image"}),this.getTagLine(),s.createElement("div",{className:o({"u-l-dn":_,"drag-prompt":!0})},this.getFolderInfo(),this.getHelpLink()))},t})(s.PureComponent);p.defaultProps={tagline:d._("This folder is empty"),isSearchState:!1},t.EmptyFolderWithImage=p}),define("modules/clean/react/browse/file_list_utils",["require","exports","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/sharing/browse_exports"],function(e,t,r,o,s){"use strict";function n(e){var t=e.file,s=e.isSelected,n=e.dropTargetHighlightMode;if(n===r.DropTargetHighlightMode.NONE)return!1;if(!t.is_dir)return!1;if(o.File.isReadOnlySharedFolder(t))return!1;if(t.isDeleted)return!1;switch(n){case r.DropTargetHighlightMode.ALL_FOLDERS:return!0;case r.DropTargetHighlightMode.NONSELECTED_FOLDERS:return!s;case r.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:return!s&&t.type!==r.FileTypes.SHARED_FOLDER;case r.DropTargetHighlightMode.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:return!s&&![r.FileTypes.SHARED_FOLDER,r.FileTypes.TEAM_SHARED_FOLDER].includes(t.type)}return!1}function i(e){var t=e.context,r=e.file;e.user;return r.isDeleted||r.is_dir&&s.shouldUsePublicFolderSharing(t.config,r.fq_path)||o.File.isTeamMemberFolder(r)||!o.File.canViewFileMembers(r,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.shouldFileBeHighlightedDropTarget=n,t.isSharingDisabledForFile=i}),define("modules/clean/react/browse/files_view/column_header",["require","exports","tslib","external/classnames","external/spectrum/checkbox","external/spectrum/table","external/react","modules/clean/react/browse/files_view/column_header_menu","modules/clean/react/browse/files_view/sticky_table_head","modules/clean/react/browse/files_view/view_type_column_header_menu","modules/clean/react/browse/constants"],function(e,t,r,o,s,n,i,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHovered:!1},t.handleChangeSelectAllCheckbox=function(e){"unchecked"===e?t.props.onDeselectAll():t.props.onSelectAll()},t.handleMouseEnter=function(){t.setState({isHovered:!0})},t.handleMouseLeave=function(){t.setState({isHovered:!1})},t}return r.__extends(t,e),t.prototype.getAriaSortValue=function(e){return e===d.SortDirections.ASCENDING?"ascending":e===d.SortDirections.DESCENDING?"descending":"none"},t.prototype.render=function(){var e=this,t=this.state.isHovered,d=this.props,u=d.columnFlex,p=d.columns,h=d.isCompactMode,m=d.isSelectMode,f=d.isSticky,_=d.isTabbing,g=d.currentSort,S=d.onSelection,w=d.onSort,b=d.onSwitchViewType,v=d.selectAllCheckboxState,y=void 0===v?"unchecked":v,T=d.stickyOffsetHeight,F=d.stickyOffsetTop,E=d.visibleColumns,C=d.viewType,I=d.isViewTypeSwitchingEnabled,A=!(_||m||t||h),D={className:o("brws-column-header",{"brws-column-header-compact":h}),onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},R=[i.createElement(n.TableHeadCell,{className:"brws-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:"columnheader",scope:"col"},i.createElement("div",{className:"brws-vertically-center"},i.createElement(s.Checkbox,{className:o("brws-checkbox",{"brws-checkbox-checked":"checked"===y}),checked:y,onChange:this.handleChangeSelectAllCheckbox,variant:A?"invisible":"default"})))].concat(E.map(function(t,r){var o=g&&g.sortField===t.sortField?g.sortDirection:void 0;return i.createElement(n.TableHeadCell,{key:r,role:"columnheader",scope:"col","aria-sort":e.getAriaSortValue(o),className:"brws-column-header-table-cell"},i.createElement(a.ColumnHeaderMenu,{column:t,sortDirection:o,columns:p,visibleColumns:E,onSelection:S,onSort:w}),r===E.length-1&&I&&i.createElement(c.ViewTypeColumnHeaderMenu,{viewType:C,onSwitchViewType:b}))}));return f?i.createElement(l.StickyTableHead,r.__assign({columnFlex:u,offsetHeight:T,offsetTop:F},D),R):i.createElement(n.FixedTableHead,r.__assign({},D),R)},t})(i.PureComponent);t.ColumnHeader=u}),define("modules/clean/react/browse/files_view/column_header_menu",["require","exports","tslib","external/classnames","external/spectrum/icon_form","external/spectrum/popover","external/react","modules/clean/react/browse/constants","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePopoverSelection=function(e){var r=t.props,o=r.onSort,s=r.onSelection,n=r.column;e===a.SortDirections.ASCENDING||e===a.SortDirections.DESCENDING?o(n.sortField,e):(s(e,n),1===t.props.visibleColumns.length&&o(e.sortField,t.props.sortDirection||a.SortDirections.ASCENDING))},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.column,r=e.columns,c=e.visibleColumns,d=e.sortDirection;if(t.isSortDisabled)return i.createElement("div",{className:"normal brws-column-header-menu"},i.createElement("span",{className:"brws-column-header-menu-trigger-disabled"},t.label));var u;!t.isLocked&&r&&r.length&&(u=[i.createElement(n.PopoverItemGroupSeparator,{key:"show-separator"}),i.createElement(n.PopoverItemGroup,{key:"show-item-group"},i.createElement(n.PopoverItemGroupTitle,{className:"brws-column-header-menu-title",key:"show-title"},l._("Show")),r.filter(function(e){return!e.isLocked}).map(function(e){return i.createElement(n.PopoverSelectableItem,{key:e.sortField,disabled:c.includes(e)&&e.sortField!==t.sortField,selected:e.sortField===t.sortField,value:e},e.label)}))]);var p=d===a.SortDirections.ASCENDING?"sort-arrow-up":d===a.SortDirections.DESCENDING?"sort-arrow-down":"caret-down";return i.createElement(n.Popover,{className:"brws-column-header-menu",onSelection:this.handlePopoverSelection},i.createElement(n.PopoverTrigger,{className:o("brws-column-header-menu-trigger",{"brws-column-header-menu-trigger-active":!!d}),title:t.label},i.createElement("span",null,t.label),i.createElement("span",{className:"brws-column-header-menu-label-icon-wrapper"},i.createElement(s.IconForm,{className:"brws-column-header-menu-label-icon",name:p}))),i.createElement(n.PopoverContent,null,i.createElement(n.PopoverItemGroup,null,i.createElement(n.PopoverItemGroupTitle,{className:"brws-column-header-menu-title"},l._("Order")),i.createElement(n.PopoverSelectableItem,{selected:d===a.SortDirections.ASCENDING,value:a.SortDirections.ASCENDING},l._("Ascending")),i.createElement(n.PopoverSelectableItem,{selected:d===a.SortDirections.DESCENDING,value:a.SortDirections.DESCENDING},l._("Descending"))),u))},t})(i.PureComponent);t.ColumnHeaderMenu=c}),define("modules/clean/react/browse/files_view/column_manager",["require","exports","tslib","external/react","modules/clean/immutability_helper"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleSelection=function(e,t){r.setState(function(r){var o=r.visibleColumns.indexOf(t);return o===-1||r.visibleColumns.includes(e)?r:{visibleColumns:s.splice(r.visibleColumns,o,1,e)}})},r.state=r.getStateFromProps(t),r}return r.__extends(t,e),t.prototype.componentWillReceiveProps=function(e,t){if(this.props.columns!==e.columns)if(1===e.numVisibleColumns&&e.columns.length&&e.currentSort){var r=e.columns,o=e.currentSort,s=r.find(function(e){return e.sortField===o.sortField});this.setState({visibleColumns:[s||r[0]]})}else this.setState(this.getStateFromProps(e));else e.numVisibleColumns<this.props.numVisibleColumns?this.setState(function(t){return{visibleColumns:t.visibleColumns.slice(0,e.numVisibleColumns)}}):e.numVisibleColumns>this.props.numVisibleColumns&&this.setState(function(t){var r=e.numVisibleColumns-t.visibleColumns.length,o=[];return e.columns.forEach(function(e){o.length<r&&!t.visibleColumns.includes(e)&&o.push(e)}),{visibleColumns:t.visibleColumns.concat(o)}})},t.prototype.getStateFromProps=function(e){return{visibleColumns:e.columns.slice(0,e.numVisibleColumns||e.columns.length)}},t.prototype.render=function(){var e=this.state.visibleColumns,t=this.props,r=t.children,o=t.columns;if(!r)return null;var s=r;return"function"==typeof r&&(s=r({columns:o,visibleColumns:e,handleSelection:this.handleSelection})),s},t})(o.PureComponent);t.ColumnManager=n}),define("modules/clean/react/browse/files_view/constants",["require","exports","modules/clean/react/browse/constants","modules/core/i18n"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PAGE_HEADER_HEIGHT=96,t.DEFAULT_COLUMN_HEADER_HEIGHT=40,t.DEFAULT_ROW_HEIGHT=72,t.DEFAULT_VIEWPORT_TOP_OFFSET=t.DEFAULT_PAGE_HEADER_HEIGHT+t.DEFAULT_COLUMN_HEADER_HEIGHT,t.COMPACT_PAGE_HEADER_HEIGHT=76,t.COMPACT_COLUMN_HEADER_HEIGHT=48,t.COMPACT_VIEWPORT_TOP_OFFSET=t.COMPACT_PAGE_HEADER_HEIGHT+t.COMPACT_COLUMN_HEADER_HEIGHT,t.PINNED_TEAM_FOLDER_SECONDARY_HEADER_PADDING_TOP=12;t.LIST_VIEW_COLUMN_FLEX={3:["0 0 36px","1 1 50%","0 0 25%","0 0 25%"],2:["0 0 36px","1 1 60%","0 0 40%"],1:["0 0 36px","1 1 100%"]},t.LIST_VIEW_SEARCH_MODE_COLUMN_FLEX={2:["0 0 36px","1 1 66%","0 0 34%"],1:["0 0 36px","1 1 100%"]},t.GRID_VIEW_COLUMN_FLEX=["0 0 36px","1 1"],t.LIST_VIEW_COLUMNS=[{sortField:r.BrowseSortFields.FILENAME,label:o._("Name"),isLocked:!0},{sortField:r.BrowseSortFields.MODIFIED,label:o._("Modified")},{sortField:r.BrowseSortFields.SHARED_WITH,label:o._("Members")},{sortField:r.BrowseSortFields.CATEGORY,label:o._("Type")},{sortField:r.BrowseSortFields.EXTENSION,label:o._("Extension")},{sortField:r.BrowseSortFields.SIZE,label:o._("Size")}],t.GRID_VIEW_COLUMNS=[{sortField:r.BrowseSortFields.FILENAME,label:o._("Name")},{sortField:r.BrowseSortFields.MODIFIED,label:o._("Modified")},{sortField:r.BrowseSortFields.CATEGORY,label:o._("Type")},{sortField:r.BrowseSortFields.EXTENSION,label:o._("Extension")},{sortField:r.BrowseSortFields.SIZE,label:o._("Size")}],t.SEARCH_LIST_VIEW_COLUMNS=[{sortField:r.BrowseSortFields.FILENAME,label:"",isLocked:!0,isSortDisabled:!0},{sortField:r.BrowseSortFields.MODIFIED,label:o._("Modified"),isLocked:!0,isSortDisabled:!0}],t.SELECTABLE_LIST_KEY_SCOPE="FilesViewSelectableList",t.SELECTABLE_LIST_LINKED_OUTSIDE_CLASSES=[".bubble-menu-item-wrapper",".browse-menu",".context-menu",".react-file-viewer",".db-modal"]}),define("modules/clean/react/browse/files_view/controller",["require","exports","tslib","external/classnames","external/immutable","external/spectrum/media_table_skeleton","external/spectrum/table","external/react","external/react-dom","external/underscore","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/browse/actions","modules/clean/react/browse/browse_drag_and_drop","modules/clean/react/browse/constants","modules/clean/react/browse/empty_folder_display_props","modules/clean/react/browse/file_actions","modules/clean/react/browse/file_list_empty_folder_with_image","modules/clean/react/browse/file_list_empty_folder_table","modules/clean/react/browse/files_view/column_header","modules/clean/react/browse/files_view/column_manager","modules/clean/react/browse/files_view/constants","modules/clean/react/browse/files_view/list","modules/clean/react/browse/files_view/pinned_team_folder_view","modules/clean/react/browse/files_view/selectable_list","modules/clean/react/browse/files_view/selectors","modules/clean/react/browse/files_view/tile_grid","modules/clean/react/browse/models","modules/clean/react/browse/name_input","modules/clean/react/browse/internal_drag_status","modules/clean/react/file_uploader/constants","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/core/i18n","modules/core/notify","modules/clean/sharing/constants"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S,w,b,v,y,T,F,E,C,I,A,D,R,N,P,L,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var O=function(){},M=[x.NameSpaceAccess.ACCESS_NO_ACCESS,x.NameSpaceAccess.ACCESS_READER,x.NameSpaceAccess.ACCESS_READER_NO_COMMENT],U=(function(t){function x(){var e=null!==t&&t.apply(this,arguments)||this;return e.gridViewPrewarmedThumbnailRequestIds=[],e.state={isTabbing:!1},e.handleOpenFile=function(t,r){f.doOpenFile({event:t,user:e.props.user,file:r,isSearchMode:e.props.isSearchMode,constructorDisplayName:"FileItemRow",onFileViewerUnmount:function(){},source:"list_browse"})},e.handleMouseDownBody=function(){e.setState({isTabbing:!1})},e.handleKeyDownBody=function(t){9===t.keyCode&&e.setState({isTabbing:!0})},e.handleTabbingStart=function(){e.setState({isTabbing:!0})},e.handleCopyToClipboard=function(){var t=e.props.selectedFiles;t.size&&u.browseActions.copyFilesToClipboard(t.toArray())},e.handlePasteFromClipboard=function(){u.browseActions.pasteClipboardFilesToCurrentPath()},e.handleSetDragCopyMode=function(e){u.browseActions.setCopyMode({copyMode:e})},e.handleNavigateToFileOrFolder=function(e,t){void 0===t&&(t=O),u.browseActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:t})},e.handleNavigateToParentFolder=function(){u.browseActions.navigateToParentFolder()},e.handleNavigateToPath=function(e){u.browseActions.setUrl({path:e})},e.handleNewFolderSubmit=function(t){""===t?e.handleNewFolderCancel({source:I.NameInputActionSources.SUBMIT}):u.browseActions.createFolder({pathName:e.props.context.currentFQPath,folderName:t,nsId:e.props.context.rootNSID})},e.handleNewFolderCancel=function(e){e.source!==I.NameInputActionSources.ESC&&L.error(P._("Please provide a name for the new folder.")),u.browseActions.cancelCreateFolder()},e.handleRenameSubmit=function(t,r){u.browseActions.renameFile({file:t,newName:r,isSearchMode:!!e.props.isSearchMode})},e.handleRenameCancel=function(e){u.browseActions.cancelFileRename({file:e})},e.handleSetDropTarget=function(e){u.browseActions.setDropTarget({target:e})},e.handleSetFileUploaderPath=function(t){var r=t?t.path:e.props.path,o=e.props.context.isCurrentPathWriteable();t&&t.hasOwnProperty("hasPermissionToUploadToFolder")&&(o=!!t.hasPermissionToUploadToFolder),e.props.setFileUploaderPath({path:r,hasPermissionToUploadToFolder:o})},e.handleDragStart=function(t,o){void 0===o&&(o=[]);var s=e.props,n=s.path,i=s.selectedFiles,a=s.user,d=c.indexBy(o,"fq_path");d=r.__assign({},d,i.toJS());var u=c.values(d);if(u.some(function(e){return C.File.isTeamSharedFolder(e)}))return void L.error(P._("Team folders can’t be moved."));if(u.some(function(e){return C.File.isTeamMemberFolder(e)}))return void L.error(P._("Your member folder can’t be moved."));var p=t.dataTransfer;p&&p.setDragImage&&e.internalDragStatusRef&&(p.setDragImage(l.findDOMNode(e.internalDragStatusRef),-10,-10),p.setData(D.INTERNAL_FILE_DATA_TRANSFER_TYPE,JSON.stringify({userId:a.id,fromPath:n,filePaths:u.map(function(e){return e.fq_path})})),
p.effectAllowed="copyMove")},e.handleDragEnter=function(t,r,o,s){p.onFileDragEnterItem(r,!!e.props.isDraggingExternalFiles,!!e.props.isDraggingInternalFiles,o,s,e.props.context,e.handleSetDropTarget,e.handleSetFileUploaderPath)},e.handleSelectionChange=function(t){R.UEClient.sendEvent("FileItemRow","CheckboxToggled"),e.props.onSelectionChange(t)},e.handleDeselectAll=function(){var t=e.props,r=t.selection;(0,t.onSelectionChange)(r.set("selected",s.OrderedSet()))},e.handleSelectAll=function(){var t=e.props,r=t.files,o=t.selection;(0,t.onSelectionChange)(o.set("selected",s.OrderedSet(r.filter(function(e){return e instanceof C.File}).map(function(e){return e.fq_path}))))},e.handleSwitchViewType=function(t){e.props.currentSort&&e.props.currentSort.sortField!==h.BrowseSortFields.FILENAME&&!e.props.responsive.isMatchedLarge&&e.props.onSortChange(h.BrowseSortFields.FILENAME,h.SortDirections.ASCENDING),u.browseActions.setViewType({viewType:t})},e.handleTTI=function(){e.props.onComponentTTI("FilesViewController")},e.setBrowseTileGridRef=function(t){e.browseTileGridRef=t},e.setInternalDragStatusRef=function(t){e.internalDragStatusRef=t},e.getFileActions=function(t){return f.getActionsForFileCollection({files:s.Set([t]),context:e.props.context,user:e.props.user,actionHandlers:e.props.actionHandlers,skipSharing:!1,isUnityLoaded:e.props.isUnityLoaded,isSearchMode:e.props.isSearchMode,isOverFreeQuota:e.props.isOverFreeQuota,isStarredLoaded:e.props.isStarredLoaded,isQueryingFolderSizes:e.props.isQueryingFolderSizes})},e.getIsCurrentPathWriteable=function(){return e.props.context.isCurrentPathWriteable()},e}return r.__extends(x,t),x.prototype.componentDidMount=function(){this.shouldShowEmptyFolderView()&&this.props.onComponentTTI("FilesViewController"),this.prewarmGridViewThumbStore(),this.setupUnity(),document.addEventListener("keydown",this.handleKeyDownBody),document.addEventListener("mousedown",this.handleMouseDownBody)},x.prototype.componentDidUpdate=function(e){e.context&&this.props.context&&e.context.currentFQPath!==this.props.context.currentFQPath&&this.prewarmGridViewThumbStore(),this.props.enableUnity&&e.files!==this.props.files&&this.triggerUnityChangeCallback&&this.triggerUnityChangeCallback(),e.path!==this.props.path&&this.handleScrollToTop()},x.prototype.componentWillUnmount=function(){this.triggerUnityChangeCallback=void 0,document.removeEventListener("keydown",this.handleKeyDownBody),document.removeEventListener("mousedown",this.handleMouseDownBody)},x.prototype.setupUnity=function(){return r.__awaiter(this,void 0,void 0,function(){var t,o=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,e(["modules/clean/unity_browse_interface"])];case 1:return t=r.sent()[0],this.triggerUnityChangeCallback=function(){t.browse_visible_change_callback(o.props.files.toArray(),o.props.user.id,0,o.props.files.size-1)},[2]}})})},x.prototype.prewarmGridViewThumbStore=function(){return r.__awaiter(this,void 0,void 0,function(){var e=this;return r.__generator(this,function(t){switch(t.label){case 0:return this.props.isSearchMode||this.props.viewType===h.ViewTypes.Grid?[2]:(this.undoPrewarmGridViewThumbStore(),[4,N.waitForTTI()]);case 1:return t.sent(),this.thumbStore=new d.GenericThumbStore,this.props.files.slice(0,100).forEach(function(t){var r=E.getThumbnailUrlForItem(t);if(r){var o=e.thumbStore.bind_url(r,{onSuccess:O});o&&e.gridViewPrewarmedThumbnailRequestIds.push(o)}}),[2]}})})},x.prototype.undoPrewarmGridViewThumbStore=function(){var e=this;this.thumbStore&&this.gridViewPrewarmedThumbnailRequestIds.length&&(this.gridViewPrewarmedThumbnailRequestIds.forEach(function(t){e.thumbStore.unbind_url(t)}),this.gridViewPrewarmedThumbnailRequestIds=[])},x.prototype.handleScrollToTop=function(){window.scrollTo(0,0)},x.prototype.getBrowseTileGridRef=function(){return this.browseTileGridRef},x.prototype.renderEmptyFolderView=function(){if(this.props.customEmptyFolderView)return this.props.customEmptyFolderView();var e=this.props,t=e.user,o=e.context,s=e.showFileUploaderModal,n=e.expBizFoldersEmptyStateAdmin,i=e.expBizFoldersEmptyStateUser,l=o.isInsideSharedFolder,c=o.isInsideTeamFolderRoot,d=o.currentSharedFolderPermissionRole;if(n||i){var u=m.getEmptyFolderDisplayProps({expBizFoldersEmptyStateAdmin:n,expBizFoldersEmptyStateUser:i,isInsideTeamFolderTree:o.isInsideTeamFolderTree,isInsideSharedFolder:o.isInsideSharedFolder});return a.createElement(_.EmptyFolderWithImage,r.__assign({currentSharedFolderPermissionRole:d,isArchiveState:!1,isInsideSharedFolder:l,isViewingTeamFolder:c,showFileUploaderModal:s,userId:t.id},u))}var p=l&&M.includes(d),h=p?void 0:P._("Drag and drop files onto this window to upload.");return a.createElement(g.EmptyFolderTable,{title:P._("This folder is empty"),subtitle:h})},x.prototype.renderPinnedTeamFolderView=function(e){var t=this.props,r=t.activeDropTarget,o=t.context,s=t.dropTargetHighlightMode,n=t.shouldShowPinnedTeamFolders,i=t.teamFolders,l=t.user,c=this.state.isTabbing;if(n&&i&&i.size)return a.createElement(y.PinnedTeamFolderView,{activeDropTarget:r,columnFlex:b.LIST_VIEW_COLUMN_FLEX[1],context:o,dropTargetHighlightMode:s,getFileActions:this.getFileActions,isCompactMode:e,isTabbing:c,onDragEnter:this.handleDragEnter,onOpenFile:this.handleOpenFile,onRenameCancel:this.handleRenameCancel,onRenameSubmit:this.handleRenameSubmit,teamFolders:i,user:l})},x.prototype.getSelectAllCheckboxCheckedVariant=function(){var e=this.props,t=e.selectedFiles,r=e.files,o="unchecked";return t.size===r.size?o="checked":t.size&&(o="mixed"),o},x.prototype.getNumVisibleColumns=function(){var e=this.props.responsive,t=e.isMatchedLarge,r=e.isMatchedMedium,o=this.props,s=o.isSearchMode;return o.viewType===h.ViewTypes.Grid?1:t?s?2:3:r?2:1},x.prototype.isCreateFolderUIActive=function(){var e=this.props.createNewFolderState;return e&&"CREATE_FOLDER_INACTIVE"!==e},x.prototype.shouldShowEmptyFolderView=function(){return this.props.loadingState===h.LoadingStates.LOADED&&!this.props.files.size&&!this.isCreateFolderUIActive()},x.prototype.render=function(){var e=this,t=this.props,r=t.currentSort,s=t.files,l=t.isSubgrowthPinnedExp,c=t.loadingState,d=t.selectedFiles,u=t.selection,p=t.shouldShowPinnedTeamFolders,m=t.teamFolders,f=t.viewType,_=this.props.responsive,g=_.isMatchedLarge,y=_.isMatchedMedium,C=this.state.isTabbing;if(c===h.LoadingStates.LOADING_FIRST_PAGE)return a.createElement(n.MediaTableSkeleton,{numRows:15});var I=F.getItemIds(this.props),D=!g,R=!!d.size;if(this.shouldShowEmptyFolderView())return a.createElement("div",{className:"brws-files-view"},this.renderPinnedTeamFolderView(D),this.renderEmptyFolderView());var N=g?b.DEFAULT_COLUMN_HEADER_HEIGHT:b.COMPACT_COLUMN_HEADER_HEIGHT,P=g||y?b.DEFAULT_PAGE_HEADER_HEIGHT:b.COMPACT_PAGE_HEADER_HEIGHT,L=N+P,x=0;return p&&m&&m.size&&(x+=N+N+b.PINNED_TEAM_FOLDER_SECONDARY_HEADER_PADDING_TOP+m.size*b.DEFAULT_ROW_HEIGHT),a.createElement("div",{className:"brws-files-view"},this.renderPinnedTeamFolderView(D),a.createElement(w.ColumnManager,{columns:this.props.columns||(f===h.ViewTypes.List?b.LIST_VIEW_COLUMNS:b.GRID_VIEW_COLUMNS),currentSort:r,numVisibleColumns:this.getNumVisibleColumns()},function(t){var n=t.columns,c=t.visibleColumns,d=t.handleSelection,p=(e.props.isSearchMode?b.LIST_VIEW_SEARCH_MODE_COLUMN_FLEX:b.LIST_VIEW_COLUMN_FLEX)[c.length],m=a.createElement(S.ColumnHeader,{columnFlex:p,columns:n,currentSort:e.props.currentSort,isCompactMode:D,isSelectMode:R,isSticky:l&&f===h.ViewTypes.List,isTabbing:C,onDeselectAll:e.handleDeselectAll,onSelectAll:e.handleSelectAll,onSelection:d,onSort:e.props.onSortChange,onSwitchViewType:e.handleSwitchViewType,selectAllCheckboxState:e.getSelectAllCheckboxCheckedVariant(),stickyOffsetHeight:N,stickyOffsetTop:P,visibleColumns:c,viewType:f,isViewTypeSwitchingEnabled:e.props.isViewTypeSwitchingEnabled});return f===h.ViewTypes.List?a.createElement(T.SelectableList,{itemIds:I,keyScope:b.SELECTABLE_LIST_KEY_SCOPE,linkedOutsideClasses:b.SELECTABLE_LIST_LINKED_OUTSIDE_CLASSES,onSelectionChange:e.handleSelectionChange,onTabbingStart:e.handleTabbingStart,selection:u},function(t){var r=t.focusedFileId,n=t.handleDeselect,l=(t.handleDeselectAll,t.handleFocusFile),d=t.handleSelect,u=(t.handleSelectAll,t.isSelectableListEvent);return a.createElement(i.Table,{"aria-rowcount":e.props.totalNumFiles,className:o("brws-files-view-list",{"brws-files-view-list-compact":D}),columnFlex:p},m,a.createElement(v.FilesViewList,{actionHandlers:e.props.actionHandlers,activeDropTarget:e.props.activeDropTarget,context:e.props.context,createNewFolderState:e.props.createNewFolderState,dropTargetHighlightMode:e.props.dropTargetHighlightMode,files:s,fileRename:e.props.fileRename,focusedFileId:r,getFileActions:e.getFileActions,getIsCurrentPathWriteable:e.getIsCurrentPathWriteable,getIsFileJumping:e.props.getIsFileJumping,isCompactMode:D,isDraggingExternalFiles:e.props.isDraggingExternalFiles,isDraggingInternalFiles:e.props.isDraggingInternalFiles,isFileViewerShown:e.props.isFileViewerShown,isSearchMode:e.props.isSearchMode,isSelectMode:R,isSelectableListEvent:u,isSharedWithLoaded:e.props.isSharedWithLoaded,isStarredLoaded:e.props.isStarredLoaded,isTabbing:C,keyScope:b.SELECTABLE_LIST_KEY_SCOPE,onCopyToClipboard:e.handleCopyToClipboard,onDragStart:e.handleDragStart,onDragEnter:e.handleDragEnter,onDeselectFile:n,onFocusFile:l,onNavigateToFileOrFolder:e.handleNavigateToFileOrFolder,onNavigateToParentFolder:e.handleNavigateToParentFolder,onNavigateToPath:e.handleNavigateToPath,onNewFolderCancel:e.handleNewFolderCancel,onNewFolderSubmit:e.handleNewFolderSubmit,onOpenFile:e.handleOpenFile,onPasteFromClipboard:e.handlePasteFromClipboard,onRenameCancel:e.handleRenameCancel,onRenameSubmit:e.handleRenameSubmit,onSelectFile:d,onSetDragCopyMode:e.handleSetDragCopyMode,onSetDropTarget:e.handleSetDropTarget,onSetFileUploaderPath:e.handleSetFileUploaderPath,onTTI:e.handleTTI,scrollPositionOffset:x,scrollToRow:r?I.indexOf(r):0,selectedFiles:e.props.selectedFiles,selection:e.props.selection,user:e.props.user,viewportTopOffset:L,visibleColumns:c}))}):a.createElement("div",null,a.createElement(i.Table,{columnFlex:b.GRID_VIEW_COLUMN_FLEX},m),a.createElement(E.BrowseTileGrid,{actionHandlers:e.props.actionHandlers,activeDropTarget:e.props.activeDropTarget,activeSortDirection:r&&r.sortDirection,activeSortField:r&&r.sortField,createNewFolderState:e.props.createNewFolderState,deselectAll:e.handleDeselectAll,fileRename:e.props.fileRename,getFileActions:e.getFileActions,getIsCurrentPathWriteable:e.getIsCurrentPathWriteable,getIsFileJumping:e.props.getIsFileJumping,handleTTI:e.handleTTI,items:s,isCreateFolderUIActive:e.isCreateFolderUIActive(),isDraggingExternalFiles:e.props.isDraggingExternalFiles,isDraggingInternalFiles:e.props.isDraggingInternalFiles,isSearchMode:e.props.isSearchMode,onCopyToClipboard:e.handleCopyToClipboard,onDragEnter:e.handleDragEnter,onDragStart:e.handleDragStart,onNewFolderCancel:e.handleNewFolderCancel,onNewFolderSubmit:e.handleNewFolderSubmit,onPasteFromClipboard:e.handlePasteFromClipboard,onRenameCancel:e.handleRenameCancel,onRenameSubmit:e.handleRenameSubmit,onSelectionChange:e.props.onSelectionChange,onSetDragCopyMode:e.handleSetDragCopyMode,onSetDropTarget:e.handleSetDropTarget,onSortChange:e.props.onSortChange,path:e.props.path,ref:e.setBrowseTileGridRef,selectAll:e.handleSelectAll,selectedFiles:e.props.selectedFiles,selection:e.props.selection,setFileUploaderPath:e.handleSetFileUploaderPath,thumbStore:e.thumbStore,totalNumItems:e.props.totalNumFiles,user:e.props.user,isQueryingFolderSizes:e.props.isQueryingFolderSizes}))}),a.createElement(A.InternalDragStatus,{className:"offscreen-drag-icon",files:this.props.selectedFiles.toArray(),ref:this.setInternalDragStatusRef}))},x})(a.PureComponent);U.defaultProps={activeDropTarget:null,dropTargetHighlightMode:h.DropTargetHighlightMode.NONE,enableUnity:!0,fileRename:null,loadingState:h.LoadingStates.LOADING_FIRST_PAGE},t.FilesViewController=U}),define("modules/clean/react/browse/files_view/culled_table_body",["require","exports","tslib","external/spectrum/table","external/react"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rangeInViewStartIndex=0,t.rangeInViewEndIndex=0,t.handleRangeInView=function(e,r){var o=document.body.scrollTop,s=window.innerHeight-t.props.viewportTopOffset,n=t.props.listItemHeight,i=t.props.items.length,a=i*n;t.rangeInViewStartIndex=Math.floor(o/a*i),t.rangeInViewEndIndex=Math.ceil((o+s||1)/a*i)-1},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.scrollToRow&&this.updateScroll(this.props.scrollToRow)},t.prototype.componentWillReceiveProps=function(e){this.props.scrollToRow!==e.scrollToRow&&this.updateScroll(e.scrollToRow)},t.prototype.updateScroll=function(e){var t=this.props,r=t.listItemHeight,o=t.viewportTopOffset;if(e<=this.rangeInViewStartIndex||e>=this.rangeInViewEndIndex){var s=document.body.scrollTop,n=window.innerHeight-o,i=(e+1)*r,a=e*r,l=0;l=a>s?Math.abs(n-i):i-r,window.scrollTo(0,l)}},t.prototype.render=function(){var e=this.props,t=(e.children,e.scrollToRow,e.viewportTopOffset),n=r.__rest(e,["children","scrollToRow","viewportTopOffset"]);return s.createElement("div",null,s.createElement(o.CulledTableBody,r.__assign({onRangeInView:this.handleRangeInView,viewportHeight:window.innerHeight-t},n)))},t})(s.PureComponent);n.defaultProps={viewportTopOffset:0},t.CulledTableBodyWithScrollToRow=n}),define("modules/clean/react/browse/files_view/file_name_cell",["require","exports","tslib","external/spectrum/media_table","external/react","modules/clean/browse_interface","modules/clean/filepath","modules/clean/browse_interface","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/name_input","modules/clean/react/browse/render_partials","modules/clean/search/search_helpers","modules/clean/user_education/user_education_client","modules/constants/starred","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(t){function _(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleNameInputSubmit=function(t){e.props.onRenameSubmit(e.props.file,t)},e.handleNameInputCancel=function(){e.props.onRenameCancel(e.props.file)},e.handleOnClickNameInput=function(e){e.stopPropagation()},e.handleOnClickName=function(t){e.props.isTextSelectable||e.props.isSelectMode||e.props.onOpenFile(t,e.props.file)},e.handleOnClickLocationLink=function(t){t.stopPropagation();var r=e.props,o=r.file,s=r.isSearchMode,n=r.user;if(s&&p.logSearchAction({result:o,user:n,action_type:"click_path_link",view_type:l.ViewTypes.List}),!(t.button>0||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey)&&e.props.onNavigateToPath){t.preventDefault();var a=i.parent_dir(o.fq_path);e.props.onNavigateToPath(a)}},e}return r.__extends(_,t),_.prototype.renderFileIcon=function(){var e=this.props,t=e.file,r=e.showCDMUserEducationEffects,o=s.createElement(u.FileIcon,{className:"brws-file-name-cell-icon",ref:"icon",file:t,onClick:this.handleOnClickName});return r?s.createElement(h.UserEducationEffect,{containerName:"FileItemRow",name:"TMFIcon",useSpan:!0},o):o},_.prototype.renderScreenReaderExtraInfo=function(){var e=[],t=this.props,r=t.file,o=t.isSelected;if(r.isDeleted&&e.push(f._("Deleted")),o&&e.push(f._("Selected")),r.is_dir&&(r.type===l.FileTypes.SHARED_FOLDER?c.File.isReadOnlySharedFolder(r)?e.push(f._("Read-only shared folder")):e.push(f._("Shared folder")):r.type===l.FileTypes.TEAM_SHARED_FOLDER?c.File.isReadOnlySharedFolder(r)?e.push(f._("Read-only team shared folder")):e.push(f._("Team shared folder")):e.push(f._("Folder"))),e.length>0)return s.createElement("span",{className:"ax-visually-hidden"},""+e.join(" "))},_.prototype.renderTitle=function(){var e=this.props,t=e.file,r=e.renameState,o=e.user;if("saving-input"===r)return s.createElement("span",{role:"status"},f._("Renaming…"));var n,l=i.filename(t.fq_path);if(n=this.props.showHighlights&&t.filename_highlights?p.highlightMatchReact(l,t.filename_highlights):s.createElement("span",null,l),!t.is_unmounted){var c=t.is_dir?t.href:a.preview_uri_for_fq_path(o,t.fq_path).toString();n=s.createElement("a",{className:"brws-file-name-cell-filename",href:c,onClick:this.handleOnClickName},n)}return this.props.showUserEducationEffects?s.createElement(h.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileNameLabel",useSpan:!0},n):n},_.prototype.renderSubtitle=function(){var e=this.props,t=e.file,r=e.isSelectMode,o=e.renameState,a=e.renderLocationAsLink,l=e.showLocation,c=e.user;if(o||!l)return null;var d=i.parent_dir(t.fq_path),u="/"===d?n.get_browse_root_name(c):d.slice(1);if(t.is_unmounted)return f._("not added yet, in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:u});var p=f._("in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:u});if(!a||r)return p;var h=n.browse_uri_for_fq_path(c,d);return s.createElement("a",{className:"brws-file-name-cell-location",href:h.toString(),onClick:this.handleOnClickLocationLink},p)},_.prototype.renderStar=function(){var t=this.props,r=t.file,o=t.user,n=t.showStar,i=t.renameState;if(n&&!i){var a=e("modules/clean/react/starred/browse_exports").Star;return s.createElement("div",{className:"brws-file-name-cell-star brws-vertically-center"},s.createElement(a,{id:r.file_id,key:"star",idType:m.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,role:o.role}))}},_.prototype.render=function(){var e,t=this.props,r=t.file,n=t.mediaActions,a=t.renameState;if("pending-input"===a){var l=r.is_dir?f._("Rename directory…"):f._("Rename file…");e=s.createElement(d.NameInput,{defaultValue:i.filename(r.fq_path),label:l,onClick:this.handleOnClickNameInput,onSubmit:this.handleNameInputSubmit,onCancel:this.handleNameInputCancel})}else e=[s.createElement(o.MediaCellText,{key:"title",highlight:this.props.isHovered},this.renderTitle(),this.renderScreenReaderExtraInfo()),s.createElement(o.MediaCellText,{highlight:this.props.isHovered,key:"subtitle",variant:"subtitle"},this.renderSubtitle())];return s.createElement(o.MediaCell,{icon:this.renderFileIcon()},s.createElement("div",{className:"brws-file-name-cell-text brws-vertically-center"},e),this.renderStar(),n)},_})(s.Component);_.defaultProps={renderLocationAsLink:!0},t.FileNameCell=_}),define("modules/clean/react/browse/files_view/file_row",["require","exports","tslib","external/classnames","external/spectrum/button","external/spectrum/icon_table","external/spectrum/checkbox","external/spectrum/media_table","external/react","external/react-dom","modules/clean/react/browse/constants","modules/clean/react/browse/files_view/file_name_cell","modules/clean/react/browse/models","modules/clean/react/browse/overflow_menu","modules/clean/react/browse/share_button","modules/clean/user_education/user_education_client","modules/core/i18n","modules/constants/browse","modules/clean/react/title_bubble"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){return e.type===d.FileTypes.TEAM_SHARED_FOLDER&&("archived"===e.team_folder_status||"archive_in_progress"===e.team_folder_status)},b=function(){return l.createElement("span",{"aria-hidden":!0},"--")},v=function(e){var t=e.isVisible,r=e.onClick;return l.createElement(s.Button,{className:"brws-file-row-view-file-button","aria-label":_._("View File"),onClick:r,tabIndex:t?void 0:-1,variant:t?"secondary":"invisible"},l.createElement(n.IconTable,{name:"view"}))},y=function(){return l.createElement("svg",{width:"20px",height:"20px",viewBox:"0 0 20 20",version:"1.1"},l.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},l.createElement("g",{id:"Group",transform:"translate(2.000000, 2.000000)"},l.createElement("circle",{id:"Oval-65",cx:"8",cy:"8",r:"8"}),l.createElement("path",{d:"M8,13 L8,14.5 L5.5,12.5 L8,10.5 L8,12 C10.209139,12 12,10.209139 12,8 C12,6.93104698 11.5806921,5.96002857 10.8975817,5.24245012 L11.4674192,4.39763124 C12.4121861,5.30722218 13,6.58496544 13,8 C13,10.7614237 10.7614237,13 8,13 Z M8,3 L8,1.5 L10.5,3.5 L8,5.5 L8,4 C5.790861,4 4,5.790861 4,8 C4,8.96511539 4.34180174,9.8503987 4.91095749,10.5414022 L4.33270318,11.3986995 C3.5056268,10.5066799 3,9.3123877 3,8 C3,5.23857625 5.23857625,3 8,3 Z",id:"Oval-67",fill:"#637282"}))))},T=function(){return l.createElement("svg",{width:"20px",height:"20px",viewBox:"0 0 20 20",version:"1.1"},l.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},l.createElement("g",{id:"icon-warning",fill:"#637282"},l.createElement("path",{d:"M13.9298189,16.125 C16.4624689,16.125 17.5138484,14.3377448 16.2785476,12.1337797 L12.238298,4.92535765 C11.002815,2.72106753 8.99951926,2.72139251 7.76421846,4.92535765 L3.7239688,12.1337797 C2.48848585,14.3380698 3.54098311,16.125 6.07269759,16.125 L13.9298189,16.125 Z M11.002944,14.0995516 L8.99957244,14.0995516 L8.99957244,12.0741033 L11.002944,12.0741033 L11.002944,14.0995516 L11.002944,14.0995516 Z M11.002944,11.0613791 L8.99957244,11.0613791 L8.99957244,7.01048239 L11.002944,7.01048239 L11.002944,11.0613791 L11.002944,11.0613791 Z",id:"Shape"}))))},F=function(){return l.createElement("div",{className:"error-tooltip"},l.createElement("div",{className:"error-tooltip__title"},_._("This folder is too large")),_._("We can’t calculate the full size of this folder right now. This can happen when there are a large number of files inside of the folder or if the request takes too long."))},E=function(e){var t=e.file;if(!t.is_dir)return l.createElement("span",null,t.size);switch(t.fetchFolderSizesStatus){case d.FetchFolderSizeStates.LOADING:return l.createElement("span",{className:"item-cell-title item-cell-title--loading"},l.createElement("span",{className:"ax-visually-hidden"},_._("Calculating folder sizes...")),l.createElement(y,null),0===t.bytes?_._("Calculating..."):t.size);case d.FetchFolderSizeStates.ERROR:return l.createElement("span",{className:"item-cell-title"},l.createElement(S,{content:l.createElement(F,null),position:S.POSITIONS.TOP,isTargetPositionFixed:!1},l.createElement("span",{className:"ax-visually-hidden"},_._("Error in calculating folder sizes")),l.createElement("span",null,l.createElement(T,null))),t.size);case d.FetchFolderSizeStates.COMPLETE:return l.createElement("span",{className:"item-cell-title"},t.size);default:return l.createElement(b,null)}},C=(function(t){function s(){var e=null!==t&&t.apply(this,arguments)||this;return e.checkboxRef=null,e.handleClick=function(t){if(!e.checkboxRef||!c.findDOMNode(e.checkboxRef).contains(t.target)){if(e.props.isSelectMode&&e.props.onDeselect&&e.props.onSelect){t.preventDefault();var r=e.props.file.fq_path;return void(e.props.isSelected?e.props.onDeselect(r,t.shiftKey):e.props.onSelect(r,t.shiftKey))}e.props.onOpenFile(t,e.props.file)}},e.handleClickViewFileButton=function(t){e.props.onOpenFile(t,e.props.file)},e.handleChangeCheckbox=function(t,r){if(e.props.onSelect&&e.props.onDeselect){var o=e.props.file.fq_path;"checked"===t?e.props.onSelect(o,r.shiftKey):e.props.onDeselect(o,r.shiftKey)}},e.handleDragEnter=function(t){var r=e.props,o=r.file,s=r.isSelected,n=r.isActiveDropTarget;e.props.onDragEnter(t,o,!!s,!!n)},e.handleDragStart=function(t){var r=e.props,o=r.file,s=r.isSelected,n=r.onDragStart,i=r.onSelect;n&&(s?n(t):(i&&i(o.fq_path),n(t,[o])))},e.setCheckboxRef=function(t){e.checkboxRef=t},e.rowChildFn=function(t){var r,s=t.isHovered,n=e.props,c=n.isCompactMode,d=n.isPinned,u=n.isSelectMode,p=n.isSelected,h=n.showUserEducationEffects,m=n.isTabbing,_=n.visibleColumns;if(!d){var g=!(m||s||p||u||c);r=l.createElement(i.Checkbox,{checked:p?"checked":"unchecked",className:o("brws-checkbox",{"brws-checkbox-checked":p}),onChange:e.handleChangeCheckbox,ref:e.setCheckboxRef,variant:g?"invisible":"default"}),h&&(r=l.createElement(f.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileSelectCheckbox",useSpan:!0},r))}return[l.createElement(a.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},l.createElement("div",{className:"brws-vertically-center"},r))].concat(_.map(function(t,r){return e.renderCell({isHovered:s,isLastCell:r===_.length-1,sortField:t.sortField})}))},e}return r.__extends(s,t),s.prototype.componentDidUpdate=function(e){var t=this;(this.props.isFocused&&!e.isFocused||this.props.isFocused&&this.props.isSelected&&!e.isSelected)&&this.checkboxRef&&Promise.resolve().then(function(){if(t.checkboxRef){var e=c.findDOMNode(t.checkboxRef);e&&e.focus()}})},s.prototype.renderMediaActions=function(e){var t=this.props,o=t.file,s=t.user,n=t.context,i=t.isCompactMode,c=t.isSelected,d=t.isSelectMode,u=t.isSharingDisabled,p=t.isTabbing,f=t.getFileActions,_=t.isSearchMode,g={browseContext:n,file:o,isSearchMode:_,user:s};return d?l.createElement(a.MediaActions,null,!u&&l.createElement(m.ShareButton,r.__assign({},g,{isVisible:!i&&(c||e)})),l.createElement(v,{isVisible:c||i||e,onClick:this.handleClickViewFileButton})):l.createElement(a.MediaActions,null,!u&&l.createElement(m.ShareButton,r.__assign({},g,{isVisible:p||e&&!i})),l.createElement(h.BrowseOverflowMenu,{file:o,actionItems:f(o),showBorders:p||e}))},s.prototype.renderModifiedCell=function(e,t){var r=e.ago,o=e.last_modified_fname||void 0,s=o&&_._("by %(modified_by)s",{comment:"name of the person that modified the file"}).format({modified_by:o});return l.createElement(a.MediaCell,{className:"brws-file-modified-at-cell",key:"modifiedAt",subtitle:s,title:r||l.createElement(b,null)},t)},s.prototype.renderSharedWithController=function(){var t=this.props,r=t.context,o=t.file,s=t.isSelectMode;if(!t.isSharedWithLoaded||w(o))return null;var n=e("modules/clean/react/browse/shared_with").SharedWithController;return l.createElement("div",{className:"brws-vertically-center brws-shared-with-wrapper"},l.createElement(n,{file:o,browseContext:r,isMaestroDesign:!0,inSelectMode:s}))},s.prototype.renderCell=function(e){var t=e.isHovered,r=e.isLastCell,o=e.sortField,s=this.props,n=s.file,i=s.user,c=s.isSearchMode,h=s.isSelectMode,m=s.isStarredLoaded,f=s.renameState,_=s.showCDMUserEducationEffects,S=s.showUserEducationEffects,w=r?this.renderMediaActions(t):void 0;switch(o){case d.BrowseSortFields.FILENAME:return l.createElement(u.FileNameCell,{key:"fileName",user:i,file:n,isHovered:t,isSearchMode:c,isSelectMode:h,mediaActions:w,onNavigateToPath:this.props.onNavigateToPath,onOpenFile:this.props.onOpenFile,onRenameCancel:this.props.onRenameCancel,onRenameSubmit:this.props.onRenameSubmit,renameState:f,showCDMUserEducationEffects:_,showHighlights:c,showLocation:c,showUserEducationEffects:S,showStar:m&&!h});case d.BrowseSortFields.MODIFIED:return this.renderModifiedCell(n,w);case d.BrowseSortFields.SHARED_WITH:return l.createElement(a.MediaCell,{className:"brws-file-shared-with-cell",key:"sharedWith"},this.renderSharedWithController(),w);case d.BrowseSortFields.CATEGORY:return l.createElement(a.MediaCell,{className:"brws-file-category-cell",key:"category",title:p.File.getCategoryDescription(n)},w);case d.BrowseSortFields.EXTENSION:return l.createElement(a.MediaCell,{className:"brws-file-extension-cell",key:"extension",title:p.File.getExtension(n)},w);case d.BrowseSortFields.SIZE:return l.createElement(a.MediaCell,{className:"brws-file-size-cell",key:"size",title:g.BROWSE_GET_FOLDER_SIZES?l.createElement(E,{file:n}):n.size||l.createElement(b,null)},w)}},s.prototype.render=function(){var e=this.props,t=e.file,s=e.isActiveDropTarget,n=e.isAvailableDropTarget,i=e.isPinned,c=e.isSelected,d=e.renameState,u=e.rowIndex,h=e.tabIndex,m=e.topOffset,f=o("brws-file-row",{"brws-file-row-selected":c,"brws-file-row-deleted":t.isDeleted,"brws-file-row-droppable":n&&!s,"brws-file-row-dragover":s,"brws-file-row-no-access":p.File.isNoAccessSharedFolder(t),"brws-file-row-pinned":i}),_=s?"dragover":n&&!s?"droppable":c?"selected":"default",g={"aria-rowindex":void 0!==u?u+1:void 0,className:f,"data-filename":t.fq_path.split("/").slice(-1),onClick:this.handleClick,onDragEnter:this.handleDragEnter,tabIndex:h,variant:_};return i?l.createElement(a.MediaRow,r.__assign({},g),this.rowChildFn):l.createElement(a.CulledMediaRow,r.__assign({},g,{draggable:!d,onDragStart:this.handleDragStart,topOffset:m}),this.rowChildFn)},s})(l.PureComponent);C.defaultProps={isSelectionEmpty:!0,topOffset:0},t.FileRow=C}),define("modules/clean/react/browse/files_view/list",["require","exports","tslib","external/react","modules/clean/react/browse/browse_drag_and_drop","modules/clean/react/browse/files_view/constants","modules/clean/react/browse/files_view/culled_table_body","modules/clean/react/browse/files_view/file_row","modules/clean/react/browse/files_view/new_folder_row","modules/clean/react/browse/files_view/paper_row","modules/clean/react/browse/files_view/selectors","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/models"],function(e,t,r,o,s,n,i,a,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(){},m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrollToRow:0},t.getIsListEvent=function(e){return t.props.isSelectableListEvent()&&"BUTTON"!==e.target.tagName},t.getSelectedFiles=function(){return t.props.selectedFiles},t.handleNavigateToFileOrFolder=function(e){t.props.onNavigateToFileOrFolder(e,function(){var e=t.props.selectedFiles.first();e&&t.props.onFocusFile(e.fq_path)})},t.enableContextMenu=function(){return!1},t.getActiveDropTarget=function(){return t.props.activeDropTarget},t.getIsDraggingInternalFiles=function(){return!!t.props.isDraggingInternalFiles},t.getIsDraggingExternalFiles=function(){return!!t.props.isDraggingExternalFiles},t.renderRow=function(e,r,s){if("NewFolderRow"===e.type)return o.createElement(l.NewFolderRow,{createNewFolderState:e.props.createNewFolderState,isInsideTeamFolderTree:e.props.isInsideTeamFolderTree,onCancel:t.props.onNewFolderCancel,onSubmit:t.props.onNewFolderSubmit,rowIndex:r,topOffset:s});if("PaperRow"===e.type)return o.createElement(c.PaperRow,{paper:e.props.paper,isSearchMode:e.props.isSearchMode,rowIndex:r,topOffset:s,user:t.props.user,visibleColumns:e.props.visibleColumns});var n=t.props.selection,i=e.props.file,d=n.selected.last()===e.props.file.fq_path||!n.selected.size&&0===r?0:void 0;return o.createElement(a.FileRow,{context:t.props.context,file:i,getFileActions:t.props.getFileActions,isActiveDropTarget:e.props.isActiveDropTarget,isAvailableDropTarget:e.props.isAvailableDropTarget,isCompactMode:e.props.isCompactMode,isFocused:e.props.isFocused,isSearchMode:e.props.isSearchMode,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,isSharedWithLoaded:e.props.isSharedWithLoaded,isSharingDisabled:e.props.isSharingDisabled,isStarredLoaded:e.props.isStarredLoaded,isTabbing:e.props.isTabbing,key:i.fq_path,onDeselect:t.props.onDeselectFile,onDragStart:t.props.onDragStart,onDragEnter:t.props.onDragEnter,onNavigateToPath:t.props.onNavigateToPath,onOpenFile:t.props.onOpenFile,onRenameCancel:t.props.onRenameCancel,onRenameSubmit:t.props.onRenameSubmit,onSelect:t.props.onSelectFile,renameState:e.props.renameState,rowIndex:r,showUserEducationEffects:0===r,showCDMUserEducationEffects:p.File.isTeamMemberFolder(i),tabIndex:d,topOffset:s,user:t.props.user,visibleColumns:e.props.visibleColumns})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.onTTI(),this.setupKeyboardShortcuts(),this.setupExternalDragHandler(),this.props.selectedFiles.size&&!this.props.isFileViewerShown()&&this.setState({scrollToRow:this.getRowIndexForFile(this.props.selectedFiles.first())})},t.prototype.componentWillReceiveProps=function(e){this.props.scrollToRow!==e.scrollToRow&&this.setState({scrollToRow:e.scrollToRow})},t.prototype.componentDidUpdate=function(e){
e.createNewFolderState===this.props.createNewFolderState||"PENDING_INPUT"!==this.props.createNewFolderState||this.props.isFileViewerShown()||this.setState(function(e){return 0===e.scrollToRow?(window.scrollTo(0,0),{}):{scrollToRow:0}})},t.prototype.componentWillUnmount=function(){this.cleanupKeyboardShortcuts(),s.cleanupExternalDragHandler(this.props.keyScope)},t.prototype.getRowIndexForFile=function(e){return this.props.files.indexOf(e)},t.prototype.cleanupKeyboardShortcuts=function(){u.resetBrowseKeyboardShortcuts(this.props.keyScope)},t.prototype.setupKeyboardShortcuts=function(){var e=this.props,t=e.actionHandlers,r=e.getIsFileJumping,o=e.keyScope,s=e.onCopyToClipboard,n=e.onNavigateToParentFolder,i=e.onPasteFromClipboard,a=e.onSetDragCopyMode;u.setupItemListKeyboardShortcuts(r,this.getIsGlobalEvent(),this.getIsListEvent,this.getSelectedFiles,this.props.getIsCurrentPathWriteable,this.enableContextMenu,h,h,s,t.onDelete,this.handleNavigateToFileOrFolder,n,i,a,t.onShowRename,h,o)},t.prototype.setupExternalDragHandler=function(){s.setupExternalDragHandler(this.props.keyScope,this.getIsDraggingInternalFiles,this.getIsDraggingExternalFiles,this.props.onSetFileUploaderPath,".brws-file-row",this.getActiveDropTarget,this.props.onSetDropTarget)},t.prototype.getIsGlobalEvent=function(){return u.generateGetIsGlobalEvent(this)},t.prototype.render=function(){var e=this.props,t=e.scrollPositionOffset,r=e.viewportTopOffset;return o.createElement(i.CulledTableBodyWithScrollToRow,{items:d.getFilesViewListRowItems(this.props),listItemHeight:n.DEFAULT_ROW_HEIGHT,renderRow:this.renderRow,scrollPositionOffset:t,scrollToRow:this.state.scrollToRow,viewportTopOffset:r})},t})(o.PureComponent);m.defaultProps={isFileViewerShown:function(){return!1}},t.FilesViewList=m}),define("modules/clean/react/browse/files_view/new_folder_row",["require","exports","external/spectrum/media_table","external/spectrum/table","external/react","modules/clean/react/browse/new_folder_icon","modules/clean/react/browse/name_input","modules/core/i18n"],function(e,t,r,o,s,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFolderRow=function(e){var t,l=e.createNewFolderState,c=e.isInsideTeamFolderTree,d=void 0!==c&&c,u=e.onCancel,p=e.onSubmit,h=e.rowIndex,m=e.topOffset;return t="SAVING_INPUT"===l?s.createElement("p",{className:"brws-new-folder-row-status",role:"status","aria-live":"polite"},a._("Creating new folder…")):s.createElement(i.NameInput,{defaultValue:"",label:a._("Folder name"),onSubmit:p,onCancel:u}),s.createElement(r.CulledMediaRow,{"aria-rowindex":void 0!==h?h+1:void 0,className:"brws-new-folder-row",topOffset:m},s.createElement(o.TableCell,{className:"brws-checkbox-cell"}),s.createElement(r.MediaCell,{icon:s.createElement(n.NewFolderIcon,{inTeamFolder:d})},s.createElement("div",{className:"brws-new-folder-row-content brws-vertically-center"},t)),s.createElement(o.TableCell,null),s.createElement(o.TableCell,null))}}),define("modules/clean/react/browse/files_view/paper_row",["require","exports","tslib","external/spectrum/media_table","external/react","modules/clean/react/browse/constants","modules/clean/react/browse/constants","modules/clean/react/browse/paper_row_icon","modules/clean/search/search_helpers","modules/core/browser","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDocNameClick=function(e){t.props.isSearchMode&&l.logSearchAction({result:t.props.paper,user:t.props.user,action_type:"paper_open",view_type:i.ViewTypes.List}),e.stopPropagation()},t.handleRowClick=function(e){e.ctrlKey?c.open_tab(t.props.paper.url):c.redirect(t.props.paper.url)},t}return r.__extends(t,e),t.prototype.renderDocName=function(e){var t=this.props,r=t.paper,n=t.showHighlights,i=s.createElement("a",{className:"brws-paper-doc-name-cell-title",href:r.url,onClick:this.handleDocNameClick},n?l.highlightMatchReact(r.title,r.title_highlights):s.createElement("span",null,r.title));return s.createElement(o.MediaCell,{highlight:e,icon:s.createElement(a.PaperRowIcon,{className:"brws-file-name-cell-icon"}),key:"docName"},s.createElement("div",{className:"brws-paper-doc-name-cell-content brws-vertically-center"},s.createElement(o.MediaCellText,{highlight:e},i),s.createElement(o.MediaCellText,{highlight:e,variant:"subtitle"},d._("in Paper",{comment:"The Dropbox Paper page"}))))},t.prototype.renderDocInfo=function(){var e=this.props.paper,t=e.last_modified_date?d._("Modified %(date)s").format({date:e.last_modified_date}):"";return s.createElement(o.MediaCell,{key:"docInfo",subtitle:e.creator_name,title:t})},t.prototype.renderCell=function(e){var t=e.isHovered;switch(e.sortField){case n.BrowseSortFields.FILENAME:return this.renderDocName(t);case n.BrowseSortFields.MODIFIED:return this.renderDocInfo()}return null},t.prototype.render=function(){var e=this,t=this.props,r=t.rowIndex,n=t.topOffset,i=t.visibleColumns;return s.createElement(o.CulledMediaRow,{"aria-rowindex":void 0!==r?r+1:void 0,className:"brws-paper-row",draggable:!1,onClick:this.handleRowClick,topOffset:n,variant:"default"},function(t){var r=t.isHovered;return[s.createElement(o.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"})].concat(i.map(function(t){return e.renderCell({isHovered:r,sortField:t.sortField})}))})},t})(s.PureComponent);u.defaultProps={showHighlights:!0,isSearchMode:!0},t.PaperRow=u}),define("modules/clean/react/browse/files_view/pinned_team_folder_view",["require","exports","tslib","external/classnames","external/spectrum/dimensions","external/spectrum/table","external/spectrum/vertically_fixed","modules/clean/react/browse/file_list_utils","modules/clean/react/browse/files_view/constants","modules/clean/react/browse/files_view/file_row","modules/clean/react/browse/models","external/react","modules/clean/react/sprite","modules/constants/python","modules/constants/subgrowth_experiments","modules/core/i18n","modules/clean/react/tooltip","modules/clean/user_education/user_education_client"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.displayName="PinnedTeamFolderView",t.isSubgrowthPinnedExp=function(){return"ON"===m.SUBGROWTH_BIZ_TRIAL_ONBOARDING_EXP1||["V1","V2"].includes(m.SUBGROWTH_BIZ_TRIAL_ONBOARDING_EXP2)},t.renderTeamFolderRow=function(e,r){var o=t.props,s=o.activeDropTarget,n=o.context,i=o.dropTargetHighlightMode,p=o.getFileActions,h=o.isTabbing,m=o.onDragEnter,f=o.onOpenFile,_=o.onRenameCancel,S=o.onRenameSubmit,w=o.user,b=a.shouldFileBeHighlightedDropTarget({dropTargetHighlightMode:i,file:e,isSelected:!1}),v=u.createElement(c.FileRow,{context:n,file:e,getFileActions:p,key:encodeURI(e.fq_path),isAvailableDropTarget:b,isActiveDropTarget:e===s,isPinned:!0,isTabbing:h,onDragEnter:m,onOpenFile:f,onRenameCancel:_,onRenameSubmit:S,showUserEducationEffects:0===r,showCDMUserEducationEffects:d.File.isTeamMemberFolder(e),user:w,visibleColumns:l.LIST_VIEW_COLUMNS.slice(0,1)});return r>0?v:u.createElement(g.UserEducationEffect,{containerName:"PinnedTeamFolder",name:"TeamFolder",key:encodeURI(e.fq_path)+"-UserEducationEffect"},v)},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){g.UEClient.sendEvent(this.displayName,"componentDidMount",JSON.stringify(this.props.context))},t.prototype.renderHeaderTitle=function(e,t){var r=t?u.createElement("span",{className:"brws-pinned-team-folder-info-button"},u.createElement(_.Tooltip,{position:_.TooltipPosition.RIGHT,tooltip_contents:u.createElement("div",null,t),tooltip_classname:"brws-pinned-team-folder-tooltip"},u.createElement(p,{group:"web",name:"info",alt:f._("File section information")}))):null;return u.createElement("span",{className:"brws-pinned-team-folder-header-title"},u.createElement("span",null,e),r)},t.prototype.renderContent=function(e){var t=this.props,r=t.columnFlex,s=t.isCompactMode,i=t.teamFolders,a=f.ungettext("Team folder","Team folders",i.size),l=this.props.expSubgrowthBizTeamHomeContent?this.renderHeaderTitle(a,f._("Team folders are the hub of content for a team and contents are           automatically shared with team folder members. %(trademark_business)s           team admins own and manage team folders.").format({trademark_business:h.TRADEMARK_BUSINESS})):this.renderHeaderTitle(a,f._("Everything in a Team folder is automatically shared with your team.           Team folders can also contain shared folders for collaborating with           people outside your team.")),c=this.props.expSubgrowthBizTeamHomeContent?this.renderHeaderTitle(f._("Everything else")):this.renderHeaderTitle(f._("Other folders"),f._("These folders help you organize your private work files."));return u.createElement("div",{className:"brws-pinned-team-folder-view",style:e},u.createElement(n.Table,{columnFlex:r},u.createElement(n.TableHead,{className:o("brws-column-header","brws-pinned-team-folder-header",{"brws-column-header-compact brws-pinned-team-folder-header-compact ":s})},u.createElement(n.TableHeadCell,{className:"brws-checkbox-cell"}),u.createElement(n.TableHeadCell,{className:"brws-vertically-center"},l)),u.createElement(n.TableBody,null,i.map(this.renderTeamFolderRow))),u.createElement(n.Table,{columnFlex:r},u.createElement(n.TableHead,{className:o("brws-column-header","brws-pinned-team-folder-header","brws-pinned-team-folder-header-secondary",{"brws-column-header-compact brws-pinned-team-folder-header-compact ":s})},u.createElement(n.TableHeadCell,{className:"brws-checkbox-cell"}),u.createElement(n.TableHeadCell,{className:"brws-vertically-center"},c))))},t.prototype.render=function(){var e=this;return this.isSubgrowthPinnedExp()?this.renderContent():u.createElement(s.Dimensions,{className:o("brws-pinned-team-folder-view-fixed",{"brws-pinned-team-folder-view-fixed-compact":this.props.isCompactMode})},function(t){var r=t.width,o=t.height;return u.createElement(i.VerticallyFixed,null,e.renderContent({width:r,height:o}))})},t})(u.Component);t.PinnedTeamFolderView=S}),define("modules/clean/react/browse/files_view/selectable_list",["require","exports","tslib","external/immutable","external/keymaster","external/react","external/react-dom","modules/core/browser"],function(e,t,r,o,s,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l="",c=(function(e){function t(t){var r=e.call(this,t)||this;return r.isFocused=!1,r.handleSelectPrevious=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.selectNeighboringItem("up"))},r.handleExtendSelectionToPrevious=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.extendSelectionRange("up"))},r.handleSelectNext=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.selectNeighboringItem("down"))},r.handleExtendSelectionToNext=function(e){r.isGlobalEvent(e)&&(e.preventDefault(),r.extendSelectionRange("down"))},r.handleDeselectAll=function(e){var t=r.props.selection;if((!e||r.isGlobalEvent(e))&&t.selected.size&&(r.updateSelection([],!0),i.findDOMNode(r).contains(document.activeElement))){var o=document.activeElement;o.blur&&o.blur()}},r.handleSelectAll=function(e){var t=r.props,o=t.itemIds,s=t.selection;e&&!r.isGlobalEvent(e)||s.selected.size===o.length||r.updateSelection(r.props.itemIds,!0)},r.handleDeselect=function(e,t){if(t)return r.extendOrShrinkSelectionByFile(e);r.updateSelectionById(e,"delete")},r.handleSelect=function(e,t){if(t)return r.extendOrShrinkSelectionByFile(e);r.updateSelectionById(e,"add")},r.handleFocusFile=function(e){r.setState({focusedFileId:e})},r.isSelectableListEvent=function(){return r.isFocused},r.handleFocus=function(){r.isFocused=!0},r.handleBlur=function(){r.isFocused=!1},r.state={focusedFileId:null,selection:t.selection},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.setupKeyboardShortcuts(),this.setFocusedIdFromSelection(this.props.selection)},t.prototype.componentDidUpdate=function(e,t){e.selection&&this.props.selection&&e.selection.anchor!==this.props.selection.anchor&&this.setFocusedIdFromSelection(this.props.selection)},t.prototype.componentWillUnmount=function(){this.cleanupKeyboardShortcuts()},t.prototype.setupKeyboardShortcuts=function(){var e=this,t=this.props.keyScope;l=s.getScope(),l!==t&&s.setScope(t),s.filter=function(t){var r=t.target||t.srcElement,o=r.tagName;return(!e.isSelectableListEvent()||"BUTTON"!==o)&&!(("INPUT"===o||"SELECT"===o||"TEXTAREA"===o)&&r instanceof HTMLInputElement&&"checkbox"!==r.type)},s("up",t,this.handleSelectPrevious),s("shift+up",t,this.handleExtendSelectionToPrevious),s("down",t,this.handleSelectNext),s("shift+down",t,this.handleExtendSelectionToNext),s("escape",t,this.handleDeselectAll),a.mac?s("command+a",t,this.handleSelectAll):s("ctrl+a",t,this.handleSelectAll)},t.prototype.cleanupKeyboardShortcuts=function(){s.clearScope(this.props.keyScope),l&&s.setScope(l),s.resetFilter()},t.prototype.setFocusedIdFromSelection=function(e){e.anchor&&0!==e.selected.size&&this.setState({focusedFileId:e.anchor})},t.prototype.handleTabbingStart=function(){document.body.classList.add("tabbing"),this.props.onTabbingStart()},t.prototype.updateSelection=function(e,t){void 0===t&&(t=!1);var r=this.props.selection,s=t?e.length?e[0]:this.props.itemIds[0]:r.anchor,n=r.merge({selected:o.OrderedSet(e),anchor:s});this.props.onSelectionChange(n)},t.prototype.selectNeighboringItem=function(e){var t=this.props,r=t.itemIds,o=t.selection,s=r.indexOf(o.selected.last()),n=0;n="up"===e?Math.max(0,s-1):Math.min(r.length-1,s+1);var i=r[n];this.setState({focusedFileId:i}),this.updateSelection([i],!0),this.handleTabbingStart()},t.prototype.extendSelectionRange=function(e){var t=this.props,r=t.itemIds,o=t.selection,s=o.anchor||r[0];if(s){var n=r.indexOf(o.selected.last()),i=o.selected.toArray(),a=r.indexOf(s),l=this.getRangeOfSelectedBlock(s),c=l.startIndex,d=l.endIndex;if("up"===e){if(0===n)return;if(a===d)c-1>=0&&i.push(r[c-1]);else{var u=i.indexOf(r[d]);i.splice(u,1)}}else{if(n===r.length)return;if(a===c||a!==d)d+1<r.length&&i.push(r[d+1]);else{var u=i.indexOf(r[c]);i.splice(u,1)}}this.setState({focusedFileId:i[i.length-1]}),this.updateSelection(i),this.handleTabbingStart()}},t.prototype.getRangeOfSelectedBlock=function(e){for(var t=this.props,r=t.itemIds,o=t.selection,s=r.indexOf(e),n=0,i=0;n=s,s--,!(s<0)&&o.selected.has(r[s]););for(s=n;;){var a=r[s];if(!a||!o.selected.has(a))break;i=s,s++}return{startIndex:n,endIndex:i}},t.prototype.extendOrShrinkSelectionByFile=function(e){var t=this.props,r=t.itemIds,o=t.selection,s=o.anchor||r[0];if(s){var n=r.indexOf(s),i=r.indexOf(e),a=this.getRangeOfSelectedBlock(s),l=a.startIndex,c=a.endIndex;if(i!==c){var d=[],u=[];r.forEach(function(e,t){l<=t&&t<=c&&d.push(e),(i<=t&&t<=n||n<=t&&t<=i)&&u.push(e)}),i<n&&u.reverse();var p=o.update("selected",function(e){return e.subtract(d).union(u)});this.setState({focusedFileId:e}),this.props.onSelectionChange(p),this.handleTabbingStart()}}},t.prototype.updateSelectionById=function(e,t){var r=this.props.selection,o=r.selected[t](e),s=r.merge({selected:o,anchor:o.first()||null});this.props.onSelectionChange(s)},t.prototype.isGlobalEvent=function(e){var t=e.target instanceof HTMLInputElement,r=t&&"checkbox"===e.target.type;return!document.activeElement||document.activeElement===document.body||i.findDOMNode(this).contains(e.target)&&(!t||r)},t.prototype.render=function(){var e=this.props.children,t=this.state.focusedFileId;if(!e)return null;var r=e;return"function"==typeof e&&(r=e({focusedFileId:t,handleDeselect:this.handleDeselect,handleDeselectAll:this.handleDeselectAll,handleFocusFile:this.handleFocusFile,handleSelect:this.handleSelect,handleSelectAll:this.handleSelectAll,isSelectableListEvent:this.isSelectableListEvent})),n.createElement("div",{onBlur:this.handleBlur,onFocus:this.handleFocus},r)},t})(n.PureComponent);t.SelectableList=c}),define("modules/clean/react/browse/files_view/selectors",["require","exports","tslib","external/reselect","modules/clean/react/browse/file_list_utils","modules/clean/react/browse/models"],function(e,t,r,o,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o.createSelector(function(e){return e.isCompactMode},function(e){return e.isSelectMode},function(e){return e.isSharedWithLoaded},function(e){return e.isStarredLoaded},function(e){return e.isSearchMode},function(e){return e.isTabbing},function(e,t,r,o,s,n){return{isCompactMode:e,isSelectMode:t,isSharedWithLoaded:r,isStarredLoaded:o,isSearchMode:s,isTabbing:n}});t.getFilesViewListRowItems=o.createSelector(i,function(e){return e.activeDropTarget},function(e){return e.context},function(e){return e.createNewFolderState},function(e){return e.dropTargetHighlightMode},function(e){return e.files},function(e){return e.fileRename},function(e){return e.focusedFileId},function(e){return e.selection},function(e){return e.user},function(e){return e.visibleColumns},function(e,t,o,i,a,l,c,d,u,p,h){var m=l.toArray().map(function(i){if(i instanceof n.Paper)return{type:"PaperRow",props:{isSearchMode:e.isSearchMode,paper:i,visibleColumns:h}};var l=u.selected.has(i.fq_path),m=s.shouldFileBeHighlightedDropTarget({file:i,isSelected:l,dropTargetHighlightMode:a});return{type:"FileRow",props:r.__assign({},e,{file:i,isActiveDropTarget:m&&t===i,isAvailableDropTarget:m,isFocused:i.fq_path===d,isSelected:l,isSharingDisabled:s.isSharingDisabledForFile({context:o,file:i,user:p}),renameState:c&&c.file===i?c.state:void 0,visibleColumns:h})}});return i&&"CREATE_FOLDER_INACTIVE"!==i&&m.unshift({type:"NewFolderRow",props:{createNewFolderState:i,isInsideTeamFolderTree:o.isInsideTeamFolderTree}}),m}),t.getItemIds=o.createSelector(function(e){return e.files},function(e){return e.toArray().map(function(e){return e.fq_path})})}),define("modules/clean/react/browse/files_view/sticky_table_head",["require","exports","tslib","external/spectrum/dimensions","external/spectrum/table","external/react","modules/clean/react/sticky/sticky","modules/clean/react/sticky/container"],function(e,t,r,o,s,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickyTableHead=function(e){var t=e.children,l=e.columnFlex,c=e.offsetHeight,d=e.offsetTop,u=r.__rest(e,["children","columnFlex","offsetHeight","offsetTop"]);return n.createElement("thead",{className:"brws-sticky-table-head"},n.createElement(o.Dimensions,{tagName:"tr"},function(e){var o=e.width;return n.createElement("td",{className:"brws-sticky-table-cell"},n.createElement(a.StickyContainer,{offsetTop:d,useNativeSticky:!0,useWindowToDetermineBottom:!0},n.createElement(i.Sticky,{offsetHeight:c},n.createElement(s.Table,{columnFlex:l,style:{width:o}},n.createElement(s.TableHead,r.__assign({},u),t)))))}))}}),define("modules/clean/react/browse/files_view/tile_grid",["require","exports","tslib","external/classnames","external/immutable","external/react","external/spectrum/button","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/browse_drag_and_drop","modules/clean/react/browse/constants","modules/clean/react/browse/file_actions","modules/clean/react/browse/file_grouper","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/models","modules/clean/react/browse/overflow_menu","modules/clean/react/browse/tile_label_input","modules/clean/react/maestro/tile_grid","modules/clean/react/title_bubble","modules/clean/static_urls","modules/core/i18n","modules/core/uri"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S,w,b,v){"use strict";function y(e){var t;return e.thumbnail_url_tmpl&&(t=v.parse(e.thumbnail_url_tmpl),t=t.removeQuery("size").removeQuery("size_mode"),t=t.updateQuery({size:"256x256",size_mode:"2"}).toString()),t}Object.defineProperty(t,"__esModule",{value:!0}),t.getThumbnailUrlForItem=y;var T=["ai","au","fl","key","numbers","pages","pkg","pr","psd","sketch","txt","md"],F=["acrobat","code","compressed","excel","film","gear","picture","powerpoint","sound","word"],E=["folder","folder_app","folder_camera","folder_team","folder_team_locked","folder_user","folder_user_locked"],C=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={inSelectMode:!1,sectionLabels:s.List(),sectionStartIndices:s.List(),selectedIds:s.Set(),totalNumItems:0},t.setTileGridRef=function(e){t.tileGrid=e},t.getTileItem=function(e,o){var s,a=t.props,c=a.activeDropTarget,d=a.isCreateFolderUIActive,u=a.isPhotosPage,p=a.items,h=a.selection;if(d){if(0===e)return t.getCreateFolderTile();e-=1}var f=p.get(e);if(!f){var _="Placeholder "+e;return{altText:_,iconUrl:t.props.isPhotosPage?w.static_url("/static/images/maestro/tile-icons/picture-vflIDcp5T.svg"):w.static_url("/static/images/maestro/tile-icons/unknown-vflEPx1xQ.svg"),id:_,isViewOnly:!0,isDraggable:!1,isSelectable:!1}}var g=t.createViewFileHandler(f),S=t.createToggleSelectHandler(f),v=f instanceof m.File,T=g,F=!1,E=!1;v&&(s=t.renderTileOverflowMenu(f,o)),t.state.inSelectMode&&(F=h.anchor===f.fq_path,E=h.selected.has(f.fq_path),T=S,v&&(s=n.createElement(i.Button,{className:"tile__action-button--view-file",variant:"secondary",size:"small","aria-label":b._("View File"),onClick:g})));var C=u?void 0:t.renderLabelElement(f),I=l.filename(f.fq_path),A=y(f),D=f===c,R=t.getSVGIconName(f),N={id:f.sjid.toString(),labelNode:C,altText:I,iconUrl:w.static_url("/static/images/maestro/tile-icons/"+R+".svg"),thumbnailUrl:A,actionNode:s,onTileAction:T,isDraggable:!1,isFocused:F,isSelectable:!0,handleToggleSelect:S,checkboxAriaText:b._("Select tile")};return u||(N=r.__assign({},N,{isDraggable:!0,onDragEnter:t.createDragEnterHandler(f,E,D),onDragStart:t.createDragStartHandler(f,E,S)})),N},t}return r.__extends(t,e),t.prototype.componentWillMount=function(){this.setState({inSelectMode:this.props.selectedFiles.count()>0}),this.setTotalNumItems(this.props),this.setTileItemsSections(this.props),this.setSelectedTiles(this.props)},t.prototype.componentDidMount=function(){this.setupExternalDragHandler(),this.setupKeyboardShortcuts()},t.prototype.componentWillUnmount=function(){h.resetBrowseKeyboardShortcuts("BrowseTileGrid")},t.prototype.componentWillReceiveProps=function(e){e.items===this.props.items&&e.createNewFolderState===this.props.createNewFolderState||this.setTotalNumItems(e),e.selectedFiles!==this.props.selectedFiles&&(this.setSelectedTiles(e),this.setState({inSelectMode:e.selectedFiles.count()>0})),e.activeSortField===this.props.activeSortField&&e.activeSortDirection===this.props.activeSortDirection&&e.sections===this.props.sections&&e.items===this.props.items||this.setTileItemsSections(e)},t.prototype.componentDidUpdate=function(e){(e.createNewFolderState===d.NewFolderCreationStates.PENDING_INPUT&&this.props.createNewFolderState===d.NewFolderCreationStates.SAVING_INPUT||e.fileRename!==this.props.fileRename||e.items!==this.props.items)&&this.tileGrid.forceUpdate()},t.prototype.setTotalNumItems=function(e){var t=Math.max(e.items.size,e.totalNumItems);e.isCreateFolderUIActive&&(t+=1),this.setState({totalNumItems:t})},t.prototype.setTileItemsSections=function(e){var t;t=e.sections?e.sections:e.activeSortField?p.getSections(e.items,e.activeSortField,e.activeSortDirection):{sectionLabels:[],sectionStartIndices:[]},this.setState({sectionLabels:s.List(t.sectionLabels),sectionStartIndices:s.List(t.sectionStartIndices)})},t.prototype.createRenameCancelHandler=function(e){var t=this;return function(){t.props.onRenameCancel(e)}},t.prototype.createRenameSubmitHandler=function(e){var t=this;return function(r){t.props.onRenameSubmit(e,r)}},t.prototype.createToggleSelectHandler=function(e){var t=this,r=e.fq_path;return function(){var e=t.props.selection;e=e.selected.has(r)?e.update("selected",function(e){return e.delete(r)}):e.update("selected",function(e){return e.add(r)}).set("anchor",r),t.props.onSelectionChange(e)}},t.prototype.renderTileOverflowMenu=function(e,t){var r=this.props.getFileActions(e),o=0===t?"left":"right";return n.createElement(f.BrowseOverflowMenu,{file:e,attachment:o,actionItems:r,size:f.OverflowMenuSize.Small,showBorders:!0})},t.prototype.renderLabelElement=function(e){var t=l.filename(e.fq_path);if(this.props.fileRename&&l.paths_are_equal(this.props.fileRename.file.fq_path,e.fq_path)){if(this.props.fileRename.state===d.RenameStates.PENDING_INPUT)return n.createElement(_.TileLabelInput,{defaultValue:t,label:t,onCancel:this.createRenameCancelHandler(e),onSubmit:this.createRenameSubmitHandler(e)});if(this.props.fileRename.state===d.RenameStates.SAVING_INPUT)return n.createElement(g.TileItemLabelText,{className:"tile-label__text--saving",label:b._("Renaming…")})}var r=a.em_snippet(t,16,.5),o=n.createElement(g.TileItemLabelText,{label:r});return t!==r?n.createElement(S,{content:t,position:S.POSITIONS.BOTTOM,className:"tile-label__title-bubble"},o):o},t.prototype.createViewFileHandler=function(e){var t=this;return this.props.isPhotosPage?function(r){r.preventDefault();var o=t.props.items.filter(function(e){return!!e}).toJS(),s=o.findIndex(function(t){return t.file_id===e.file_id});u.doOpenPhoto({event:r,user:t.props.user,files:o,index:s,onFileViewerUnmount:function(){return t.tileGrid&&t.tileGrid.getAndUpdateTileLayout()},source:"photos_page"})}:function(r){r.preventDefault(),u.doOpenFile({event:r,user:t.props.user,file:e,isSearchMode:t.props.isSearchMode,constructorDisplayName:"BrowseTileGrid",onFileViewerUnmount:function(){return t.tileGrid&&t.tileGrid.getAndUpdateTileLayout()},source:"visual_browse"})}},t.prototype.getSVGIconName=function(e){var t=this.getSVGIconBaseName(e);return e.isDeleted&&(t+="-disabled"),t},t.prototype.getSVGIconBaseName=function(e){var t=e.icon;if(t&&("_32"===t.slice(-3)&&(t=t.slice(0,-3)),"page_white_"===t.slice(0,11)&&(t=t.slice(11)),"_gray"===t.slice(-5)&&(t=t.slice(0,-5))),e.is_dir)return E.includes(t)?t:"folder";var r=l.file_extension(l.filename(e.fq_path));return T.includes(r)?r:F.includes(t)?t:"unknown"},t.prototype.setSelectedTiles=function(e){var t=s.Set().withMutations(function(t){e.selectedFiles.forEach(function(e){t.add(e.sjid.toString())})});this.setState({selectedIds:t})},t.prototype.setupExternalDragHandler=function(){var e=this,t=function(){return!!e.props.isDraggingInternalFiles},r=function(){return!!e.props.isDraggingExternalFiles},o=function(){return e.props.activeDropTarget};c.setupExternalDragHandler("BrowseTileGrid",t,r,this.props.setFileUploaderPath,".tile",o,this.props.onSetDropTarget)},t.prototype.setupKeyboardShortcuts=function(){var e=this,t=this.props,r=t.actionHandlers,o=t.deselectAll,s=t.getIsCurrentPathWriteable,n=t.getIsFileJumping,i=t.onCopyToClipboard,a=t.onPasteFromClipboard,l=t.onSetDragCopyMode,c=t.selectAll,d=h.generateGetIsGlobalEvent(this),u=d,p=function(){return e.props.selectedFiles};h.setupGeneralBrowseKeyboardShortcuts(n,d,u,p,!1,s,c,o,i,r.onDelete,a,l,r.onShowRename,"BrowseTileGrid")},t.prototype.createDragEnterHandler=function(e,t,r){var o=this;return function(s){o.props.onDragEnter(s,e,t,r)}},t.prototype.createDragStartHandler=function(e,t,r){var o=this;return function(s){t?o.props.onDragStart(s):(r(),o.props.onDragStart(s,[e]))}},t.prototype.getCreateFolderTile=function(){var e=b._("New folder"),t=n.createElement("div",null);return this.props.createNewFolderState===d.NewFolderCreationStates.PENDING_INPUT?(e=b._("Folder name"),t=n.createElement(_.TileLabelInput,{label:e,onCancel:this.props.onNewFolderCancel,onSubmit:this.props.onNewFolderSubmit})):this.props.createNewFolderState===d.NewFolderCreationStates.SAVING_INPUT&&(e=b._("Creating new folder…"),t=n.createElement(g.TileItemLabelText,{className:"tile-label__text--saving",label:e})),{altText:e,iconUrl:w.static_url("/static/images/maestro/tile-icons/folder-vflMFXe_s.svg"),id:"New folder tile",isDraggable:!1,isSelectable:!1,labelNode:t}},t.prototype.getTileGridRef=function(){return this.tileGrid},t.prototype.render=function(){var e=this.props.enableMaxHeightGrouping,t=o({"file-tile-grid-container":!0,"file-tile-grid-container--show-checkboxes":this.state.inSelectMode});return n.createElement("div",null,n.createElement(g.InfiniteTileGrid,{key:"tileGrid",ref:this.setTileGridRef,totalNumItems:this.state.totalNumItems,containerClass:t,rowClass:"file-tile-row",enableMaxHeightGrouping:e,delayRenderFullTile:!this.props.isCreateFolderUIActive,logTileLoading:!0,numThresholdRows:d.BrowseTileGridConstants.NUM_THRESHOLD_ROWS,scrollDeltaThreshold:d.BrowseTileGridConstants.SCROLL_DELTA_THRESHOLD,sectionStartIndices:this.state.sectionStartIndices,sectionLabels:this.state.sectionLabels,showLabels:!this.props.isPhotosPage,contentOffset:136,getTileItem:this.getTileItem,selectedIds:this.state.selectedIds,handleTTI:this.props.handleTTI,thumbStore:this.props.thumbStore,onRangeInView:this.props.onRangeInView}))},t})(n.PureComponent);C.defaultProps={isUnityLoaded:!1,enableMaxHeightGrouping:!1},t.BrowseTileGrid=C}),define("modules/clean/react/browse/files_view/view_type_column_header_menu",["require","exports","tslib","external/spectrum/icon_form","external/spectrum/icon_mode","external/spectrum/popover","external/react","modules/clean/react/browse/constants","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelection=function(e){e!==t.props.viewType&&t.props.onSwitchViewType(e)},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.viewType;return i.createElement(n.Popover,{className:"brws-view-type-column-header-menu",onSelection:this.handleSelection},i.createElement(n.PopoverTrigger,{className:"brws-view-type-column-header-menu-trigger",title:e===a.ViewTypes.Grid?l._("Grid"):l._("List")},i.createElement(s.IconMode,{name:e===a.ViewTypes.Grid?"tiles":"list"}),i.createElement(o.IconForm,{name:"caret-down"})),i.createElement(n.PopoverContent,{attachment:"right",className:"brws-view-type-column-header-menu-content"},i.createElement(n.PopoverItemGroup,null,i.createElement(n.PopoverItemGroupTitle,null,l._("View Mode")),i.createElement(n.PopoverSelectableItem,{icon:i.createElement(s.IconMode,{name:"list"}),selected:e===a.ViewTypes.List,value:a.ViewTypes.List},l._("List")),i.createElement(n.PopoverSelectableItem,{icon:i.createElement(s.IconMode,{name:"tiles"}),selected:e===a.ViewTypes.Grid,value:a.ViewTypes.Grid},l._("Grid")))))},t})(i.PureComponent);t.ViewTypeColumnHeaderMenu=c}),define("modules/clean/react/browse/global_actions",["require","exports","modules/clean/ajax","modules/clean/browse_interface","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/async_onboarding_new_folder_modal_util","modules/clean/react/browse/constants","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/viewer","modules/constants/cloud_content","modules/core/browser","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h){"use strict";function m(e){var t=e.context,r=e.user,o=e.showDeletedFiles,s=e.onFileUpload,n=(e.isContextMenu,e.isNoComment),i=void 0!==n&&n,c=e.experiments,d=void 0===c?{}:c,p=t.isCurrentlyInRoot,h=!t.canViewContainingNSMembers,m=t.isCurrentPathWriteable(),f={className:"action-upload",label:_,iconName:"upload",performAction:A(s),disabled:!m},I=[];if(t.isInsideDeletedSharedFolder||t.isInsideDeletedNestedSharedFolder)I.push({label:b,spriteName:"restore",performAction:x(r,t)});else if(t.isInsideDeletedFolder)I.push({label:w,spriteName:"restore",className:"action-restore",performAction:L(r,t)});else{var D={label:S,iconName:"new-folder",performAction:O(r,t,d.expBizOnboardingTriggerFolderRwl||{}),disabled:!m,className:"action-new-folder"},U={label:p?T:F,iconName:"new-shared-folder",performAction:N(r,t),disabled:h,className:"action-share-folder"},k={label:C,iconName:"new-team-folder",performAction:M(r,t),disabled:!1,className:"action-team-folder"};r.is_cdm_member&&"/"===t.currentFQPath?I.push(f,D):p?(I.push(f),
!r.is_cdm_member&&l.GoldenGate.hasContentManagerAndSuperAdmin(r.id)&&I.push(k),I.push(U,D)):(I.push(U),I.push(f,D)),u.ENABLE_CREATE&&I.push({label:g,iconName:"upload",className:"action-paper-docs",performAction:R(a.CloudContentDocuments.PAPER,t),disabled:!1}),i||I.push({label:o?y:v,iconName:o?"hide":"show-deleted-files",performAction:P(r,o),disabled:h,className:"action-deleted-files"}),l.GoldenGate.hasContentManagerAndSuperAdmin(r.id)&&l.GoldenGate.hasNewOwnershipModel(r.id)&&!t.isNonUserRelativeContext&&t.isInsideTeamFolderTree&&I.push({label:E,iconName:"settings-gear",performAction:M(r,t)})}return I}Object.defineProperty(t,"__esModule",{value:!0});var f=h._("Enter a title for the new document"),_=h._("Upload files"),g=h._("New Paper Document"),S=h._("New folder"),w=h._("Restore folder"),b=h._("Re-add shared folder"),v=h._("Show deleted files"),y=h._("Hide deleted files"),T=h._("New shared folder"),F=h._("Share folder"),E=h._("Manage as admin"),C=h._("New team folder"),I=function(){return null},A=function(e){return function(){e&&e()}},D=function(e,t){return function(){s.logCreateFolder({uid:e.id}),e.is_cdm_member&&"/"===t.currentFQPath?l.asyncShowCdmNewFolderModal(function(r,o){o?l.asyncShowNewFolderShareModal(e,null,t.currentFQPath,r,o):n.browseActions.createFolder({pathName:t.currentFQPath,folderName:r})},e):n.browseActions.nameNewFolder()}},R=function(e,t){return function(){var r=window.prompt(f);null!=r&&n.browseActions.createCloudContent({pathName:t.currentFQPath,title:r,documentType:e})}},N=function(e,t){return function(){t.isCurrentlyInRoot?l.asyncShowShareAFolderWizardModal(e):l.asyncShowShareModal(e,t,{origin:c.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS})}},P=function(e,t){return function(){s.logToggleDeletedFiles({uid:e.id,show_deleted_files:!t}),n.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:!t})}},L=function(e,t){return function(){var r=o.getRestoreFileUrl({fqPath:t.currentFQPath,userId:e.id});p.redirect(r)}},x=function(e,t){return function(){var r=t.currentFQPath.toLowerCase(),o=t.inactiveNSIDByFQPath[r],s=t.isInsideDeletedNestedSharedFolder;o&&l.asyncMountSharedFolder(o,e.role,c.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,!1,null,s)}},O=function(e,t,o){return function(){function s(t){void 0===t&&(t=I),r.WebRequest({url:"/browse_close_onboarding_new_folder_modal",subject_user:e,complete:t})}var n=o.isActive,a=o.hasSeenNewFolderModal,l=o.hasSeenNewFolderModalCallback;n&&!a?i.asyncShowOnboardingNewFolderModal(function(){return s(function(){return p.redirect("/guide/business/manage-files/organize-your-folders")})},function(){s(),l&&l(),D(e,t)()}):D(e,t)()}},M=function(e,t){return function(){l.asyncGoToContentManagerForPath({isLimitedTeam:d.get_viewer().team_is_limited,containingFolder:t.currentFQPath,isCDM:e.is_cdm_member})}};t.getGlobalActions=m}),define("modules/clean/react/browse/internal_drag_status",["require","exports","tslib","external/classnames","external/react","modules/clean/react/sprite"],function(e,t,r,o,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.className,r=e.files,i=o("active",t);return s.createElement("div",{id:"drag-status",className:i},s.createElement("div",{id:"drag-selection-status"},r.slice(0,4).map(function(e,t){return e.thumbnail_url_tmpl?s.createElement("img",{key:t,src:e.thumbnail_url_tmpl,className:"icon icon"+t,alt:""}):s.createElement(n,{key:t,group:"web",name:e.icon,className:"icon icon"+t,alt:""})}),s.createElement("span",{className:"badge"},r.length)))},t})(s.PureComponent);t.InternalDragStatus=i}),define("modules/clean/react/browse/keyboard_shortcuts",["require","exports","jquery","external/keymaster","external/react","external/react-dom","modules/clean/keycode","modules/clean/react/browse/file_jump","modules/clean/react/browse/keyboard_shortcuts_modal","modules/clean/react/modal","modules/clean/undo","modules/core/browser","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h){"use strict";function m(e){o.clearScope(e),o.setScope(F)}function f(e,t){return function(r){e(r)&&(r.preventDefault(),"function"==typeof t&&t(r))}}function _(e){return function(t){return!document.activeElement||document.activeElement===document.body||n.findDOMNode(e).contains(t.target)}}function g(e){var t=e.scope,o=e.onSetDragCopyMode,s=function(e,t){return function(r){r.keyCode!==i.KeyCode.CONTROL&&r.keyCode!==i.KeyCode.ALT||t(e)}};r(document).on("keydown."+t,s(!0,o)).on("keyup."+t,s(!1,o))}function S(e){var t=e.scope,s=e.getIsFileJumping,n=function(e){o.getScope()===t&&a.handleKeyPress(e,s)};r(document).on("keypress."+t,n)}function w(e){m(e),r(document).off("."+e)}function b(e,t,n,i,a,m,_,w,b,v,E,C,I,A){S({scope:A,getIsFileJumping:e}),g({scope:A,onSetDragCopyMode:C}),F=o.getScope(),F!==A&&o.setScope(A);var D=function(){var e=i(),t=e.some(function(e){return e.read_only});if(1===e.size)if(m()&&!t){var r=e.first();r.isDeleted?h.error(p._("Deleted files can’t be renamed.")):I(r)}else h.warning(p._("You don’t have permission to rename files in this folder."))},R=function(){var e=i();e.size&&v(e.toArray())},N=function(){d.performUndo()},P=function(){var e=s.createElement(l.KeyboardShortcutsModal,{shortcuts:a?T:y});c.Modal.showInstance(e)},L=function(){return r(".search-bar__text-input").focus()};o("f2",A,f(n,D)),o("/",A,f(t,L)),o("shift+/",A,f(t,P)),o("escape",A,f(t,w)),u.mac?(o("command+a",A,f(t,_)),o("command+c",A,f(n,b)),o("backspace",A,f(n,R)),o("command+v",A,f(t,E)),o("command+z",A,f(t,N))):(o("ctrl+a",A,f(t,_)),o("ctrl+c",A,f(n,b)),o("delete",A,f(n,R)),o("ctrl+v",A,f(t,E)),o("ctrl+z",A,f(t,N)))}function v(e,t,s,n,i,a,l,c,d,u,p,h,m,_,g,S,w){b(e,t,s,n,!0,i,l,c,d,u,m,_,g,w);var v=function(){var e=n();1===e.size&&p(e.first())},y=function(){var e=n(),t=e.first();1===e.size&&t.is_dir&&p(t)},T=function(e){if("function"==typeof S&&n().size){var t=r(e.target).closest(".browse-file-row--is-selected").first();if(t.length){S(t[0].offsetLeft+200,t[0].offsetTop+5,t.get(0))}}else S(10,10)};o("enter",w,f(s,v)),o("right",w,f(s,y)),o("left",w,f(t,h)),a()&&o("alt+a",w,f(t,T))}Object.defineProperty(t,"__esModule",{value:!0});var y=[{windowsKey:"Enter",macKey:"return",desc:p._("Open file or folder")},{key:"/",desc:p._("Search")},{windowsKey:"Ctrl + a",macKey:"⌘ + a",desc:p._("Select all files")},{windowsKey:"Esc",macKey:"esc",desc:p._("Deselect all files")},{windowsKey:"Ctrl + c",macKey:"⌘ + c",desc:p._("Copy selected file(s)")},{windowsKey:"Ctrl + v",macKey:"⌘ + v",desc:p._("Paste selected file(s) into the current folder")},{key:"F2",desc:p._("Rename selected file")},{windowsKey:"Delete",macKey:"delete",desc:p._("Delete selected file(s)")},{windowsKey:"Ctrl + z",macKey:"⌘ + z",desc:p._("Undo recent move/copy/rename/delete")},{key:"?",desc:p._("Show keyboard shortcuts")}],T=[{key:"↑",desc:p._("Select previous file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"↓",desc:p._("Select next file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"←",desc:p._("Go up a folder")},{key:"→",desc:p._("Open folder")}].concat(y),F="";t.generateGetIsGlobalEvent=_,t.setupFileJumpKeyboardShortcuts=S,t.resetBrowseKeyboardShortcuts=w,t.setupGeneralBrowseKeyboardShortcuts=b,t.setupItemListKeyboardShortcuts=v}),define("modules/clean/react/browse/keyboard_shortcuts_modal",["require","exports","tslib","jquery","external/react","external/react-dom","modules/clean/keycode","modules/clean/react/flag","modules/clean/react/modal","modules/core/browser","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l,c,d){"use strict";function u(e){return!!e.key}function p(e){return s.createElement("li",{className:"keyboard-shortcuts__item u-mar-bottom-xs"},s.createElement(a.Flag,{leftAttachment:s.createElement("span",{className:"keyboard-shortcuts__key"},u(e)?e.key:c.mac?e.macKey:e.windowsKey),alignment:"top"},s.createElement("span",{className:"keyboard-shortcuts__desc"},e.desc)))}Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleQuestionMarkKeyDown=function(e){e.shiftKey&&e.which===i.KeyCode.FORWARD_SLASH&&(e.stopPropagation(),t.shortcutsModal.close())},t.setModalRef=function(e){t.shortcutsModal=e},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){o(n.findDOMNode(this.shortcutsModal.refs.modal)).on("keydown",this.handleQuestionMarkKeyDown)},t.prototype.componentWillUnmount=function(){o(n.findDOMNode(this.shortcutsModal.refs.modal)).off("keydown",this.handleQuestionMarkKeyDown)},t.prototype.render=function(){return s.createElement(l.Modal,{ref:this.setModalRef,acceptButtonText:"",className:"keyboard-shortcuts",title:d._("Dropbox keyboard shortcuts"),width:750},s.createElement("ul",{className:"keyboard-shortcuts__pane u-unlist u-trim-padding"},this.props.shortcuts.map(p)))},t})(s.Component);t.KeyboardShortcutsModal=h}),define("modules/clean/react/browse/name_input",["require","exports","tslib","external/classnames","external/react","modules/clean/keycode"],function(e,t,r,o,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){};t.NameInputActionSources={ESC:"ESC",SUBMIT:"SUBMIT",BLUR:"BLUR"};var a=(function(e){function i(){var r=null!==e&&e.apply(this,arguments)||this;return r.setInputRef=function(e){r.inputRef=e},r.handleDragStart=function(e){e.stopPropagation()},r.handleSubmit=function(e){e.preventDefault(),r.submitIfChanged(t.NameInputActionSources.SUBMIT)},r.handleKeyDown=function(e){e.keyCode===n.KeyCode.ESC&&(e.preventDefault(),r.props.onCancel({source:t.NameInputActionSources.ESC}))},r.handleBlur=function(e){r.submitIfChanged(t.NameInputActionSources.BLUR)},r.handleClick=function(e){r.props.onClick(e)},r}return r.__extends(i,e),i.prototype.componentDidMount=function(){var e=this;this.inputRef.focus(),window.requestAnimationFrame(function(){var t=e.inputRef.value,r=t.lastIndexOf(".");r<0&&(r=t.length),e.inputRef.setSelectionRange(0,r)})},i.prototype.submitIfChanged=function(e){var t=this.inputRef.value.trim();t===this.props.defaultValue?this.props.onCancel({source:e}):this.props.onSubmit(t)},i.prototype.render=function(){return s.createElement("form",{className:"u-pad-right-xs",onSubmit:this.handleSubmit},s.createElement("input",{ref:this.setInputRef,defaultValue:this.props.defaultValue,className:o("c-input",this.props.className),onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onDragStart:this.handleDragStart,"aria-label":this.props.label,onClick:this.handleClick}))},i})(s.PureComponent);a.defaultProps={className:"",onCancel:i,onClick:i,onSubmit:i},t.NameInput=a}),define("modules/clean/react/browse/nav_actions",["require","exports","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/selectable_list","modules/clean/sharing/gating_util","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(){function e(e){this.dataApi=e}return e.prototype.setUrlPrefix=function(e){var t=e.prefix;i.BrowseDispatcher.dispatch({type:n.BrowseActionTypes.SET_URL_PREFIX,data:{prefix:t}})},e.prototype.setUrl=function(e){var t=e.path,o=(e.qargs,{});"1"===r.deconstruct_url().qargs.d&&(o.d="1");var s=t?h.encode_parts(t):"";r.push_state(l.browseStore.urlPrefix()+s,o),i.BrowseDispatcher.dispatch({type:n.BrowseActionTypes.SET_SELECTION,data:{selection:c.createSelection()}})},e.prototype.setLoadingState=function(e){var t=e.loadingState,r=e.path;i.BrowseDispatcher.dispatch({type:n.BrowseActionTypes.SET_LOADING_STATE,data:{loadingState:t,path:r}})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;i.BrowseDispatcher.dispatch({type:n.BrowseActionTypes.SET_MOUNT_POINTS,data:{mountPoints:t}})},e.prototype.setTeamFolders=function(e){var t=e.teamFolders;i.BrowseDispatcher.dispatch({type:n.BrowseActionTypes.SET_TEAM_FOLDERS,data:{teamFolders:t}})},e.prototype.setPath=function(e){var t=this,r=e.path,s=e.onPathLoaded,c=e.nsId,h=e.logFetchedDataRequiredForTTI,m=void 0!==h&&h;i.BrowseDispatcher.dispatch({type:n.BrowseActionTypes.SET_PATH,data:{path:r}}),this.setLoadingState({loadingState:n.LoadingStates.LOADING_FIRST_PAGE,path:r});var f=l.browseStore.user(),_=f.id,g=function(e){var i=e.path,c=e.data;m&&u.log_js_modules_fetched_data_required_for_tti(),t.setMountPoints({mountPoints:c.ns_id_to_mount_point}),t.setTeamFolders({teamFolders:c.team_folders_js_info});var p=a.BrowseContext.fromServerObject(c);if(c.paginated){t.setLoadingState({loadingState:n.LoadingStates.LOADING_REMAINING_PAGES,path:r}),t.load({path:i,files:[],context:p});var h=l.browseStore.context().isNonUserRelativeContext,g=h&&!f.is_cdm_member&&!d.GoldenGate.hasContentManagerCdm(_),S=l.browseStore.path(),w="/"!==S&&g?S.split("/")[1]:"";o.PaginationManager.create({firstPage:c.first_page,keyName:"sjid",ajaxURL:"/browse_get_next",userID:_,newDataAvailableCallback:function(e,o){t.add({path:i,files:o}),e.areAllItemsReady()&&(t.setLoadingState({loadingState:n.LoadingStates.LOADED,path:r}),e.stopAutoFetching())},fqPathPrefix:w}).startAutoFetching()}else{var b=c.file_info;t.load({path:i,files:b,context:p}),t.setLoadingState({loadingState:n.LoadingStates.LOADED,path:r})}s&&s()};this.dataApi.loadPath({path:r,userId:_,sortFoldersFirst:!p.mac,includeDeletedFiles:l.browseStore.shouldShowDeletedFiles(),nsId:c,onSuccess:g,onError:function(){"/"!==r&&t.setPath({path:"/",onPathLoaded:s})}})},e.prototype.load=function(e){var t=e.path,r=e.files,o=e.context;i.BrowseDispatcher.dispatch({type:n.BrowseActionTypes.LOAD_PATH,data:{path:t,files:r,context:o}})},e.prototype.add=function(e){var t=e.path,r=e.files;i.BrowseDispatcher.dispatch({type:n.BrowseActionTypes.ADD_FILES,data:{path:t,files:r}})},e.prototype.setDataApi=function(e){this.dataApi=e},e})();t.BrowseNavActions=m,t.browseNavActions=new m(s)}),define("modules/clean/react/browse/new_folder_icon",["require","exports","external/react","external/classnames","modules/clean/filepath","modules/clean/react/sprite","modules/clean/static_urls"],function(e,t,r,o,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFolderIcon=function(e){var t=e.inTeamFolder,a=s.new_folder_icon(t),l=o("sprite","sprite_web","brws-file-name-cell-icon",a);return r.createElement(n,{group:"web",name:i.static_url("/static/images/icons/icon_spacer-vflN3BYt2.gif"),className:l,alt:""})}}),define("modules/clean/react/browse/overflow_menu",["require","exports","tslib","external/react","external/spectrum/overflow_button","external/spectrum/popover","modules/core/i18n"],function(e,t,r,o,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;(function(e){e[e.Normal=0]="Normal",e[e.Small=1]="Small"})(a=t.OverflowMenuSize||(t.OverflowMenuSize={}));var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stopPropagation=function(e){return e.stopPropagation()},t.handleSelection=function(e){e.performAction()},t}return r.__extends(t,e),t.prototype.renderOverflowButton=function(){return o.createElement(s.OverflowButton,{"aria-label":i._("More actions"),className:"browse-overflow-menu-trigger-button",tagName:"span",size:this.props.size===a.Small?"small":"default",variant:this.props.showBorders?"secondary":"borderless"})},t.prototype.render=function(){var e=this.props,t=e.actionItems,r=e.attachment,s=t.map(function(e){return o.createElement(n.PopoverContentItem,{className:e.className,key:e.label,value:e,disabled:e.disabled},e.label)});return o.createElement("div",{className:"browse-overflow-menu",onClick:this.stopPropagation,onDoubleClick:this.stopPropagation},o.createElement(n.Popover,{onSelection:this.handleSelection,closeOnSelection:!0},o.createElement(n.PopoverTrigger,{className:"browse-overflow-menu-trigger"},this.renderOverflowButton()),o.createElement(n.PopoverContent,{attachment:r,className:"browse-overflow-menu-content"},s)))},t})(o.PureComponent);l.defaultProps={attachment:"right"},t.BrowseOverflowMenu=l}),define("modules/clean/react/browse/professional_collection_actions",["require","exports","modules/clean/ajax","modules/core/browser","modules/core/notify","modules/core/i18n"],function(e,t,r,o,s,n){"use strict";function i(t){e(["modules/clean/react/professional_collection/add_to_collection_modal_controller"],t)}function a(e,t,i){s.success(n._("Creating collection...")),r.WebRequest({url:"/premium_sharing/create",subject_user:i,data:{ns_id:e,path:t},success:function(e){var t=JSON.parse(e);t.error?s.error(t.error):o.redirect(t.collectionUrl)},error:function(){s.error(n._("Error during the creation of the collection."))}})}function l(e,t){i(function(r){return(0,r.showAddToCollectionModal)(e,t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.createProfessionalCollection=a,t.showAddToCollectionModal=l}),define("modules/clean/react/browse/selectors",["require","exports","external/reselect","modules/clean/react/browse/constants"],function(e,t,r,o){"use strict";function s(e,t){return e.withMutations(function(r){t.forEach(function(t,o){var s=e.get(o);if(s&&t){var n=s.updateSize(t.size,t.state);r.set(o,n)}})})}function n(e,t){return e.map(function(e){var r=t.get(e.fq_path);return r?e.updateSize(r.size,r.state):e})}Object.defineProperty(t,"__esModule",{value:!0}),t.makeFilesWithoutTeamSharedFolders=function(){return r.createSelector(function(e){return e.sortedFiles},function(e){return e.filter(function(e){return e.type!==o.FileTypes.TEAM_SHARED_FOLDER})})},t.makeUnsortedFilesWithFolderSizes=function(){return r.createSelector(function(e){return e.unsortedFiles},function(e){return e.folderSizes},function(e,t){return s(e,t)})},t.makeSortedFilesWithFolderSizes=function(){return r.createSelector(function(e){return e.sortedFiles},function(e){return e.folderSizes},function(e){return e.currentSort},function(e,t){return n(e,t)})}}),define("modules/clean/react/browse/share_button",["require","exports","tslib","external/spectrum/button","external/react","modules/clean/search/search_helpers","modules/clean/react/browse/constants","modules/clean/sharing/browse_exports","modules/core/i18n"],function(e,t,r,o,s,n,i,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(e){var r=t.props,o=r.file,s=r.user,l=r.browseContext;t.props.isSearchMode&&n.logSearchAction({result:o,user:s,action_type:"share",view_type:i.ViewTypes.List}),a.asyncShowShareModal(s,o,{browseContext:l,origin:"BROWSE_FILE_ROW"}),e.stopPropagation()},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.isVisible;return s.createElement(o.Button,{"aria-label":l._("Share"),className:"inline-share-button",onClick:this.handleClick,tabIndex:e?void 0:-1,variant:e?"secondary":"invisible"},l._("Share"))},t})(s.PureComponent);c.defaultProps={isVisible:!0,isSearchMode:!1},t.ShareButton=c}),define("modules/clean/react/browse/sort_helpers",["require","exports"],function(e,t){"use strict";function r(e,t,r){for(var o="=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<Math.max(e.length,t.length);s++){var n=e.charAt(s),i=t.charAt(s);if(!n)return-r;if(!i)return r;var a=o.indexOf(n),l=o.indexOf(i);if(a<l)return-r;if(l<a)return r}return 0}function o(e,t,o){if(Array.isArray(e)&&Array.isArray(t)){for(var s=0;s<Math.max(e.length,t.length);s++){var n=e[s],i=t[s];if(null==n)return-o;if(null==i)return o;if("number"==typeof n&&"string"==typeof i)return-o;if("number"==typeof i&&"string"==typeof n)return o;if("string"==typeof n&&"string"==typeof i){var a=r(n,i,o);if(0!==a)return a}else{if(n<i)return-o;if(i<n)return o}}return 0}return e===t?0:e<t?-o:o}Object.defineProperty(t,"__esModule",{value:!0}),t.compare=o}),define("modules/clean/react/browse/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/sort_helpers","modules/clean/react/selectable_list","modules/constants/subgrowth_experiments","modules/core/browser","modules/core/exception","modules/constants/browse","modules/clean/react/browse/selectors","modules/core/cookies"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unsortedFilesWithFolderSizes=m.makeUnsortedFilesWithFolderSizes(),t.sortedFilesWithFolderSizes=m.makeSortedFilesWithFolderSizes(),t.filesWithoutTeamSharedFolders=m.makeFilesWithoutTeamSharedFolders(),t}return r.__extends(t,e),t.prototype._init=function(){this._unsortedFiles=o.Map(),this._sortedFiles=o.List(),this._teamFolders=o.List(),this._path="",this._user=null,this._urlPrefix="",this._selection=c.createSelection(),this._loadingState=i.LoadingStates.LOADING_FIRST_PAGE,this._context=new a.BrowseContext,this._mountPoints=null,this._shouldShowDeletedFiles=!1,this._activeDropTarget=null,this._inCopyMode=!1,this._clipboardFiles=[],this._currentSort={sortField:i.BrowseSortFields.FILENAME,sortDirection:i.SortDirections.ASCENDING},this._viewType=this.getViewTypeCookie()||i.ViewTypes.List,this._fileRename=null,this._newFolderCreationState=i.NewFolderCreationStates.CREATE_FOLDER_INACTIVE,this._filePathsToSelectOnNextUpdate=o.Set(),this._activeFileJumpFilter="",this._fileJumpIndex=[],this._activeTab=void 0,this._folderSizes=o.Map(),this._currentFolderSizesQuery=o.Set(),this._isQueryingFolderSizes=!1},t.prototype.isPathEqualsTo=function(e){return!(e&&"/"!==e||this._path&&"/"!==this._path)||e===this._path},t.prototype.files=function(){return h.BROWSE_GET_FOLDER_SIZES&&this._folderSizes.size>0?this.sortedFilesWithFolderSizes({sortedFiles:this._sortedFiles,folderSizes:this._folderSizes,currentSort:this._currentSort}):this._sortedFiles},t.prototype.filesMap=function(){return h.BROWSE_GET_FOLDER_SIZES&&this._folderSizes.size>0?this.unsortedFilesWithFolderSizes({unsortedFiles:this._unsortedFiles,folderSizes:this._folderSizes}):this._unsortedFiles},t.prototype.filesWithoutTeamFolders=function(){return h.BROWSE_GET_FOLDER_SIZES&&this._folderSizes.size>0?this.sortedFilesWithFolderSizes({sortedFiles:this._sortedFiles,folderSizes:this._folderSizes,currentSort:this._currentSort}).filter(function(e){return e.type!==i.FileTypes.TEAM_SHARED_FOLDER}):this.filesWithoutTeamSharedFolders({sortedFiles:this._sortedFiles})},t.prototype.teamFolders=function(){return"ON"===d.SUBGROWTH_BIZ_TRIAL_ONBOARDING_EXP1||["V1","V2"].includes(d.SUBGROWTH_BIZ_TRIAL_ONBOARDING_EXP2)?this._sortedFiles.filter(function(e){return e.type===i.FileTypes.TEAM_SHARED_FOLDER}):h.BROWSE_GET_FOLDER_SIZES&&this._folderSizes.size>0?this.sortedFilesWithFolderSizes({sortedFiles:this._sortedFiles,folderSizes:this._folderSizes,currentSort:this._currentSort}).filter(function(e){return e.type===i.FileTypes.TEAM_SHARED_FOLDER}):this._teamFolders},t.prototype.path=function(){return this._path},t.prototype.user=function(){return this._user},t.prototype.urlPrefix=function(){return this._urlPrefix},t.prototype.selection=function(){return this._selection},t.prototype.selectedFiles=function(){var e=this,t=this._sortedFiles.filter(function(t){return e._selection.selected.has(t.fq_path)});return o.OrderedMap(t.map(function(e){return[e.fq_path,e]}))},t.prototype.activeTab=function(){return this._activeTab},t.prototype.loadingState=function(){return this._loadingState},t.prototype.context=function(){return this._context},t.prototype.mountPoints=function(){return this._mountPoints},t.prototype.shouldShowDeletedFiles=function(){return this._shouldShowDeletedFiles},t.prototype.activeDropTarget=function(){return this._activeDropTarget},t.prototype.currentSort=function(){return this._currentSort},t.prototype.viewType=function(){return this._viewType},t.prototype.getIndexOfFile=function(e){return this._sortedFiles.findIndex(function(t){return t.sjid===e.sjid&&t.ns_id===e.ns_id})},t.prototype.getFileByFilename=function(e){return this._sortedFiles.find(function(t){return s.filename(t.fq_path)===e})||null},t.prototype.getFileByFullPath=function(e){return this._sortedFiles.find(function(t){return t.fq_path===e})||null},t.prototype.inCopyMode=function(){return this._inCopyMode},t.prototype.clipboardFiles=function(){return this._clipboardFiles},t.prototype.fileRename=function(){return this._fileRename},t.prototype.newFolderCreationState=function(){return this._newFolderCreationState},t.prototype.isFileJumping=function(){return this._activeFileJumpFilter.length>0},t.prototype.isQueryingFolderSizes=function(){return this._isQueryingFolderSizes},t.prototype.initializeEverything=function(e){var t=e.user,r=e.path,s=e.files,n=e.urlPrefix,a=e.context,l=e.mountPoints,c=e.fqPathsToSelect,d=e.loadingState,u=e.shouldShowDeletedFiles,p=e.teamFolders;this._user=t,this._path=r,this._urlPrefix=n,this.appendFiles({path:r,files:s},!1),this._context=a,this._mountPoints=o.Map(l),this._loadingState=d,this.setTeamFolders({teamFolders:p}),d===i.LoadingStates.LOADED?this.selectFqPaths({fqPathsToSelect:c},!1):this._filePathsToSelectOnNextUpdate=o.Set(c),this._shouldShowDeletedFiles=!!u,this.emit_change()},t.prototype.setUser=function(e){var t=e.user;null==this.user()&&(this._user=t)},t.prototype.setPathData=function(e){var t=e.path,r=e.files,o=e.context;s.paths_are_equal(t,this._path)&&(this._unsortedFiles=this._unsortedFiles.clear(),this._sortedFiles=this._sortedFiles.clear(),this._selection=c.createSelection(),this.appendFiles({path:t,files:r},!1),this._context=o,this.emit_change())},t.prototype.appendFiles=function(e,t){var r=e.path,n=e.files;if(void 0===t&&(t=!0),s.paths_are_equal(r,this._path)){for(var i=[],l=[],c=0,d=n;c<d.length;c++){var u=d[c],h=u instanceof a.File?u:a.File.fromServerObject(u);i.push([u.fq_path,h]),this._unsortedFiles.has(u.fq_path)||l.push(h)}this._unsortedFiles=this._unsortedFiles.merge(o.Map(i)),this._sortedFiles=this._sortedFiles.concat(o.List(l)),p.assert(this._unsortedFiles.size===this._sortedFiles.size,"appendFiles ended up with mismatched data structures"),this.sortFiles(this._currentSort,!1),this._filePathsToSelectOnNextUpdate.count()&&this.selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),this.buildFileJumpIndex(),t&&this.emit_change()}},t.prototype.applyFileDeltas=function(e){var t=e.path,r=e.fileDeltas;if(s.paths_are_equal(t,this._path)){for(var n=0,i=r;n<i.length;n++){var a=i[n],l=a.before,c=a.after;this.applyFileDelta({before:l,after:c,pathForDelta:t})}if(this._filePathsToSelectOnNextUpdate.size){this.selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1).size===this._filePathsToSelectOnNextUpdate.size&&(this._filePathsToSelectOnNextUpdate=o.Set())}p.assert(this._unsortedFiles.size===this._sortedFiles.size,"applyFileDeltas ended up with mismatched file collections (map vs. sorted list)"),this.sortFiles(this._currentSort,!1),this.buildFileJumpIndex(),this.emit_change()}},t.prototype.setPath=function(e){var t=e.path;this._path=t,this.emit_change()},t.prototype.setUrlPrefix=function(e){var t=e.prefix;this._urlPrefix=t,this.emit_change()},t.prototype.setLoadingState=function(e){var t=e.path,r=e.loadingState;s.paths_are_equal(t,this._path)&&(this._loadingState=r,r===i.LoadingStates.LOADED&&(this._filePathsToSelectOnNextUpdate=o.Set()),this.emit_change())},t.prototype.setMountPoints=function(e){var t=e.mountPoints;this._mountPoints=o.Map(t)},t.prototype.setTeamFolders=function(e){var t=e.teamFolders;this._teamFolders=o.List((t||[]).map(a.File.fromServerObject))},t.prototype.setSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype.selectFilesAfterUpload=function(e){var t=this,r=e.fqPathsToSelect;r.every(function(e){return t.filesMap().has(e)})?this.selectFqPaths({fqPathsToSelect:r}):this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:r})},t.prototype.selectFqPaths=function(e,t){var r=e.fqPathsToSelect;void 0===t&&(t=!0);var s=r.map(function(e){return e.toLowerCase()}),n=this._sortedFiles.filter(function(e){return s.includes(e.fq_path.toLowerCase())}),i=n.map(function(e){return e.fq_path}),a=this._selection.set("selected",o.OrderedSet(i)),l=i.size?i.get(0):null;return a=a.set("anchor",l),this._selection=a,t&&this.emit_change(),i},t.prototype.setActiveTab=function(e){var t=e.tabName;this._activeTab=t,this.emit_change()},t.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles;this._shouldShowDeletedFiles=!!t,this.emit_change()},t.prototype.setDropTarget=function(e){var t=e.target;this._activeDropTarget=t,this.emit_change()},t.prototype.setCopyMode=function(e){var t=e.copyMode;this._inCopyMode=t,this.emit_change()},t.prototype.setViewType=function(e){var t=e.viewType;this._viewType=t,this.setViewTypeCookie(t),this.emit_change()},t.prototype.getViewTypeCookie=function(){return f.read(i.VIEW_TYPE_COOKIE_NAME)},t.prototype.setViewTypeCookie=function(e){f.delete(i.VIEW_TYPE_COOKIE_NAME),f.create(i.VIEW_TYPE_COOKIE_NAME,e,1095)},t.prototype.sortFiles=function(e,t){function r(e,t){var r=e.value,o=e.isTMF,s=t.value;return n(o,t.isTMF)||l.compare(r,s,h)}function o(e,t){var r=e.isFolder,o=e.value,s=e.isTMF,i=t.isFolder,a=t.value,c=t.isTMF,d=n(s,c);return d?d:(o||(o=1/0*h),a||(a=1/0*h),r&&i?l.compare(o,a,h):r?-h:i?h:l.compare(o,a,h))}function s(e,t){var r=e.isFolder,o=e.value,s=e.isTMF,i=t.isFolder,a=t.value,c=t.isTMF,d=n(s,c);return d?d:r&&i?l.compare(o,a,h):r?1:i?-1:""===o?1:""===a?-1:l.compare(o,a,h)}function n(e,t){if(m){if(e)return-1;if(t)return 1}return 0}var c=this,d=e.sortField,p=e.sortDirection;void 0===t&&(t=!0);var h=p===i.SortDirections.ASCENDING?1:-1,m=!this._context.isNonUserRelativeContext,f=d===i.BrowseSortFields.FILENAME||d===i.BrowseSortFields.SHARED_WITH,_=u.mac?r:o;f?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.sort_key,isTMF:a.File.isTeamMemberFolder(e)}},_):d===i.BrowseSortFields.MODIFIED?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.ts,isTMF:a.File.isTeamMemberFolder(e)}},s):d===i.BrowseSortFields.CATEGORY?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:a.File.getCategoryDescription(e),isTMF:a.File.isTeamMemberFolder(e)}},s):d===i.BrowseSortFields.EXTENSION?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:a.File.getExtension(e),isTMF:a.File.isTeamMemberFolder(e)}},s):d===i.BrowseSortFields.SIZE&&(this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.is_dir&&c._folderSizes.has(e.fq_path)?-c._folderSizes.get(e.fq_path).size:-e.bytes,isTMF:a.File.isTeamMemberFolder(e)}},_)),this._currentSort={sortField:d,sortDirection:p},t&&this.emit_change()},t.prototype.setClipboardToFiles=function(e){this._clipboardFiles=e,this.emit_change()},t.prototype.updateRenameState=function(e,t){this._fileRename=t?{file:e,state:t}:null,this.emit_change()},t.prototype.setNewFolderCreationState=function(e){this._newFolderCreationState=e,this.emit_change()},t.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t=e.fqPathsToSelect,r=void 0===t?[]:t;this._filePathsToSelectOnNextUpdate=o.Set(r)},t.prototype.addCommentStatusBatch=function(e){var t=this,r=e.commentStatusByFqPath;Object.keys(r).map(function(e){var o=t._unsortedFiles.get(e);if(null!=o){var s=o.merge(r[e]);t.insertOrUpdateFile({file:s,forceUpdate:!0})}}),this.emit_change()},t.prototype.addFileJumpKeyCode=function(e){var t=e.keyChar;this._activeFileJumpFilter+=t.toLowerCase();for(var r=null,o=0,s=this._fileJumpIndex;o<s.length;o++){
var n=s[o],i=n.fqPath;if(n.filename>=this._activeFileJumpFilter){r=i;break}}null!=r&&this.selectFqPaths({fqPathsToSelect:[r]})},t.prototype.resetFileJump=function(){this._activeFileJumpFilter=""},t.prototype.buildFileJumpIndex=function(){this._fileJumpIndex=this._unsortedFiles.keySeq().toArray().map(function(e){return{filename:s.filename(e).toLowerCase(),fqPath:e}}),this._fileJumpIndex.sort(function(e,t){var r=e.filename,o=t.filename;return r<o?-1:r>o?1:0})},t.prototype.applyFileDelta=function(e){var t=e.before,r=e.after,o=e.pathForDelta;if(r&&!s.paths_are_equal(s.parent_dir(r.fq_path),o)&&(r=null),r!==t){var n=r&&this._unsortedFiles.get(r.fq_path);if(!(n&&n.sjid>=r.sjid)){if(this._fileRename&&r&&t){var i=this._folderSizes.get(t.fq_path);i&&(this._folderSizes=this._folderSizes.set(r.fq_path,{size:i.size,state:i.state}))}return t&&(this._folderSizes=this._folderSizes.delete(t.fq_path)),r&&t?this.replaceFile({existingFile:t,newFile:r}):r&&!t?this.insertOrUpdateFile({file:r}):t&&!r?this.removeFile({file:t}):void 0}}},t.prototype.insertOrUpdateFile=function(e){function t(e){return e.fq_path.toLowerCase()===n}var r=e.file,o=e.forceUpdate,s=void 0!==o&&o;this._unsortedFiles=this._unsortedFiles.set(r.fq_path,r);var n=r.fq_path.toLowerCase(),i=this._sortedFiles.findEntry(t)||[null,null],a=i[0],l=i[1];l?(s||r.sjid>l.sjid)&&(this._sortedFiles=this._sortedFiles.set(a,r)):this._sortedFiles=this._sortedFiles.push(r)},t.prototype.removeFile=function(e){function t(e){return e.fq_path.toLowerCase()===s}var r=e.file;p.assert(this._unsortedFiles.has(r.fq_path),"trying to remove a file that doesn't exist in the file map");var o=this._sortedFiles.indexOf(r),s=r.fq_path.toLowerCase(),n=this._sortedFiles.findEntry(t),i=n?n[0]:-1;p.assert(i!==-1,"tried to remove file that doesn't exist in the sorted file list"),this._unsortedFiles=this._unsortedFiles.delete(r.fq_path),this._sortedFiles=this._sortedFiles.delete(o)},t.prototype.replaceFile=function(e){function t(e){return e.fq_path.toLowerCase()===s}var r=e.existingFile,o=e.newFile;p.assert(this._unsortedFiles.has(r.fq_path),"tried to replace file, but previous file doesn't exist in map");var s=r.fq_path.toLowerCase(),n=this._sortedFiles.findEntry(t),a=n?n[0]:-1;p.assert(a!==-1,"tried to update file, but previous file doesn't exist in sorted list"),r.fq_path===o.fq_path?(this._sortedFiles=this._sortedFiles.set(a,o),this._unsortedFiles=this._unsortedFiles.set(r.fq_path,o)):(this._sortedFiles=this._sortedFiles.delete(a),this._unsortedFiles=this._unsortedFiles.delete(r.fq_path),this._unsortedFiles=this._unsortedFiles.set(o.fq_path,o),this._sortedFiles=this._sortedFiles.push(o),this._fileRename&&this._fileRename.state===i.RenameStates.SAVING_INPUT&&(this.updateRenameState(r,null),this.selectFqPaths({fqPathsToSelect:[o.fq_path]})))},t.prototype.requestFolderSizes=function(e){this._isQueryingFolderSizes||(this._isQueryingFolderSizes=!0,this._folderSizes=this._folderSizes.withMutations(function(t){t.set(e,{size:0,state:i.FetchFolderSizeStates.LOADING})}),this.emit_change())},t.prototype.setFolderSizesPending=function(e){var t=this;this._folderSizes=this._folderSizes.withMutations(function(r){for(var o=function(e){r.update(e.fq_path,{size:0,state:i.FetchFolderSizeStates.LOADING},function(t){return{size:t.size+e.size,state:i.FetchFolderSizeStates.LOADING}}),t._currentFolderSizesQuery=t._currentFolderSizesQuery.add(e.fq_path)},s=0,n=e.sizes_dict;s<n.length;s++){o(n[s])}}),this.emit_change()},t.prototype.completeFolderSizes=function(e){var t=this;this._folderSizes=this._folderSizes.withMutations(function(r){t._currentFolderSizesQuery.forEach(function(o){var s=t._folderSizes.get(o);s&&r.update(o,function(){return{size:s.size,state:e}})})}),this._currentFolderSizesQuery=o.Set(),this._isQueryingFolderSizes=!1,this.emit_change()},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case i.BrowseActionTypes.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case i.BrowseActionTypes.LOAD_PATH:this.setPathData(t.data);break;case i.BrowseActionTypes.ADD_FILES:this.appendFiles(t.data);break;case i.BrowseActionTypes.ADD_FILES_AND_SET_LOADING_STATE:this.appendFiles(t.data,!1),this.setLoadingState(t.data);break;case i.BrowseActionTypes.SET_PATH:this.setPath(t.data);break;case i.BrowseActionTypes.SET_USER:this.setUser(t.data);break;case i.BrowseActionTypes.SET_URL_PREFIX:this.setUrlPrefix(t.data);break;case i.BrowseActionTypes.CHANGE_FILES:this.applyFileDeltas(t.data);break;case i.BrowseActionTypes.SET_ACTIVE_TAB:this.setActiveTab(t.data);break;case i.BrowseActionTypes.SET_SELECTION:this.setSelection(t.data);break;case i.BrowseActionTypes.SELECT_FILES_AFTER_UPLOAD:this.selectFilesAfterUpload(t.data);break;case i.BrowseActionTypes.SELECT_FILES_BY_FQ_PATH:this.selectFqPaths(t.data);break;case i.BrowseActionTypes.SET_LOADING_STATE:this.setLoadingState(t.data);break;case i.BrowseActionTypes.SET_MOUNT_POINTS:this.setMountPoints(t.data);break;case i.BrowseActionTypes.SET_TEAM_FOLDERS:this.setTeamFolders(t.data);break;case i.BrowseActionTypes.SET_SHOULD_SHOW_DELETED_FILES:this.setShouldShowDeletedFiles(t.data);break;case i.BrowseActionTypes.SET_DROP_TARGET:this.setDropTarget(t.data);break;case i.BrowseActionTypes.SET_COPY_MODE:this.setCopyMode(t.data);break;case i.BrowseActionTypes.COPY_FILES_TO_CLIPBOARD:this.setClipboardToFiles(t.data.files);break;case i.BrowseActionTypes.SET_VIEW_TYPE:this.setViewType(t.data);break;case i.BrowseActionTypes.SORT_FILES:this.sortFiles(t.data);break;case i.BrowseActionTypes.REQUEST_NEW_FILE_NAME:this.updateRenameState(t.data.file,i.RenameStates.PENDING_INPUT);break;case i.BrowseActionTypes.SET_FILE_RENAME_PENDING:this.updateRenameState(t.data.file,i.RenameStates.SAVING_INPUT);break;case i.BrowseActionTypes.SET_FILE_RENAME_COMPLETE:case i.BrowseActionTypes.CANCEL_FILE_RENAME:this.updateRenameState(t.data.file,null);break;case i.BrowseActionTypes.REQUEST_FOLDER_NAME:this.setNewFolderCreationState(i.NewFolderCreationStates.PENDING_INPUT);break;case i.BrowseActionTypes.CREATE_FOLDER_PENDING:this.setNewFolderCreationState(i.NewFolderCreationStates.SAVING_INPUT);break;case i.BrowseActionTypes.CREATE_FOLDER_COMPLETE:case i.BrowseActionTypes.CANCEL_CREATE_FOLDER:this.setNewFolderCreationState(i.NewFolderCreationStates.CREATE_FOLDER_INACTIVE);break;case i.BrowseActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:this.setFilePathsToSelectOnNextUpdate(t.data);break;case i.BrowseActionTypes.ADD_COMMENT_STATUS_BATCH:this.addCommentStatusBatch(t.data);break;case i.BrowseActionTypes.ADD_FILE_JUMP_KEY_CODE:this.addFileJumpKeyCode(t.data);break;case i.BrowseActionTypes.RESET_FILE_JUMP:this.resetFileJump();break;case i.BrowseActionTypes.REQUEST_FETCH_FOLDER_SIZES:this.requestFolderSizes(t.data.fqPath);break;case i.BrowseActionTypes.FETCHED_FOLDER_SIZES:this.setFolderSizesPending(t.data.resp);break;case i.BrowseActionTypes.COMPLETE_FETCH_FOLDER_SIZES:this.completeFolderSizes(t.data.state)}},t})(n);t.BrowseStore=_,t.browseStore=new _}),define("modules/clean/react/browse/tile_label_input",["require","exports","external/classnames","external/react","modules/clean/react/browse/name_input"],function(e,t,r,o,s){"use strict";function n(e){var t=r("tile-label-input",e.className),n=e.defaultValue||"",i=function(e){e.stopPropagation()};return o.createElement(s.NameInput,{className:t,defaultValue:n,label:e.label,onCancel:e.onCancel,onClick:i,onSubmit:e.onSubmit})}Object.defineProperty(t,"__esModule",{value:!0}),t.TileLabelInput=n}),define("modules/clean/react/browse/util",["require","exports","modules/clean/react/browse/models","modules/clean/em_string","modules/clean/filepath","modules/core/i18n"],function(e,t,r,o,s,n){"use strict";function i(e){if(1===e.count()){var t=e.first(),r=s.filename(t.fq_path);return o.em_snippet(r,13.5)}if(e.count()>1){var i=function(e){return e.isDeleted},a=e.some(i)&&!e.every(i),l=e.toArray().filter(function(e){return e.is_dir}),c=e.toArray().filter(function(e){return!e.is_dir});if(a)return n._("No available actions");var d=[];if(c.length){var u=n.ungettext("%(num_files)d file","%(num_files)d files",c.length).format({num_files:c.length});d.push(u)}if(l.length){var u=n.ungettext("%(num_folders)d folder","%(num_folders)d folders",l.length).format({num_folders:l.length});d.push(u)}return 2===d.length?n._("%(x)s and %(y)s",{comment:'\n            The whole string is a phrase like "2 files and 3 folders". \'x\' is\n            a string containing a phrase like "2 files" and \'y\' is a string\n            containing a phrase like "3 folders".\n          '}).format({x:d[0],y:d[1]}):d[0]}return""}function a(e,t){var o=e.count(),s=n._("You only have partial access");return o>0?1!==o||r.File.canViewFileMembers(e.first(),t)?n.ungettext("%(count)d item selected","%(count)d items selected",o).format({count:o}):r.File.isNoAccessSharedFolder(e.first())?n._("You don’t have access to this folder"):s:t&&!t.canViewContainingNSMembers?s:""}Object.defineProperty(t,"__esModule",{value:!0});t.describeFiles=i,t.getSelectedFilesText=a}),function(){define("modules/clean/react/bubble_menu",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/bubble_dropdown_v2"],function(e,t,r,o,s,n,i){var a,l,c,d,u,p,h,m,f,_;return h=n.KeyCode,_=r.DOM,f=r.createElement,m=function(e,t,r){var o,s;if(o=e[t].type,o!==l&&o!==u&&o!==c)return s=(null!=o?o.displayName:void 0)||e[t],new Error("Expected menu items to be instances of BubbleMenuItem, not "+s+".")},d={DEFAULT:1,CHECKBOX:2,RADIO:3},l=r.createClass({displayName:"BubbleMenuItem",propTypes:{onClick:r.PropTypes.func,href:r.PropTypes.string,target:r.PropTypes.string,disabled:r.PropTypes.bool,closeOnClick:r.PropTypes.bool,closeFunc:r.PropTypes.func,className:r.PropTypes.string,onMouseEnter:r.PropTypes.func,onMouseLeave:r.PropTypes.func,itemType:r.PropTypes.oneOf(s.values(d)),checked:r.PropTypes.bool},getDefaultProps:function(){return{onClick:s.noop,href:"#",target:null,disabled:!1,closeOnClick:!0,closeFunc:s.noop,className:null,onMouseEnter:s.noop,onMouseLeave:s.noop,itemType:d.DEFAULT,checked:null}},_handleMouseEnter:function(t){if(null!=this.refs.item)return e(o.findDOMNode(this.refs.item)).closest(".bubble-menu").removeClass("bubble-menu--keyboard"),this.props.onMouseEnter(t)},_handleClick:function(e){return this.props.disabled?(e.preventDefault(),e.stopPropagation()):"#"===this.props.href&&(e.preventDefault(),this.props.onClick(e),this.props.closeOnClick)?this.props.closeFunc():void 0},_getRole:function(){switch(this.props.itemType){case d.CHECKBOX:return"menuitemcheckbox";case d.RADIO:return"menuitemradio";default:return"menuitem"}},_getAriaChecked:function(){switch(this.props.itemType){case d.CHECKBOX:case d.RADIO:return this.props.checked||!1;default:return null}},renderContents:function(){var e;return e={"bubble-menu-item":!0,"bubble-menu-item--disabled":this.props.disabled,"bubble-menu-item--checked":this.props.checked},_.a({ref:"item",role:this._getRole(),className:t(e),href:this.props.href,target:this.props.target,onClick:this._handleClick,onMouseEnter:this._handleMouseEnter,onMouseLeave:this.props.onMouseLeave,"aria-disabled":this.props.disabled,"aria-checked":this._getAriaChecked()},this.props.children)},render:function(){return _.li({role:"presentation",className:t("bubble-menu-item-wrapper",this.props.className)},this.renderContents())}}),l.TYPES=d,u=r.createClass({displayName:"BubbleMenuSeparator",propTypes:{className:r.PropTypes.string},getDefaultProps:function(){return{className:"bubble-menu-item-separator"}},render:function(){return _.li({role:"separator",className:this.props.className},this.props.children)}}),c=r.createClass({displayName:"BubbleMenuItemGroup",props:{items:r.PropTypes.arrayOf(m).isRequired,closeFunc:r.PropTypes.func},render:function(){var e,t;return 0===this.props.items.length?null:_.li({className:"bubble-menu-item-group",role:"presentation"},_.ul({className:"bubble-menu-item-group u-unlist u-trim-padding",role:"group"},function(){var o,s,n,i,a;for(n=this.props.items,a=[],e=o=0,s=n.length;o<s;e=++o)t=n[e],a.push(r.cloneElement(t,{closeFunc:this.props.closeFunc,key:null!=(i=t.key)?i:e}));return a}.call(this)))}}),a=r.createClass({displayName:"BubbleMenu",propTypes:s.extend({},i.propTypes,{headerContent:r.PropTypes.element,items:r.PropTypes.arrayOf(m).isRequired,onShowDropdown:r.PropTypes.func,targetButton:function(e,t,r){var o;if("button"!==(null!=(o=e.targetButton)?o.type:void 0))return new Error("BubbleDropdown's targetButton must be a `<button>`, found: "+e[t].type)}}),showMenu:function(){var e,t;return null!=(e=this.refs.bubble)&&null!=(t=e.getWrappedComponent())?t.showDropdown():void 0},hideMenu:function(){var e,t;return null!=(e=this.refs.bubble)&&null!=(t=e.getWrappedComponent())?t.hideDropdown():void 0},_onShowBubbleMenu:function(){var t;if(null!=this.refs.menu&&null!=this.refs.bubble)return this.$menu=e(o.findDOMNode(this.refs.menu)),this.$menuitems=this.$menu.find('*[role="menuitem"],*[role="menuitemcheckbox"],*[role="menuitemradio"]'),this.$menu.addClass("bubble-menu--keyboard"),"function"==typeof(t=this.props).onShowDropdown?t.onShowDropdown():void 0},_onKeyDown:function(e){return this.$menu.addClass("bubble-menu--keyboard"),e.keyCode===h.DOWN?(this._focusNext(e.target),e.preventDefault(),e.stopPropagation()):e.keyCode===h.UP?(this._focusPrevious(e.target),e.preventDefault(),e.stopPropagation()):void 0},_onKeyPress:function(e){var t,r,o,s,n,i,a,l,c,d,u,p;for(this.$menu.addClass("bubble-menu--keyboard"),n=null!=(l=e.which)?l:e.keyCode,s=String.fromCharCode(n).toLowerCase(),c=this.$menuitems,p=[],r=o=0,i=c.length;o<i;r=++o){if(a=c[r],t=null!=(d=a.textContent)&&null!=(u=d[0])?u.toLowerCase():void 0,t===s&&r>this.$menuitems.index(e.target)){a.focus(),e.stopPropagation();break}p.push(void 0)}return p},_focusPrevious:function(e){var t;return t=this.$menuitems.index(e),t=t===-1||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},_focusNext:function(e){var t;return t=this.$menuitems.index(e),t=t===-1||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},render:function(){var e,t,o;return this.props.targetButton&&(o=f(p,{ref:"targetButton",childProps:{"aria-haspopup":!0}},this.props.targetButton)),f(i,s.extend({},this.props,{ref:"bubble",shouldTrapKeyboardFocus:!0,onShowDropdown:this._onShowBubbleMenu,targetButton:o}),_.div({},this.props.headerContent),_.ul({role:"menu",ref:"menu",className:"bubble-menu",onKeyDown:this._onKeyDown,onKeyPress:this._onKeyPress},function(){var o,s,n,i,a;for(n=this.props.items,a=[],e=o=0,s=n.length;o<s;e=++o)t=n[e],a.push(r.cloneElement(t,{closeFunc:this.hideMenu,key:null!=(i=t.key)?i:e}));return a}.call(this)))}}),p=r.createClass({displayName:"BubbleMenuTargetButtonWrapper",propTypes:{childProps:r.PropTypes.object},render:function(){return r.cloneElement(this.props.children,this.props.childProps)}}),a.POSITIONS=i.POSITIONS,{BubbleMenuItem:l,BubbleMenuSeparator:u,BubbleMenuItemGroup:c,BubbleMenu:a}})}.call(this),define("modules/clean/react/file_uploader/constants",["require","exports","tslib","external/immutable","modules/core/browser"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploaderActionTypes={SET_PATH:"UPLOADER_SET_PATH",SET_USER:"UPLOADER_SET_USER",SET_NUM_DRAGGING_FILES:"SET_NUM_DRAGGING_FILES",QUEUE_UPLOADS:"QUEUE_UPLOADS",START_UPLOAD:"START_UPLOAD",COMPLETE_UPLOAD:"COMPLETE_UPLOAD",CANCEL_UPLOADS:"CANCEL_UPLOADS",SET_CURRENT_UPLOAD_PROGRESS:"SET_CURRENT_UPLOAD_PROGRESS",UPLOAD_ERROR:"UPLOAD_ERROR",SET_IS_UPLOAD_MODAL_OPEN:"SET_IS_UPLOAD_MODAL_OPEN",SET_IS_INLINE_STATUS_DISMISSED:"SET_IS_INLINE_STATUS_DISMISSED",ADD_NEW_FAILED_FILE:"ADD_NEW_FAILED_FILE"},t.FileStatusTypes={PENDING:"PENDING",UPLOADING:"UPLOADING",COMPLETE:"COMPLETE",CANCELLED:"CANCELLED",FAILED:"FAILED"},t.UploadErrorTypes={FILE_SIZE_ERROR:"FILE_SIZE_ERROR",HTTP_ERROR:"HTTP_ERROR",CONNECTION_ERROR:"CONNECTION_ERROR",OVER_QUOTA_ERROR:"OVER_QUOTA_ERROR",IGNORED:"IGNORED",EMPTY_OR_FOLDER:"EMPTY_OR_FOLDER",PACKAGE_FILE:"PACKAGE_FILE",GENERIC:"GENERIC"},t.OverQuotaStatusTypes={NONE:"NONE",BASIC_OVER_QUOTA:"BASIC_OVER_QUOTA",BASIC_NEAR_QUOTA:"BASIC_NEAR_QUOTA",LIMITED_TEAM_USER_OVER_QUOTA:"LIMITED_TEAM_USER_OVER_QUOTA",LIMITED_TEAM_TSD_OVER_QUOTA:"LIMITED_TEAM_TSD_OVER_QUOTA"};var n=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(o.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:t.FileStatusTypes.PENDING,errorType:t.UploadErrorTypes.GENERIC,errorMessage:""},"FileUpload"));t.FileUpload=n,t.INTERNAL_FILE_DATA_TRANSFER_TYPE=s.msie?"text":"application/x-dropbox-file-list"}),function(){var e=function(e,r){function o(){this.constructor=e}for(var s in r)t.call(r,s)&&(e[s]=r[s]);return o.prototype=r.prototype,e.prototype=new o,e.__super__=r.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_uploader/store",["external/immutable","modules/clean/base64","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/file_uploader/constants","modules/core/exception","modules/clean/react/file_uploader/utils"],function(t,r,o,s,n,i,a){var l,c,d,u,assert,p,reportStack;return l=s.BrowseActionTypes,d=n.UploaderActionTypes,c=n.FileStatusTypes,assert=i.assert,reportStack=i.reportStack,p=a.generateUploadId,u=(function(r){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,r),o.prototype._init=function(){return this._path="/",this._hasPermissionToUploadToFolder=!0,this._user=null,this._fileList=t.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._isInlineStatusDismissed=!1,this._numSecondsLeft=0},o.prototype.fileList=function(){return this._fileList},o.prototype.currentUpload=function(){return this._fileList.get(this._currentUploadId)},o.prototype.currentUploadPercentage=function(){return this.currentUpload().percentUploaded},o.prototype.numSecondsLeft=function(){return this._numSecondsLeft},o.prototype.isUploadCancelled=function(e){var t;return(null!=(t=this._fileList.get(e))?t.status:void 0)===c.CANCELLED},o.prototype.isInlineStatusDismissed=function(){return this._isInlineStatusDismissed},o.prototype.path=function(){return this._path},o.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},o.prototype.user=function(){return this._user},o.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===c.PENDING})},o.prototype.numDraggingFiles=function(){return this._numDraggingFiles},o.prototype.isInternalTransfer=function(){return this._isInternalTransfer},o.prototype.totalSizeOfCompletedUploads=function(){return this._fileList.reduce(function(e,t){return t.status===c.COMPLETE?e+t.size:e},0)},o.prototype.totalSize=function(){return this._fileList.reduce(function(e,t){var r;return(r=t.status)===c.COMPLETE||r===c.PENDING||r===c.UPLOADING?e+t.size:e},0)},o.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},o.prototype._setUser=function(e){var t;return t=e.user,this._user=t,this.emit_change()},o.prototype._setPath=function(e){var t,r,o;return r=e.path,t=null==(o=e.hasPermissionToUploadToFolder)||o,this._path=r,this._hasPermissionToUploadToFolder=t,this.emit_change()},o.prototype._initializeEverything=function(e){var t,r,o;return o=e.user,r=e.path,t=e.context,this._user=o,this._path=r,this._hasPermissionToUploadToFolder=t.isCurrentPathWriteable(),this.emit_change()},o.prototype._queueUploads=function(e){var t,r,o,s,n;for(r=e.files,n={},o=0,s=r.length;o<s;o++)t=r[o],n[t.uploadId]=t;return this._fileList=this._fileList.merge(n),this.emit_change()},o.prototype._startUpload=function(e){var t;return t=e.file,assert(null==this._currentUpload),assert(null!=t),assert(this._fileList.get(t.uploadId)===t),this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",c.UPLOADING)}),this._currentUploadId=t.uploadId,this.emit_change()},o.prototype.countIfThereArePendingUploadsWithoutCurrent=function(e){var t;return t=e.uploadId,this._fileList.count(function(e){var r;return((r=e.status)===c.PENDING||r===c.UPLOADING)&&e.uploadId===!t})},o.prototype._completeUpload=function(e){var t,r;return t=e.uploadId,r=this._fileList.get(t),t===this._currentUploadId&&r.status===c.UPLOADING||reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:r.toJS(),fileListLength:this._fileList.count(),uploadId:t,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(r.uploadId,function(e){return e.set("status",c.COMPLETE)}),this._currentUploadId=null,this.emit_change()},o.prototype._cancelUploads=function(e){var t,r,o,s;for(r=e.files,o=0,s=r.length;o<s;o++)t=r[o],this._fileList=this._fileList.update(t.uploadId,function(e){var t;return(t=e.status)===c.PENDING||t===c.UPLOADING?e.set("status",c.CANCELLED):e}),t.uploadId===this._currentUploadId&&(this._currentUploadId=null);return this.emit_change()},o.prototype._setCurrentUploadProgress=function(e){var t,r;return r=e.percentComplete,t=e.numSecondsLeft,this._fileList=this._fileList.update(this._currentUploadId,function(e){return e.set("percentUploaded",r)}),this._numSecondsLeft=t,this.emit_change()},o.prototype._handleUploadError=function(e){var t,r,o,s;return s=e.uploadId,r=e.errorType,t=e.errorMessage,o=this._fileList.get(s),o.uploadId!==this._currentUploadId&&reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:o.toJS(),fileListLength:this._fileList.count(),errorType:r,errorMessage:t}}),this._fileList=this._fileList.update(o.uploadId,function(e){return e.set("status",c.FAILED).set("errorType",r).set("errorMessage",t)}),this._currentUploadId=null,this.emit_change()},o.prototype._setNumDraggingFiles=function(e){var t,r,o;return r=e.numDraggingFiles,t=null!=(o=e.isInternalTransfer)&&o,this._numDraggingFiles=r,this._isInternalTransfer=t,this.emit_change()},o.prototype._setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,this._isUploadModalOpen=t,this.emit_change()},o.prototype._setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,this._isInlineStatusDismissed=t,this.emit_change()},o.prototype._addNewFailedFile=function(e){var t,r,o;return o=e.file,r=e.errorType,t=e.errorMessage,null==o.uploadId&&(o=o.set("uploadId",p())),o=o.set("status",c.FAILED).set("errorType",r).set("errorMessage",t),this._fileList=this._fileList.set(o.uploadId,o),this.emit_change()},o.prototype._new_payload=function(e){switch(e.action.type){case l.INITIALIZE_EVERYTHING:return this._initializeEverything(e.action.data);case l.SET_USER:case d.SET_USER:return this._setUser(e.action.data);case l.SET_PATH:case d.SET_PATH:return this._setPath(e.action.data);case d.QUEUE_UPLOADS:return this._queueUploads(e.action.data);case d.START_UPLOAD:return this._startUpload(e.action.data);case d.COMPLETE_UPLOAD:return this._completeUpload(e.action.data);case d.CANCEL_UPLOADS:return this._cancelUploads(e.action.data);case d.SET_CURRENT_UPLOAD_PROGRESS:return this._setCurrentUploadProgress(e.action.data);case d.UPLOAD_ERROR:return this._handleUploadError(e.action.data);case d.SET_NUM_DRAGGING_FILES:return this._setNumDraggingFiles(e.action.data);case d.SET_IS_UPLOAD_MODAL_OPEN:return this._setIsUploadModalOpen(e.action.data);case d.SET_IS_INLINE_STATUS_DISMISSED:return this._setIsInlineStatusDismissed(e.action.data);case d.ADD_NEW_FAILED_FILE:return this._addNewFailedFile(e.action.data)}},o})(o),{UploaderStore:new u}})}.call(this),define("modules/clean/react/file_uploader/utils",["require","exports","modules/clean/base64","modules/clean/react/file_uploader/constants"],function(e,t,r,o){"use strict";function s(){for(var e="",t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));var o=r.encode(e);return o=o.replace(/\+/g,"-"),o=o.replace(/\//g,"_"),o=o.replace(/\=*$/,"")}function n(e){var t=e.fileList,r=e.uploadId;return!!t.find(function(e){return e.status in[o.FileStatusTypes.PENDING,o.FileStatusTypes.UPLOADING]&&e.uploadId!==r})}function i(e,t){var r=0;return e.forEach(function(e){t.indexOf(e.status)!==-1&&(r+=e.size)}),r}Object.defineProperty(t,"__esModule",{value:!0}),t.generateUploadId=s,t.checkIfThereArePendingUploadsWithoutCurrent=n,t.calculateSizeOfUploads=i}),define("modules/clean/react/home/home_access/home_access_util",["require","exports","modules/constants/starred"],function(e,t,r){"use strict";function o(){return r.HOME_ENABLED}Object.defineProperty(t,"__esModule",{value:!0}),t.isHomeEnabled=o}),define("modules/clean/react/maestro/checkbox",["require","exports","tslib","external/react","external/classnames"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;(function(e){e[e.Checked=0]="Checked",e[e.PartiallyChecked=1]="PartiallyChecked",e[e.Unchecked=2]="Unchecked"})(n||(n={})),t.CheckboxState=n;var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.checkboxState,t=s({"checkbox-button":!0,"partial-checked":e===n.PartiallyChecked,checked:e===n.Checked});return o.createElement("button",{role:"checkbox","aria-checked":e===n.Checked,"aria-label":this.props.ariaLabel,className:t,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown})},t})(o.PureComponent);t.Checkbox=i}),define("modules/clean/react/maestro/tile_element",["require","exports","tslib","external/classnames","external/react","modules/clean/keycode","modules/clean/react/maestro/checkbox","modules/clean/react/maestro/tile_grid_logger"],function(e,t,r,o,s,n,i,a){"use strict";function l(e){var t=e.leftOffset,r=e.tileHeight,o=e.tileWidth,n=e.thumbNode,i=e.labelNode,a={left:t,height:r,width:o,pointerEvents:"none"},l={height:o,width:o};return s.createElement("div",{className:"tile",style:a},s.createElement("div",{className:"tile__thumb-container",style:l},n||s.createElement("div",{className:"tile__preview--placeholder"})),i)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){return null};t.TilePlaceholder=l;var d=(function(e){function t(t){var r=e.call(this,t)||this;return r.animationRequestIds=[],r.focusTile=function(){if(!r.state.isFocused){var e=r.refs.tileThumbContainer;e&&e.focus()}},r.logTileInteractive=function(){var e=!!r.props.thumbnailUrl,t=r.state.thumbLoaded;if(r.props.onThumbnailLoad){var o=window.requestAnimationFrame(function(){var o=window.requestAnimationFrame(function(){r.props.onThumbnailLoad(r.props.tileIndex,e,t)});r.animationRequestIds.push(o)});r.animationRequestIds.push(o)}},r.toggleSelect=function(e){e.stopPropagation(),r.props.handleToggleSelect()},r.handleThumbKeyPress=function(e){var t=e.keyCode;t!==n.KeyCode.SPACE&&t!==n.KeyCode.ENTER||(e.preventDefault(),r.props.onTileAction(e))},r.onBlur=function(e){r.setState({isFocused:!1})},r.onFocus=function(e){r.setState({isFocused:!0})},r.state={iconLoaded:!!t.thumbStore.get_thumb(t.iconUrl),thumbLoaded:!(!t.thumbnailUrl||!t.thumbStore.get_thumb(t.thumbnailUrl))},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.delayRenderFullTile?this.renderCompleteTileTimeout=setTimeout(function(){e.renderCompleteTileTimeout=0,e.fetchThumbnail()},100):this.fetchThumbnail(),this.logTileInteractive()},t.prototype.componentDidUpdate=function(e,t){!e.isFocused&&this.props.isFocused&&this.focusTile()},t.prototype.componentWillUnmount=function(){this.thumbRequestId&&this.props.thumbStore.unbind_url(this.thumbRequestId),this.props.thumbStore.unbind_url(this.iconRequestId),this.renderCompleteTileTimeout&&clearTimeout(this.renderCompleteTileTimeout),this.animationRequestIds.forEach(function(e){window.cancelAnimationFrame(e)}),this.animationRequestIds=[]},t.prototype.fetchThumbnail=function(){var e=this;if(this.props.thumbnailUrl){var t=Date.now();this.thumbRequestId=this.props.thumbStore.bind_url(this.props.thumbnailUrl,{onSuccess:function(){e.setState({thumbLoaded:!0}),a.InfiniteTileGridLogger.logThumbRTT(Date.now()-t)},onError:function(){e.props.onThumbnailError&&e.props.onThumbnailError(e.props.tileIndex)}})}this.iconRequestId=this.props.thumbStore.bind_url(this.props.iconUrl,{onSuccess:function(){e.state.thumbLoaded||e.setState({iconLoaded:!0})}})},t.prototype.renderCheckbox=function(){var e=this.props.isSelected?i.CheckboxState.Checked:i.CheckboxState.Unchecked;return s.createElement("div",{key:"tile-select-checkbox",className:"tile-select-checkbox"},s.createElement(i.Checkbox,{ariaLabel:this.props.checkboxAriaText,checkboxState:e,onClick:this.toggleSelect}))},t.prototype.renderActionNode=function(){return s.createElement("div",{key:"tile-action-node",className:"tile__action-button"},this.props.actionNode)},t.prototype.renderThumbnail=function(){var e="tile__preview",t=null;return this.state.thumbLoaded&&(t=this.props.thumbStore.get_thumb(this.props.thumbnailUrl),t&&(e+=" tile__preview--thumb")),!t&&this.state.iconLoaded&&(t=this.props.thumbStore.get_thumb(this.props.iconUrl),t&&(e+=" tile__preview--icon")),t?s.createElement("img",{alt:this.props.altText,className:e,draggable:!1,src:t,style:{maxHeight:this.props.width,maxWidth:this.props.width}}):s.createElement("div",{className:"tile__preview--placeholder"})},t.prototype.render=function(){var e=null;this.props.labelNode&&(e=s.createElement("div",{className:"tile-label"},this.props.labelNode));var t=this.props.width+this.props.labelHeight;if(this.props.isViewOnly)return s.createElement(l,{leftOffset:this.props.leftOffset,tileHeight:t,tileWidth:this.props.width,thumbNode:this.renderThumbnail(),labelNode:e});var n={left:this.props.leftOffset,height:t,width:this.props.width},i={height:this.props.width,width:this.props.width},a={className:o("tile",{"tile--is-selected":this.props.isSelected,"tile--focused-in":this.state.isFocused}),style:n,draggable:this.props.isDraggable,onBlur:this.onBlur,onClick:this.props.onTileAction,onDragEnter:this.props.onDragEnter,onDragStart:this.props.onDragStart,onFocus:this.onFocus},c=s.createElement("div",{ref:"tileThumbContainer",className:"tile__thumb-container",style:i,tabIndex:0,onKeyDown:this.handleThumbKeyPress},this.renderThumbnail());return s.createElement("div",r.__assign({},a),c,this.props.isSelectable&&this.renderCheckbox(),this.renderActionNode(),e)},t})(s.PureComponent);d.defaultProps={checkboxAriaText:"",delayRenderFullTile:!0,handleToggleSelect:c,isFocused:!1,isSelected:!1,isViewOnly:!1,onDragEnter:c,onDragStart:c,onTileAction:c},t.TileElement=d}),define("modules/clean/react/maestro/tile_grid",["require","exports","tslib","external/react","external/react-dom","external/classnames","modules/clean/js_client_stopwatch","external/spectrum/culled_list","modules/clean/react/maestro/tile_element","modules/clean/react/maestro/tile_grid_logger","modules/clean/photos/thumb_loading/generic_thumb_store"],function(e,t,r,o,s,n,i,a,l,c,d){"use strict";function u(e){var t=null;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];if(!t||t.length!==r.length||!t.every(function(e,t){return e===r[t]}))return t=r,e.apply(void 0,r)}}function p(e){var t=e.className,r=e.label;return t=n("tile-label__text",t),o.createElement("div",{className:t},r)}Object.defineProperty(t,"__esModule",{value:!0});t.memoizeCallback=u,t.TileItemLabelText=p;var h=(function(e){function t(t){var r=e.call(this,t)||this;if(r.ttiReported=!1,r.itemRangeByRow=[],r.scrollTileIntoView=function(e,t){var o=r.props.contentOffset||0,s=document.documentElement.scrollTop||document.body.scrollTop,n=Math.floor(t/r.state.tilesPerRow),i=e-o,a=r.getRowHeight(),l=n*a,c=l+a;s<=l&&c<=i+s||(l<s?window.scrollTo(0,l):window.scrollTo(0,c-i))},r.updateOnResize=function(){window.requestAnimationFrame(function(){r.getAndUpdateTileLayout()})},r.handleTTI=function(){r.ttiReported=!0,r.props.handleTTI()},r.setLastViewedPage=function(e){
var t=document.documentElement.scrollTop||document.body.scrollTop,o=Math.round(t/e);if(r.tileLoadLogger.pruneTrackedPages(),r.tileLoadLogger.logCompletedPages(),!r.tileLoadLogger.pagesCompletedLogging.has(o)&&!r.tileLoadLogger.pagesToLog.has(o))if(o!==r.tileLoadLogger.lastViewedPage){if(r.tileLoadLogger.lastViewedPage=o,r.tileLoadLogger.pageChangeTime=r.tileLoadLogger.getTimeNow(),!r.tileLoadLogger.startTimeByPage.get(o)){var s=r.tileLoadLogger.getTimeNow(),n=r.tileLoadLogger.startTimeByPage.set(o,s);r.tileLoadLogger.startTimeByPage=n}}else{var s=r.tileLoadLogger.getTimeNow();if(s-r.tileLoadLogger.pageChangeTime>1e3){var i=r.tileLoadLogger.pagesToLog.add(o);r.tileLoadLogger.pagesToLog=i}}},r.logTileError=function(e){r.tileLoadLogger&&r.tileLoadLogger.recordTileError(e),r.props.logTileLoading&&c.InfiniteTileGridLogger.logThumbLoadError()},r.logTileLoaded=function(e,t,o){r.tileLoadLogger&&r.tileLoadLogger.recordTileLoaded(e,t,o)},r.renderTileElement=function(e,t,s){if(e<0||e>r.props.totalNumItems)return null;var n=r.props.getTileItem(e,s);if(!n)return o.createElement(l.TilePlaceholder,{leftOffset:t,tileHeight:r.state.tileWidth,tileWidth:r.state.tileWidth});var i=r.ttiReported&&r.props.delayRenderFullTile,a=n.isSelectable&&!!r.props.selectedIds&&r.props.selectedIds.has(n.id);return o.createElement(l.TileElement,{key:n.id,onTileAction:n.onTileAction,width:r.state.tileWidth,leftOffset:t,tileIndex:e,labelHeight:n.labelNode?r.props.labelHeight:0,delayRenderFullTile:i,actionNode:n.actionNode,iconUrl:n.iconUrl,thumbnailUrl:n.thumbnailUrl,labelNode:n.labelNode,altText:n.altText,onThumbnailError:r.props.logTileLoading?r.logTileError:void 0,onThumbnailLoad:r.props.logTileLoading?r.logTileLoaded:void 0,isDraggable:n.isDraggable,onDragEnter:n.onDragEnter,onDragStart:n.onDragStart,isFocused:n.isFocused,isSelectable:n.isSelectable,isSelected:a,isViewOnly:n.isViewOnly,handleToggleSelect:n.handleToggleSelect,checkboxAriaText:n.checkboxAriaText,thumbStore:r.thumbStore,scrollTileIntoView:r.scrollTileIntoView})},r.renderRow=function(e,t,s){var n=r.rowHeights?r.rowHeights[t]:r.getRowHeight();if(!e)return o.createElement(a.CulledItem,{className:r.props.rowClass,height:n,key:t,tagName:"li",topOffset:s});if(!Array.isArray(e))return o.createElement(a.CulledItem,{className:r.props.rowClass,height:n,key:t,tagName:"li",topOffset:s},e);for(var i=e,l=i[0],c=i[1],d=r.state.tileWidth+r.props.tilePadding,u=[],p=4,h=l;h<c;h++)u.push(r.renderTileElement(h,p,u.length)),p+=d;return o.createElement(a.CulledItem,{className:r.props.rowClass,height:n,key:t,tagName:"li",topOffset:s},u)},r.handleRangeInView=u(function(e,t){var o=r.props.onRangeInView;if(o){var s=r.translateRowRangeToItemRange(e,t);o(s[0],s[1])}}),r.props.sectionLabels||r.props.sectionStartIndices){if(!r.props.sectionLabels||!r.props.sectionStartIndices)throw new Error("Included only one of `sectionLabels` or `sectionStartIndices`.");if(r.props.sectionLabels.count()!==r.props.sectionStartIndices.count())throw new Error("sectionLabels and sectionStartIndices must be of same length.")}return r.state={tilesPerRow:3,tileWidth:r.props.maxTileWidth},r.props.thumbStore?r.thumbStore=r.props.thumbStore:r.thumbStore=new d.GenericThumbStore,i.JSStopwatch.create_stopwatch_if_not_exist("infinite_tile_grid_logging"),r}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;window.addEventListener("resize",this.updateOnResize),this.animationFrameRequestId=window.requestAnimationFrame(function(){var t=e.getAndUpdateTileLayout();e.props.logTileLoading&&e.setupTileLogging(e.getRowHeight(),t.tilesPerRow)})},t.prototype.componentWillReceiveProps=function(e){this.tileLoadLogger&&this.tileLoadLogger.updateNumTiles(e.totalNumItems)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateOnResize),this.animationFrameRequestId&&window.cancelAnimationFrame(this.animationFrameRequestId),this.tileLoadLogger&&(clearInterval(this.logTrackingInterval),delete this.tileLoadLogger)},t.prototype.getRowHeight=function(){var e=this.props.tileHeight+this.props.tilePadding;return this.props.showLabels&&(e+=this.props.labelHeight+4),e},t.prototype.getPageHeight=function(){var e=document.documentElement.clientHeight||window.outerHeight,t=this.props.contentOffset||0,r=e-t,o=this.getRowHeight(),s=o*Math.ceil(r/o);return Math.max(s,o)},t.prototype.getAndUpdateTileLayout=function(){var e=this.props.maxTileWidth+this.props.tilePadding,t=s.findDOMNode(this);if(!t||0===t.clientWidth)return{tileWidth:this.state.tileWidth,tilesPerRow:this.state.tilesPerRow};var r=t.clientWidth,o=Math.max(1,Math.floor(r/e)),n=this.props.maxTileWidth;return r%e>1&&(o++,n=r/o-this.props.tilePadding),this.state.tileWidth===n&&this.state.tilesPerRow===o||this.setState({tileWidth:n,tilesPerRow:o}),{tileWidth:n,tilesPerRow:o}},t.prototype.setupTileLogging=function(e,t){var r=this.getPageHeight(),o=t*Math.ceil(r/e);this.tileLoadLogger=new c.InfiniteTileGridLogger(this.props.totalNumItems,o,t,this.handleTTI);var s=this.tileLoadLogger.pagesToLog.add(0);this.tileLoadLogger.pagesToLog=s;var n=this.tileLoadLogger.getTimeNow(),i=this.tileLoadLogger.startTimeByPage.set(0,n);this.tileLoadLogger.startTimeByPage=i,this.logTrackingInterval=setInterval(this.setLastViewedPage,200,r)},t.prototype.translateRowRangeToItemRange=function(e,t){var r=this.itemRangeByRow;return[r[e][0],r[t][1]]},t.prototype.render=function(){var e=this,t=this.itemRangeByRow;t.length=0;var r=[],s=this.getRowHeight(),n=this.props,i=n.containerClass,l=n.enableMaxHeightGrouping,c=n.numThresholdRows,d=n.scrollDeltaThreshold,u=n.sectionStartIndices,p=n.sectionLabels,h=n.totalNumItems;if(u&&u.count()>0)return this.rowHeights=[],u.forEach(function(n,i){var a=h;i!==u.count()-1&&(a=u.get(i+1)),e.rowHeights.push(32);var l=a-n,c=Math.ceil(l/e.state.tilesPerRow),d=p.get(i),m=o.createElement("div",{className:"tile-section-header"},d);r.push(m),t.push([n,n]);for(var f=0;f<c;f++){var _=n+f*e.state.tilesPerRow,g=Math.min(_+e.state.tilesPerRow,a),S=[_,g];r.push(S),t.push(S),e.rowHeights.push(s)}}),o.createElement(a.CulledList,{enableMaxHeightGrouping:l,items:r,listItemHeight:this.rowHeights,itemBuffer:c,className:i,renderRow:this.renderRow,scrollThreshold:d,onRangeInView:this.handleRangeInView});for(var m=Math.ceil(h/this.state.tilesPerRow),f=0;f<m;f++){var _=f*this.state.tilesPerRow,g=Math.min(_+this.state.tilesPerRow,h),S=[_,g];r.push(S),t.push(S)}return o.createElement(a.CulledList,{enableMaxHeightGrouping:l,items:r,listItemHeight:s,itemBuffer:c,className:i,renderRow:this.renderRow,scrollThreshold:d,onRangeInView:this.handleRangeInView})},t})(o.PureComponent);h.defaultProps={enableMaxHeightGrouping:!1,numThresholdRows:10,tilePadding:16,tileHeight:160,maxTileWidth:160,labelHeight:40,logTileLoading:!1,scrollDeltaThreshold:1,showLabels:!0,getTileItem:function(e,t){return null},handleTTI:function(){}},t.InfiniteTileGrid=h}),define("modules/clean/react/maestro/tile_grid_logger",["require","exports","external/immutable","modules/clean/js_client_stopwatch","modules/core/browser"],function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,o,s){var n=this;this.recordTileError=function(e){var t=Math.floor(e/n.numTilesPerPage);n.pagesWithThumbErrors.has(t)||(n.pagesWithThumbErrors=n.pagesWithThumbErrors.add(t))},this.recordTileLoaded=function(e,t,r){if(r){if(n.thumbsLoaded.has(e))return;n.thumbsLoaded=n.thumbsLoaded.add(e)}else{if(n.iconsLoaded.has(e))return;n.iconsLoaded=n.iconsLoaded.add(e)}var o=!1;o=n.numTiles%n.numTilesPerPage===0?e>=n.numTiles-n.numTilesPerPage:e>=n.numTiles-n.numTiles%n.numTilesPerPage;var s=n.numTilesPerPage;if(o){var i=n.numTiles%n.numTilesPerPage;0!==i&&(s=i)}var a=Math.floor(e/n.numTilesPerPage);if(r||!t){var l=n.numTilesFinalizedByPage,c=l.get(a)||0;n.numTilesFinalizedByPage=l.set(a,c+1)}if(0===a&&n.handleTTI){!(n.iconsLoaded.has(e)&&n.thumbsLoaded.has(e))&&(n.numTilesLoadedOnFirstPage++,n.numTilesLoadedOnFirstPage===s&&n.handleTTI())}r&&(n.pagesWithThumbs.has(a)||(n.pagesWithThumbs=n.pagesWithThumbs.add(a)),n.anyThumbLoadedTimeByPage.get(a)||(n.anyThumbLoadedTimeByPage=n.anyThumbLoadedTimeByPage.set(a,n.getTimeNow())),n.numTilesFinalizedByPage.get(a)===s&&(n.allThumbsLoadedTimeByPage=n.allThumbsLoadedTimeByPage.set(a,n.getTimeNow())))},this.pruneTrackedPages=function(){n.startTimeByPage.entrySeq().forEach(function(e){var t=e[0],r=e[1];!n.pagesToLog.has(t)&&!n.pagesCompletedLogging.has(t)&&n.getTimeNow()-r>2e3&&(n.startTimeByPage=n.startTimeByPage.delete(t))})},this.logCompletedPages=function(){n.pagesToLog.forEach(function(e){var t=n.startTimeByPage.get(e),r=Math.max(n.allThumbsLoadedTimeByPage.get(e),t),o=Math.max(n.anyThumbLoadedTimeByPage.get(e),t);return r&&!n.pagesWithThumbs.has(e)?void n.handlePageCompletedLogging(e):n.pagesWithThumbErrors.has(e)?void n.handlePageCompletedLogging(e):void(t&&r&&o&&(n.logPerfStats(e,t,o,r),n.handlePageCompletedLogging(e)))})},this.numTiles=e,this.numTilesPerPage=t,this.numTilesFinalizedByPage=r.List(),this.numTilesLoadedOnFirstPage=0,this.iconsLoaded=r.Set(),this.thumbsLoaded=r.Set(),this.startTimeByPage=r.Map(),this.allThumbsLoadedTimeByPage=r.Map(),this.anyThumbLoadedTimeByPage=r.Map(),this.pagesWithThumbErrors=r.Set(),this.pagesWithThumbs=r.Set(),this.pagesCompletedLogging=r.Set(),this.pagesToLog=r.Set(),this.handleTTI=s}return e.prototype.getTimeNow=function(){var e=s.performance(),t=-1;return e&&e.now&&(t=e.now()),t},e.prototype.updateNumTiles=function(e){this.numTiles>=e||(this.numTiles=e)},e.prototype.handlePageCompletedLogging=function(e){this.pagesCompletedLogging=this.pagesCompletedLogging.add(e),this.pagesToLog=this.pagesToLog.delete(e),this.startTimeByPage=this.startTimeByPage.delete(e),this.anyThumbLoadedTimeByPage=this.anyThumbLoadedTimeByPage.delete(e),this.allThumbsLoadedTimeByPage=this.allThumbsLoadedTimeByPage.delete(e)},e.logThumbLoadError=function(){o.JSStopwatch.recordTrace("visual_browse_thumb_load_error",{stopwatchName:"infinite_tile_grid_logging",traceTime:0})},e.logThumbRTT=function(e){o.JSStopwatch.recordTrace("visual_browse_thumb_rtt",{stopwatchName:"infinite_tile_grid_logging",traceTime:e})},e.prototype.logPerfStats=function(e,t,r,s){o.JSStopwatch.recordTrace("loaded_any_thumbs_page_"+e,{stopwatchName:"infinite_tile_grid_logging",traceTime:r-t}),o.JSStopwatch.recordTrace("loaded_all_thumbs_page_"+e,{stopwatchName:"infinite_tile_grid_logging",traceTime:s-t})},e})();t.InfiniteTileGridLogger=n}),function(){define("modules/clean/react/outside_event",["external/react","external/underscore","modules/clean/react/util"],function(e,t,r){var o,s,n,i,a;return a=r.mergeProps,i=e.createElement,e.DOM,n=function(r,o,s,n){var l,c,d;return l=null!=(d=r.displayName)?d:"UnnamedComponent",e.createClass({displayName:"Outside"+o+"Handled"+l,propTypes:(c={},c[""+s]=e.PropTypes.func,c[""+n]=e.PropTypes.func,c),componentDidMount:function(){return document.addEventListener(o,this._handleOutsideEvent,!1)},componentWillUnmount:function(){return document.removeEventListener(o,this._handleOutsideEvent,!1)},render:function(){var e,o;return o=a(t.omit(this.props,s,n,"children"),(e={},e[""+s]=this._handleInsideEvent,e)),i(r,o,this.props.children)},_handleOutsideEvent:function(e){var t;return"function"==typeof(t=this.props)[n]?t[n](e):void 0},_handleInsideEvent:function(e){var t,r;return e.stopPropagation(),"function"==typeof(t=e.nativeEvent).stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof(r=this.props)[s]?r[s](e):void 0}})},o=n("div","click","onClick","onOutsideClick"),s=n("div","mousedown","onMouseDown","onOutsideMouseDown"),{OutsideClickHandler:o,OutsideMouseDownHandler:s,addOutsideEventHandling:n}})}.call(this),function(){var e=[].slice,t={}.hasOwnProperty;define("modules/clean/react/selectable_list",["jquery","external/underscore","external/react","external/react-dom","external/immutable","external/keymaster","modules/clean/keycode","modules/clean/react/outside_event","modules/core/browser","modules/core/exception","modules/clean/react/helpers"],function(r,o,s,n,i,a,l,c,d,u,p){var h,m,f,_,g,S,w,assert,b,v,y,T;return l.KeyCode,w=c.addOutsideEventHandling,assert=u.assert,T=p.shallowCompareStateAndProps,_="",S=i.Record({selected:new i.OrderedSet,anchor:null}),v=function(e,t){return null==e&&(e=[]),null==t&&(t=null),new S({selected:new i.OrderedSet(e),anchor:t||e[0]})},f="up",m="down",y=function(e){return d.mac&&e.metaKey||!d.mac&&e.ctrlKey},function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],function(){var e,r,s,n;for(n=[],r=0,s=t.length;r<s;r++)e=t[r],o.isFunction(e)&&n.push(e.apply(this,arguments));return n}},g={onMouseEnter:"handleMouseEnterRow",onMouseDown:"handleMouseDownInRow",onMouseUp:"handleMouseUpInRow",onToggleRowSelected:"handleToggleRowSelected",onFocus:"handleInitialTab"},h={onMouseDown:"handleMouseDownInCheckbox",onToggleRowSelected:"handleToggleRowSelected",onMouseEnter:"noop",onMouseUp:"noop"},function(){var e;return"INPUT"===(e=document.activeElement.tagName)||"TEXTAREA"===e||"SELECT"===e||"BUTTON"===e},b=function(e,l){var c,u;return u=null!=(c=(null!=l?l:{}).shouldComponentUpdate)?c:T,e=w(e,"mouseup","onMouseUp","onOutsideMouseUp"),s.createClass({displayName:"Selectable"+e.displayName,propTypes:{allItemIds:s.PropTypes.instanceOf(i.List),onSelectionChange:s.PropTypes.func,selection:s.PropTypes.instanceOf(S),defaultSelection:s.PropTypes.instanceOf(S),keyScope:s.PropTypes.string,linkedOutsideClasses:s.PropTypes.array,addTabbingClassWhenKeyboardNavigating:s.PropTypes.bool,isCheckboxes:s.PropTypes.bool},getDefaultProps:function(){return{onSelectionChange:o.noop,selection:null,defaultSelection:new S,keyScope:"SelectableList",linkedOutsideClasses:[],addTabbingClassWhenKeyboardNavigating:!0}},getInitialState:function(){return{selection:this.props.defaultSelection}},componentWillMount:function(){return this._focusedItem=null,this._handlerCache={},this._isFocused=!1,this._keepFocusOnToggle=!1,this._mostRecentMousedownTarget=null,this._isSelecting=!1},componentDidMount:function(){return this._setupKeyboardShortcuts(),this._focusItem(this._selection().anchor),r(n.findDOMNode(this)).on("focusin.SelectableList",this.getFocusHandler(!0)).on("focusout.SelectableList",this.getFocusHandler(!1))},shouldComponentUpdate:u,componentDidUpdate:function(e,t){var r,o;if((null!=(r=e.selection)?r.anchor:void 0)!==(null!=(o=this.props.selection)?o.anchor:void 0)&&this._selection().selected.size&&(this._focusedItem=this._selection().anchor),this._focusedItem)return this._focusItem(this._focusedItem),this._focusedItem=null},componentWillUnmount:function(){return this._handlerCache=null,_!==this.props.keyScope&&(a.clearScope(this.props.keyScope),a.setScope(_)),r(n.findDOMNode(this)).off(".SelectableList")},getFocusHandler:function(e){return(function(t){return function(){return t._isFocused=e,!0}})(this)},_setupKeyboardShortcuts:function(){var e,t,r,o,s,i,l,c,u;return _=a.getScope(),_!==this.props.keyScope&&a.setScope(this.props.keyScope),i=(function(e){return function(t){return e._isFocused&&"BUTTON"!==t.target.tagName}})(this),s=(function(e){return function(t){return!document.activeElement||document.activeElement===document.body||n.findDOMNode(e).contains(t.target)&&"INPUT"!==t.target.nodeName}})(this),o=function(e,t){return function(r){return e(r)?(r.preventDefault(),t(r)):null}},u=(function(e){return function(){return e._selectNeighboringItem({direction:f})}})(this),r=(function(e){return function(){return e._extendSelectionRange({direction:f})}})(this),c=(function(e){return function(){return e._selectNeighboringItem({direction:m})}})(this),t=(function(e){return function(){return e._extendSelectionRange({direction:m})}})(this),l=(function(e){return function(){return e._selectAllItems()}})(this),e=(function(e){return function(){return e._deselectAllItems()}})(this),a("up",this.props.keyScope,o(s,u)),a("shift+up",this.props.keyScope,o(s,r)),a("down",this.props.keyScope,o(s,c)),a("shift+down",this.props.keyScope,o(s,t)),a("escape",this.props.keyScope,o(s,e)),d.mac?a("command+a",this.props.keyScope,o(i,l)):a("ctrl+a",this.props.keyScope,o(i,l))},_focusItem:function(e){var t;if(t=this.refs[e],t&&!this._keepFocusOnToggle)return Promise.resolve().then((function(e){return function(){if(e.isMounted())return n.findDOMNode(t).focus()}})(this))},_itemIds:function(){var e;return this.props.allItemIds?this.props.allItemIds:(e=[],s.Children.forEach(this.props.children,function(t){var r;return(null!=t&&null!=(r=t.props)?r.selectableListId:void 0)?e.push(t.props.selectableListId):(null!=t?t.key:void 0)?e.push(t.key):void 0}),i.List(e))},_selection:function(){return this.props.selection?this.props.selection:this.state.selection},_updateState:function(e,t){if(null==t&&(t=!1),this._keepFocusOnToggle=t,this.setState({isSelecting:!1}),!i.is(this._selection(),e))return this.props.selection||this.setState({selection:e}),this.props.onSelectionChange(e)},_selectAllItems:function(){return this.setSelectedItems({itemIds:this._itemIds().toArray()})},_deselectAllItems:function(){if(this.setSelectedItems({itemIds:[]}),n.findDOMNode(this).contains(document.activeElement))return document.activeElement.blur()},_toggleItemSelected:function(e){var t,r,o,s,n,i,a,l,c,d,u,p;if(o=e.itemId,a=e.keepFocusOnToggle,p=this._selection(),p.selected.has(o)){for(p=p.update("selected",(function(e){return function(t){return e.setState({isSelecting:!0}),t.delete(o)}})(this)),l=null,t=this._itemIds().indexOf(o),r=n=c=t+1,d=this._itemIds().count();c<=d?n<d:n>d;r=c<=d?++n:--n)if(s=this._itemIds().get(r),p.selected.has(s)){l=s;break}if(!l)for(r=i=u=t-1;u<=0?i<=0:i>=0;r=u<=0?++i:--i)if(s=this._itemIds().get(r),p.selected.has(s)){l=s;break}l||(l=this._itemIds().get(0)),p=p.set("anchor",l)}else p=p.update("selected",(function(e){return function(t){return e.setState({isSelecting:!0}),t.add(o)}})(this)).set("anchor",o);return this._updateState(p,a)},_selectItemsInRangeTo:function(e){var t,r,o,s,n,i,a,l,c,d,u,p,h;if(i=e.itemId,p=this._selection(),t=null!=(d=p.anchor)?d:this._itemIds().get(0))return r=this._itemIds().indexOf(t),c=this._itemIds().indexOf(i),u=this._rangeOfSelectedBlockSurrounding(t),h=u.startIndex,o=u.endIndex,a=function(){var e,t,r,i;for(r=this._itemIds().toArray(),i=[],n=e=0,t=r.length;e<t;n=++e)s=r[n],h<=n&&n<=o&&i.push(s);return i}.call(this),l=function(){var e,t,o,i;for(o=this._itemIds().toArray(),i=[],n=e=0,t=o.length;e<t;n=++e)s=o[n],(c<=n&&n<=r||r<=n&&n<=c)&&i.push(s);return i}.call(this),c<r&&l.reverse(),p=p.update("selected",(function(e){return function(t){return e.setState({isSelecting:!0}),t.subtract(a).union(l)}})(this)),this._updateState(p)},_selectNeighboringItem:function(e){var t,o,s,n;if(t=e.direction,s=this._itemIds().indexOf(this._selection().selected.last()),o=0,t===f?o=Math.max(0,s-1):t===m&&(o=Math.min(this._itemIds().count()-1,s+1)),n=this._itemIds().get(o),this._focusedItem=n,this.setSelectedItems({itemIds:[n]}),this.props.addTabbingClassWhenKeyboardNavigating)return r(document.body).addClass("tabbing")},_extendSelectionRange:function(e){var t,o,s,n,i,a,l,c,d;if(s=e.direction,c=i=this._selection(),t=null!=(a=c.anchor)?a:this._itemIds().get(0))return o=this._itemIds().indexOf(t),l=this._rangeOfSelectedBlockSurrounding(t),d=l.startIndex,n=l.endIndex,this.setState({isSelecting:!0}),s===f?o===n?d-1>=0&&(c=c.update("selected",(function(e){return function(t){return t.add(e._itemIds().get(d-1))}})(this))):c=c.update("selected",(function(e){return function(t){return t.delete(e._itemIds().get(n))}})(this)):s===m&&(o===d||o!==n?n+1<this._itemIds().count()&&(c=c.update("selected",(function(e){return function(t){return t.add(e._itemIds().get(n+1))}})(this))):c=c.update("selected",(function(e){return function(t){return t.delete(e._itemIds().get(d))}})(this))),c!==i&&(this._focusedItem=c.selected.last(),this._updateState(c)),this.props.addTabbingClassWhenKeyboardNavigating?r(document.body).addClass("tabbing"):void 0},_rangeOfSelectedBlockSurrounding:function(e){var t,r,o,s;for(r=this._itemIds().indexOf(e);;)if(s=r,r-=1,r<0||!this._selection().selected.has(this._itemIds().get(r)))break;for(r=s;;){if(o=this._itemIds().get(r),null==o||!this._selection().selected.has(o))break;t=r,r+=1}return{startIndex:s,endIndex:t}},setSelectedItems:function(e){var t,r,o;return r=e.itemIds,this.setState({isSelecting:!0}),o=this._selection().set("selected",i.OrderedSet(r)),t=r.length>0?r[0]:this._itemIds().get(0),this._updateState(o.set("anchor",t))},handleMouseEnterRow:function(e,t){if(this._isSelecting)return this._selectItemsInRangeTo({itemId:e})},handleMouseDownInRow:function(e,t){return 2===t.button?void(this._selection().selected.has(e)||this.setSelectedItems({itemIds:[e]})):t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):y(t)?void this._toggleItemSelected({itemId:e}):(this._selection().selected.has(e)||(this.setSelectedItems({itemIds:[e]}),this._isSelecting=!0),this._mostRecentMousedownTarget=e)},handleMouseUpInRow:function(e,t,r){return e===this._mostRecentMousedownTarget&&this.setSelectedItems({itemIds:[e]}),this._isSelecting=!1},handleInitialTab:function(e){if(this._itemIds().first()===e&&!this._selection().selected.has(e)&&!this.state.isSelecting)return this.setSelectedItems({itemIds:[e]})},handleToggleRowSelected:function(e,t){return(null!=t?t.shiftKey:void 0)?void this._selectItemsInRangeTo({itemId:e}):this._toggleItemSelected({itemId:e,keepFocusOnToggle:!0})},handleOutsideMouseUp:function(e){var t;if(this._isSelecting=!1,this._mostRecentMousedownTarget=null,t=n.findDOMNode(this),!t.contains(e.target)&&!r(e.target).closest(this.props.linkedOutsideClasses.join()).length&&!this._mostRecentMousedownTarget)return this._deselectAllItems()},handleMouseDownInCheckbox:function(e,t){return t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):this._toggleItemSelected({itemId:e})},noop:function(e,t){},render:function(){var r,n,i,a;return n=this._handlerCache,this._handlerCache={},r=s.Children.map(this.props.children,(function(e){return function(r){var i,a,l,c,d,u,p,m,f;if(!(null!=r&&null!=(p=r.props)?p.selectableListId:void 0)&&!(null!=r?r.key:void 0))return r;u=null!=(m=null!=r&&null!=(f=r.props)?f.selectableListId:void 0)?m:r.key,c={},d=e.props.isCheckboxes?h:g;for(l in d)t.call(d,l)&&(a=d[l],assert(!r.props[l],"SelectableList does not support children having seperate "+l+" listeners"),i=l+u,c[l]=n[i]||e[a].bind(e,u),e._handlerCache[i]=c[l]);return s.cloneElement(r,o.extend(c,{ref:u,isSelected:e._selection().selected.has(u)}))}})(this)),i=Object.keys(this.constructor.propTypes),a=o.extend({},o.omit(this.props,i),{selection:this._selection(),onOutsideMouseUp:this.props.isCheckboxes?o.noop():this.handleOutsideMouseUp}),s.createElement(e,a,r)}})},{createSelectableList:b,createSelection:v}})}.call(this),define("modules/clean/search/api",["require","exports","modules/clean/ajax","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/types","modules/clean/search/models"],function(e,t,r,o,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(){this._activeRequest=null}return e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype.loadResults=function(e){var t=e.user,r=e.path,o=e.query,s=e.start,n=e.maxResults,i=e.searchSessionID,a=e.nsid,l=e.fileNameOnly,c=e.loadDeleted,d=e.showPaperResults,u=e.isDropdown,p=e.isAdminConsole,h=e.webTimer,m=e.onSuccess,f=e.onError,_={query:o,fq_path:r,ns_id:a,filename_only:!!l,max_results:n,deleted:!!c,start:s,show_paper_results:!!d,is_dropdown:!!u,is_admin_console:!!p,show_unmounted_results:!0};this._fetchFullResults(_,t,i,m,f,h)},e.prototype._extractSearchResultsList=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var i=o[r];switch(i.search_result_type){case n.SearchResultTypes.FILE:t.push(s.File.fromServerObject(i));break;case n.SearchResultTypes.PAPER:t.push(s.Paper.fromServerObject(i))}}return t},e.prototype._getSearchType=function(e){return e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"},e.prototype._fetchFullResults=function(e,t,s,n,a,l){var c=this;null!=this._activeRequest&&this._activeRequest.abort();var d={path_scoped:"/"!==e.fq_path,search_type:this._getSearchType(e),query_string:e.query,start:e.start,search_session_id:s};o.SearchClientActivityLogger.log("query_started",t.id,d);var u=(new Date).getTime();this._activeRequest=r.WebRequest({url:"/ajax_fulltext_search",data:e,dataType:"json",subject_user:t,success:function(r,a,p){var h=i.extractBrowseContext(r),m=r.search_results,f=p.getResponseHeader("x-dropbox-request-id");m.forEach(function(e){return e.request_id=f});var _=!!m.find(function(e){return e.used_spellcorrect}),g=c._extractSearchResultsList(m);n({context:h,searchResults:g,deleted:!!e.deleted});var S=o.SearchClientActivityLogger.create_completion_log_dict(d,_,f,u,e.query,g.length,null,s);o.SearchClientActivityLogger.log("query_completed",t.id,S),l&&l.end(f?f:void 0)},error:function(r,n,i){"abort"!==n&&"function"==typeof a&&a(i);var c=r.getResponseHeader("x-dropbox-request-id"),p=o.SearchClientActivityLogger.create_completion_log_dict(d,null,c,u,e.query,null,n,s);o.SearchClientActivityLogger.log("query_failed",t.id,p),l&&l.abort()},complete:function(){this._activeRequest=null}})},e})();t.SearchApiClient=a,t.searchApiClient=new a}),define("modules/clean/search/search_results/actions",["require","exports","modules/clean/search/constants","modules/clean/search/search_results/dispatcher","modules/clean/search/api","modules/clean/search/search_results/store","modules/clean/search/constants"],function(e,t,r,o,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e,t){void 0===e&&(e=s.searchApiClient),void 0===t&&(t=n.searchResultsStore),this._searchApi=e,this._searchResultsStore=t}return e.prototype.runSearch=function(e){var t=this,s=e.user,n=e.path,a=e.query,l=e.qsid,c=e.webTimer,d=e.logOnceFetchedDataRequiredForTTI;o.SearchResultsDispatcher.dispatch({type:r.START_SEARCH_ACTION,data:{query:a,qsid:l}}),this._searchApi.loadResults({user:s,path:n,query:a,start:0,maxResults:i.MaxResults.MAX_SEARCH_RESULTS,fileNameOnly:!1,showPaperResults:!0,isDropdown:!1,isAdminConsole:!1,loadDeleted:!1,searchSessionID:this._searchResultsStore.searchSessionID(),webTimer:c,onSuccess:function(e){var r=e.searchResults,o=e.context;"function"==typeof d&&d(),t._setSearchResults({searchResults:r,context:o}),t._loadDeletedResults({path:n,user:s})}})},e.prototype.loadMoreResults=function(e){var t,s=this,n=e.path,a=e.user;if(this._searchResultsStore.loadingState()===r.SearchLoadingStates.LOADED){if(this._searchResultsStore.hasMoreResults())t=!1;else{if(!this._searchResultsStore.hasMoreResults(!0))return;t=!0}o.SearchResultsDispatcher.dispatch({type:r.CONTINUE_SEARCH_ACTION,data:{didLoadDeletedResults:t}});var l=t?this._searchResultsStore.numDeletedResults():this._searchResultsStore.searchResults().size;this._searchApi.loadResults({user:a,path:n,query:this._searchResultsStore.latestQuery(),fileNameOnly:!1,showPaperResults:!0,isDropdown:!1,isAdminConsole:!1,loadDeleted:t,start:l,maxResults:i.MaxResults.MAX_SEARCH_RESULTS,searchSessionID:this._searchResultsStore.searchSessionID(),onSuccess:function(e){var t=e.searchResults,r=e.context,o=e.deleted;s._appendSearchResults({searchResults:t,context:r,deleted:o}),s._loadDeletedResults({path:n,user:a})}})}},e.prototype._setSearchResults=function(e){var t=e.searchResults,s=e.context;o.SearchResultsDispatcher.dispatch({type:r.SET_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:s}})},e.prototype._appendSearchResults=function(e){var t=e.searchResults,s=e.context,n=e.deleted;o.SearchResultsDispatcher.dispatch({type:r.APPEND_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:s,deleted:n}})},e.prototype._loadDeletedResults=function(e){var t=e.path,r=e.user;this._searchResultsStore.hasMoreResults()||this._searchResultsStore.didLoadDeletedResults()||this.loadMoreResults({path:t,user:r})},e.prototype.setSearchSelection=function(e){var t=e.selection;o.SearchResultsDispatcher.dispatch({type:r.SET_SEARCH_SELECTION_ACTION,data:{selection:t}})},e.prototype.removeSearchResults=function(e){var t=e.fq_paths,s=t.map(function(e){return{before:e,after:null}});o.SearchResultsDispatcher.dispatch({type:r.CHANGE_FILES_ACTION,data:{fileDeltas:s}})},e.prototype.clearSearch=function(){o.SearchResultsDispatcher.dispatch({type:r.CLEAR_SEARCH_ACTION})},e})();t.SearchResultsActions=a,t.searchResultsActions=new a}),define("modules/clean/search/search_results/controller",["require","exports","tslib","external/react","external/react-dom","external/underscore","modules/clean/react/async_file_modal_controller","modules/clean/react/css","modules/clean/search/search_results/actions","modules/clean/search/search_results/store","modules/clean/react/browse/constants","modules/clean/search/search_results/view","modules/clean/react/browse/models","modules/clean/react/browse/store"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e._onSearchResultsStoreChanged=function(){e.setState(e._getStateFromSearchResultsStore()),e.deferredCheckForMissingStarredData&&e.deferredCheckForMissingStarredData()},e._onBrowseStoreChanged=function(){e.setState(e._getStateFromBrowseStore())},e._handleScroll=function(){s.findDOMNode(e).getBoundingClientRect().bottom<=window.innerHeight&&l.searchResultsActions.loadMoreResults({path:e.props.path,user:e.props.user})},e._handleSelectionChange=function(e){l.searchResultsActions.setSearchSelection({selection:e})},e._handleDelete=function(t){i.showDelete(e.props.user,t,e.state.context,function(){})},e._handleRestore=function(t){i.showRestore(e.props.user,t,function(){})},e._handlePermanentDelete=function(t){var r=function(){l.searchResultsActions.removeSearchResults({fq_paths:t.map(function(e){return e.fq_path})})};i.showPermanentlyDelete(e.props.user,t,r)},e._actionHandlers={onDelete:e._handleDelete,onRestore:e._handleRestore,onPermanentDelete:e._handlePermanentDelete,onShowRename:e.props.actionHandlers.onShowRename},e}return r.__extends(a,t),a.prototype.componentWillMount=function(){this.state=this._getStateFromStores()},a.prototype.componentWillReceiveProps=function(e){e.isStarredLoaded&&!this.props.isStarredLoaded&&this.enableStarring()},a.prototype.componentDidMount=function(){c.searchResultsStore.add_change_listener(this._onSearchResultsStoreChanged),h.browseStore.add_change_listener(this._onBrowseStoreChanged),this.props.isStarredLoaded&&this.enableStarring(),this.setState(this._getStateFromStores())},a.prototype.componentWillUnmount=function(){c.searchResultsStore.remove_change_listener(this._onSearchResultsStoreChanged),h.browseStore.remove_change_listener(this._onBrowseStoreChanged)},a.prototype.enableStarring=function(){var t=this,r=e("modules/clean/react/starred/browse_exports").checkForMissingStarredData;this.deferredCheckForMissingStarredData=function(){return n.defer(function(){var e=[];c.searchResultsStore.searchResults().forEach(function(t){t instanceof p.File&&e.push(t)}),r({files:e,user:t.props.user})})},this.deferredCheckForMissingStarredData()},a.prototype._getStateFromStores=function(){return r.__assign({},this._getStateFromBrowseStore(),this._getStateFromSearchResultsStore())},a.prototype._getStateFromBrowseStore=function(){return{viewType:this.props.expRetrievalSearchGridEnabled?h.browseStore.viewType():d.ViewTypes.List}},a.prototype._getStateFromSearchResultsStore=function(){return{context:c.searchResultsStore.browseContext(),hasMoreResults:c.searchResultsStore.hasMoreResults(),loadingState:c.searchResultsStore.loadingState(),latestQuery:c.searchResultsStore.latestQuery(),searchSessionId:c.searchResultsStore.searchSessionID(),searchResults:c.searchResultsStore.searchResults(),selection:c.searchResultsStore.selection(),
selectedFiles:c.searchResultsStore.selectedFiles()}},a.prototype.render=function(){return o.createElement(u.SearchResultsView,r.__assign({},this.state,{maestroSearchBarProps:this.props.maestroSearchBarProps,onFullSearch:this.props.onFullSearch,onScroll:n.throttle(this._handleScroll,200),setFileUploaderPath:this.props.setFileUploaderPath,onSelectionChange:this._handleSelectionChange,path:this.props.path,user:this.props.user,actionHandlers:this._actionHandlers,handleComponentTTI:this.props.handleComponentTTI,ensureFileViewerClosedIfNotPreviewing:this.props.ensureFileViewerClosedIfNotPreviewing,getIsFileJumping:this.props.getIsFileJumping,isFileViewerShown:this.props.isFileViewerShown,fileRename:this.props.fileRename,isStarredLoaded:this.props.isStarredLoaded,expRetrievalSearchGridEnabled:this.props.expRetrievalSearchGridEnabled}))},a})(o.Component);t.SearchResultsController=a(m,["/static/css/browse/browse-vflKskgm_.css","/static/css/scooter/scooter-scoped-vfl8iXN08.css"])}),define("modules/clean/search/search_results/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResultsDispatcher=r}),define("modules/clean/search/search_results/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/selectable_list","modules/clean/search/constants","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/search/store_helpers"],function(e,t,r,o,s,n,i,a,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(t){var r=e.call(this,t)||this;return r._resetSearchResults(),r}return r.__extends(t,e),t.prototype._resetSearchResults=function(){this._browseContext=new c.BrowseContext,this._rawQuery="",this._latestQuery="",this._loadingState="LOADED",this._searchResults=o.List.of(),this._selection=i.createSelection(),this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1},t.prototype.rawQuery=function(){return this._rawQuery},t.prototype.searchSessionID=function(){return this._searchSessionID},t.prototype.browseContext=function(){return this._browseContext},t.prototype.latestQuery=function(){return this._latestQuery},t.prototype.loadingState=function(){return this._loadingState},t.prototype.searchResults=function(){return this._searchResults},t.prototype.hasMoreResults=function(e){return void 0===e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},t.prototype.numDeletedResults=function(){return this._numDeletedResults},t.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},t.prototype.selection=function(){return this._selection},t.prototype.selectedFiles=function(){var e=this,t=this._searchResults.filter(function(t){return t instanceof c.File&&e._selection.selected.has(t.fq_path)});return o.OrderedMap(t.map(function(e){return[e.fq_path,e]}))},t.prototype._setRawQuery=function(e,t){t?this._searchSessionID=t:d.shouldStartNewSearchSession(this._rawQuery,e)&&(this._searchSessionID=d.generateRandomID()),this._rawQuery=e},t.prototype._setSearchQuery=function(e){var t=e.query;this._setRawQuery(t),this.emit_change()},t.prototype._startSearch=function(e){var t=e.query,r=e.qsid;this._resetSearchResults(),this._setRawQuery(t,r),this._latestQuery=d.normalize(t),this._loadingState="LOADING_FIRST_PAGE",this.emit_change()},t.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context;this._setSearchResultsInternal(t),this._loadingState="LOADED",this._browseContext=r,this._updateMoreResults(t),this.emit_change()},t.prototype._setSearchResultsInternal=function(e){this._searchResults=o.List(e)},t.prototype._continueSearch=function(e){e.didLoadDeletedResults&&(this._didLoadDeletedResults=!0),this._loadingState="LOADING_ADDITIONAL_PAGE",this.emit_change()},t.prototype._appendSearchResults=function(e){var t=e.deleted,r=e.searchResults,o=e.context;t&&(this._numDeletedResults+=r.length),this._searchResults=this._searchResults.concat(r),this._loadingState="LOADED",this._browseContext=o,this._updateMoreResults(r),this.emit_change()},t.prototype._clearSearch=function(){this._resetSearchResults(),this.emit_change()},t.prototype._updateMoreResults=function(e){var t=e.length===a.MaxResults.MAX_SEARCH_RESULTS;this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults&&(this._hasMoreDeletedResults=t)},t.prototype._setSearchSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype._applyFileDeltas=function(e){var t=e.fileDeltas;if(t){for(var r=function(e,t){var r=void 0;!e&&t?o._searchResults=o._searchResults.push(t):e&&!t?(r=o._searchResults.findIndex(function(t){return t instanceof c.File&&s.paths_are_equal(t.fq_path,e)}),o._searchResults=o._searchResults.delete(r)):e&&t&&(r=o._searchResults.findIndex(function(t){return t instanceof c.File&&s.paths_are_equal(t.fq_path,e)}),o._searchResults=r>-1?o._searchResults.set(r,t):o._searchResults.push(t))},o=this,n=0,i=t;n<i.length;n++){var a=i[n];r(a.before,a.after)}this.emit_change()}},t.prototype._updateContext=function(e){this._browseContext=e.context},t.prototype._new_payload=function(e){switch(e.action.type){case a.START_SEARCH_ACTION:this._startSearch(e.action.data);break;case a.SET_SEARCH_RESULTS_ACTION:this._setSearchResults(e.action.data);break;case a.CONTINUE_SEARCH_ACTION:this._continueSearch(e.action.data);break;case a.APPEND_SEARCH_RESULTS_ACTION:this._appendSearchResults(e.action.data);break;case a.SET_SEARCH_SELECTION_ACTION:this._setSearchSelection(e.action.data);break;case a.CHANGE_FILES_ACTION:this._applyFileDeltas(e.action.data);break;case a.CLEAR_SEARCH_ACTION:this._clearSearch();break;case l.BrowseActionTypes.SET_URL_PREFIX:this._clearSearch();break;case l.BrowseActionTypes.LOAD_PATH:this._updateContext(e.action.data)}},t})(n);t.SearchResultsStore=u,t.searchResultsStore=new u}),define("modules/clean/search/search_results/view",["require","exports","tslib","jquery","external/underscore","external/react","modules/clean/browse_interface","modules/clean/history","modules/clean/react/browse/util","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/react/browse/file_list_empty_folder_table","modules/clean/filepath","modules/core/i18n","modules/core/uri","modules/clean/react/browse/constants","modules/clean/react/browse/files_view/constants","modules/clean/react/browse/files_view/controller","modules/clean/react/app_actions_view","modules/clean/react/browse/file_actions","modules/clean/search/constants"],function(e,t,r,o,s,n,i,a,l,c,d,u,p,h,m,f,_,g,S,w,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(t){var r=e.call(this,t)||this;return r._ensureFileViewerClosedIfNotPreviewing=function(){var e=a.deconstruct_url().qargs;r.props.ensureFileViewerClosedIfNotPreviewing(e)},r._handleFullSearchOnClick=function(e){e.preventDefault(),r.props.onFullSearch(r.props.latestQuery)},r._renderEmptyFolderView=function(){var e=p.paths_are_equal(r.props.path,"/"),t=h._("No results found"),o=e?h._("Please update your search and try again"):h._("Search all of my Dropbox instead"),s=e?void 0:r._getFullSearchLink(),i=e?void 0:r._handleFullSearchOnClick;return n.createElement(u.EmptyFolderTable,{title:t,subtitle:o,subtitleLink:s,subtitleOnClick:i})},r._maybeRenderMaestroActionMenu=function(e){if(r.props.selectedFiles.size){var t=w.getActionsForFileCollection({files:r.props.selectedFiles,context:r.props.context,user:r.props.user,actionHandlers:r.props.actionHandlers,isSearchMode:!0,isStarredLoaded:r.props.isStarredLoaded});if(t.length>0){var o={displayName:t[0].label,handleClick:t[0].performAction,iconName:t[0].iconName,className:t[0].className},s=t.slice(1).map(function(e){return{displayName:e.label,handleClick:e.performAction,iconName:e.iconName,className:e.className,disabled:e.disabled}}),i=l.getSelectedFilesText(r.props.selectedFiles,r.props.context);return n.createElement(S.AppActionsView,{headerText:i,popoverTriggerLabel:h._("Actions"),primaryMenuItem:o,secondaryMenuItems:s,responsive:e})}}return n.createElement("div",null)},r._renderMaestroAppContent=function(e){return n.createElement("div",{className:"search-results"},r._renderSearchResultItems(e))},r.state={},r}return r.__extends(t,e),t.prototype.componentWillMount=function(){a.add_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype.componentDidMount=function(){o(window).on("scroll.SearchResults",this.props.onScroll)},t.prototype.componentWillUnmount=function(){o(window).off("scroll.SearchResults"),a.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype._getFullSearchLink=function(){var e="work"===this.props.user.role?i.WORK_ROOT:i.PERSONAL_ROOT;return m.parse("/search"+e).setQuery({path:"/",query:this.props.latestQuery,qsid:this.props.searchSessionId}).toString()},t.prototype._searchResultsTitle=function(){return p.paths_are_equal(this.props.path,"/")?h.ungettext("%(num_results)d result in files, folders, Paper docs, and content.","%(num_results)d results in files, folders, Paper docs, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}):h.ungettext("%(num_results)d result in files, folders, and content.","%(num_results)d results in files, folders, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size})},t.prototype._getLoadingState=function(){return this.props.loadingState===b.SearchLoadingStates.LOADING_FIRST_PAGE?f.LoadingStates.LOADING_FIRST_PAGE:this.props.loadingState===b.SearchLoadingStates.LOADING_ADDITIONAL_PAGE?f.LoadingStates.LOADING_REMAINING_PAGES:f.LoadingStates.LOADED},t.prototype._renderSearchResultItems=function(e){return n.createElement(g.FilesViewController,{actionHandlers:this.props.actionHandlers,context:this.props.context,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:f.NewFolderCreationStates.CREATE_FOLDER_INACTIVE,fileRename:this.props.fileRename,files:this.props.searchResults,getIsFileJumping:this.props.getIsFileJumping,isFileViewerShown:this.props.isFileViewerShown,isSearchMode:!0,isStarredLoaded:this.props.isStarredLoaded,isTextSelectable:!1,loadingState:this._getLoadingState(),onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.props.onSelectionChange,onSortChange:s.noop,path:this.props.path,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:this.props.setFileUploaderPath,showFileUploaderModal:s.noop,user:this.props.user,viewType:this.props.viewType,totalNumFiles:this.props.searchResults.size,responsive:e,columns:this._generateColumns(),isViewTypeSwitchingEnabled:!!this.props.expRetrievalSearchGridEnabled})},t.prototype._generateColumns=function(){var e=this;return _.SEARCH_LIST_VIEW_COLUMNS.map(function(t,o){return r.__assign({},t,{label:0===o?e._searchResultsTitle():t.label})})},t.prototype.render=function(){var e=this.props,t=e.user,r=e.maestroSearchBarProps;return n.createElement(d.MaestroChrome,{user:t,titleRegion:n.createElement(c.MaestroHeaderTitle,null,h._("Search results")),embeddedAppRegion:this._renderMaestroAppContent,actionSidebarRegion:this._maybeRenderMaestroActionMenu,searchBarProps:r})},t})(n.Component);t.SearchResultsView=v}),define("modules/clean/sharing/browse_exports",["require","exports","tslib","modules/core/browser","modules/clean/sharing/gating_util","modules/clean/sharing/async_share_modal_util","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/wizard/async_wizard_modals"],function(e,t,r,o,s,n,i,a){"use strict";function l(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e(["modules/clean/sharing/shared_content_link_sync_utils"],function(e){return e.mountSharedFolder.apply(e,t)})}function c(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(r){return[2,new Promise(function(r,o){e(["modules/clean/sharing/ui_util"],function(e){r(e.genContentManagerBridgeUri.apply(void 0,t))},o)})]})})}function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(r){switch(r.label){case 0:return[4,c.apply(void 0,e)];case 1:return t=r.sent(),o.open_tab(t.toString()),[2]}})})}function u(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e(["modules/clean/sharing/cdm_new_folder_modal"],function(e){e.showCdmNewFolderModal.apply(e,t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncMountSharedFolder=l,t.asyncGoToContentManagerForPath=d,t.asyncShowCdmNewFolderModal=u,t.GoldenGate=s.GoldenGate,t.asyncShowShareModal=n.asyncShowShareModal,t.asyncShowNewFolderShareModal=n.asyncShowNewFolderShareModal,t.asyncShowPrefilledShareModal=n.asyncShowPrefilledShareModal,t.asyncShowSharedContentLinkSyncModal=n.asyncShowSharedContentLinkSyncModal,t.makePublicFolderLink=i.makePublicFolderLink,t.shouldUsePublicFolderSharing=i.shouldUsePublicFolderSharing,t.showPublicFolderLinkModal=i.showPublicFolderLinkModal,t.asyncShowShareAFolderWizardModal=a.asyncShowShareAFolderWizardModal}),define("modules/clean/sharing/gating_util",["require","exports","modules/clean/sharing/constants"],function(e,t,r){"use strict";function o(e){return r.TRUELINK.NO_COMMENT_ENABLED&&!!(null!=e?r.TRUELINK.NO_COMMENT_ENABLED[e.id]:void 0)}Object.defineProperty(t,"__esModule",{value:!0}),t.GoldenGate={canSetFolderConfidential:function(e){return Boolean(r.GOLDEN_GATE.CAN_SET_FOLDER_CONFIDENTIAL[e])},hasNewOwnershipModel:function(e){return Boolean(r.GOLDEN_GATE.HAS_NEW_OWNERSHIP_MODEL[e])},hasContentManagerAndSuperAdmin:function(e){return Boolean(r.GOLDEN_GATE.HAS_CONTENT_MANAGER_AND_SUPER_ADMIN[e])},hasContentManagerActionsDisabled:function(e){return Boolean(r.GOLDEN_GATE.HAS_CONTENT_MANAGER_ACTIONS_DISABLED[e])},hasContentManagerCdm:function(e){return Boolean(r.GOLDEN_GATE.HAS_CONTENT_MANAGER_CDM[e])},hasContentManagerTSDSwitch:function(e){return Boolean(r.GOLDEN_GATE.HAS_CONTENT_MANAGER_TSD_SWITCH[e])},SHARING_TOTAL_LIMIT:r.GOLDEN_GATE.SHARING_TOTAL_LIMIT},t.isUserNoCommentEnabled=o}),define("modules/clean/sharing/public_folder/public_folder",["require","exports","modules/core/uri","modules/constants/public_folder_constants"],function(e,t,r,o){"use strict";function s(e,t){if(e.publicAppToken)return t;if(!e.isPublicFolderEnabled)return null;var r=(e.publicFolderFqPath||"/public").toLowerCase(),o=t.toLowerCase();return o===r?"/":o.startsWith(r+"/")?t.substring(r.length):null}function n(e,t){return null!=s(e,t)}function i(e,t,n,i){if(i)return null;var a,l=s(t,n);if(a=o.SHOULD_REDIRECT_URL?"u"+e+".dl.dropboxusercontent.com":"dl.dropboxusercontent.com",null!=l){var c=new r({scheme:"https",authority:a});return t.publicAppToken?(c.setPath("/spa/"+t.publicAppToken+l+"/data"),c.toString()):(c.setPath("/u/"+e+l),c.toString())}return null}function a(t){return new Promise(function(r,o){e(["external/react","modules/clean/react/modal","modules/clean/sharing/public_folder/modal"],function(e,o,s){var n=o.Modal,i=s.CopyPublicLinkModal;n.showInstance(e.createElement(i,{publicLink:t})),r()})})}Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUsePublicFolderSharing=n,t.makePublicFolderLink=i,t.showPublicFolderLinkModal=a}),define("modules/core/framework_args",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FRAMEWORK_ARGS=["country_override","cProfile","public_mode_override","stormcrow_override","stormcrow_override_data_field","stormcrow_override_population","stormcrow_override_ttl","stormcrow_panel","uncompressed_js","use_packages"]});
//# sourceMappingURL=pkg-browse.min.js-vflpvchyX.map