define("modules/clean/react/home/home_access/home_access_main",["require","exports","tslib","jquery","external/react","modules/clean/react/home/constants","modules/clean/react/home/home_access/onboarding/actions","modules/clean/react/home/home_access/recents/section","modules/clean/react/home/home_access/unread/home_access_unread","modules/clean/react/home/starred/starred_view","modules/clean/react/home/store","modules/clean/react/home/util/constants","modules/clean/web_timing_logger","modules/clean/user_education/user_education_client","modules/clean/user_education/user_education_interface"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.updateWidth=function(){var e=n.refs&&n.refs.main;e&&e.getBoundingClientRect&&n.setState({width:e.getBoundingClientRect().width||u.DEFAULT_HOME_WIDTH})},n.onHomeStoreUpdate=function(){n.setState({sectionVisibility:d.HomeStore.getSectionVisibility()})},n.state={sectionVisibility:t.initialSectionVisibility,width:u.DEFAULT_HOME_WIDTH},n.removeStoreListeners=d.HomeStore.addListener(n.onHomeStoreUpdate),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){m.log_js_modules_application_code_start(),p.eventEmitter.on(h.UserEducationStateChannel,function(e){var t=function(e){i("html, body").animate({scrollTop:e},500)},n=e.step;if(n)if(n.name===u.HOME_V1_USER_EDUCATION_STEP_NAMES.RECENTLY_VIEWED){var r=i(".home-recents-section").offset().top,o=i(".maestro-header"),a=o.outerHeight()+o.offset().top;t(r-a)}else n.name===u.HOME_V1_USER_EDUCATION_STEP_NAMES.FILES&&t(0)}),a.updateShowUnreadOnboarding(this.props.showUnreadOnboarding),this.props.onboardingComplete&&a.markHomeOnboardingComplete()},t.prototype.componentDidMount=function(){this.updateWidth(),window.addEventListener("resize",this.updateWidth)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateWidth),this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.componentWillReceiveProps=function(e){!this.props.hasAsyncRendered&&e.hasAsyncRendered&&this.updateWidth()},t.prototype.render=function(){return r.createElement("main",{className:"home-access",role:"main"},r.createElement("ul",{className:"home-access-sections",ref:"main"},r.createElement("li",{className:"home-access-section"},r.createElement(c.HomeAccessUnread,{width:this.state.width})),r.createElement("li",{className:"home-access-section"},r.createElement(l.StarredView,{user:this.props.user,hideSection:this.props.hideStarredSection,isListView:this.props.betas.hasStarredListView,width:this.state.width})),r.createElement("li",{className:"home-access-section"},r.createElement(s.HomeRecentsSection,{user:this.props.user,role:this.props.role,isHiddenByUser:!this.state.sectionVisibility[o.HomeSections.RECENTS],shouldThrottleRecents:this.props.betas.shouldThrottleRecents,shouldAllowHiddenRecents:this.props.betas.shouldAllowHiddenRecents}))))},t})(r.PureComponent);_.displayName="HomeAccessMain",_.defaultProps={showUnreadOnboarding:!1},t.HomeAccessMain=_}),define("modules/clean/react/home/home_access/home_access_web",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/home/home_access/home_access_main","modules/clean/react/home/home_access/sidebar","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/maestro/header","modules/clean/react/home/bootstrap/shared","modules/clean/react/maestro/layout","modules/clean/viewer","modules/core/i18n","modules/clean/history","modules/pagelet_config"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.markHomeAsRendered=function(){var e=window.ensemble;e&&(e.markPageletRenderedByDOMNode?e.markPageletRenderedByDOMNode(r.findDOMNode(n)):e.markPageletRendered&&e.markPageletRendered(h.REQUIREJS_CONFIG.context)),n.setState({hasAsyncRendered:!0})},n.state={hasAsyncRendered:!1},n}return n.__extends(t,e),t.prototype.renderMain=function(e,t){var n={hasStarredListView:this.props.hasStarredListView,shouldThrottleRecents:this.props.shouldThrottleRecents,shouldAllowHiddenRecents:this.props.shouldAllowHiddenRecents};return i.createElement("div",{className:"home"},i.createElement(o.HomeAccessMain,{role:this.props.initialRole,user:e,viewer:t,betas:n,hasAsyncRendered:this.state.hasAsyncRendered,hideStarredSection:this.props.hideStarredSection,showUnreadOnboarding:this.props.showUnreadOnboarding,onboardingComplete:this.props.onboardingComplete,initialSectionVisibility:this.props.initialSectionVisibility}))},t.prototype.renderSidebar=function(e){return this.props.shouldShowSidebar?i.createElement(a.HomeSidebar,{user:e,isPaperEnabledForUser:this.props.isPaperEnabledForUser}):null},t.prototype.componentWillMount=function(){this.props.isBootstrapped||l.initializeHomeStores(this.props.initialRole,this.props.initialSectionVisibility)},t.prototype.componentDidMount=function(){p.remove_query_param("role"),s.homeTimingLogger.registerLoadCallback(this.markHomeAsRendered,4e3)},t.prototype.render=function(){var e=u.get_viewer(),t=e.get_user_by_role(this.props.initialRole);return t?i.createElement(d.MaestroChrome,{user:t,embeddedAppRegion:this.renderMain(t,e),titleRegion:i.createElement(c.MaestroHeaderTitle,null,m._("Home")),actionSidebarRegion:this.renderSidebar(t)}):null},t})(i.PureComponent);_.displayName="HomeAccessWeb",t.HomeAccessWeb=_}),define("modules/clean/react/home/home_access/onboarding/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/api","modules/clean/react/home/home_access/onboarding/constants","modules/clean/react/home/home_access/onboarding/store","modules/clean/react/home/home_access/onboarding/tooltips"],function(e,t,n,i,r,o,a){"use strict";function s(){n.dispatch({type:r.HomeOnboardingActionTypes.SET_ONBOARDING_COMPLETE})}function c(){o.HomeOnboardingStore.shouldShowUnreadOnboarding()&&a.showUnreadTooltipIfRendered()&&(i.hideUnreadOnboarding(),l(!1))}function l(e){n.dispatch({type:r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING,showUnreadOnboarding:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.markHomeOnboardingComplete=s,t.showUnreadOnboardingTooltipIfNecessary=c,t.updateShowUnreadOnboarding=l}),define("modules/clean/react/home/home_access/onboarding/api",["require","exports","modules/clean/react/home/store","modules/clean/react/home/api"],function(e,t,n,i){"use strict";function r(){return i.makeRequest({url:"/home_feed/hide_unread_onboarding",type:"POST",data:{role:n.HomeStore.getRole()}})}Object.defineProperty(t,"__esModule",{value:!0}),t.hideUnreadOnboarding=r}),define("modules/clean/react/home/home_access/onboarding/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeOnboardingActionTypes={SET_ONBOARDING_COMPLETE:"HOME_ONBOARDING_SET_ONBOARDING_COMPLETE",UPDATE_SHOW_UNREAD_ONBOARDING:"HOME_ONBOARDING_UPDATE_SHOW_UNREAD_ONBOARDING"}}),define("modules/clean/react/home/home_access/onboarding/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/constants","modules/clean/flux/flux_store"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=e.call(this,i)||this;return t.isOnboardingComplete=!1,t.showUnreadOnboarding=!1,t}return n.__extends(t,e),t.prototype.getIsOnboardingComplete=function(){return this.isOnboardingComplete},t.prototype.shouldShowUnreadOnboarding=function(){return this.showUnreadOnboarding&&this.getIsOnboardingComplete()},t.prototype.onUpdateShowUnreadOnboarding=function(e){this.showUnreadOnboarding=e},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case r.HomeOnboardingActionTypes.SET_ONBOARDING_COMPLETE:this.isOnboardingComplete=!0;break;case r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING:this.onUpdateShowUnreadOnboarding(t.showUnreadOnboarding);break;default:return}this.__emitChange()},t})(o);t.HomeOnboardingStoreClass=a,t.HomeOnboardingStore=new a}),define("modules/clean/react/home/home_access/onboarding/tooltips",["require","exports","jquery","modules/core/i18n","modules/clean/react/home/util/static_tooltip"],function(e,t,n,i,r){"use strict";function o(e,t,i,o,a){var c=n(e);return!(!c||!c.get(0))&&((new r.StaticTooltip).show(t,i,c.get(0),o,s,s,a),!0)}function a(){return o(".home__unread-card--first",i._("Tip"),i._("New shared files and comments show up here."),r.StaticTooltip.POSITIONS.TOP_LEFT,"home-tooltip__unread-onboarding")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){return null};t.showUnreadTooltipIfRendered=a}),define("modules/clean/react/home/home_access/recents/section",["require","exports","tslib","external/react","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/recent_activity/react/recent_activity_container","modules/clean/react/home/section_header","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/activity_logger","modules/core/i18n"],function(e,t,n,i,r,o,a,s,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeRecentsVisibility=function(){var e=!t.props.isHiddenByUser;r.HomeActions.setSectionVisibility(t.props.user.id,o.HomeSections.RECENTS,!e),l.homeActivityLogger.logShowHideSection(o.HomeSections.RECENTS,e)},t.renderHiddenText=function(){return i.createElement("div",{className:"home-access__recents-hidden-text u-pad-vertical-m"},d._("Your recently viewed files are hidden")," · ",i.createElement("button",{className:"button-as-link",onClick:t.onChangeRecentsVisibility},d._("Show")))},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.isHiddenByUser&&this.props.shouldAllowHiddenRecents&&(c.homeTimingLogger.activate(),c.homeTimingLogger.logTTData(o.LoggingSections.RECENTS),c.homeTimingLogger.logTTI(o.LoggingSections.RECENTS))},t.prototype.render=function(){var e=null,t="home-recents-section__container",r=null;return this.props.shouldAllowHiddenRecents&&(this.props.isHiddenByUser?(e=d._("Show"),t="home-recents-section__container-hidden",r=this.renderHiddenText()):e=d._("Hide")),i.createElement("span",{className:"home-recents-section"},i.createElement(s.SectionHeader,{title:d._("Recent"),ueName:"recents",buttonText:e,buttonAction:this.onChangeRecentsVisibility}),i.createElement("div",{className:"home-access-section__content u-pad-vertical-s"},r,i.createElement("div",{className:t},i.createElement(a.RecentActivityContainer,n.__assign({},this.props)))))},t})(i.PureComponent);u.displayName="HomeRecentsSection",t.HomeRecentsSection=u}),define("modules/clean/react/home/home_access/recents/utils/events",["require","exports","jquery","external/underscore","external/react-dom","modules/clean/recent_activity/recent_activity_logger","modules/clean/react/home/util/logging/activity_logger"],function(e,t,n,i,r,o,a){"use strict";function s(e,n,i,r,o){var s=t.extractLogInfo(e,n,i,r,o);return a.homeActivityLogger.logRecentsAction(s.actionTaken,s.scope,s.itemNumber,s.extension,s.sprite,s.subgroupPosition)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(e,t){return 1===e?o.ActionScopes.SINGLE:t.length===e?o.ActionScopes.AGGREGATION:o.ActionScopes.SUBSET},l=function(e){var t=e.find(".recents-item__icon img.sprite");if(t.length)for(var n=t.attr("class").split(/\s+/),i=0,r=n;i<r.length;i++){var o=r[i];if(o.match(/^s_.*_32$/))return o}return"thumbnail"},d=function(e){var t=e.closest(".recents-view"),n=e.closest(".recents-item");return t.find(".recents-item").index(n)},u=function(e,t,n,i,r){if(e===o.ActionScopes.AGGREGATION||n===o.ActionTypes.COLLAPSE||n===o.ActionTypes.UNCOLLAPSE)return"various";for(var a=0,s=["paper_doc","folder","paper_project"];a<s.length;a++){var c=s[a];if(t.indexOf(c)>=0)return"n/a"}var l=i[r];if(!l)return"n/a";var d=l.lastIndexOf(".");return d===-1?"":l.substr(d+1)},m=function(e,t,n,i){return e===o.ActionScopes.AGGREGATION?n.props.recentItem?0:t+1:e===o.ActionScopes.SUBSET?i.hasClass("recents-item")?0:i.index()+1:0};t.extractLogInfo=function(e,t,i,o,a){var s=n(r.findDOMNode(t)),p=c(o,i),h=l(s);return{actionTaken:e,scope:p,itemNumber:d(s),extension:u(p,h,e,i,a||0),sprite:h,subgroupPosition:m(p,a||0,t,s)}},t.countRecentsItem=function(e){var t=i.countBy(e,function(e){switch(e.type){case 1:return"metaserver";case 16:return"paper";default:return"unknown"}});return{numMetaserverItems:t.metaserver||0,numPaperItems:t.paper||0}},t.logEvent=s}),define("modules/clean/react/home/home_access/sidebar",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/app_actions_view","modules/clean/react/file_uploader/file_uploader","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/util/logging/activity_logger","modules/clean/sharing/wizard/async_wizard_modals","modules/clean/web_timing_logger"],function(e,t,n,i,r,o,a,s,c,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleUploadFiles=function(){a.FileUploaderController.showModal(),l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_UPLOAD_FILES)},t.handleCreateSharedFolder=function(){d.asyncShowShareAFolderWizardModal(t.props.user,function(e){l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_NEW_SHARED_FOLDER,e)})},t.handleCreatePaperDoc=function(){s.HomeActions.createPaperDocInNewTab(t.props.user.id),l.homeActivityLogger.logClickRightMenu(c.LoggingTypes.CLICK_CREATE_PAPER_DOC)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){a.FileUploaderController.setUser(this.props.user),u.waitForTTI().then(function(){a.FileUploaderController.loadCoreComponent()})},t.prototype.render=function(){var e=this.props.user.is_cdm_member?this.props.user.cdm_tmf_path:"/",t=[{displayName:r._("New shared folder"),iconName:"new-shared-folder",handleClick:this.handleCreateSharedFolder}];return this.props.isPaperEnabledForUser&&t.push({displayName:r._("Create Paper doc"),iconName:"new-paper-doc",handleClick:this.handleCreatePaperDoc}),i.createElement("div",{className:"home-access-sidebar"},i.createElement(a.FileUploaderController,{loadOnRender:!1,needToSetStoreValues:!0,dragAndDropEnabled:!1,initialPath:e}),i.createElement(o.AppActionsView,{primaryMenuItem:{displayName:r._("Upload files"),handleClick:this.handleUploadFiles,className:"action-upload"},secondaryMenuItems:t}))},t})(i.PureComponent);t.HomeSidebar=m}),define("modules/clean/react/home/home_access/unread/activity_snippet",["require","exports","external/react"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadActivitySnippet=function(e){var t=e.snippetElement,i=e.aggregationText;return n.createElement("div",{className:"home__unread-activity"},n.createElement("div",{className:"home__unread-activity-snippet",children:t}),i?n.createElement("div",{className:"home__doc-sticker"},i):null)},t.UnreadActivitySnippet.displayName="UnreadActivitySnippet"}),define("modules/clean/react/home/home_access/unread/card",["require","exports","tslib","external/react","external/classnames","modules/clean/react/home/constants","modules/clean/react/home/home_access/unread/activity_snippet","modules/clean/react/home/home_access/unread/detail","modules/clean/react/home/home_access/unread/helpers","modules/clean/react/home/util/doc_with_avatar_icon","modules/clean/react/home/util/logging/activity_logger","modules/clean/web_timing_logger","modules/clean/react/home/util/navigation","modules/core/i18n","modules/core/exception"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.actionMetadata,n=t.actorName,o=t.avatarIcon,c=t.notificationType,d=t.snippetText,u=this.props.resourceMetadata,m=u.resourceTitle,h=u.uriString,_=r({"home__unread-card":!0,"home__unread-card--last-in-row":this.props.lastInRow,"home__unread-card--first":this.props.isFirstCard}),g=function(t,n,i){t.stopPropagation(),t.preventDefault(),"BUTTON"!==i.tagName&&e.props.logClickAndOpen(h,n,t)},f=function(e){return function(t){return g(t,e,t.target)}},v=function(e){return function(t){"Enter"===t.key&&g(t,e,t.target)}};return i.createElement("span",{className:_,onClick:f("card"),onKeyPress:v("card"),href:h,style:{width:this.props.width},"aria-label":"unread-item",role:"button"},i.createElement("div",{className:"home__doc-header"},i.createElement("span",{className:"home__doc-header__icon",onClick:f("icon"),onKeyPress:v("icon"),href:h,"aria-label":"unread-item-icon",role:"button"},i.createElement(l.DocWithAvatarIcon,{avatarIconModel:o,displayType:this.props.displayType,fileName:this.props.resourceMetadata.resourceTitle})),i.createElement("div",{className:"home__doc-text"},i.createElement("div",{className:"home__doc-title-group"},i.createElement("span",{className:"home__doc-title",onClick:f("title"),onKeyPress:v("title"),href:h,"aria-label":"unread-item-title",tabIndex:0,role:"button"},m),i.createElement("button",{className:"home__doc-unread-indicator button-as-link",title:p._("Mark as read"),"aria-label":p._("Mark as read"),onClick:this.props.markRead},p._("Mark as read"))),i.createElement("span",{className:"home__doc-detail",onClick:f("detail"),onKeyPress:v("detail"),href:h,"aria-label":"unread-item-detail",role:"button"},i.createElement(s.UnreadEntryDetail,{actorName:n,notificationType:c,feedTime:this.props.feedTime})),i.createElement("span",{className:"home__doc-snippet",onClick:f("snippet"),onKeyPress:v("snippet"),href:h,"aria-label":"unread-item-snippet",role:"button"},i.createElement(a.UnreadActivitySnippet,{snippetElement:d,aggregationText:this.props.stickerText})))))},t})(i.PureComponent);_.displayName="UnreadCardView",t.UnreadCardView=_;var g=(function(t){function r(){var n=null!==t&&t.apply(this,arguments)||this;return n.logClickAndOpen=function(e,t,i){var r=function(){return d.homeActivityLogger.logOpenUnreadNotificationItem(n.props.notification,o.LoggingSections.UNREAD,t,n.props.position)};m.logAndNavigate(e,r,i)},n.logAndMarkRead=function(t){d.homeActivityLogger.logMarkNotificationAsRead(n.props.notification,n.props.position),t.stopPropagation(),t.preventDefault(),u.waitForTTI().then(function(){e(["modules/clean/react/user_notifications/actions"],function(e){e.acknowledge(n.props.notification)})})},n}return n.__extends(r,t),r.prototype.render=function(){var e=this.props.notification,t=c.getNotificationMetadata(e);return t?i.createElement(_,{actionMetadata:t.actionMetadata,feedTime:e.feedTime,displayType:t.displayType,isFirstCard:this.props.isFirstCard,lastInRow:this.props.lastInRow,logClickAndOpen:this.logClickAndOpen,markRead:this.logAndMarkRead,resourceMetadata:t.resourceMetadata,stickerText:null,width:this.props.width}):(h.reportException({err:new Error("missing metadata for Home Access Unread card"),tags:[o.ExceptionTags.UNREAD]}),null)},r})(i.PureComponent);g.displayName="UnreadNotificationCard",t.UnreadNotificationCard=g}),define("modules/clean/react/home/home_access/unread/detail",["require","exports","external/react","modules/clean/datetime","modules/clean/react_format","modules/core/i18n","modules/clean/react/home/home_access/unread/constants"],function(e,t,n,i,r,o,a){"use strict";function s(e){switch(e){case a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE:return o._("<actor_span>%(actor_name)s</actor_span> shared %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.FOLDER_SHARE:return o._("<actor_span>%(actor_name)s</actor_span> invited you %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.MENTION:return o._("<actor_span>%(actor_name)s</actor_span> mentioned you %(ago)s");case a.UNREAD_NOTIFICATION_TYPES.COMMENT:return o._("<actor_span>%(actor_name)s</actor_span> commented %(ago)s");default:return o._("Unknown notification")}}Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadEntryDetail=function(e){var t=e.actorName,o=e.feedTime,a=e.notificationType,c=r.reactFormat(s(a),{actor_name:t,actor_span:n.createElement("span",{className:"home__unread-detail-actor"}),ago:i.ago(o,!1)});return n.createElement("div",{className:"home__unread-detail-header",children:c})},t.UnreadEntryDetail.displayName="UnreadEntryDetail"}),define("modules/clean/react/home/home_access/unread/home_access_unread",["require","exports","tslib","external/react","modules/constants/home","modules/clean/react/home/constants","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/show_hide_link","modules/clean/react/home/section_header","modules/clean/react/home/home_access/unread/card","modules/clean/react/home/util/rendering","modules/core/i18n","modules/clean/react/home/home_access/unread/store","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/home_access/onboarding/actions"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function t(t){var n=e.call(this,t)||this;return n.onStoreUpdate=function(){var e=p.getHomeUnreadStore(),t=e.getNotifications(),i=e.getLoadingState();if(i===o.LoadingStates.SUCCESS){if(s.homeTimingLogger.logTTData(o.LoggingSections.UNREAD)){var r=u.calculateItemsToShow(n.props.width,t.length,296,416,16,1),a=r.itemsPerRow,c=r.itemWidth,l=r.numRows,d=r.hasHiddenRows;h.homeActivityLogger.logUnreadShown(t.length,a,c,l,d)}}n.setState({loadingState:i,notifications:t})},n.toggleShowAll=function(){h.homeActivityLogger.logClickShowAll("unread",!n.state.showAll),n.setState({showAll:!n.state.showAll})},n.state={notifications:[],loadingState:o.LoadingStates.LOADING,showAll:!1},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=p.getHomeUnreadStore();this.removeStoreListener=e.addListener(this.onStoreUpdate),e.getLoadingState()===o.LoadingStates.SUCCESS&&this.onStoreUpdate()},t.prototype.componentDidMount=function(){this.triggerOnboarding()},t.prototype.componentWillUnmount=function(){this.removeStoreListener&&this.removeStoreListener()},t.prototype.componentDidUpdate=function(){this.triggerOnboarding()},t.prototype.triggerOnboarding=function(){setTimeout(_.showUnreadOnboardingTooltipIfNecessary)},t.prototype.shouldShowSection=function(){return this.state.loadingState===o.LoadingStates.SUCCESS&&this.state.notifications.length>0&&this.props.width},t.prototype.buttonText=function(e){return r.HOME_BETA_NEW_SHOW_HIDE_LINK?null:e?this.state.showAll?m._("Show less"):m._("Show all"):null},t.prototype.renderCards=function(e,t){if(!this.props.width)return null;var n=this.state.showAll?this.state.notifications:this.state.notifications.slice(0,e);return h.homeActivityLogger.logRenderedNotifications(n),n.map(function(n,r){var o=r%e===e-1;return i.createElement(d.UnreadNotificationCard,{notification:n,width:t,lastInRow:o,position:r,isFirstCard:0===r,key:n.key})})},t.prototype.renderShowHideLink=function(e,t){return r.HOME_BETA_NEW_SHOW_HIDE_LINK&&e?i.createElement(c.ShowHideLink,{onClick:this.toggleShowAll,isExpanded:this.state.showAll,hiddenItemCount:this.state.notifications.length-1*t,canLoadMore:!1}):null},t.prototype.render=function(){if(!this.shouldShowSection())return null;var e=u.calculateItemsToShow(this.props.width,this.state.notifications.length,296,416,16,1),t=e.hasHiddenRows,n=this.renderCards(e.itemsPerRow,e.itemWidth);return i.createElement("div",null,i.createElement(l.SectionHeader,{buttonAction:this.toggleShowAll,buttonText:this.buttonText(t),title:m._("Unread"),ueName:"unread"}),i.createElement("div",{className:"home-access-section__content home__unread-items"},n),this.renderShowHideLink(t,e.itemsPerRow))},t})(i.PureComponent);g.displayName="HomeAccessUnread",t.HomeAccessUnreadInner=g,t.HomeAccessUnread=a.timingComponent(g,o.LoggingSections.UNREAD)}),define("modules/clean/react/home/section_header",["require","exports","tslib","external/react","modules/clean/user_education/user_education_client"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderButton=function(){return this.props.buttonText&&this.props.buttonAction?i.createElement("div",{className:"home-section-header__button"},i.createElement("button",{className:"button-as-link",onClick:this.props.buttonAction},this.props.buttonText)):null},t.prototype.render=function(){return i.createElement("h2",{className:"home-access-section__header"},i.createElement("div",{className:"home-access-section__title"},i.createElement("div",{className:"home-access-section__title-text"},i.createElement(r.UserEducationEffect,{containerName:"home-section-header",name:this.props.ueName},this.props.title))),this.renderButton())},t})(i.PureComponent);o.displayName="SectionHeader",t.SectionHeader=o}),define("modules/clean/react/home/starred/starred_item",["require","exports","tslib","external/classnames","external/spectrum/overflow_button","external/spectrum/popover","external/react","modules/core/i18n","modules/core/uri","modules/clean/react/home/store","modules/clean/react/home/util/navigation","modules/clean/react/home/util/resource_icon","modules/clean/react/starred/actions","modules/clean/react/starred/star","modules/clean/react/starred/id_type_pair","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/constants","modules/clean/undo","modules/clean/user_education/user_education_client","modules/clean/sharing/async_share_modal_util","modules/clean/static_urls","modules/constants/home","modules/clean/react/home/resource/actions"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h,_,g,f,v,y,E,I,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=(T={},T[g.FILE_RESOURCE_TYPE]=!0,T[g.FOLDER_RESOURCE_TYPE]=!0,T[g.PAPER_DOCUMENT_RESOURCE_TYPE]=!0,T),A=(function(e){function t(t){var n=e.call(this,t)||this;return n.getLoggingInfo=function(){var e=g.DisplayTypeToResourceType[n.props.item.displayType],t="n/a";if(e===g.FILE_RESOURCE_TYPE){var i=n.props.item.title,r=i.lastIndexOf(".");t=r===-1?"":i.substr(r+1)}return{resourceId:n.props.item.resourceId,resourceType:e,resourceExt:t,position:n.props.position}},n.onClick=function(e){if(!n.state.isRenaming){e.stopPropagation();var t=g.DisplayTypeToResourceType[n.props.item.displayType];if(I.HOME_BETA_OPEN_IN_MODAL&&t===g.FILE_RESOURCE_TYPE)e.preventDefault(),S.openInFileViewer(h.idTypePairToString({type:n.props.item.idType,id:n.props.item.resourceId}),n.logOpen);else{var i=n.props.item.displayType===g.EXTERNAL_RESOURCE_TYPE;d.logAndNavigate(n.props.item.url,n.logOpen,e,!0,i)}}},n.onStarClick=function(e){if(!e){var t=n.getLoggingInfo(),i=t.resourceId,r=t.resourceType,o=t.resourceExt,a=t.position;_.homeActivityLogger.logUnstarItem(i,r,o,a);var c=n.props.item,d=s._("Removed from Starred."),u=function(e){var t=e.itemToStar,s=g.DisplayTypeToResourceType[n.props.item.displayType],c=s===g.EXTERNAL_RESOURCE_TYPE;m.StarredActions.update(l.HomeStore.getRole(),t.resourceId,t.idType,!0,c?t.title:void 0,c?t.details.favicon:void 0),_.homeActivityLogger.logUndoUnstarItem(i,r,o,a)};f.notifyWithUndo(d,{itemToStar:c},u,10)}},n.logEvent=function(e){var t=n.getLoggingInfo();return e(t.resourceId,t.resourceType,t.resourceExt,t.position)},n.logOpen=function(){return n.logEvent(_.homeActivityLogger.logOpenStarredItem)},n.logClickMenu=function(){return n.logEvent(_.homeActivityLogger.logClickStarOverflowMenu)},n.logClickUpload=function(){return n.logEvent(_.homeActivityLogger.logClickStarOverflowUpload)},n.logClickShare=function(){return n.logEvent(_.homeActivityLogger.logClickStarOverflowShare)},n.redirectToUpload=function(e){d.logAndNavigate(c.parse(n.props.item.url).updateQuery({upload:"1"}).toString(),n.logClickUpload)},n.handleShare=function(e){if(n.props.item.displayType===g.PAPER_DOCUMENT_RESOURCE_TYPE)return void d.logAndNavigate(n.props.item.url+"?openSharing=1",n.logClickShare,e);n.logClickShare();var t=g.DisplayTypeToResourceType[n.props.item.displayType]===g.FOLDER_RESOURCE_TYPE,i=t?n.props.item.details.targetNsId:null;y.asyncShowShareModal(n.props.user,{fqPath:n.props.item.details.fqPath,isFolder:t,targetNsId:i})},n.handleRenameInputChange=function(e){n.setState({newName:e.target.value})},n.handleRenameStart=function(e){n.setState({isRenaming:!0,newName:n.props.item.title})},n.handleRenameSubmit=function(e){e.preventDefault();var t=n.props.item,i=t.title,r=n.state.newName;void 0!==r&&null!==r&&(n.setState({isRenaming:!1,newName:""}),m.StarredActions.renameExternalResource(t.resourceId,i,r))},n.handleFaviconError=function(e){e.currentTarget.src=E.static_url("/static/images/home/generic-website-favicon-vfl8fV8SM.png")},n.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},n.handleSelection=function(e,t){e(t)},n.getTitle=function(){var e=n.props.item.title,t=s._("Untitled");return e.trim().length?e:t},n.getIcon=function(){if(g.DisplayTypeToResourceType[n.props.item.displayType]===g.EXTERNAL_RESOURCE_TYPE){var e=n.props.item.details.favicon;return(void 0===e||null===e||e.startsWith("http:"))&&(e=E.static_url("/static/images/home/generic-website-favicon-vfl8fV8SM.png")),a.createElement("img",{src:e,alt:s._("starred webpage favicon"),onError:n.handleFaviconError,className:"starred-item__external-favicon"})}return a.createElement(u.HomeResourceIcon,{className:"starred-item__file-icon",displayType:n.props.item.displayType,fileName:n.props.item.title,variant:"small"})},n.state={isRenaming:!1,newName:n.props.item.title},n}return n.__extends(t,e),t.prototype.renderDropdown=function(){var e=[],t=g.DisplayTypeToResourceType[this.props.item.displayType];t===g.FOLDER_RESOURCE_TYPE&&e.push(a.createElement(o.PopoverContentItem,{className:"starred-context-menu-item",key:"upload",value:this.redirectToUpload},s._("Upload"))),t in w&&e.push(a.createElement(o.PopoverContentItem,{className:"starred-context-menu-item",key:"share",value:this.handleShare},s._("Share"))),t===g.EXTERNAL_RESOURCE_TYPE&&e.push(a.createElement(o.PopoverContentItem,{className:"starred-context-menu-item",key:"rename",value:this.handleRenameStart},s._("Rename")));var c={"aria-label":s._("More actions"),onDoubleClick:function(e){e.stopPropagation()}},l=a.createElement(r.OverflowButton,n.__assign({tagName:"span",className:"starred-item__context-menu-button","aria-label":s._("More Actions")},c));return a.createElement("div",{onClick:this.stopEvent,className:i({"starred-item__context-menu-emtpy":!e.length})},a.createElement(o.Popover,{onSelection:this.handleSelection,onMenuToggle:this.logClickMenu},a.createElement(o.PopoverTrigger,{className:"starred-item__context-menu-trigger"},l),a.createElement(o.PopoverContent,{attachment:"right"},e)))},t.prototype.getStarredItemName=function(){return this.state.isRenaming?a.createElement("form",{className:"starred-item__rename-form",onSubmit:this.handleRenameSubmit},a.createElement("input",{className:"rename-input",type:"text",value:this.state.newName,onChange:this.handleRenameInputChange}),a.createElement("input",{type:"submit",value:"OK"})):a.createElement("a",{onClick:this.onClick,href:this.props.item.url,className:"starred-item__title"},this.getTitle())},t.prototype.render=function(){var e={"starred-item":!0,"starred-item--last-in-row":this.props.lastInRow,"starred-item--in-last-row":this.props.inLastRow};return a.createElement("li",{style:this.props.width?{width:this.props.width}:{},className:i(e),onClick:this.onClick},this.getIcon(),a.createElement("div",{className:"starred-item__content"
},a.createElement(v.UserEducationEffect,{containerName:"StarredItem",name:"starred-item-"+String(this.props.position)}),this.getStarredItemName(),a.createElement("div",{className:"starred-item__star"},a.createElement(p.Star,{role:l.HomeStore.getRole(),id:this.props.item.resourceId,idType:this.props.item.idType,itemName:this.props.item.title,onStarClick:this.onStarClick}))),this.renderDropdown())},t})(a.PureComponent);A.displayName="StarredItem",t.StarredItem=A;var T}),define("modules/clean/react/home/starred/starred_view",["require","exports","tslib","external/react","external/classnames","external/spectrum/tip_card","modules/constants/home","modules/clean/components/loading_indicator","modules/clean/react/home/section_header","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/util/show_hide_link","modules/clean/react/home/constants","modules/clean/react/home/starred/starred_item","modules/core/i18n","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/starred/starred_resource_store","modules/clean/react/home/starred/actions","modules/clean/react/home/util/rendering"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h,_,g,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=(function(e){function t(n){var i=e.call(this,n)||this;return i.onStoreUpdate=function(){var e=g.getStarredResourceStore(),t=e.getLoadingState(),n=e.getItems(),r=e.getHasMore(),o=e.getHideEmptySection();if(t===m.LoadingStates.SUCCESS){if(l.homeTimingLogger.logTTData(m.LoggingSections.STARRED)){var a=v.calculateItemsToShow(i.props.width,n.length,266,416,40,2),s=a.itemsPerRow,c=a.itemWidth,d=a.numRows,u=a.hasHiddenRows;_.homeActivityLogger.logStarredShown(n.length,s,c,d,u,r)}}i.setState({itemModels:n,loadingState:t,hasMore:r,hideEmptySection:o})},i.toggleShowAll=function(){var e=!i.state.showAll;_.homeActivityLogger.logClickShowAll("starred",!i.state.showAll),e&&i.state.hasMore&&f.StarredActions.loadAllItems(),i.setState({showAll:e})},i.hideSection=function(){f.StarredActions.hideSection()},i.state=t.getInitialState(),i.removeStoreListener=g.getStarredResourceStore().addListener(i.onStoreUpdate),i}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.props.hideSection&&f.StarredActions.hideSection(!0)},t.prototype.componentWillUnmount=function(){this.removeStoreListener&&this.removeStoreListener()},t.getInitialState=function(){return{showAll:!1,itemModels:[],loadingState:m.LoadingStates.LOADING,hasMore:!1,hideEmptySection:!1}},t.prototype.renderStarredGridItem=function(e,t,n,r,o){return i.createElement(p.StarredItem,{key:e.resourceId,item:e,width:t,lastInRow:n%r===r-1,inLastRow:o<=r+n-n%r,user:this.props.user,position:n})},t.prototype.renderEmptyState=function(){return i.createElement("div",{className:"starred--empty"},i.createElement(o.TipCard,{onDismiss:this.hideSection},h._("When you star items, they’ll show up here for easy access.")))},t.prototype.renderItems=function(e){return e.length?e:this.state.loadingState!==m.LoadingStates.LOADING?this.renderEmptyState():null},t.prototype.buttonText=function(e){return this.props.isListView&&a.HOME_BETA_NEW_SHOW_HIDE_LINK?null:e||this.state.hasMore&&this.state.loadingState===m.LoadingStates.SUCCESS?this.state.showAll?h._("Show less"):h._("Show all"):null},t.prototype.renderLoadingIndicator=function(){return this.state.loadingState!==m.LoadingStates.LOADING||this.state.itemModels.length&&!this.state.showAll?null:i.createElement("div",{className:"home-access__loading-indicator home--loading-indicator"},i.createElement(s,{style:s.LoadingIndicatorStyle.BLUE_SPINNER}))},t.prototype.getItemListToRender=function(){var e=this,t=this.state.itemModels;if(this.props.isListView){var n=t.length>4;n&&!this.state.showAll&&(t=t.slice(0,4));return{items:t.map(function(t,n){return i.createElement(p.StarredItem,{key:t.resourceId,item:t,user:e.props.user,position:n})}),hasHiddenRows:n}}return this.getItemListForGridView(t)},t.prototype.getItemListForGridView=function(e){var t=this,n=v.calculateItemsToShow(this.props.width,e.length,266,416,40,2),i=n.itemsPerRow,r=n.itemWidth,o=n.hasHiddenRows,a=e;return this.state.showAll||(a=a.slice(0,2*i)),{items:a.map(function(e,n){return t.renderStarredGridItem(e,r,n,i,a.length)}),hasHiddenRows:o}},t.prototype.renderShowHideLink=function(e){return a.HOME_BETA_NEW_SHOW_HIDE_LINK&&e&&this.props.isListView?i.createElement(u.ShowHideLink,{onClick:this.toggleShowAll,isExpanded:this.state.showAll,hiddenItemCount:this.state.itemModels.length-4,canLoadMore:!1}):null},t.prototype.render=function(){var e=this.getItemListToRender(),t=e.items,n=e.hasHiddenRows;if(this.state.loadingState===m.LoadingStates.SUCCESS&&!t.length&&this.state.hideEmptySection||!this.props.isListView&&!this.props.width)return null;var o=r({"starred-grid":!this.props.isListView,"starred-list":this.props.isListView});return i.createElement("div",{className:"starred"},i.createElement(c.SectionHeader,{title:h._("Starred",{comment:"Home's starred section"}),ueName:"starred",buttonAction:this.toggleShowAll,buttonText:this.buttonText(n)}),i.createElement("ul",{className:o},this.renderItems(t),this.renderLoadingIndicator()),this.renderShowHideLink(n))},t})(i.PureComponent);y.displayName="StarredView",t.StarredView=d.timingComponent(y,m.LoggingSections.STARRED)}),define("modules/clean/react/home/util/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HOME_V1_USER_EDUCATION_STEP_NAMES={START:"start",RECENTLY_VIEWED:"recently_viewed",FILES:"files"},t.DEFAULT_HOME_WIDTH=10}),define("modules/clean/react/home/util/doc_with_avatar_icon",["require","exports","external/react","modules/clean/react/home/util/resource_icon","modules/clean/react/home/util/avatar_icon","modules/clean/avatar/size"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocWithAvatarIcon=function(e){var t=e.avatarIconModel,a=e.displayType,s=e.fileName;return n.createElement("div",{className:"home__doc-with-avatar-icon"},n.createElement(i.HomeResourceIcon,{displayType:a,fileName:s,variant:"small"}),n.createElement(r.AvatarIcon,{avatarIcon:t,className:"home__doc-avatar-icon",size:o.AVATAR_DIMENSION_BY_SIZE.SMALL}))},t.DocWithAvatarIcon.displayName="DocWithAvatarIcon"}),define("modules/clean/react/home/util/logging/timing_component",["require","exports","tslib","external/react","modules/clean/react/home/util/logging/timing_logger"],function(e,t,n,i,r){"use strict";function o(e,t){return(function(o){function a(){return null!==o&&o.apply(this,arguments)||this}return n.__extends(a,o),a.prototype.componentDidMount=function(){r.homeTimingLogger.logTTI(t);var e=this.refs.wrapped,n=e.componentDidUpdate;e.componentDidUpdate=function(){r.homeTimingLogger.logTTI(t),n&&n.call(e)}},a.prototype.render=function(){return i.createElement(e,n.__assign({ref:"wrapped"},this.props))},a})(i.PureComponent)}Object.defineProperty(t,"__esModule",{value:!0}),t.timingComponent=o}),define("modules/clean/react/home/util/navigation",["require","exports","modules/core/browser"],function(e,t,n){"use strict";function i(e){return e.metaKey||e.ctrlKey}function r(e,t,r,o,a){void 0===o&&(o=!0),void 0===a&&(a=!1);var s=!1;r&&(r.preventDefault(),s=!(o||i(r))),s||(a?n.unsafe_open_tab(e):n.open_tab(e)),t().then(function(){s&&n.redirect(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.logAndNavigate=r}),define("modules/clean/react/home/util/rendering",["require","exports"],function(e,t){"use strict";function n(e,t,n,i,r,o){var a=[0,0,0,!1],s=a[0],c=a[1],l=a[2],d=a[3];if(e){var u=Math.floor((e+r)/(n+r));s=Math.max(1,Math.min(t,u)),c=(e-r*(s-1))/s,c=Math.max(n,Math.min(c,i)),l=Math.ceil(t/s),d=l>o}return{itemsPerRow:s,itemWidth:c,numRows:l,hasHiddenRows:d}}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateItemsToShow=n}),define("modules/clean/react/home/util/resource_icon",["require","exports","tslib","external/react","external/spectrum/icon_content","external/spectrum/file_icon","modules/clean/react/home/constants","modules/clean/react/sprite","modules/constants/home"],function(e,t,n,i,r,o,a,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderIcon=function(){if(a.DisplayTypeToResourceType[this.props.displayType]===a.FILE_RESOURCE_TYPE)return i.createElement(o.FileIcon,{path:this.props.fileName,variant:this.props.variant});var e=a.DisplayTypeToIconName[this.props.displayType]||"unknown";return i.createElement(r.IconContent,{name:e+"-"+this.props.variant})},t.prototype.render=function(){return c.HOME_BETA_NEW_ICONS?i.createElement("span",{className:this.props.className},this.renderIcon()):i.createElement(s,{className:this.props.className,group:"web",name:a.DisplayTypeToSpriteName[this.props.displayType],alt:""})},t})(i.PureComponent);l.displayName="HomeResourceIcon",t.HomeResourceIcon=l}),define("modules/clean/react/home/util/show_hide_link",["require","exports","tslib","external/classnames","external/react","external/spectrum/icon_arrow","modules/core/i18n"],function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getLinkText=function(){return this.props.isExpanded?a._("Collapse section"):this.props.hiddenItemCount<=0?a._("Show more"):this.props.canLoadMore?a._("Show %(number)s+ more").format({number:this.props.hiddenItemCount}):a._("Show %(number)s more").format({number:this.props.hiddenItemCount})},t.prototype.getLinkClass=function(){return i({"button-as-link":!0,"show-hide-link":!0,"show-hide-link--expanded":this.props.isExpanded})},t.prototype.render=function(){return r.createElement("div",{className:"show-hide-link__container"},r.createElement("button",{onClick:this.props.onClick,className:this.getLinkClass()},r.createElement("div",{className:"show-hide-link__arrow"},r.createElement(o.IconArrow,{name:"right"})),this.getLinkText()))},t})(r.PureComponent);s.displayName="ShowHideLink",t.ShowHideLink=s}),define("modules/clean/react/home/util/static_tooltip",["require","exports","external/react","external/react-dom","modules/clean/react/bubble_dropdown_v2","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){var e=this;this.isTooltipTriggered=!1,this.onTooltipTriggerRendered=function(t){e.isTooltipTriggered||(e.isTooltipTriggered=!0,e.triggerButton=t,e.simulateTriggerButtonClick())},this.simulateTriggerButtonClick=function(){e.triggerButton.click()},this.show=function(t,s,c,l,d,u,m){void 0===m&&(m="");var p=n.createElement("button",{className:"home-tooltip__trigger-button",ref:e.onTooltipTriggerRendered,"aria-label":"close"}),h=n.createElement(r,{className:"home-tooltip",position:l,targetButton:p,onShowDropdown:d||function(){},onHideDropdown:u||function(){}},n.createElement("h4",{className:"home-tooltip__title"},t),s,n.createElement("button",{className:"home-tooltip__close-button",onClick:e.simulateTriggerButtonClick,"aria-label":a._("Close tooltip")},n.createElement(o,{group:"web",name:"lightbox_close",alt:a._("Close")}))),_=e.createMountingElement(m);c.appendChild(_),i.render(h,_)},this.hide=function(){e.simulateTriggerButtonClick()}}return e.prototype.createMountingElement=function(e){var t=document.createElement("DIV");return e&&(t.className=e),t.addEventListener("click",function(e){e.preventDefault()}),t},e})();s.POSITIONS=r.POSITIONS,t.StaticTooltip=s}),define("modules/clean/recent_activity/actions/federated_recent_activity_actions",["require","exports","modules/core/i18n","modules/core/browser","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_federated_model","modules/clean/recent_activity/stores/recent_activity_store","modules/core/exception","modules/core/notify","modules/clean/react/home/home_access/recents/utils/events","modules/clean/recent_activity/recent_activity_logger"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p){"use strict";function h(e,t,n){e?i.open_tab(e):d.reportStack("Cannot open tab to preform the action "+t,{severity:d.SEVERITY.NONCRITICAL,exc_extra:{paperRecentItem:n.paperRecentItem}})}function _(e,t,n){m.logEvent(e,n.cellView,[t.getFqPath()],1,1)}function g(e,t){_(p.ActionTypes.PAPER_SHARE,e,t),h(c.getPaperShareUrl(e),p.ActionTypes.PAPER_SHARE,e)}function f(e,t){_(p.ActionTypes.PAPER_OPEN,e,t),h(e.getUrl(),p.ActionTypes.PAPER_OPEN,e)}function v(e,t){a.recentActivityDispatcher.dispatch({type:e,activityKey:t})}function y(e,t,i){var a=e.getActivityKey();if(l.getRecentActivityStore().canArchiveActivityKey(a)){var d=e.getActivityKey();r.SimpleModal.show({title_text:n._("Archive document?"),body_html:n._("Do you want to archive this document?"),confirm_text:n._("Archive"),cancel_text:n._("Cancel"),autoclose:!0,confirm_callback:function(){_(p.ActionTypes.PAPER_ARCHIVE,e,i),v(o.ARCHIVE_PAPER_DOCUMENT_PENDING,d),s.archivePaperResources(t,[e.paperRecentItem]).then(function(t){t.some(function(t){return c.equalsPaperRecentItem(e,t)})?(v(o.ARCHIVE_PAPER_DOCUMENT_COMMIT,d),u.success(n._("The document was archived."))):v(o.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,d)},function(){return v(o.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,d)})}})}}Object.defineProperty(t,"__esModule",{value:!0}),t.shareItem=g,t.previewItem=f,t.promptAndArchiveItem=y}),define("modules/clean/recent_activity/actions/recent_activity_action_permissions",["require","exports","modules/clean/recent_activity/models/utils"],function(e,t,n){"use strict";function i(e,t){return n.isShareLinkRecentItem(e)?r(!!t.canOpen):{open:!!t.canOpen,delete:!t.isReadOnly,download:!0,comment:!t.isDir,versions:!t.isDir,archive:!1,share:!1}}function r(e){return{archive:!1,comment:!1,delete:!1,download:!1,open:e,share:!1,versions:!1}}function o(e,t){if(e.federatedRecentItem)return{archive:e.federatedRecentItem.isArchiveable(),comment:!1,delete:!1,download:!1,open:!1,share:e.federatedRecentItem.isShareable(),versions:!1};var i=t[0],o=1===t.length;if(n.isShareLinkRecentItem(e))return r(!(!o||!i.canOpen));var s=a(t),c=o&&!i.isDir;return{archive:!1,comment:c,delete:s.allItemsAreNotReadOnly,download:o,open:!(!o||!i.canOpen),share:!(!o&&!s.allItemsAreInRootCollection),versions:c}}function a(e){for(var t=!0,n=!0,i=0,r=e;i<r.length;i++){var o=r[i];if(o.inRootCollection||(t=!1),o.isReadOnly&&(n=!1),!t||!n)break}return{allItemsAreInRootCollection:t,allItemsAreNotReadOnly:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.getDocAttachmentViewPermissions=i,t.getRecentActivityItemViewPermissions=o}),define("modules/clean/recent_activity/actions/recent_activity_actions",["require","exports","external/underscore","modules/clean/downloads","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/sharing/async_share_modal_util","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/web_timing_logger","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/store_utils"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h,_,g,f,v,y,E){"use strict";function I(t){v.waitForTTI().then(function(){return e(["modules/clean/fileops"],function(e){return t(e)})})}function S(e,t,n,i){e.homeLogEventFunction(t,e.cellView,n,e.totalCount,i)}function w(e){return n.compact(n.pluck(e,"fqPath"))}function A(e){var t=u.getRecentActivityStore().getFileSyncCursor();return t&&l.loadRecentItems(e,t),!!t}function T(e,t,n){l.ensureAttachments(e,[t],function(t){var i=t[0],r=i.fqPath||"",o=p.get_viewer().get_user_by_id(e);if(m.asyncShowShareModal(o,{fqPath:r,isFolder:i.previewInfo.is_dir,origin:"RECENTS"}),n){var a=w(t);c.logShareFile(e,r,n.totalCount,n.cellView),S(n,s.ActionTypes.SHARE,a,a.indexOf(r))}})}function C(e){h.redirect(e)}function N(t,i,r,o){void 0===o&&(o=n.noop),e(["modules/clean/unity/features"],function(e){_.assert(!!e,"Unity is not supported by this browser"),l.ensureAttachments(t,[i],function(i){var a=i[0],l=a.nsId,d=a.nsPath,u=i[0].fqPath||"";if(e.open_file(l,d,t,n.noop,function(e){f.error("We were unable to open this file"),_.reportException({err:Error(e),tags:["recents"],severity:_.SEVERITY.NONCRITICAL})}),r){var m=w(i);c.logUnityOpenFile(t,u,r.totalCount,r.cellView),S(r,s.ActionTypes.OPEN,m,m.indexOf(u))}o()})})}function b(e,t,i){var u,m,p=function(){return l.ensureAttachments(e,t,function(r){var l=w(r);if(i){var d=i.totalCount,u=i.cellView;c.logDeleteFiles(e,l,d,u),S(i,s.ActionTypes.DELETE,l,void 0)}var m=n.uniqueId("DELETE_FILES");a.recentActivityDispatcher.dispatch({type:o.DELETE_FILES_PENDING,attachmentIds:t,transactionId:m});var p=function(){return a.recentActivityDispatcher.dispatch({type:o.DELETE_FILES_COMMIT,transactionId:m})},h=function(){return a.recentActivityDispatcher.dispatch({type:o.DELETE_FILES_ROLLBACK,transactionId:m})};I(function(t){return t.do_nonbrowse_delete(e,l).then(p,h)})})};if(1===t.length){m=g._("Delete file?");var h=d.attachmentStore.getById(t[0]);u=h&&h.isLoaded?g._("Do you want to delete <b>%(file_name)s</b>?").format({file_name:n.escape(h.displayName||"")}):g._("Do you want to delete this file?")}else m=g._("Delete files?"),u=g._("Do you want to delete <b>%(num)s files</b>?").format({num:n.escape(String(t.length))});r.SimpleModal.show({title_text:m,body_html:u,confirm_text:g._("Delete"),confirm_callback:p,cancel_text:g._("Cancel"),autoclose:!0})}function R(e,t){a.recentActivityDispatcher.dispatch({type:o.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:e,userId:t})}function L(e,t,n){l.ensureAttachments(e,t,function(t){if(n){var r=w(t);c.logDownloadFile(e,r,n.totalCount,n.cellView),S(n,s.ActionTypes.DOWNLOAD,r)}for(var o=0,a=t;o<a.length;o++){var l=a[o];if(l.isDir&&l.fqPath&&null!=l.previewInfo&&null!=l.previewInfo.block_hash)i.get_zip({fq_paths:[l.fqPath],subject_uid:e,block_hash:l.previewInfo.block_hash,parent_path:l.fqPath});else{var d=null!=l.previewInfo?l.previewInfo.direct_blockserver_link:void 0;d&&i.get_blockserver_link({url:d})}}})}function O(e,t,n){l.ensureAttachments(e,[t],function(t){var i=t[0].fqPath||"";I(function(r){var o=r.build_revisions_uri(i,e);if(n){var a=w(t);c.logOpenVersions(e,i,n.totalCount,n.cellView),S(n,s.ActionTypes.VERSIONS,a,a.indexOf(i))}h.redirect(o.toString())})})}function x(e){u.getRecentActivityStore().didReceiveItemsFromAllStreams()&&(a.recentActivityDispatcher.dispatch({type:o.REFRESH_RECENT_ACTIVITIES}),l.loadRecentItems(e),l.loadPaperRecentItems(e,!1))}Object.defineProperty(t,"__esModule",{value:!0}),t.getFqPaths=w,t.loadNextPage=A,t.loadAttachmentsForRecentActivities=y.loadAttachmentsForRecentActivities,t.shareFile=T,t.browseFile=C,t.openFile=N,t.promptAndDeleteAttachments=b,t.loadAttachments=E.loadAttachments,t.updateRecentActivities=E.updateRecentActivities,t.updateRelatedActivities=R,t.downloadFiles=L,t.openVersions=O,t.refreshRecentItems=x}),define("modules/clean/recent_activity/react/attachment_file_icon_view",["require","exports","tslib","external/classnames","external/react","external/underscore","modules/constants/home","modules/clean/em_string","modules/clean/react/home/util/resource_icon","modules/clean/react/sprite"],function(e,t,n,i,r,o,a,s,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),t.props.handleClick(t.props.id)},t.onContextMenu=function(e){e.preventDefault(),t.props.handleContextMenu(t.props.id)},t}return n.__extends(t,e),t.prototype.renderFilename=function(){var e=this.props.file.displayName.split("."),t="."+e.pop(),n=s.em_snippet(e.join("."),10);return r.createElement("span",{className:"attachment-item__filename"},n,r.createElement("wbr",null),r.createElement("span",{className:"nowrap"},t))},t.prototype.renderIcon=function(){return a.HOME_BETA_NEW_ICONS?r.createElement(c.HomeResourceIcon,{className:"attachment-item__icon",displayType:this.props.file.displayType,fileName:this.props.file.displayName,variant:"small"}):r.createElement(l,{alt:"",group:"web",name:this.props.file.icon,className:"attachment-item__icon"})},t.prototype.render=function(){var e,t=this.renderIcon(),n=this.renderFilename(),o=this.props,a=o.overlayText,s=o.file;return a&&(e=r.createElement("span",{className:"attachment-item__overlay"},a)),r.createElement("div",{className:i({"attachment-item":!0,"attachment-item--file-thumb":!0,"attachment-item--show-more":!!a})},r.createElement("a",{href:s.entityUri,title:s.displayName,className:"attachment-item__anchor",onClick:this.onClick,onContextMenu:this.onContextMenu},t,n,e))},t})(r.Component);d.defaultProps={handleClick:o.noop,handleContextMenu:o.noop},t.AttachmentFileIconView=d}),define("modules/clean/recent_activity/react/attachment_grid",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t){this._gridWidth=e,this._gutterWidth=t}return e.create=function(t,n){return new e(t,n)},e.prototype.generate=function(e,t){void 0===t&&(t=1/0);for(var n=[],i=0;n.length<t&&i<e.length;){var r=this.buildRow(e.slice(i));i+=r.length,n.push(r)}return n},e.prototype.buildRow=function(e){for(var t=[],n=this._gridWidth+this._gutterWidth,i=0,r=e;i<r.length;i++){var o=r[i];if(n=n-o.width-this._gutterWidth,!(n>=0||0===t.length))break;t.push(o)}return t},e})();t.AttachmentGrid=n}),define("modules/clean/recent_activity/react/attachment_image_expanded_view",["require","exports","tslib","external/react","modules/clean/accessibility/utils","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCornerClick=function(e){e.preventDefault();var n=t.props.handleCornerClick;n&&n(t.props.id)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.image;return i.createElement("div",{className:"attachment-item attachment-item--expanded",style:{width:e.width,height:e.height}},i.createElement("div",{className:"attachment-item--expanded__image"},i.createElement(o.AttachmentImageView,n.__assign({},this.props))),i.createElement("a",n.__assign({},r.accessibleTriggerProps(this.handleCornerClick),{className:"attachment-item--expanded__corner"}),"-"))},t})(i.Component);t.AttachmentImageExpandedView=a}),define("modules/clean/recent_activity/react/attachment_image_stack_view",["require","exports","tslib","external/react","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCornerClick=function(e){e.preventDefault();var n=t.props.handleCornerClick;n&&n(t.props.id)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.image,t=e.width,o=e.height,a=t-4,s=o-4,c=n.__assign({},e,{width:a,height:s});return i.createElement("div",{className:"attachment-item attachment-item--stacked",style:{width:t,height:o}},i.createElement("div",{className:"attachment-item--stacked__front"},i.createElement(r.AttachmentImageView,n.__assign({},this.props,{image:c}))),i.createElement("div",{className:"attachment-item--stacked__back"},i.createElement(r.AttachmentImageView,{image:c})),i.createElement("a",{className:"attachment-item--stacked__corner",onClick:this.handleCornerClick},"+%(count)s".format({count:this.props.stackLength-1})))},t})(i.Component);t.AttachmentImageStackView=o}),define("modules/clean/recent_activity/react/attachment_image_view",["require","exports","tslib","external/classnames","external/react"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isLoading:!0},t.onClick=function(e){e.preventDefault(),t.props.handleClick(t.props.id)},t.onContextMenu=function(e){e.preventDefault(),t.props.handleContextMenu(t.props.id)},t.onLoad=function(){t.setState({isLoading:!1})},t.onError=function(){t.props.handleLoadError(t.props.id),t.setState({isLoading:!1})},t}return n.__extends(t,e),t.prototype.render=function(){var e,t=this.props,n=t.overlayText,o=t.badgeType,a=t.image;return n&&(e=r.createElement("span",{className:"attachment-item__overlay"},n)),r.createElement("div",{className:i((s={"attachment-item":!0,"attachment-item--show-more":!!n,"attachment-item--is-loading":this.state.isLoading},s["attachment-item--badge-"+o]=!!o,s))},r.createElement("a",{href:a.entityUri,onClick:this.onClick,onContextMenu:this.onContextMenu,title:a.displayName,className:"attachment-item__anchor",style:{width:a.width,height:a.height},tabIndex:0},r.createElement("img",{alt:a.displayName,className:"attachment-item__thumbnail",src:a.thumbnailUrl,onLoad:this.onLoad,onError:this.onError}),e));var s},t})(r.PureComponent);o.defaultProps={handleClick:function(){},handleContextMenu:function(){},handleLoadError:function(){}},t.AttachmentImageView=o}),define("modules/clean/recent_activity/react/attachment_list_layout",["require","exports","external/underscore","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_grid","modules/clean/recent_activity/react/attachment_image_view","modules/core/browser","modules/core/exception"],function(e,t,n,i,r,o,a,s,c){"use strict";function l(e,t){var n,r,o,a=s.is_high_density_display();switch(t){case"aggregated-scaled":o=a?200:100,n=a?200:100,r=d;break;case"aggregated-cropped":o=a?200:100,n=a?200:100,r=u;break;case"aggregated-wide-cropped":o=a?718:359,n=a?200:100,r=u;break;default:return c.assert(!1,"invalid ThumbnailVariant: "+t),""}return i.thumbnailUrlForSize(e,o,n,r)}Object.defineProperty(t,"__esModule",{value:!0});var d=i.ThumbnailSizeMode.FIT_ONE,u=i.ThumbnailSizeMode.EXACT_NO_BACKGROUND,m=(function(){function e(e,t,n){this._gridWidth=e,this._columnWidth=t,this._gutterWidth=n,this._grid=o.AttachmentGrid.create(e,n)}return e.create=function(t,n,i){return new e(t,n,i)},e.prototype.generate=function(e,t,n){var i=this.cellMetadata(e,n);return this._grid.generate(i,t)},e.prototype.cellMetadata=function(e,t){var i=this,r=n.object(t,t);return e.map(function(e){return r[e.id]||e.isLoaded&&!e.thumbnailUrl?i.buildFileIconViewMetadata(e):e.isLoaded?i.buildImageViewMetadata(e):i.buildLoadingImageViewMetadata(e)})},e.prototype.buildFileIconViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:r.AttachmentFileIconView,width:92,height:100,attachment:e}},e.prototype.buildLoadingImageViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:null,width:100,height:100,attachment:e}},e.prototype.buildImageViewMetadata=function(e){var t=e.thumbnailUrl,n=this.calculateThumbnailDimensions(e.thumbnailDimensions),i=n.width,r=n.height,o=n.variant;return t.startsWith("data:")||(t=l(t,o)),{id:e.id,view:a.AttachmentImageView,scaledThumbnailUrl:t,width:i+6,height:r+6,attachment:e}},e.prototype.calculateThumbnailDimensions=function(e){var t,n,i;if(e){i="aggregated-scaled";var r=e.width/e.height;t=100,n=Math.floor(r*t),n>this._columnWidth-6&&(i="aggregated-wide-cropped",n=this._columnWidth-6)}return(!e||n<75)&&(i="aggregated-cropped",n=100,t=100),{width:n,height:t,variant:i}},e})();t.AttachmentListLayout=m}),define("modules/clean/recent_activity/react/attachment_list_view",["require","exports","tslib","external/react","external/underscore","jquery","modules/clean/components/loading_indicator","modules/clean/react/home/constants","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_image_expanded_view","modules/clean/recent_activity/react/attachment_image_stack_view","modules/clean/web_timing_logger","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_list_layout","modules/clean/recent_activity/recent_activity_constants","modules/core/exception","modules/core/i18n"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h,_,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setAttachmentListRef=function(e){return t.attachmentsList=e},t.state={rows:1,errored:[],containerWidth:null,expandedAttachments:{}},t.previewAttachment=function(e){var n=t.props.attachments,i={totalCount:n.length,cellView:t};t.props.renderingInfo.version.previewAttachment(e,n,i)},t.expandStack=function(e){for(var i=t.dedupeMetadata(),o=r.find(i,function(t){return t.attachment.id===e}),a=n.__assign({},t.state.expandedAttachments),s=t.props.attachments.indexOf(o.attachment),c=o.stackLength,l=s;l<s+c;l++)a[t.props.attachments[l].id]=e;t.setState({expandedAttachments:a})},t.collapseStack=function(e){for(var i=t.state.expandedAttachments[e],o=t.dedupeMetadata(),a=r.find(o,function(e){return e.attachment.id===i}),s=n.__assign({},t.state.expandedAttachments),c=t.props.attachments.indexOf(a.attachment),l=a.stackLength,d=c;d<c+l;d++)delete s[t.props.attachments[d].id];t.setState({expandedAttachments:s})},t.handleImageLoadError=function(e){var n=t.state.errored.slice();n.push(e),t.setState({errored:n})},t.revealNextGroup=function(){t.setState({rows:t.state.rows+_.SHOW_MORE_THUMBNAIL_ROW_INCREMENT})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.updateLayoutController(),this.loadRemainingAttachments()},t.prototype.componentDidUpdate=function(e){this.updateLayoutController(),this.loadRemainingAttachments()},t.prototype.updateLayoutController=function(){var e=o(this.attachmentsList),t=e.innerWidth();if(t!==this.state.containerWidth){var n=Math.abs(parseFloat(e.css("margin-left")))||0,i=Math.floor(t/2)-n;this.layoutController=h.AttachmentListLayout.create(t,i,n),this.setState({containerWidth:t})}},t.prototype.loadRemainingAttachments=function(){var e=this.props.attachments[0].viewingUserId,t=this.props.attachments.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});t.length&&m.waitForTTI().then(function(){return c.loadAttachments(e,t)})},t.prototype.renderFileIconView=function(e,t,n){var r=e.attachment;return i.createElement(l.AttachmentFileIconView,{key:"attachment-"+e.id,id:e.id,file:{icon:r.previewInfo.icon,displayName:r.displayName||"",displayType:r.displayType||s.DisplayTypes.FILE,entityUri:r.entityUri||""},overlayText:t,handleClick:n})},t.prototype.renderStackedImageView=function(e,t,r){var o=this.propsForImageView(e,r);return i.createElement(u.AttachmentImageStackView,n.__assign({},o,{key:"attachment-stacked-"+e.id,handleClick:this.expandStack,handleCornerClick:this.expandStack,stackLength:t}))},t.prototype.renderExpandedImageView=function(e,t,r){var o=this.propsForImageView(e,r);return i.createElement(d.AttachmentImageExpandedView,n.__assign({},o,{handleCornerClick:this.collapseStack}))},t.prototype.renderImageView=function(e,t,r){var o=this.propsForImageView(e,r);return i.createElement(p.AttachmentImageView,n.__assign({},o,{key:"attachment-expanded-"+e.id,overlayText:t}))},t.prototype.propsForImageView=function(e,t){
var n=e.attachment,i=n.previewInfo,r="video"===(i&&i.preview_type);return{id:e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,entityUri:n.entityUri||"",displayName:n.displayName||"",width:e.width,height:e.height},badgeType:r?"video":void 0,handleClick:t,handleLoadError:this.handleImageLoadError}},t.prototype.dedupeMetadata=function(){var e,t=[],n={},i={},r={};if(this.props.duplicateIds)for(var o=0;o<this.props.attachments.length;o++){e=this.props.attachments[o];var a=this.props.duplicateIds[o];n.hasOwnProperty(a)||(n[a]=[],r[e.id]=e),n[a].push(e),i[e.id]=n[a]}for(var s=0,c=this.props.attachments;s<c.length;s++){e=c[s];var l=this.state.expandedAttachments.hasOwnProperty(e.id),d=i[e.id],u=d&&d.length,m=r.hasOwnProperty(e.id),p=u>1&&m;u>1&&!m&&!l||t.push({attachment:e,stackLength:u,isParentOfStack:m,isStacked:p,isExpanded:l})}return t},t.prototype.isLoading=function(){return this.state.rows>1&&this.props.attachments.some(function(e){return!e.isLoaded})},t.prototype.renderAttachmentItems=function(){if(!this.state.containerWidth)return[];for(var e=this.dedupeMetadata(),t=r.pluck(e,"attachment"),n=this.isLoading()?1:this.state.rows,o=this.layoutController.generate(t,n,this.state.errored),a=r.flatten(o),s=this.previewAttachment,c=a.length,d=t.length,u=d-c+1,m=!this.isLoading()&&c<d,h=[],_=0;_<a.length;_++){var v=void 0,y=void 0,E=a[_],I=_===a.length-1,S=e[_],w=S.isStacked,A=S.isParentOfStack,T=S.isExpanded,C=S.stackLength;I&&m&&(s=this.revealNextGroup,y=f._("+%(count)s").format({count:u}));var N="attachment-item-"+E.attachment.id;switch(E.view){case l.AttachmentFileIconView:v=this.renderFileIconView(E,y,s);break;case p.AttachmentImageView:var b=m&&I;C>1&&!b?A&&T?v=this.renderImageView(E,y,s):w&&!T?v=this.renderStackedImageView(E,C,s):T&&(v=this.renderExpandedImageView(E,y,s)):v=this.renderImageView(E,y,s);break;default:E.view&&g.assert(!1,E.view.name+" is not supported by AttachmentListView")}h.push(i.createElement("li",{key:N},v))}return h},t.prototype.renderLoadingView=function(){return i.createElement("div",{className:"attachment-loading"},i.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.render=function(){var e=null;return this.isLoading()&&(e=this.renderLoadingView()),i.createElement("div",{className:"recents-item__attachments"},i.createElement("ul",{ref:this.setAttachmentListRef,className:"attachment-list"},this.renderAttachmentItems()),e)},t})(i.Component);t.AttachmentListView=v}),define("modules/clean/recent_activity/react/pending_attachment_list_view",["require","exports","tslib","external/classnames","external/react","external/underscore"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.count,t=o.times(Math.min(e,4),function(){return r.createElement("li",{className:"attachment-item attachment-item--placeholder"})}),n={"attachment-list":!0,"attachment-list--is-pending":!0,"attachment-list--standalone":1===e};return r.createElement("div",{className:"recents-item__attachments"},r.createElement("ul",{className:i(n)},t))},t})(r.Component);t.PendingAttachmentListView=a}),define("modules/clean/recent_activity/react/recent_activity_container",["require","exports","tslib","jquery","external/underscore","external/react","modules/constants/home","modules/clean/web_timing_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/recent_activity/versions/recent_activity_version_2","modules/clean/recent_activity/react/recent_activity_view","modules/clean/react/home/store","modules/clean/react/home/home_access/recents/utils/events","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/constants"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h,_,g,f){"use strict";function v(e){var t=0,n=function(){var n=i(window).scrollTop()/(document.documentElement.scrollHeight-window.innerHeight);n>.8&&n>t&&e(),t=n};window.addEventListener("scroll",r.throttle(n,150,{trailing:!1}),!1)}Object.defineProperty(t,"__esModule",{value:!0});var y=(function(t){function i(e){var n=t.call(this,e)||this;return n.onShouldLoadMore=function(){var e=l.getRecentActivityStore();if(!n.state.isPending&&n.state.showAll&&!e.didTruncateRecentItems()&&e.didReceiveItemsFromAllStreams()){var t=e.getRecentItems();t.length>n.state.items.length?n.setState({items:t}):c.loadNextPage(n.props.user.id)&&n.setState({isPending:!0})}},n.handleVisibilityChange=function(){"visible"===document.visibilityState&&c.refreshRecentItems(n.props.user.id)},n.onUpdateFromStore=function(){var e=l.getRecentActivityStore(),t=!e.didReceiveItemsFromAllStreams(),i=e.getRecentItems();if(!t){if(_.homeTimingLogger.logTTData(f.LoggingSections.RECENTS)&&i.length){var r=p.countRecentsItem(i);g.homeActivityLogger.logRecentsShown(r.numMetaserverItems,r.numPaperItems,!m.HomeStore.getSectionVisibility()[f.HomeSections.RECENTS])}}n.setState({isPending:t,items:i})},n.onShowAll=function(){n.setState({showAll:!0})},n.removeStoreListeners=r.noop,n.state={items:[],isPending:!1,isUnityAvailable:!1,showAll:!a.HOME_BETA_NEW_SHOW_HIDE_LINK},n}return n.__extends(i,t),i.prototype.componentWillMount=function(){var e=this.props.shouldThrottleRecents?r.throttle(this.onUpdateFromStore,1e3):this.onUpdateFromStore;this.removeStoreListeners=l.getRecentActivityStore().addListener(e),this.onUpdateFromStore()},i.prototype.componentDidMount=function(){var t=this;s.waitForTTI().then(function(){v(r.throttle(t.onShouldLoadMore,2e3,{trailing:!1})),e(["modules/clean/sharing/share_modal_util","modules/clean/sharing/wizard/wizard_modals","modules/clean/unity/features"],function(e,n,i){null!=i&&t.setState({isUnityAvailable:!0})})}),!this.state.items.length&&l.getRecentActivityStore().didReceiveItemsFromAllStreams()&&this.setState({isPending:!1}),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1)},i.prototype.componentWillUnmount=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.removeStoreListeners()},i.prototype.render=function(){return o.createElement(u.RecentActivityView,{items:this.state.items,isPending:this.state.isPending,showAll:this.state.showAll,userId:this.props.user.id,onShowAll:this.onShowAll,renderingInfo:{isUnityAvailable:this.state.isUnityAvailable,version:d.RecentActivityVersion2,role:this.props.user.role}})},i})(o.PureComponent);y.displayName="RecentActivityContainer",t.RecentActivityContainerInner=y,t.RecentActivityContainer=h.timingComponent(y,f.LoggingSections.RECENTS)}),define("modules/clean/recent_activity/react/recent_activity_item_actions_view",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/models/utils"],function(e,t,n,i,r,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onOpen=function(e){e.preventDefault(),t.getHandler().handleOpen()},t.onDelete=function(e){e.preventDefault(),t.getHandler().handleDelete()},t.onArchive=function(e){e.preventDefault(),t.getHandler().handleArchive()},t.onDownload=function(e){e.preventDefault(),t.getHandler().handleDownload()},t.onComment=function(e){e.preventDefault(),t.getHandler().handleComment()},t.onVersions=function(e){e.preventDefault(),t.props.permissions.versions&&t.getHandler().handleVersions()},t}return n.__extends(t,e),t.prototype.getHandler=function(){return this.props.handler},t.prototype.canOpen=function(){return this.props.permissions.open&&this.props.renderingInfo.isUnityAvailable},t.prototype.getDeleteLabel=function(){return this.props.attachmentCount>1?o._("Delete all…"):o._("Delete…")},t.prototype.render=function(){if(this.props.renderingInfo.version.shouldRenderItemActions(this.props.permissions)){var e=i((t={},t["recents-item__more-actions"]=!0,t["recents-item__more-actions--disabled"]=this.props.disableActions,t));return s.isShareLinkEventType(this.props.type)?r.createElement("div",{className:e}):r.createElement("div",{className:e},this.props.renderingInfo.version.renderItemActionsPlaceholder(),r.createElement("div",{className:"recents-item__more-actions-button recents-item__action-button",tabIndex:-1},this.props.renderingInfo.version.renderMoreActionsElement(this)))}return null;var t},t})(r.PureComponent);c.defaultProps={handler:a.getStubRecentActivityItemContainerHandler(),tooltipHandler:a.getStubRecentActivityTooltipHandler(),attachmentCount:1,disableActions:!1},t.RecentActivityItemActionsView=c}),define("modules/clean/recent_activity/react/recent_activity_item_container",["require","exports","tslib","external/underscore","external/react","modules/core/exception","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_item_view","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/stores/attachment_store"],function(e,t,n,i,r,o,a,s,c,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAttachmentStoreChange=function(){n.setState({attachments:u.attachmentStore.getByIds(n.getRecentItem().attachmentIds)})},n.handleArchive=function(){n.getVersion().archiveRecentItem(n.getRecentItem(),n.getLogData())},n.handleComment=function(){var e=n.getSingleAttachment("handleComment only supports a single attachment"),t=Math.max(0,n.state.attachments.indexOf(e));n.previewOrOpenFiles({index:t,shouldFocusCommentInput:!0})},n.handleDelete=function(){n.getVersion().deleteRecentItem(n.getRecentItem(),n.state.attachments,n.getLogData())},n.handleDownload=function(){var e=n.getSingleAttachment("handleDownload only supports a single attachment");s.downloadFiles(n.getViewingUserId(),[e.id],n.getLoggingInfo())},n.handleHeaderClick=function(){if(n.getRecentItem().uniqueFilterTypes.length>1){var e=n.state.isCollapsed?a.ActionTypes.UNCOLLAPSE:a.ActionTypes.COLLAPSE;n.getVersion().logEvent(e,n,n.getAttachmentFqPaths(),n.state.attachments.length)}n.setState({isCollapsed:!n.state.isCollapsed})},n.handleOpen=function(){var e=n.getSingleAttachment("handleOpen only supports a single attachment");s.openFile(n.getViewingUserId(),e.id,n.getLoggingInfo())},n.handlePathClick=function(e){var t=n.getAttachmentFqPaths();l.logOpenPathUrl(n.getViewingUserId(),t,n.props.recentItem.attachmentIds.length,n),n.getVersion().handlePathClick(e,n.getRecentItem(),n.getLogData())},n.handlePreview=function(){n.previewOrOpenFiles({shouldFocusCommentInput:!1})},n.handleShare=function(){n.getVersion().shareRecentItem(n.getRecentItem(),n.state.attachments,n.getLogData())},n.handleVersions=function(){var e=n.getSingleAttachment("handleVersions only supports a single attachment");s.openVersions(n.getViewingUserId(),e.id,n.getLoggingInfo())},n.removeStoreListeners=null,n.state={attachments:[],isCollapsed:!0},n}return n.__extends(t,e),t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.getViewingUserId=function(){return this.props.recentItem.viewingUserId},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getLogData=function(){return{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}},t.prototype.getLoggingInfo=function(){return this.getVersion().getLoggingInfo(this.getLogData())},t.prototype.getAttachmentFqPaths=function(){return i.compact(i.pluck(this.state.attachments,"fqPath"))},t.prototype.getSingleAttachment=function(e){return o.assert(1===this.state.attachments.length,e),this.state.attachments[0]},t.prototype.previewOrOpenFiles=function(e){e.shouldBrowse=d.isShareLinkRecentItem(this.props.recentItem);var t=e.shouldBrowse?[this.getSingleAttachment("previewOrOpenFiles only supports a single shared link")]:this.state.attachments;this.getVersion().previewOrBrowseRecentItem(this.getRecentItem(),t,e,this.getLogData())},t.prototype.componentWillMount=function(){this.removeStoreListeners=u.attachmentStore.addListener(this.onAttachmentStoreChange),this.onAttachmentStoreChange()},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.render=function(){return r.createElement(c.RecentActivityItemView,{recentItem:this.getRecentItem(),attachments:this.state.attachments,handler:this,isCollapsed:this.state.isCollapsed,renderingInfo:this.props.renderingInfo})},t})(r.PureComponent);m.displayName="RecentActivityItemContainer",t.RecentActivityItemContainer=m}),define("modules/clean/recent_activity/react/recent_activity_item_header_view",["require","exports","tslib","external/classnames","external/react","external/spectrum/icon_arrow","modules/constants/home","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/home/constants","modules/clean/react/home/util/resource_icon","modules/clean/react/file_icon_view","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/recent_activity_view_helper"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.stopPropagation(),e.preventDefault(),t.props.handleClick(e)},t.shouldComponentUpdate=c.compareStateAndProps,t}return n.__extends(t,e),t.prototype.getHeaderProps=function(){return this.props.header},t.prototype.renderIcon=function(){var e,t=this.getHeaderProps();if(a.HOME_BETA_NEW_ICONS){var n=t.isAggregation?l.DisplayTypes.AGGREGATION:t.displayType;e=r.createElement("span",{className:"file-icon file-icon--sprite file-icon--spectrum"},r.createElement(d.HomeResourceIcon,{className:"file-icon__img",displayType:n||l.DisplayTypes.FILE,variant:"small",fileName:t.fileName||""}))}else e=r.createElement(u.FileIconView,{icon:t.icon,className:"recents-item__img",src:t.thumbnailUrl});return r.createElement("div",{className:"recents-item__icon"},e)},t.prototype.renderHeading=function(){return r.createElement("a",n.__assign({ref:"heading",className:"recents-item__heading"},s.accessibleTriggerProps(this.props.handleClick)),this.getHeaderProps().heading)},t.prototype.renderSubheading=function(){var e=this.getHeaderProps().subheading;return e?r.createElement("div",{ref:"subheading",className:"recents-item__subheading"},e):null},t.prototype.renderDetails=function(){return r.createElement("div",{ref:"recentsItemDetails",className:"recents-item__details"},r.createElement("div",{className:"recents-item__heading-group"},this.renderHeading(),this.renderStar()),this.renderSubheading())},t.prototype.renderStar=function(){var e=this.getHeaderProps().star;return e?r.createElement("div",{className:"item__star"},e):null},t.prototype.renderActions=function(){if(this.props.recentActivityType&&m.isShareLinkEventType(this.props.recentActivityType)||0===r.Children.count(this.props.children))return null;var e=i((t={},t["recents-item__actions-inner"]=!0,t["recents-item__actions-inner--tooltip-shown"]=this.props.tooltipShown,t));return r.createElement("div",{ref:"actions",className:"recents-item__actions"},r.createElement("div",{className:e},this.props.children));var t},t.prototype.renderCarat=function(){if(!this.getHeaderProps().isAggregation||!a.HOME_BETA_COLLAPSE_RECENTS_IMAGES)return null;var e=i({"recents-item__carat":!0,"recents-item__carat--expanded":!this.getHeaderProps().isCollapsed});return r.createElement("div",{className:e},r.createElement(o.IconArrow,{name:"right"}))},t.prototype.render=function(){return r.createElement("div",{className:"recents-item__wrapper",onClick:p.ensureUserIntentToClick(this.onClick)},this.renderCarat(),this.renderIcon(),this.renderDetails(),this.renderActions())},t})(r.PureComponent);h.defaultProps={handleClick:function(e){return null},tooltipShown:!1},t.RecentActivityItemHeaderView=h}),define("modules/clean/recent_activity/react/recent_activity_item_view",["require","exports","tslib","external/classnames","external/react","modules/constants/home","modules/core/exception","modules/core/i18n","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_text_helper","modules/clean/recent_activity/react/attachment_list_view","modules/clean/recent_activity/react/pending_attachment_list_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/react/recent_activity_item_actions_view"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h,_,g,f,v,y,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=(function(e){function t(t){var n=e.call(this,t)||this;return n.onDisabled=function(e){e.preventDefault()},n.handleMouseEnter=function(){n.setState({isHovered:!0})},n.handleMouseLeave=function(){n.setState({isHovered:!1})},n.onShare=function(e){e.preventDefault(),n.props.handler.handleShare()},n.onShowTooltip=function(){n.setState({tooltipShown:!0})},n.onHideTooltip=function(){n.setState({tooltipShown:!1})},n.shouldComponentUpdate=d.compareStateAndProps,n.state={tooltipShown:!1,isHovered:!1},n}return n.__extends(t,e),t.prototype.shouldDisableActions=function(){var e=this.props.recentItem.federatedRecentItem;return e?!e.hasMenuActions():!this.hasLoadedAttachments()},t.prototype.isAggregation=function(){return this.props.recentItem.attachmentIds.length>1},t.prototype.shouldShowThumbnails=function(){var e=this.props.recentItem;return!p.isShareLinkRecentItem(e)&&p.shouldShowThumbnailsForRecentItem(e)},t.prototype.getLoadedAttachmentsCount=function(){return this.props.attachments.filter(function(e){return e.isLoaded}).length},t.prototype.canRenderAttachmentView=function(){var e=this.getLoadedAttachmentsCount();return e===this.props.recentItem.attachmentIds.length||e>=m.MAX_INITIAL_THUMBNAIL_ATTACHMENTS},t.prototype.hasLoadedAttachments=function(){return!(!this.props.attachments.length||!this.getLoadedAttachmentsCount())},t.prototype.getHeading=function(){var e=this.props,t=e.attachments,n=e.recentItem;if(t.length<2)return c.em_snippet(n.displayName||"",30);for(var i=n.attachmentIds.length,r=n.uniqueFilterTypes,o=[],a=0,l=t;a<l.length;a++){var d=l[a];d.isLoaded&&d.displayName&&o.push(d.displayName)}switch(r.length){case 1:switch(r[0]){case m.RECENT_EVENT_FILTER_TYPE.PHOTOS:return s.ungettext("%(count)s image","%(count)s images",i).format({count:i});case m.RECENT_EVENT_FILTER_TYPE.VIDEOS:return s.ungettext("%(count)s video","%(count)s videos",i).format({count:i});case m.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES:return s.ungettext("%(count)s visual note","%(count)s visual notes",i).format({count:i})}break;case 2:if(r.indexOf(m.RECENT_EVENT_FILTER_TYPE.PHOTOS)>=0&&r.indexOf(m.RECENT_EVENT_FILTER_TYPE.VIDEOS)>=0)return s._("%(count)s images and videos").format({count:i})}return o.length?g.snippetList(o,30,{totalCount:i}):s.ungettext("%(count)s file","%(count)s files",i).format({count:i})},t.prototype.getSubheading=function(){var e=this.props,t=e.recentItem,n=e.handler;return p.isShareLinkRecentItem(t)?t.type===m.RECENT_EVENT_TYPES.FILE_SHARED_ADD?r.createElement("a",{className:"recents-item__subheading-path",href:"/links/your_links",onClick:n.handlePathClick},s._("Your links")):r.createElement("div",{className:"recents-item__subheading"},r.createElement("span",{className:"recents-item__subheading-path"},s._("Recently viewed"))):t.paths.length?r.createElement(l.FilePathBreadcrumb,{pathClassname:"recents-item__subheading-path",handlePathClick:n.handlePathClick,paths:t.paths}):null},t.prototype.getIcon=function(){var e=this.props,t=e.recentItem,n=e.attachments,i=t.icon+"_32";if(t.attachmentIds.length>1){for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a.previewInfo){i=a.previewInfo.icon;break}}i=i.replace(/_32$/,"_stack_32")}return i},t.prototype.getThumbnailUrl=function(){var e=this.props.attachments;return 1===e.length&&e[0].thumbnailUrl||void 0},t.prototype.renderShareButton=function(){var e=this.props,t=e.recentItem,n=e.renderingInfo,o=n.version.getShareButtonVisibility(t,this.hasLoadedAttachments());if(o!==m.RecentElementVisibilities.HIDDEN){var a=i({disabled:o===m.RecentElementVisibilities.DISABLED,"button-secondary":!0,"recents-item__share-link":!0});return r.createElement("a",{ref:"shareLink",className:a,href:"#share",onClick:o===m.RecentElementVisibilities.SHOWN?this.onShare:this.onDisabled},s._("Share"))}return null},t.prototype.renderAttachments=function(){var e=this.props,t=e.recentItem,n=e.attachments,i=e.renderingInfo;return this.shouldShowThumbnails()?this.props.isCollapsed&&o.HOME_BETA_COLLAPSE_RECENTS_IMAGES?null:this.canRenderAttachmentView()?r.createElement(f.AttachmentListView,{ref:"attachments",attachments:n,renderingInfo:i}):r.createElement(v.PendingAttachmentListView,{ref:"pendingAttachments",count:t.attachmentIds.length}):(this.isAggregation()&&a.reportStack("Tried to render non-photo aggregation but failed",{severity:a.SEVERITY.NONCRITICAL,exc_extra:{recent_item:t,attachments:n}}),null)},t.prototype.renderActions=function(e){var t=this.props,n=t.recentItem,i=t.handler;return r.createElement(E.RecentActivityItemActionsView,{ref:"recentsItemActionsView",handler:i,tooltipHandler:this,type:n.type,permissions:e,attachmentCount:n.attachmentIds.length,disableActions:this.shouldDisableActions(),rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderButton=function(e){return e.share?r.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()):null},t.prototype.getHeaderProps=function(){var e=this.props,t=e.recentItem,n=e.renderingInfo;return{heading:this.getHeading(),subheading:this.getSubheading(),icon:this.getIcon(),thumbnailUrl:this.getThumbnailUrl(),star:this.props.renderingInfo.version.renderStar(n.role,t),fileName:t.displayName,displayType:t.displayType,isAggregation:this.isAggregation(),isCollapsed:this.props.isCollapsed}},t.prototype.renderHeader=function(){var e=this.props,t=e.recentItem,n=e.attachments,i=e.handler,o=u.getRecentActivityItemViewPermissions(t,n);return r.createElement(y.RecentActivityItemHeaderView,{ref:"header",header:this.getHeaderProps(),handleClick:this.isAggregation()?i.handleHeaderClick:i.handlePreview,tooltipShown:this.state.tooltipShown,recentActivityType:t.type},this.renderButton(o),this.renderActions(o))},t.prototype.render=function(){var e=this.props,t=e.recentItem,n=e.handler,o=i((s={},s["recents-item"]=!0,s["recents-item--loaded"]=this.hasLoadedAttachments(),s)),a=p.isShareLinkRecentItem(t)&&this.isAggregation()?void 0:_.ensureUserIntentToClick(n.handlePreview);return r.createElement("li",{"data-item-id":t.id,"data-item-type":t.type,"data-item-date":t.when,className:o,onClick:a,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.renderHeader(),this.renderAttachments());var s},t})(r.PureComponent);I.displayName="RecentActivityItemView",I.defaultProps={handler:h.getStubRecentActivityItemContainerHandler(),isCollapsed:!0,attachments:[]},t.RecentActivityItemView=I}),define("modules/clean/recent_activity/react/recent_activity_list_view",["require","exports","tslib","external/classnames","external/react","modules/clean/recent_activity/react/recent_activity_item_container"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.renderingInfo,t=this.props.items.map(function(t){return r.createElement(o.RecentActivityItemContainer,{key:t.id,recentItem:t,renderingInfo:e})});return r.createElement("ul",{className:i({"recents-list":!0,"recents-list--is-pending":this.props.isPending&&0===t.length})},t)},t})(r.Component);t.RecentActivityListView=a}),define("modules/clean/recent_activity/react/recent_activity_view",["require","exports","tslib","external/classnames","modules/core/i18n","external/react","modules/clean/components/loading_indicator","modules/clean/react/home/util/show_hide_link"],function(e,t,n,i,r,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderLoadingView=function(){return o.createElement("div",{className:"recents-loading-view",key:"loading"},o.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.renderItems=function(){var e=this.props.showAll?this.props.items:this.props.items.slice(0,10);return this.props.renderingInfo.version.renderItems({items:e,renderingInfo:this.props.renderingInfo,isPending:this.props.isPending,localDatetime:this.props.localDatetime})},t.prototype.renderShowMoreLink=function(){return this.props.showAll?null:o.createElement(s.ShowHideLink,{onClick:this.props.onShowAll,isExpanded:!1,hiddenItemCount:Math.max(this.props.items.length-10,0),canLoadMore:!0})},t.prototype.renderPendingContent=function(){return[this.renderLoadingView(),this.renderItems()]},t.prototype.renderBlankSlateContent=function(){return[o.createElement("div",{className:"recents-empty_state",key:"empty_state"},o.createElement("div",{className:"recents-empty_state_image"}),o.createElement("div",{className:"recents-empty_state_heading"},r._("Items you recently viewed will show up here.")))]},t.prototype.renderLoadedContent=function(){return[this.renderItems(),this.props.isPending?this.renderLoadingView():null,this.renderShowMoreLink()]},t.prototype.renderContent=function(){return this.props.items.length?this.renderLoadedContent():this.props.isPending?this.renderPendingContent():this.renderBlankSlateContent()},t.prototype.render=function(){var e=i({"recents-view":!0,"recents-view--is-pending":this.props.isPending&&0===this.props.items.length});return o.createElement("div",{className:e},this.renderContent())},t})(o.PureComponent);c.displayName="RecentActivityView",c.defaultProps={isPending:!1},t.RecentActivityView=c}),define("modules/clean/recent_activity/recent_activity_rendering_models",["require","exports"],function(e,t){"use strict";function n(){return{handleArchive:function(){},handleComment:function(){},handleDelete:function(){},handleDownload:function(){},handleHeaderClick:function(){},handleOpen:function(){},handlePathClick:function(){},handlePreview:function(){},handleShare:function(){},handleVersions:function(){}}}function i(){return{onShowTooltip:function(){},onHideTooltip:function(){}}}Object.defineProperty(t,"__esModule",{value:!0}),t.getStubRecentActivityItemContainerHandler=n,t.getStubRecentActivityTooltipHandler=i}),define("modules/clean/recent_activity/recent_activity_text_helper",["require","exports","modules/clean/em_string","modules/core/i18n"],function(e,t,n,i){"use strict";function r(e,t){return i.ungettext("%(name)s and %(num)s other","%(name)s and %(num)s others",t).format({name:e,num:t})}function o(e,t,o){void 0===o&&(o={});var a=Math.max(Math.floor(o.totalCount||0),e.length);if(1===a)return n.em_snippet(e[0],t);var s=e[0],c=a-1,l=r(s,c);if(new n(l).length>t){var d=Math.floor(t-new n(r("",c)).length)-1;l=d<3?i.ungettext("%(num)s other","%(num)s others",a).format({num:a}):r(n.em_snippet(s,d),c)}for(var u="",m=1;m<e.length&&(m+=1,u=e.slice(0,m).join(", "),m<a&&(u=r(u,a-m)),new n(u).length<t);)l=u;return l}Object.defineProperty(t,"__esModule",{value:!0}),t.snippetList=o}),define("modules/clean/recent_activity/recent_activity_view_helper",["require","exports"],function(e,t){"use strict";function n(e){return function(t){if(!window.getSelection().toString()){for(var n=t.target;n&&n.parentNode&&n!==t.currentTarget;){if(["a","button"].indexOf(n.nodeName.toLowerCase())>=0)return;n=n.parentNode}e.apply(this,arguments)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.ensureUserIntentToClick=n}),define("modules/clean/recent_activity/versions/recent_activity_actions_menu_version_2",["require","exports","external/classnames","external/spectrum/overflow_button","external/react","modules/core/i18n","external/spectrum/popover","modules/clean/recent_activity/versions/recent_activity_version_shared"],function(e,t,n,i,r,o,a,s){"use strict";function c(e,t,n){return r.createElement(a.PopoverContentItem,{className:"recents-actions-list__item recents-actions-list__item--"+e,key:e,value:n},t)}function l(e){var t=e.props.permissions;return[e.canOpen()?c("open",s.ACTION_LABELS.OPEN,e.onOpen):null,t.download?c("download",s.ACTION_LABELS.DOWNLOAD,e.onDownload):null,t.comment?c("comment",s.ACTION_LABELS.COMMENT,e.onComment):null,t.delete?c("delete",e.getDeleteLabel(),e.onDelete):null,t.archive?c("archive",s.ACTION_LABELS.ARCHIVE,e.onArchive):null,t.versions?c("versions",s.ACTION_LABELS.VERSION,e.onVersions):null].filter(Boolean)}function d(e,t){e(t)}function u(e){var t=n({"recents-item__actions-button":!0,"button-secondary":!0,disabled:e.props.disableActions});return r.createElement(i.OverflowButton,{tagName:"span",className:t,"aria-label":o._("More Actions"),tabIndex:0})}function m(e){return e.props.disableActions?u(e):r.createElement("div",{onClick:p,onDoubleClick:p},r.createElement(a.Popover,{onSelection:d,closeOnSelection:!0},r.createElement(a.PopoverTrigger,null,u(e)),r.createElement(a.PopoverContent,{attachment:"right"},l(e))))}Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){return e.stopPropagation()};t.renderMoreActionsButton=m}),define("modules/clean/recent_activity/versions/recent_activity_version_2",["require","exports","tslib","external/react","modules/clean/recent_activity/actions/federated_recent_activity_actions","modules/clean/browse_interface","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/react/recent_activity_list_view","modules/clean/recent_activity/store_utils","modules/clean/react/home/home_access/recents/utils/events","modules/core/exception","modules/clean/react/starred/star","modules/clean/react/home/store","modules/clean/recent_activity/recent_activity_constants","modules/clean/react/home/util/navigation","modules/clean/react/sprite","modules/clean/recent_activity/versions/recent_activity_version_shared","modules/clean/recent_activity/versions/recent_activity_actions_menu_version_2","modules/constants/home","modules/clean/react/home/resource/actions"],function(e,t,n,i,r,o,a,s,c,l,d,u,m,p,h,_,g,f,v,y,E,I){"use strict";function S(e,t){return 1===t.length?t[0]:0===t.length&&1===e.attachmentIds.length?c.attachmentStore.getById(e.attachmentIds[0]):null}function w(e,t){return e.fqPath?String(o.preview_uri_for_fq_path(t,e.fqPath)):e.previewInfo?e.previewInfo.href||null:null}function A(e,t,n){var i=c.attachmentStore.getByIds(t).map(function(e){return e.fqPath}).filter(Boolean);return u.logEvent(e,n.cellView,i,n.totalCount)}function T(e,t,n,i,r){g.logAndNavigate(e,function(){return A(t,n,i)},r,!0)}function C(e,t,n){if(E.HOME_BETA_OPEN_IN_MODAL&&!e.isDir)return I.openInFileViewer(e.id,function(){return A(a.ActionTypes.VIEW_FILE,t,n)}),!0;var i=w(e,h.HomeStore.getUser());return!!i&&(T(i,a.ActionTypes.VIEW_FILE,t,n),!0)}function N(e,t,n,i){
if(e.federatedRecentItem)r.previewItem(e.federatedRecentItem,n);else{var o=h.HomeStore.getUser(),a=S(e,t);a?d.ensureAttachments(o.id,[a.id],function(t){if(1===t.length){if(C(t[0],e.attachmentIds,n))return}i()}):i()}}function b(e){return e.resourceId&&e.idType?{id:e.resourceId,type:e.idType}:null}Object.defineProperty(t,"__esModule",{value:!0});var R=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderStar=function(e,t){var n=b(t);return n?i.createElement(p.Star,{id:n.id,idType:n.type,role:e}):null},t.prototype.logEvent=function(e,t,n,i,r){u.logEvent(e,t,n,i,r)},t.prototype.shareRecentItem=function(t,n,i){t.federatedRecentItem?r.shareItem(t.federatedRecentItem,i):e.prototype.shareRecentItem.call(this,t,n,i)},t.prototype.previewOrBrowseRecentItem=function(t,n,i,r){var o=this;N(t,n,r,function(){e.prototype.previewOrBrowseRecentItem.call(o,t,n,i,r)})},t.prototype.previewRecentItem=function(e,t,n,i){N(e,t,i,function(){m.reportStack("Failed to preview the RecentItem",{severity:m.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e,attachments:t,previewOptions:n}})})},t.prototype.deleteRecentItem=function(t,n,i){t.federatedRecentItem?m.reportStack("Deleting is not supported for federated recent items",{severity:m.SEVERITY.NONCRITICAL,exc_extra:{recentItem:t}}):e.prototype.deleteRecentItem.call(this,t,n,i)},t.prototype.archiveRecentItem=function(t,n){t.federatedRecentItem?r.promptAndArchiveItem(t.federatedRecentItem,t.viewingUserId,n):e.prototype.archiveRecentItem.call(this,t,n)},t.prototype.handlePathClick=function(e,t,n){T(e.currentTarget.href,a.ActionTypes.OPEN_PATH,t.attachmentIds,n,e)},t.prototype.shouldRenderItemActions=function(e){for(var t in e)if("share"!==t&&e[t])return!0;return!1},t.prototype.getShareButtonVisibility=function(e,t){return e.federatedRecentItem?e.federatedRecentItem.isShareable()?_.RecentElementVisibilities.SHOWN:_.RecentElementVisibilities.HIDDEN:t?_.RecentElementVisibilities.SHOWN:_.RecentElementVisibilities.HIDDEN},t.prototype.renderItems=function(e){return i.createElement("ul",{className:"recents-view__sections"},i.createElement("li",{className:"recents-section"},i.createElement(l.RecentActivityListView,{items:e.items,isPending:e.isPending,renderingInfo:e.renderingInfo})))},t.prototype.renderItemActionsPlaceholder=function(){return i.createElement(f,{className:"recents-item__more-actions-placeholder",group:"web",name:"overflow-glyph",alt:"…"})},t.prototype.renderMoreActionsElement=function(e){return y.renderMoreActionsButton(e)},t.prototype.previewAttachment=function(e,t,n){C(t.find(function(t){return t.id===e}),s.extractAttachmentIds(t),n)},t})(v.RecentActivityVersionShared);t.RecentActivityVersion2=new R}),define("modules/clean/recent_activity/versions/recent_activity_version_shared",["require","exports","tslib","modules/core/i18n","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/models/utils","modules/core/exception"],function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){}return e.prototype.getLoggingInfo=function(e){return n.__assign({homeLogEventFunction:this.logEvent},e)},e.prototype.shareRecentItem=function(e,t,n){r.shareFile(e.viewingUserId,t[0].id,this.getLoggingInfo(n))},e.prototype.previewOrBrowseRecentItem=function(e,t,n,i){if(n.shouldBrowse){var o=t[0].entityUri;o?r.browseFile(o):a.reportStack("Missing entityUri. Cannot browse/preview",{severity:a.SEVERITY.NONCRITICAL,exc_extra:{recent_item:e,attachments:t}})}else this.previewRecentItem(e,t,n,i)},e.prototype.deleteRecentItem=function(e,t,n){r.promptAndDeleteAttachments(e.viewingUserId,o.extractAttachmentIds(t),this.getLoggingInfo(n))},e.prototype.archiveRecentItem=function(e,t){a.reportStack("Archiving is not supported",{severity:a.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}})},e})();t.RecentActivityVersionShared=s,t.ACTION_LABELS={OPEN:i._("Open"),DOWNLOAD:i._("Download"),COMMENT:i._("Comment"),ARCHIVE:i._("Archive"),VERSION:i._("Version history")}});
//# sourceMappingURL=pkg-home.min.js-vflGWi-Sw.map