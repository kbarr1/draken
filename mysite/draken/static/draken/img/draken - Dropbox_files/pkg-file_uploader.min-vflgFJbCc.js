(function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/clean/filepath","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/browse/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/utils"],function(t,o,r,a,s,n,i,l,u,d){var p,c,m,f,h,_,g,E,assert,T,y,U;return E=t._,assert=r.assert,U=s.file_extension,T=n.browseActions,c=i.FileStatusTypes,m=i.FileUpload,h=i.UploaderActionTypes,f=i.UploadErrorTypes,g=l.UploaderStore,y=d.calculateSizeOfUploads,d.checkIfThereArePendingUploadsWithoutCurrent,p=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],_=(function(){function t(){}return t.prototype.initPLU=function(t){if(!u.isInitialized)return this.sendNS=!1,u.init(t),u.onFilesAdded((function(t){return function(o){var r,s,n,i,l,u,d,c,m,_;for(s=(function(){var e,t,r;for(r=[],e=0,t=o.length;e<t;e++)n=o[e],null==n.size&&r.push(n);return r})(),o=(function(){var e,t,r;for(r=[],e=0,t=o.length;e<t;e++)n=o[e],null!=n.size&&r.push(n);return r})(),i=0,u=s.length;i<u;i++)r=s[i],a.dispatch({type:h.ADD_NEW_FAILED_FILE,data:{file:r,errorType:f.EMPTY_OR_FOLDER,errorMessage:E("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(c=function(t){var o;return o=U(t.name),e.call(p,o)>=0&&t.size%34===0},_=(function(){var e,t,r;for(r=[],e=0,t=o.length;e<t;e++)n=o[e],c(n)&&r.push(n);return r})(),o=(function(){var e,t,r;for(r=[],e=0,t=o.length;e<t;e++)n=o[e],c(n)||r.push(n);return r})(),l=0,d=_.length;l<d;l++)m=_[l],a.dispatch({type:h.ADD_NEW_FAILED_FILE,data:{file:m,errorType:f.PACKAGE_FILE,errorMessage:E("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return s.length&&t.cancelUploads({files:s}),_.length&&t.cancelUploads({files:_}),a.dispatch({type:h.QUEUE_UPLOADS,data:{files:o}}),t._frobPLU()}})(this)),u.onUploadProgress(function(e){var t,o,r,s,n;if(!g.isUploadCancelled(e.uploadId))return s=e.percentUploaded,o=s*g.currentUpload().size/100,n=o+g.totalSizeOfCompletedUploads(),y(g.fileList(),[c.COMPLETE,c.PENDING,c.UPLOADING]),t=u.bytesPerSec(),r=g.fileList().count(function(e){var t;return(t=e.status)===c.PENDING||t===c.UPLOADING}),a.dispatch({type:h.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:s,numSecondsLeft:(g.totalSize()-n)/t+r}})}),u.onFileUploaded((function(e){return function(t,r){var s,n;if(!g.isUploadCancelled(t.uploadId))return s=JSON.parse(r.response),"error"in s?(u.removeFiles({files:[t]}),"ignored"===s.error?a.dispatch({type:h.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:f.IGNORED,errorMessage:E("This file was skipped because it’s an internal system file.")}}):a.dispatch({type:h.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:f.GENERIC}})):(assert("complete"===s.status),assert(s.total_size===t.size),assert(s.upload_id===t.uploadId),a.dispatch({type:h.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}}),g.countIfThereArePendingUploadsWithoutCurrent({uploadId:t.uploadId})||(n=g.fileList().valueSeq().filter(function(e){return e.status===c.COMPLETE}).map(function(e){return o.normalize(e.dest)+o.normalize(e.name)}),T.selectFilesAfterUpload({fqPathsToSelect:n.toArray()}))),e._frobPLU()}})(this)),u.onError((function(e){return function(t,o,r){return g.fileList().has(t.uploadId)?a.dispatch({type:h.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:o,errorMessage:r}}):a.dispatch({type:h.ADD_NEW_FAILED_FILE,data:{file:t,errorType:o,errorMessage:r}}),e._frobPLU()}})(this))},t.prototype.setPath=function(e){var t,o,r;if(o=e.path,t=null==(r=e.hasPermissionToUploadToFolder)||r,o!==g.path()||t!==g.hasPermissionToUploadToFolder())return a.dispatch({type:h.SET_PATH,data:{path:o,hasPermissionToUploadToFolder:t}})},t.prototype.setUser=function(e){var t;return t=e.user,a.dispatch({type:h.SET_USER,data:{user:t}})},t.prototype.setNumDraggingFiles=function(e){var t,o,r;return o=e.numDraggingFiles,t=null!=(r=e.isInternalTransfer)&&r,a.dispatch({type:h.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:o,isInternalTransfer:t}})},t.prototype.addFilesToPLU=function(e){var t,o,r;return t=e.files,o=null!=(r=e.path)?r:g.path(),u.addFiles({files:t,path:o}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},t.prototype.addDirectoriesToPLU=function(t){var o,r,s,n,i,l,u,d,c,m,_,T;for(r=t.directoryEntries,o=g.path(),n=[],d=0,i=(function(e){return function(){var t;return(t=function(){var o,r,a;if(n.length>0)return a=n.pop(),r=a.entry,o=a.dest,r.file(function(r){return e.addFilesToPLU({files:[r],path:o}),t()})})()}})(this),c=function(e){var t,r;return d+=1,r=e.createReader(),(t=function(){return r.readEntries(function(r){var a,s,l,u;if(r.length>0){for(s=0,l=r.length;s<l;s++)u=r[s],u.isDirectory?c(u):(a=o+e.fullPath,a=a.split("//").join("/"),n.push({entry:u,dest:a}));return t()}if(d-=1,0===d)return i()})})()},_=[],l=0,u=r.length;l<u;l++)T=r[l],m=U(T.name),e.call(p,m)>=0?(s=new File({name:T.name,dest:o}),_.push(a.dispatch({type:h.ADD_NEW_FAILED_FILE,data:{file:s,errorType:f.PACKAGE_FILE,errorMessage:E('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):_.push(c(T));return _},t.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,a.dispatch({type:h.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},t.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,a.dispatch({type:h.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},t.prototype.setSendNS=function(e){return this.sendNS=e,u.setSendNS(e)},t.prototype.cancelUploads=function(e){var t;return t=e.files,u.removeFiles({files:t}),a.dispatch({type:h.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},t.prototype.manuallySetInErrorState=function(e){var t,o,r;return r=e.file,o=e.errorType,t=e.errorMessage,u.removeFiles({files:[r]}),a.dispatch({type:h.UPLOAD_ERROR,data:{uploadId:r.uploadId,errorType:o,errorMessage:t}}),this._frobPLU()},t.prototype._startUpload=function(e){var t,o,r,s;return o=e.file,a.dispatch({type:h.START_UPLOAD,data:{file:o}}),s="url"===(r=U(o.name))||"webloc"===r||"website"===r?0:1,t={dest:o.dest,reported_total_size:o.size,uploadId:o.uploadId,_subject_uid:o.userId,offset:0,overwrite:s},this.sendNS&&(t.ns_id=o.ns_id,t.ns_path=o.ns_path),u.setAjaxParams(t),u.start(),!0},t.prototype._frobPLU=function(){var e;if(e=g.nextUpload(),null!=e&&null==g.currentUpload())return assert(e instanceof m),this._startUpload({file:e})},t})(),{UploaderDispatcher:a,UploaderActions:new _}})}).call(this),define("modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/clean/react/modal","modules/clean/static_urls","modules/core/i18n","modules/clean/ajax","modules/clean/react_format"],function(e,t,o,r,a,s,n,i,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.componentDidMount=function(){var e=window.ensemble&&window.ensemble.viewer.getActiveUser().userId;u.SilentBackgroundRequest({url:"/log_nearquota_upload_modal_variant",data:{_subject_uid:e}})},t.prototype.renderAltAction=function(){return r.createElement("a",{href:"/pro/out-of-space?oqa=upl_nq"},l._("Learn More"))},t.prototype.render=function(){return r.createElement(n.Modal,{ref:"NearquotaUploadModal",style:"clean",onDismiss:this.props.onDismiss,onAccept:this.props.onAccept,altAction:this.renderAltAction(),acceptButtonText:l._("Continue adding files"),acceptButtonImportance:"primary",className:"NearquotaUploadModal",showX:!0},r.createElement(s,{src:i.static_url("/static/images/browse/illo_how-create-vflZtnnP8.png"),srcHiRes:i.static_url("/static/images/browse/illo_how-create@2x-vflkv0qQG.png"),className:"NearquotaUploadModal__image"}),r.createElement("h2",{className:"NearquotaUploadModal__title"},l._("Thanks for uploading!")),r.createElement("p",{className:"NearquotaUploadModal__copy"},l._("Just so you know, you’re getting close to your space limit.")),r.createElement("p",{className:"NearquotaUploadModal__copy"},l._("Learn more about what to do if you run out of space.")))},t})(r.Component),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"exp-subgrowth-pro-nearquota-upload-modal"},r.createElement("div",null,r.createElement(s,{className:"exp-subgrowth-pro-nearquota-upload-modal__warning",src:i.static_url("/static/images/browse/warning-vflZsXcW-.svg"),alt:l._("Warning")})),r.createElement("p",{className:"exp-subgrowth-pro-nearquota-upload-modal__copy"},d.reactFormat(l._("Thanks for adding stuff to Dropbox! Just so you know, you’re getting close\n          to your space limit. <overQuotaLink>Learn more</overQuotaLink> about what to do if you\n          run out of space."),{overQuotaLink:r.createElement("a",{key:"nq-link",href:"/pro/out-of-space?oqa=upl_nq"})})))},t})(r.Component);t.NearquotaUploadModal=a(p,["/static/css/exp_subgrowth_pro_nearquota_upload_modal-vflsHPc8t.css"]),t.NearquotaUploadAltAction=a(c,["/static/css/exp_subgrowth_pro_nearquota_upload_modal-vflsHPc8t.css"])}),function(){define("modules/clean/react/file_uploader/file_uploader_modal",["external/classnames","external/react","external/react-dom","jquery","modules/clean/ajax","modules/clean/browse_interface","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react_format","modules/clean/react/button","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/uploader_modal","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/static_urls","modules/clean/viewer","modules/constants/payments","modules/constants/python","modules/core/i18n","modules/core/uri"],function(e,t,o,r,a,s,n,i,l,u,d,p,c,m,f,h,_,g,E,T,y,U,v,S,b,N,D,w,L,I,O,A){var F,M,R,P,x,C,B,k,q,Q,z,G,V,j,H,Y,W,$,Z,J,X,K,ee,te;return J=s.get_browse_root_name,W=s.browse_uri_for_fq_path,X=p.reactFormat,c.button,Y=f.browseStore,z=h.UploaderActions,F=_.FileStatusTypes,x=_.OverQuotaStatusType,C=_.OverQuotaStatusTypes,Q=_.UploadErrorTypes,g.NearquotaUploadModal,P=g.NearquotaUploadAltAction,V=T.UploaderStore,G=y.UploaderModal,R=S.Modal,k=N.Tooltip,q=N.TooltipPosition,ee=D.static_url,B=I.TRADEMARK_BUSINESS,j=O._,te=O.ungettext,m.BrowseLogEventSources,$=t.createElement,K=t.DOM,K.div,K.a,K.form,Z=t.DOM,H=function(e){var t,o,r,a,s,n,i;return null==e&&(e={}),n=e.user,r=e.path,o=null!=(a=e.maxLength)?a:1e3,i=w.get_viewer(),i.is_paired&&n.is_team&&(s=i.team_name),"/"===r?i.is_paired?n.is_team?j(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:s}):j(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):j(" upload to your Dropbox"):(t=l.em_snippet(u.filename(r),o),i.is_paired?n.is_team?j(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:s}):j(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):j(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},M=t.createClass({displayName:"FileUploaderModal",mixins:[d(V)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:t.PropTypes.bool,shouldShowDestinationLink:t.PropTypes.bool,onModalDismissed:t.PropTypes.func,clickOutToClose:t.PropTypes.bool,sendNS:t.PropTypes.bool,isTeamOnboarding:t.PropTypes.bool,expSubgrowthProNearquotaUploadModal:t.PropTypes.string,numTeamMembers:t.PropTypes.number,numTeamAdmins:t.PropTypes.number,teamAdminEmail:t.PropTypes.string,teamAdminFname:t.PropTypes.string,promptAdminToUpgradeEmailTemplateUrl:t.PropTypes.string,overQuotaStatus:x},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1,isTeamOnboarding:!1,numTeamMembers:0,numTeamAdmins:0,overQuotaStatus:C.NONE}},_get_state_from_stores:function(){return{path:V.path(),ns_id:Y.context().currentNSID,ns_path:Y.context().currentNSPath,user:V.user(),fileList:V.fileList(),numDraggingFiles:V.numDraggingFiles(),currentUpload:V.currentUpload(),numSecondsLeft:V.numSecondsLeft(),hasPermissionToUploadToFolder:V.hasPermissionToUploadToFolder()}},_log_subgrowth_pro_nearquota_upload_modal_exposure:function(){if(["CONTROL","V1","V2"].indexOf(this.props.expSubgrowthProNearquotaUploadModal)>-1)return a.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_nearquota_upload_modal",variant:this.props.expSubgrowthProNearquotaUploadModal}})},componentDidMount:function(){if(this._usingFileUploaderModal())return this._log_subgrowth_pro_nearquota_upload_modal_exposure(),this._setBrowseButton(),setTimeout((function(e){return function(){return e.forceUpdate()}})(this),250),r(window).on("resize.uploaderModal",(function(e){return function(){return e._setBrowseButton()}})(this))},componentDidUpdate:function(e,t){var a,s,n,i;if(this._usingFileUploaderModal()&&(this._setBrowseButton(),this.state.numDraggingFiles?(a=r(o.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+this.DROPZONE_ID),a.length||r("#"+this.DROPZONE_ID).clone().prependTo(r(o.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):r(o.findDOMNode(this.refs.modal)).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>t.fileList.count()&&(n=r(o.findDOMNode(this.refs.uploadFilesList)),s=null!=(i=n.find(".upload-file"))?i.eq(t.fileList.count()):void 0,s.length)))return n.scrollTop(n.scrollTop()+s.position().top)},componentWillUnmount:function(){return E.setBrowseButton(null),r(window).off("resize.uploaderModal")},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_usingFileUploaderModal:function(){var e;return e=0===this.state.fileList.count(),!(!e&&this.state.overQuotaStatus!==!C.NONE)},_setBrowseButton:function(){var e;return e=o.findDOMNode(this.refs.pluFileChooseButton),E.setBrowseButton(e),r(e).focus()},_handleClose:function(){var e,t;t=this.state.fileList.find(function(e){var t;return(t=e.status)===F.PENDING||t===F.UPLOADING}),t||z.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),z.setIsUploadModalOpen({isUploadModalOpen:!1}),R.close(),"function"==typeof(e=this.props).onModalDismissed&&e.onModalDismissed()},_handleCancel:function(e){return z.cancelUploads({files:[e]})},_limitedTeamOverquotaLink:function(e){var t;return this.state.user.is_cdm_member&&!this.state.user.is_team_admin&&this.props.numTeamAdmins>0?this.props.promptAdminToUpgradeEmailTemplateUrl:(t=1===this.props.numTeamMembers?"/plans":"/team/upgrade",A({path:t,query:{_tk:"over_quota",_camp:"upload_modal",oqa:e?"upl":"upl_b"}}))},_renderIntroModalButtons:function(){var e,t,o,r,a,s,n,i;return t=Z.div({className:"u-font-medium"},this.props.overQuotaStatus===C.BASIC_OVER_QUOTA?X(j("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:Z.a({className:"overquota-uploader-link",href:"/upgrade?oqa=upl"})}):!this.state.user.is_cdm_member||(a=this.props.overQuotaStatus)!==C.LIMITED_TEAM_USER_OVER_QUOTA&&a!==C.LIMITED_TEAM_TSD_OVER_QUOTA?this.props.overQuotaStatus===C.LIMITED_TEAM_USER_OVER_QUOTA?X(j("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:Z.a({className:"overquota-uploader-link",href:this._limitedTeamOverquotaLink(!0)})}):j("Having problems? Please try again."):""),r=null,n=null,i=j(this.state.user.is_cdm_member?this.state.user.is_team_admin||0===this.props.numTeamAdmins?"Get more space":"Ask for more space":"Upgrade to Upload"),this.props.overQuotaStatus===C.BASIC_OVER_QUOTA?(o=L.BUY_URL+"?oqa=upl_b",r=Z.a({className:"dbmodal-button c-btn c-btn--primary",href:o},i)):r=(s=this.props.overQuotaStatus)===C.LIMITED_TEAM_USER_OVER_QUOTA||s===C.LIMITED_TEAM_TSD_OVER_QUOTA?Z.a({className:"dbmodal-button c-btn c-btn--primary",href:this._limitedTeamOverquotaLink(!1)},i):Z.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary"},j("Choose files")),n=Z.button({importance:"tertiary",className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:this._handleClose},j("Cancel")),this.props.overQuotaStatus===C.BASIC_OVER_QUOTA||this.props.overQuotaStatus===C.LIMITED_TEAM_USER_OVER_QUOTA&&!this.state.user.is_cdm_member?(e="c-banner c-banner--warning upload-overquota-banner__content",Z.div({className:"u-mar-vertical-l clearfix"},Z.div({className:"u-l-fr"},r,n),Z.div({className:"upload-overquota-banner__container"},Z.div({id:"upload-overquota-banner",className:e},t)))):Z.div({className:"u-mar-top-l"},$(U.Flag,{spacing:"s",rightAttachment:Z.div({},r,n)},t))},_renderFileListModalButtons:function(){var e,t,o,r;return o=this.state.fileList.find(function(e){var t;return(t=e.status)===F.PENDING||t===F.UPLOADING}),t=o?"tertiary":"primary",r=Z.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},j("Add more files")),e=Z.button({className:"dbmodal-button c-btn c-btn--"+t,onClick:this._handleClose},j(o?"Hide":"Done")),Z.div({className:"u-mar-top-s"},$(U.Flag,{leftAttachment:r,rightAttachment:e,spacing:"s"},Z.div({className:"u-font-small"},o?void 0:j("Having problems? Please try again."))))},_renderIntroMessage:function(){var e,t,o,r,a;return a=H({user:this.state.user,path:this.state.path}),r=w.get_viewer().team_name,Z.span({},!this.state.user.is_cdm_member||(t=this.props.overQuotaStatus)!==C.LIMITED_TEAM_USER_OVER_QUOTA&&t!==C.LIMITED_TEAM_TSD_OVER_QUOTA?(o=this.props.overQuotaStatus)===C.BASIC_OVER_QUOTA||o===C.LIMITED_TEAM_USER_OVER_QUOTA?j("You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):this.props.isTeamOnboarding?j("Choose files to add to the %(team_name)s team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the %(team_name)s Dropbox will have access to files in the team folder.").format({team_name:r}):this.props.dragAndDropEnabled?j("Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:a}):j("Choose files to %(upload_folder_name)s. You can select more than one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:a}):(e=this.props.overQuotaStatus===C.LIMITED_TEAM_USER_OVER_QUOTA?j("Your member folder is full, so no new files can be added"):j("The %(team_name)s shared workspace is full, so no new files can be added").format({team_name:r}),this.state.user.is_team_admin||!this.props.numTeamAdmins?X(te("%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade your account </upgradeLink>.","%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade to %(trademark_business)s</upgradeLink>.",this.props.numTeamMembers),{dropbox_full_message:e,trademark_business:B,upgradeLink:Z.a({href:this._limitedTeamOverquotaLink(!1)})}):te("%(dropbox_full_message)s. To get more space, ask your Dropbox admin (%(admin_email)s).","%(dropbox_full_message)s. To get more space, ask your Dropbox admins (%(admin_email)s and %(num_other_admins)s others).",this.props.numTeamAdmins).format({dropbox_full_message:e,admin_email:this.props.teamAdminEmail,num_other_admins:this.props.numTeamAdmins-1})))},_renderDropzone:function(){return Z.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},Z.div({},te("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:H({user:this.state.user,path:this.state.path,maxLength:20})})))},_renderFileListRowStatus:function(e){var t;return Z.div({className:"status-col"},e.status===F.UPLOADING&&100===e.percentUploaded?$(v,{src:ee("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:ee("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===F.PENDING||t===F.UPLOADING?Z.button({className:"button-as-link",onClick:(function(t){return function(o){return o.preventDefault(),t._handleCancel(e)}})(this)},$(b,{group:"web",name:"xclose",alt:j("Cancel")})):e.status===F.COMPLETE?$(b,{group:"web",name:"s_check",alt:j("Upload successful")}):e.status===F.CANCELLED?$(v,{src:ee("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:ee("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:j("Upload cancelled")}):e.status===F.FAILED?$(v,{src:ee("/static/images/nosync-vfl18cuTS.png"),srcHiRes:ee("/static/images/nosync@2x-vflgS4F07.png"),alt:j("Error")}):void 0)},_renderFileListRowError:function(e){var t,o;return t=(null!=(o=e.errorMessage)?o.length:void 0)>0?e.errorMessage:j("Something went wrong while uploading this file."),Z.div({className:"error-col"},Z.span({className:"error-msg"},j(e.errorType===Q.FILE_SIZE_ERROR?"File too large":"Upload Error")),Z.span({className:"error-details"},$(k,{position:q.RIGHT,tooltip_contents:Z.div({},t),tooltip_classname:"upload-error-tooltip"},$(b,{group:"web",name:"information",alt:j("More information")}))))},_renderFileListRowDest:function(e){var t,o;return Z.div({className:"dest-col"},e.status===F.CANCELLED?j("Canceled"):(o=w.get_viewer().get_user_by_id(e.userId),t=Y.context().isNonUserRelativeContext?"":J(o),Z.a({href:W(o,e.dest).toString()},l.em_snippet(""+t+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(t,o){var r,a;return r=t.status===F.UPLOADING?t.percentUploaded:t.status===F.PENDING?0:100,a={"upload-file":!0,complete:t.status===F.COMPLETE,cancelled:t.status===F.CANCELLED,error:t.status===F.FAILED},Z.li({className:e(a),key:t.uploadId},Z.div({className:"upload-progress-bar",style:{width:r+"%"}}),Z.div({className:"upload-file-info",style:{overflow:"hidden"}},Z.div({className:"filename-col"},$(b,{group:"web",name:u.file_icon(t.name),alt:""}),Z.span({className:"filename"},l.em_snippet(t.name,this.FILENAME_SNIPPET_LENGTH)),null!=t.size?Z.span({className:"size"}," - ",i.format_bytes(t.size)):void 0),t.status!==F.FAILED?o?this._renderFileListRowDest(t):void 0:this._renderFileListRowError(t),this._renderFileListRowStatus(t)))},_renderFileList:function(e,t){var o,r,a;return a=null==(r=(null!=t?t:{}).shouldShowDestinationLink)||r,Z.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,r,s;for(s=[],t=0,r=e.length;t<r;t++)o=e[t],s.push(this._renderFileListRow(o,a));return s}.call(this))},_renderTimeLeft:function(){var e;if(e=this.state.currentUpload,null!=e&&e.status===F.UPLOADING)return Z.div({style:{marginTop:8,textAlign:"right"}},j("%(time_left)s left").format({time_left:n.format_time(this.state.numSecondsLeft)}))},render:function(){var e,t,o,r,a;return a=j(this.props.isTeamOnboarding?"Which files would you like to add?":!this.state.user.is_cdm_member||(o=this.props.overQuotaStatus)!==C.LIMITED_TEAM_USER_OVER_QUOTA&&o!==C.LIMITED_TEAM_TSD_OVER_QUOTA?"Upload to Dropbox":"More space needed"),e=null,"V1"===this.props.expSubgrowthProNearquotaUploadModal&&(t=null!=this.state.fileList.find(function(e){return e.status===F.COMPLETE}),t&&this.props.overQuotaStatus===C.BASIC_NEAR_QUOTA&&(e=$(P,{}))),Z.div({ref:"container"},this._renderDropzone(),0!==this.state.fileList.count()||(r=this.state.overQuotaStatus)!==C.NONE&&r!==C.BASIC_NEAR_QUOTA?this._usingFileUploaderModal()?$(R,{ref:"modal",title:a,showX:!1,clickOutToClose:this.props.clickOutToClose,altAction:e,buttonComponent:0===this.state.fileList.count()?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:(function(e){return function(e){return z.setIsUploadModalOpen({isUploadModalOpen:!1})}})(this)},0===this.state.fileList.count()?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray(),{shouldShowDestinationLink:this.props.shouldShowDestinationLink}),this._renderTimeLeft()):$(G,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose,expSubgrowthProNearquotaUploadModal:this.props.expSubgrowthProNearquotaUploadModal,overQuotaStatus:this.props.overQuotaStatus}):void 0)}}),{FileUploaderModal:M}})}.call(this),define("modules/clean/react/file_uploader/inline_upload_status",["require","exports","tslib","external/classnames","external/react","modules/clean/datetime","modules/clean/em_string","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/core/i18n"],function(e,t,o,r,a,s,n,i,l,u,d,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClose=function(e){return e.preventDefault(),i.UploaderActions.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})},t.handleViewDetails=function(e){return e.preventDefault(),t.props.onViewDetails()},t}return o.__extends(t,e),t.prototype.getOverallUploadState=function(){return this.props.fileList.some(function(e){return e.status===l.FileStatusTypes.PENDING||e.status===l.FileStatusTypes.UPLOADING})?"uploading":this.props.fileList.some(function(e){return e.status===l.FileStatusTypes.FAILED})?"error":"complete"},t.prototype.getProgressBarWidth=function(){var e=this.getOverallUploadState();return"uploading"===e&&this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},t.prototype.getNumStatusFiles=function(e){return this.props.fileList.count(function(t){return t.status===e})},t.prototype.getNumNoncancelledFiles=function(){return this.props.fileList.count(function(e){return e.status!==l.FileStatusTypes.CANCELLED})},t.prototype.getUploadErrorReason=function(e){switch(e){case l.UploadErrorTypes.OVER_QUOTA_ERROR:return c._("over quota");case l.UploadErrorTypes.FILE_SIZE_ERROR:return c._("file too large");case l.UploadErrorTypes.CONNECTION_ERROR:return c._("lost connection");case l.UploadErrorTypes.HTTP_ERROR:return c._("server error");case l.UploadErrorTypes.EMPTY_OR_FOLDER:return c._("can’t upload folders or empty files");case l.UploadErrorTypes.PACKAGE_FILE:return c._("OSX package file");default:return""}},t.prototype.renderIcon=function(){var e=this.getOverallUploadState();return"uploading"===e?a.createElement(d,{group:"web",name:"s_sync",alt:c._("Uploading")}):"complete"===e?a.createElement(d,{group:"web",name:"s_check",alt:c._("Upload successful")}):a.createElement(u,{src:p.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:p.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:c._("Error")})},t.prototype.renderCloseButton=function(){return a.createElement("button",{className:"button-as-link",onClick:this.handleClose},a.createElement(d,{group:"web",name:"xclose",alt:c._("Close")}))},t.prototype.renderViewDetailsLink=function(){var e=this.getNumStatusFiles(l.FileStatusTypes.PENDING),t=c.ungettext("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e});return a.createElement("span",{className:"details"}," - ",a.createElement("button",{className:"view-details button-as-link",onClick:this.handleViewDetails},e>0?t:c._("View details")))},t.prototype.renderUploadDescription=function(){var e=this.getOverallUploadState(),t=this.getNumNoncancelledFiles();return this.props.currentUpload?c._("Uploading %(filename)s").format({filename:n.em_snippet(this.props.currentUpload.name,30)}):"uploading"===e?c._("Starting upload..."):"complete"===e?t>1?c._("Uploaded %(num_files)d files").format({num_files:t}):c._("Uploaded %(filename)s").format({filename:n.em_snippet(this.props.fileList.last().name,30)}):""},t.prototype.renderErrorDescription=function(){var e=this.getNumNoncancelledFiles(),t=this.getNumStatusFiles(l.FileStatusTypes.FAILED),o=c.ungettext("- %(num_errors)d error","- %(num_errors)d errors",t).format({num_errors:t});if(e>1)return[c._("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:this.getNumStatusFiles(l.FileStatusTypes.COMPLETE),num_files:e})," ",a.createElement("span",{className:"num-errors"},o)];var r=this.props.fileList.last().errorType;return r===l.UploadErrorTypes.GENERIC?c._("Unable to upload %(filename)s").format({filename:n.em_snippet(this.props.fileList.last().name,30)}):c._("Unable to upload %(filename)s: %(reason)s").format({filename:n.em_snippet(this.props.fileList.last().name,30),reason:this.getUploadErrorReason(r)})},t.prototype.renderFileDescription=function(){var e=this.getOverallUploadState();return a.createElement("span",{className:"file-desc"},this.props.currentUpload||"error"!==e?this.renderUploadDescription():this.renderErrorDescription())},t.prototype.render=function(){var e=this.getOverallUploadState(),t={"upload-file":!0,error:"error"===e,complete:"complete"===e};return a.createElement("div",{id:"inline-upload-status",className:r(t)},a.createElement("div",{className:"inline-upload-info"},a.createElement("div",{className:"icon"},this.renderIcon()),a.createElement("div",{className:"files-info"},this.renderFileDescription(),a.createElement("span",{className:"num-errors"}),this.renderViewDetailsLink()),a.createElement("div",{className:"status"},"uploading"===e&&this.props.numSecondsLeft?c._("%(time_left)s left").format({time_left:s.format_time(this.props.numSecondsLeft)}):this.renderCloseButton())),a.createElement("div",{className:"inline-upload-bar"},a.createElement("div",{className:"inline-upload-progress",style:{width:this.getProgressBarWidth()+"%"}})))},t})(a.PureComponent);t.InlineUploadStatus=m}),define("modules/clean/react/file_uploader/mapper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(){this.fileIdMap={}}return e.prototype.pathOf=function(e){var t=this.fileIdMap[e];return t?t[1]:null},e.prototype.uploadIdOf=function(e){var t=this.fileIdMap[e];return t?t[0]:null},e.prototype.set=function(e,t,o){this.fileIdMap[e]=[t,o]},e})();t.uploaderMapper=new o}),
define("modules/clean/react/file_uploader/oq_drag_drop_modal",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react/browse/store","modules/clean/react/modal","modules/clean/react_format","modules/clean/static_urls","modules/constants/file_uploader","modules/constants/payments"],function(e,t,o,r,a,s,n,i,l,u,d,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){return r.createElement("div",{className:"drag-drop-oq"},r.createElement(l.Modal,{style:"clean",className:"drag-drop-oq--modal",buttonComponent:this.renderButtons(),width:480},r.createElement("div",null,r.createElement(s,{src:d.static_url("/static/images/pro/overquota/overquota-folder-vflgFxxXj.png"),srcHiRes:d.static_url("/static/images/pro/overquota/overquota-folder@2x-vfloUmya6.png")})),this.renderTitle(),this.renderBody()))},t.prototype.isTeamUser=function(){return!!i.browseStore.user()&&i.browseStore.user().is_team},t.prototype.renderBody=function(){var e=u.reactFormat(n._("In order to finish uploading %(filename)s, you need to add more storage to your Dropbox."),{filename:this.props.oqFilename}),t=i.browseStore.context().isNonUserRelativeContext;return p.IS_MSL_TEAM&&this.isTeamUser()&&!t&&(e=u.reactFormat(n._("Your Dropbox account is full. To add this file, remove files or ask your admin for more space."))),r.createElement("div",{className:"drag-drop-oq--copy"},e)},t.prototype.renderTitle=function(){var e=n._("Your Dropbox is full"),t=i.browseStore.context().isNonUserRelativeContext;return p.IS_MSL_TEAM&&this.isTeamUser()&&!t&&(e=n._("Can’t upload file")),r.createElement("div",{className:"drag-drop-oq--header"},e)},t.prototype.renderButtons=function(){var e=c.OUT_OF_SPACE_URL+"?oqa=upl_dd",t=n._("Get more space"),o=i.browseStore.context().isNonUserRelativeContext;return p.IS_MSL_TEAM&&this.isTeamUser()&&!o&&(e="/help/business/space-limit-full",t=n._("Learn more about Dropbox space")),r.createElement("div",{className:"drag-drop-oq--buttons"},r.createElement("a",{href:e,className:"drag-drop-oq--button c-btn c-btn--primary"},t))},t})(r.Component);t.OQDragDropModal=a(m,["/static/css/browse/oq_drag_drop_upsell-vfliUOCI_.css"])}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["external/plupload_dev","external/underscore","jquery","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/mapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/sharing/ui_util","modules/core/cookies","modules/core/exception","modules/core/i18n"],function(t,o,r,a,s,n,i,l,u,d,p,c,m){var f,h,_,g,E,T,y,assert,U,v,S,b;return U=s.browseStore,f=n.FileUpload,g=n.UploadErrorTypes,b=i.uploaderMapper,E=l.UploaderStore,v=u.generateUploadId,h=d.GoldenGate,assert=c.assert,T=m._,S=window.plupload,y=function(e,t){var r,a;return null==t&&(t={}),r=o.extend({},t,e),new f({uploadId:r.uploadId,dest:r.dest,ns_id:r.ns_id,ns_path:r.ns_path,name:r.name,size:r.size,userId:r.userId,percentUploaded:null!=(a=r.percent)?a:0})},_=(function(){function t(){this.removeFiles=e(this.removeFiles,this),this.bytesPerSec=e(this.bytesPerSec,this),this.onError=e(this.onError,this),this.onFileUploaded=e(this.onFileUploaded,this),this.onUploadProgress=e(this.onUploadProgress,this),this.onFilesAdded=e(this.onFilesAdded,this),this.setBrowseButton=e(this.setBrowseButton,this),this.setAjaxParams=e(this.setAjaxParams,this),this.start=e(this.start,this),this.addFiles=e(this.addFiles,this),this.init=e(this.init,this),this.isInitialized=!1,this.sendNS=!1}return t.prototype.PLU_CONTAINER_ID="flash-upload-container",t.prototype.setSendNS=function(e){return this.sendNS=e},t.prototype.init=function(){var e;if(!this.isInitialized)return this.isInitialized=!0,this.$secretBrowseButton=r("<button>").addClass("secret-file-uploader-button").hide().appendTo(r("body")),this.$pluContainer=r("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(r("body")),this.$currentExternalBrowseButton=r(),e={url:"https://dl-web.dropbox.com/chunked_upload",file_data_name:"file",runtimes:"html5",multipart_params:{},multipart:!1,max_retries:2,browse_button:this.$secretBrowseButton[0],max_file_size:"50000mb",chunk_size:"8mb",container:this.PLU_CONTAINER_ID,init:{ChunkUploaded:(function(e){return function(t,o,r){var a,s,n;return n=b.uploadIdOf(o.id),assert(JSON.parse(r.response).upload_id===n),s=E.fileList().get(n),a={dest:s.dest,reported_total_size:s.size,uploadId:s.uploadId,_subject_uid:s.userId,offset:r.offset,overwrite:1},e.sendNS&&(a.ns_id=s.ns_id,a.ns_path=s.ns_path),e.setAjaxParams(a)}})(this)}},this.uploader=new S.Uploader(e),this.uploader.init()},t.prototype.addFiles=function(e){var t,o;return t=e.files,o=e.path,this.isInitialized||this.init(),this.uploader.addFile(t,o)},t.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},t.prototype.setAjaxParams=function(e){var t,o,r,a,s,n,i,l;if(i=e.reported_total_size,o=e.dest,l=e.uploadId,s=e.offset,t=e._subject_uid,n=e.overwrite,r=e.ns_id,a=e.ns_path,this.isInitialized||this.init(),null==i||null==o||null==l||null==s||null==t||null==n)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:p.read("__Host-js_csrf"),reported_total_size:i,dest:o,upload_id:l,offset:s,_subject_uid:t,overwrite:n,ns_id:r,ns_path:a}},t.prototype.setBrowseButton=function(e){var t;return this.isInitialized||this.init(),"flash"===this.uploader.runtime?(this.$currentExternalBrowseButton=r(e),this.$currentExternalBrowseButton.length?(r("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),t=r("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),t[0].style.top="0px",t[0].style.left="0px",t[0].style.width="100%",t[0].style.height="100%"):r("#"+this.PLU_CONTAINER_ID).hide()):(this.$currentExternalBrowseButton.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton=r(e),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",(function(e){return function(){return e.$secretBrowseButton.click()}})(this)))},t.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",(function(t){return function(o,r){var s;return a.logUploadFile({uid:E.user().id,num_files:r.length,uploader_type:"enhanced",upload_method:"chooser"}),s=r.map(function(e){var o,r,a,s,n;return n=v(),s=E.path(),""!==e.dest?s=e.dest:e.dest=E.path(),b.set(e.id,n,s),r=null,a=null,t.sendNS&&(o=t.getNsIdAndPath(s,e.name),r=o[0],a=o[1]),y(e,{uploadId:n,dest:s,userId:E.user().id,ns_id:r,ns_path:a})}),e(s)}})(this))},t.prototype.getNsIdAndPath=function(e,t){var o,r,a,s,n,i,l;return s=U.context().currentNSID,a=U.context().currentMountPoint,h.hasContentManagerCdm(E.user().id)?r=e:(i=e.split("/"),l="/"+i.slice(2).join("/"),r=l),o=r.replace(a,""),"/"===o&&(o=""),n=o+"/"+t,[s,n]},t.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",(function(t){return function(t,o){var r,a;return a=b.uploadIdOf(o.id),r=E.fileList().get(a),e(r.set("percentUploaded",o.percent))}})(this))},t.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",(function(t){return function(t,o,r){var a,s;return s=b.uploadIdOf(o.id),a=E.fileList().get(s),e(a,r)}})(this))},t.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",(function(t){return function(o,r){var a,s,n,i,l,u,d;if(null==r.file)throw new Error("PLU error without an associated file.");return s=(function(){switch(r.code){case S.FILE_SIZE_ERROR:return g.FILE_SIZE_ERROR;case S.HTTP_ERROR:return 0===r.status?g.CONNECTION_ERROR:507===r.status?g.OVER_QUOTA_ERROR:g.HTTP_ERROR;default:return g.GENERIC}})(),a=(function(){switch(s){case g.OVER_QUOTA_ERROR:return T("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case g.FILE_SIZE_ERROR:return T("This file is too large to upload using the Dropbox website. Please use the desktop client.");case g.HTTP_ERROR:return T("Something went wrong while uploading this file. There was a server error during the upload request.");case g.CONNECTION_ERROR:return T("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return T("Something went wrong while uploading this file.")}})(),d=b.uploadIdOf(r.file.id),E.fileList().has(d)?n=E.fileList().get(d):(l=null,u=null,t.sendNS&&(i=t.getNsIdAndPath(E.path(),r.file.name),l=i[0],u=i[1]),n=y(r.file,{uploadId:v(),dest:E.path(),ns_id:l,ns_path:u})),e(n,s,a)}})(this))},t.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},t.prototype.removeFiles=function(e){var t,r,a,s,n;for(r=e.files,this.isInitialized||this.init(),a=0,s=r.length;a<s;a++)t=r[a],n=o.find(this.uploader.files,(function(e){return function(e){return b.uploadIdOf(e.id)===t.uploadId}})(this)),this.uploader.removeFile(n);return this.uploader.stop(),this.uploader.start()},t})(),new _})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/uploader",["jquery","external/react","external/react-dom","external/underscore","modules/clean/analytics","modules/clean/ajax","modules/clean/browse/browse_drag_utils","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react/browse/actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/oq_drag_drop_modal","modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/modal","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/react/file_uploader/file_uploader_modal","modules/clean/react/file_uploader/inline_upload_status"],function(t,o,r,a,s,n,i,l,u,d,p,c,m,f,h,_,g,E,T,y,U,v,S,b,N,D,w){var L,I,O,A,F,M,R,P,x,C,B,k,q,Q,z,G,V,j,H,Y,W,$;return B=s.TeamsWebActionsLogger,V=p.browseActions,j=m.browseStore,q=f.UploaderActions,I=h.FileStatusTypes,F=h.INTERNAL_FILE_DATA_TRANSFER_TYPE,C=h.OverQuotaStatusTypes,k=h.UploadErrorTypes,x=_.OQDragDropModal,P=g.NearquotaUploadModal,g.NearquotaUploadAltAction,Q=E.UploaderStore,R=y.Modal,z=S._,A=D.FileUploaderModal,M=w.InlineUploadStatus,L=c.BrowseLogEventSources,H=o.createElement,$=o.DOM,$.div,$.a,$.form,Y=o.DOM,G=function(e){var t,o,r,a,s,n,i;return null==e&&(e={}),n=e.user,r=e.path,o=null!=(a=e.maxLength)?a:1e3,i=U.get_viewer(),i.is_paired&&n.is_team&&(s=i.team_name),"/"===r?i.is_paired?n.is_team?z(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:s}):z(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):z(" upload to your Dropbox"):(t=l.em_snippet(u.filename(r),o),i.is_paired?n.is_team?z(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:s}):z(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):z(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},W=null,O=o.createClass({displayName:"FileUploader",mixins:[d(Q)],propTypes:{dragAndDropEnabled:o.PropTypes.bool,shouldShowDestinationLink:o.PropTypes.bool,onFileUploadComplete:o.PropTypes.func,onAllFileUploadsComplete:o.PropTypes.func,onModalDismissed:o.PropTypes.func,clickOutToClose:o.PropTypes.bool,sendNS:o.PropTypes.bool,expSubgrowthProNearquotaUploadModal:o.PropTypes.string},statics:{showModal:function(){return W?W.showModal():void console.warn("Tried to show the file upload modal, but no FileUploader component has been instantiated on the page yet.")},showOOQModal:function(){return W?W.showOOQModal():void console.warn("Tried to show the out of quota modal, but no FileUploader component has been instantiated on the page yet.")},showModalWithTeamOnboarding:function(){if(W)return W.setState({isTeamOnboarding:!0},W.showModal)},setBrowseButton:function(e){if(W)return W.setBrowseButton(e)}},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onFileUploadComplete:function(){},onAllFileUploadsComplete:function(){},onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1}},getInitialState:function(){return{isTeamOnboarding:!1,hasOverquotaError:!1,userQuotaUsageRatio:0,tsdQuotaUsageRatio:0,numTeamMembers:0,numTeamAdmins:0,teamAdminEmail:"",teamAdminFname:"",promptAdminToUpgradeEmailTemplateUrl:"",seenNearquotaModal:!1,overQuotaStatus:C.NONE}},_get_state_from_stores:function(){return{path:Q.path(),user:Q.user(),fileList:Q.fileList(),numDraggingFiles:Q.numDraggingFiles(),isInternalTransfer:Q.isInternalTransfer(),currentUpload:Q.currentUpload(),isUploadModalOpen:Q.isUploadModalOpen(),numSecondsLeft:Q.numSecondsLeft(),isInlineStatusDismissed:Q.isInlineStatusDismissed(),hasPermissionToUploadToFolder:Q.hasPermissionToUploadToFolder()}},INLINE_STATUS_CONTAINER_CLASS:"inline-upload-status-container",showModal:function(){var e;if(this.fetchQuotaUpsellInfo(),0!==this.state.fileList.count()||(e=this.state.overQuotaStatus)!==C.NONE&&e!==C.BASIC_NEAR_QUOTA)return R.showInstance(H(A,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose,isTeamOnboarding:this.state.isTeamOnboarding,sendNS:this.props.sendNS,expSubgrowthProNearquotaUploadModal:this.props.expSubgrowthProNearquotaUploadModal,numTeamMembers:this.state.numTeamMembers,numTeamAdmins:this.state.numTeamAdmins,teamAdminEmail:this.state.teamAdminEmail,teamAdminFname:this.state.teamAdminFname,promptAdminToUpgradeEmailTemplateUrl:this.state.promptAdminToUpgradeEmailTemplateUrl,overQuotaStatus:this.state.overQuotaStatus})),q.setIsUploadModalOpen({isUploadModalOpen:!0})},_showNearquotaModal:function(){return R.showInstance(H(P,{onDismiss:this._dismissNearquotaModal,onAccept:this._acceptNearquotaModal})),this.setState({seenNearquotaModal:!0})},_acceptNearquotaModal:function(e){return e.preventDefault(),this.showModal()},_dismissNearquotaModal:function(e){return q.setIsUploadModalOpen({isUploadModalOpen:!1})},showOOQModal:function(){var e,t,o;return e=this.state.fileList.toArray().filter(function(e){return e.errorType===k.OVER_QUOTA_ERROR||e.errorType===k.GENERIC}),t=(null!=e&&null!=(o=e[e.length-1])?o.name:void 0)||z("this file"),R.showInstance(H(x,{oqFilename:t}))},componentWillMount:function(){if(W)throw new Error("Only one FileUploader component may be rendered to the page at any time. You have tried to instantiate multiple uploaders.");return W=this},componentDidMount:function(){var o;if(q.initPLU(),q.setSendNS(this.props.sendNS),this.dragEnterCount=0,this.lastEnteredElement=null,o=t(document),o.on("dragover.fileUploader",function(e){return e.preventDefault(),e.stopPropagation()}).on("dragenter.fileUploader",(function(t){return function(o){var r,s,n,i;if(o.preventDefault(),o.stopPropagation(),o.target!==t.lastEnteredElement)return t.lastEnteredElement=o.target,t.dragEnterCount+=1,n=(function(){var e;try{return null!=(e=o.originalEvent.dataTransfer.mozItemCount)?e:Object.keys(o.originalEvent.dataTransfer.items).length}catch(e){return 1}})(),i=o.originalEvent.dataTransfer.types,r=["Files","application/x-moz-file",F,"text/x-moz-url","text/uri-list","Url"],null!=i&&(null!=i.indexOf&&a.intersection(i,r).length>0||i instanceof DOMStringList&&(i.contains("Files")||i.contains("text/x-moz-url")||i.contains(F)||v.msie&&(i.contains("Text")||i.contains("text/plain"))))?(s=e.call(i,F)>=0||e.call(i,"text/plain")>=0||i instanceof DOMStringList&&(i.contains("Text")||i.contains("text/plain")),q.setNumDraggingFiles({numDraggingFiles:n,isInternalTransfer:s})):void 0}})(this)).on("dragleave.fileUploader",(function(e){return function(t){if(t.preventDefault(),t.stopPropagation(),e.lastEnteredElement=null,e.dragEnterCount-=1,e.dragEnterCount<1)return e.dragEnterCount=0,q.setNumDraggingFiles({numDraggingFiles:0})}})(this)).on("drop.fileUploader",this._handleFileDrop),t("<div>").addClass(this.INLINE_STATUS_CONTAINER_CLASS).prependTo(t("#page-content")),t(window).on("beforeunload.fileUploader",(function(e){return function(t){var o,r;return o=null!=e.state.fileList.find(function(e){var t;return(t=e.status)===I.PENDING||t===I.UPLOADING}),o&&e.state.fileList.count()>0?(r=z("Leaving this page will cancel your uploads."),t.returnValue=r,r):void 0}})(this)),this.state.user)return this.fetchQuotaUpsellInfo()},updateInlineStatus:function(){var e,o,a,s;return s=null!=this.state.fileList.find(function(e){var t;return(t=e.status)===I.PENDING||t===I.UPLOADING}),a=!this.state.isUploadModalOpen&&(s||this.state.fileList.count()>0&&!s&&!this.state.isInlineStatusDismissed),e=t("."+this.INLINE_STATUS_CONTAINER_CLASS),a?r.render(H(M,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this._handleInlineStatusViewDetails,numSecondsLeft:this.state.numSecondsLeft}),e[0]):(o=e[0])?r.unmountComponentAtNode(o):void 0},componentWillReceiveProps:function(e){if(this.showOverquotaError())return this.setState({hasOverquotaError:!0,isInlineStatusDismissed:!0})},componentWillUpdate:function(e,t){var o,r,a;if(null==t.currentUpload&&null!=this.state.currentUpload&&("function"==typeof(o=this.props).onFileUploadComplete&&o.onFileUploadComplete(this.state.currentUpload),this.state.isTeamOnboarding&&B.log("uploaded_file")),t.fileList!==this.state.fileList&&(a=null!=t.fileList.find(function(e){var t;return(t=e.status)===I.PENDING||t===I.UPLOADING}),!a&&t.fileList.count()>0&&("V2"!==this.props.expSubgrowthProNearquotaUploadModal||this.state.seenNearquotaModal||this._showNearquotaModal(),"function"==typeof(r=this.props).onAllFileUploadsComplete&&r.onAllFileUploadsComplete(this.state.fileList))),!this.state.hasOverquotaError&&t.hasOverquotaError)return this.showOOQModal()},componentDidUpdate:function(e,o){var r,a;if(r=t(".external-drop-indicator"),this.state.numDraggingFiles&&!this.state.isInternalTransfer?(o.numDraggingFiles||r.css("opacity",0).fadeTo(500,.6),this.state.hasPermissionToUploadToFolder?r.removeClass("external-drop-indicator--uploads-disabled"):r.addClass("external-drop-indicator--uploads-disabled"),this.state.isUploadModalOpen||(this.state.hasPermissionToUploadToFolder?(a=z("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:G({user:this.state.user,path:this.state.path})}),b.success(a,60)):b.error(z("You don’t have permission to add to this folder.")))):!this.state.numDraggingFiles&&o.numDraggingFiles&&(r.hide().removeClass("external-drop-indicator--uploads-disabled"),b.clear()),this.updateInlineStatus(),!o.user&&this.state.user&&this.fetchQuotaUpsellInfo(),o.overQuotaStatus!==!this.state.overQuotaStatus||this.state.overQuotaStatus!==!C.NONE||this.state.overQuotaStatus!==!C.BASIC_NEAR_QUOTA||Q.isUploadModalOpen()||this.setBrowseButton(!1),0===o.fileList.count()&&this.state.fileList.count()>0)return this.setBrowseButton(!1)},fetchQuotaUpsellInfo:function(){return n.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:this.state.user.id},success:(function(e){return function(t){return t=JSON.parse(t),e.setState({userQuotaUsageRatio:t.user_quota_usage_ratio,tsdQuotaUsageRatio:t.tsd_quota_usage_ratio,promptAdminToUpgradeEmailTemplateUrl:t.prompt_admin_to_upgrade_email_template_url,numTeamMembers:t.num_team_members,numTeamAdmins:t.num_team_admins,teamAdminEmail:t.team_admin_email,teamAdminFname:t.team_admin_fname}),e.fetchOverQuotaStatus()}})(this)})},fetchOverQuotaStatus:function(){var e;return e=C.NONE,0===this.state.user.paid&&("personal"===this.state.user.role?this.state.userQuotaUsageRatio>1?e=C.BASIC_OVER_QUOTA:this.state.userQuotaUsageRatio>.9&&(e=C.BASIC_NEAR_QUOTA):this.state.user.is_team&&U.get_viewer().team_is_limited&&(this.state.user.is_cdm_member&&!this.state.path.startsWith(this.state.user.cdm_tmf_path)?this.state.tsdQuotaUsageRatio>1&&(e=C.LIMITED_TEAM_TSD_OVER_QUOTA):this.state.userQuotaUsageRatio>1&&(e=C.LIMITED_TEAM_USER_OVER_QUOTA))),this.setState({overQuotaStatus:e})},setBrowseButton:function(e){var o;return this.fetchQuotaUpsellInfo(),e||Q.isUploadModalOpen()?0!==this.state.fileList.count()||(o=this.state.overQuotaStatus)!==C.NONE&&o!==C.BASIC_NEAR_QUOTA?void 0:T.setBrowseButton(t(".action-upload")):T.setBrowseButton(null)},componentWillUnmount:function(){return t(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),t("."+this.INLINE_STATUS_CONTAINER_CLASS).remove(),t(window).off("beforeunload.fileUploader"),W=null},_handleFileDrop:function(e){var t,o,r,a,s,n,l,u,d,p,m,f,h,_,g,E,T,y,U,S,D,w,O,A,F,M,R,P;if(e.preventDefault(),e.stopPropagation(),this.dragEnterCount=0,this.lastEnteredElement=null,q.setNumDraggingFiles({numDraggingFiles:0}),t=e.originalEvent.dataTransfer,o=v.msie?"text":"application/x-dropbox-file-list",g=t.getData(o),null!=g)try{if(F=JSON.parse(g),P=F.userId,h=F.fromPath,p=F.filePaths,(null!=p?p.length:void 0)>0&&null!=h&&null!=P){if(j.context().isNonUserRelativeContext)return;return this.state.hasPermissionToUploadToFolder?P!==this.state.user.id?void b.error(z("You can’t move or copy files here from another Dropbox.")):(R=e.ctrlKey||e.altKey,void(R?V.copyFiles({files:p.map(function(e){return{fq_path:e}}),newPath:this.state.path}):h!==this.state.path&&(c.logMoveFiles({uid:P,path:h,files:p,newPath:this.state.path,source:L.DRAG}),V.moveFiles({path:h,files:p.map(function(e){return{fq_path:e}}),newPath:this.state.path})))):void b.error(z("You don’t have permission to add to this folder."))}}catch(e){}if(this.state.hasPermissionToUploadToFolder){if(a=i.getDraggedLink(t),null!=a)return A=i.buildUrlLinkfileContents(a),O=new Blob([A],{type:"text/plain"}),w=N.parse(a).getAuthority(),O.name=w+".url",O.overwrite=!1,c.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),void q.addFilesToPLU({files:[O]});if(T=t.items,m=t.files,null!=(null!=T&&null!=(M=T[0])?M.webkitGetAsEntry:void 0)){for(n=(function(){var e,t,o;for(o=[],_=e=0,t=T.length;0<=t?e<t:e>t;_=0<=t?++e:--e)o.push(T[_].webkitGetAsEntry());return o})(),u=(function(){var e,t,o;for(o=[],e=0,t=n.length;e<t;e++)s=n[e],(null!=s?s.isFile:void 0)&&o.push(s);return o})(),r=(function(){var e,t,o;for(o=[],e=0,t=n.length;e<t;e++)s=n[e],(null!=s?s.isDirectory:void 0)&&o.push(s);return o})(),c.logUploadFile({uid:this.state.user.id,num_files:u.length,num_dirs:r.length,uploader_type:"drag",upload_method:"drag"}),y=0,S=u.length;y<S;y++)d=u[y],d.file(function(e){return q.addFilesToPLU({files:[e]})});if(r.length>0)return q.addDirectoriesToPLU({directoryEntries:r})}else if(null!=(null!=m?m.length:void 0)){for(E=function(e){return null!=e&&null!=e.type&&null!=e.size&&""===e.type&&e.size%4096===0},m=(function(){var e,t,o;for(o=[],_=e=0,t=m.length;0<=t?e<t:e>t;_=0<=t?++e:--e)o.push(m.item(_));return o})(),f=(function(e){return function(){var t;if(E(l))return t=new FileReader,t.onerror=function(){var t,o;if(t=null!=(o=e.state.fileList.find(function(e){var t;return((t=e.status)===I.PENDING||t===I.UPLOADING)&&e.name===l.name}))?o.toJS():void 0,null!=t)return q.manuallySetInErrorState({file:t,errorType:k.EMPTY_OR_FOLDER,errorMessage:z("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")})},t.readAsArrayBuffer(l)}})(this),U=0,D=m.length;U<D;U++)l=m[U],f();return c.logUploadFile({uid:this.state.user.id,num_files:m.length,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),q.addFilesToPLU({files:m})}}},_handleInlineStatusViewDetails:function(){return this.showModal()},showOverquotaError:function(){var e,t;return(null!=(e=this.state.fileList)&&null!=(t=e.last())?t.errorType:void 0)===k.OVER_QUOTA_ERROR},render:function(){return Y.div({})}}),{FileUploader:O}})}.call(this),define("modules/clean/react/file_uploader/uploader_modal",["require","exports","tslib","external/classnames","external/react-dom","external/react","jquery","modules/clean/browse_interface","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/tooltip","modules/clean/react/sprite","modules/core/i18n","modules/clean/viewer","modules/clean/static_urls","modules/constants/file_uploader"],function(e,t,o,r,a,s,n,i,l,u,d,p,c,m,f,h,_,g,E,T,y,U,v,S,b,N,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleStoreChanged=function(){r.setState(r.getStateFromStores())},r.handleClose=function(){r.isSomethingUploading()||m.UploaderActions.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),m.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),y.Modal.close(),r.props.onModalDismissed&&r.props.onModalDismissed()},r.handleCancel=function(e){return m.UploaderActions.cancelUploads({files:[e]})},r.handleDismiss=function(){m.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1})},r.state=o.__assign({},r.getStateFromStores(),{overQuotaStatus:f.OverQuotaStatusTypes.NONE}),r}return o.__extends(t,e),t.prototype.getStateFromStores=function(){return{path:_.UploaderStore.path(),user:_.UploaderStore.user(),fileList:_.UploaderStore.fileList(),numDraggingFiles:_.UploaderStore.numDraggingFiles(),currentUpload:_.UploaderStore.currentUpload(),numSecondsLeft:_.UploaderStore.numSecondsLeft(),hasPermissionToUploadToFolder:_.UploaderStore.hasPermissionToUploadToFolder()}},t.prototype.componentDidMount=function(){var e=this;_.UploaderStore.add_change_listener(this.handleStoreChanged),this.setBrowseButton(),setTimeout(function(){n(window).on("resize.uploaderModal",function(){e.setBrowseButton()})},250)},t.prototype.componentDidUpdate=function(e,t){this.setBrowseButton();var o=this.refs.modal,r=o.refs.modalBox,s=n(r).find("#upload-modal-dropzone");if(this.state.numDraggingFiles?s.length||n("#upload-modal-dropzone").clone().prependTo(n(r)).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1):s.remove(),this.state.fileList.count()>t.fileList.count()){var i=n(a.findDOMNode(this.refs.uploadFilesList)),l=void 0;i.find(".upload-file")&&(l=i.find(".upload-file").eq(t.fileList.count())),l&&l.length&&i.scrollTop(i.scrollTop()+l.position().top)}},t.prototype.componentWillUnmount=function(){g.setBrowseButton(null),_.UploaderStore.remove_change_listener(this.handleStoreChanged),n(window).off("resize.uploaderModal")},t.prototype.setBrowseButton=function(){var e=a.findDOMNode(this.refs.pluFileChooseButton);g.setBrowseButton(e),n(e).focus()},t.prototype.isSomethingUploading=function(){return this.state.fileList.some(function(e){return e.status===f.FileStatusTypes.PENDING||e.status===f.FileStatusTypes.UPLOADING})},t.prototype.renderFileChooseButton=function(){var e=S._("Add more files");return s.createElement("button",{ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},e)},t.prototype.renderDoneButton=function(){var e=this.isSomethingUploading(),t=e?"c-btn--tertiary":"c-btn--primary",o=e?S._("Hide"):S._("Done"),a=r("dbmodal-button","c-btn",t);return s.createElement("button",{className:a,onClick:this.handleClose},o)},t.prototype.renderModalButtons=function(){var e,t=this.isSomethingUploading();return t||(e=S._("Having problems? Please try again.")),s.createElement("div",{className:"u-mar-top-s"},s.createElement(E.Flag,{leftAttachment:this.renderFileChooseButton(),rightAttachment:this.renderDoneButton(),spacing:"s"},s.createElement("div",{className:"u-font-small"},e)))},t.prototype.makeUploadSnippet=function(e){var t,o=this.state,r=o.user,a=o.path,s=b.get_viewer();return s.is_paired&&r.is_team&&(t=s.team_name),s.is_paired?r.is_team?this.makeTeamSnippet(a,e,t):this.makePersonalSnippet(a,e):this.makeUnpairedSnippet(a,e)},t.prototype.makeTeamSnippet=function(e,t,o){var r=d.em_snippet(p.filename(e),t);return"/"===e?S._("upload to your %(team_name)s Dropbox").format({team_name:o}):S._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox").format({folder:r,team_name:o})},t.prototype.makePersonalSnippet=function(e,t){var o=d.em_snippet(p.filename(e),t);return"/"===e?S._("upload to your personal Dropbox"):S._("upload to the folder ‘%(folder)s’ in your personal Dropbox").format({folder:o})},t.prototype.makeUnpairedSnippet=function(e,t){var o=d.em_snippet(p.filename(e),t);return"/"===e?S._("upload to your Dropbox"):S._("upload to the folder ‘%(folder)s’").format({folder:o})},t.prototype.renderDropzone=function(){var e=S.ungettext("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles).format({upload_action:this.makeUploadSnippet(20)});return s.createElement("div",{ref:"dropzone",id:"upload-modal-dropzone",style:{display:"none"}},e)},t.prototype.createCancelFileHandler=function(e){var t=this;return function(o){return o.preventDefault(),t.handleCancel(e)}},t.prototype.renderFileListRowStatus=function(e){return e.status===f.FileStatusTypes.UPLOADING&&100===e.percentUploaded?s.createElement("div",{className:"status-col"},s.createElement(T,{src:N.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:N.static_url("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")})):e.status===f.FileStatusTypes.PENDING||e.status===f.FileStatusTypes.UPLOADING?s.createElement("div",{className:"status-col"},s.createElement("button",{className:"button-as-link",onClick:this.createCancelFileHandler(e)},s.createElement(v,{group:"web",name:"xclose",alt:S._("Cancel")}))):e.status===f.FileStatusTypes.COMPLETE?s.createElement("div",{className:"status-col"},s.createElement(v,{group:"web",name:"s_check",alt:S._("Upload successful")})):e.status===f.FileStatusTypes.CANCELLED?s.createElement("div",{className:"status-col"},s.createElement(T,{src:N.static_url("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:N.static_url("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:S._("Upload cancelled")})):e.status===f.FileStatusTypes.FAILED?s.createElement("div",{className:"status-col"},s.createElement(T,{src:N.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:N.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:S._("Error")})):s.createElement("div",{className:"status-col"})},
t.prototype.renderFileListRowError=function(e){var t;t=e.errorMessage&&e.errorMessage.length>0?e.errorMessage:S._("Something went wrong while uploading this file.");var o;o=e.errorType===f.UploadErrorTypes.FILE_SIZE_ERROR?S._("File too large"):S._("Upload Error");var r=c.browseStore.context().isNonUserRelativeContext;return D.IS_MSL_TEAM&&this.state.user.is_team&&e.errorType===f.UploadErrorTypes.OVER_QUOTA_ERROR&&!r&&(t=S._("Your Dropbox account is full. To add this file, remove files or ask your admin for more space."),o=S._("Can’t upload file")),s.createElement("div",{className:"error-col"},s.createElement("span",{className:"error-msg"},o),s.createElement("span",{className:"error-details"},s.createElement(U.Tooltip,{position:U.TooltipPosition.RIGHT,tooltip_contents:s.createElement("div",{},t),tooltip_classname:"upload-error-tooltip"},s.createElement(v,{group:"web",name:"information",alt:S._("More information")}))))},t.prototype.renderFileListRowDest=function(e){if(e.status===f.FileStatusTypes.CANCELLED)return s.createElement("div",{className:"dest-col"},S._("Canceled"));var t=void 0,o=b.get_viewer().get_user_by_id(e.userId);t=c.browseStore.context().isNonUserRelativeContext?"":i.get_browse_root_name(o);var r=d.em_snippet(t+e.dest,13,0);return s.createElement("div",{className:"dest-col"},s.createElement("a",{href:i.browse_uri_for_fq_path(o,e.dest).toString()},r))},t.prototype.renderFileListRowContent=function(e,t){return e.status!==f.FileStatusTypes.FAILED&&t?this.renderFileListRowDest(e):this.renderFileListRowError(e)},t.prototype.renderFileListRow=function(e,t){var o;o=e.status===f.FileStatusTypes.UPLOADING?e.percentUploaded:e.status===f.FileStatusTypes.PENDING?0:100;var a={"upload-file":!0,complete:e.status===f.FileStatusTypes.COMPLETE,cancelled:e.status===f.FileStatusTypes.CANCELLED,error:e.status===f.FileStatusTypes.FAILED},n=r(a),i=d.em_snippet(e.name,15),l=e.size?"-"+u.format_bytes(e.size):"";return s.createElement("li",{className:n,key:e.uploadId},s.createElement("div",{className:"upload-progress-bar",style:{width:o+"%"}}),s.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},s.createElement("div",{className:"filename-col"},s.createElement(v,{group:"web",name:p.file_icon(e.name),alt:""}),s.createElement("span",{className:"filename"}," ",i," "),s.createElement("span",{className:"size"}," ",l," ")),this.renderFileListRowContent(e,t),this.renderFileListRowStatus(e)))},t.prototype.renderFileList=function(e,t){var o=this;return s.createElement("ol",{ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},e.map(function(e){return o.renderFileListRow(e,t)}))},t.prototype.renderTimeLeft=function(){var e=this.state.currentUpload,t=S._("%(time_left)s left").format({time_left:l.format_time(this.state.numSecondsLeft)});if(e&&e.status===f.FileStatusTypes.UPLOADING)return s.createElement("div",{style:{marginTop:8,textAlign:"right"}},t)},t.prototype.renderTitle=function(){return this.props.isTeamOnboarding?S._("Which files would you like to add?"):this.state.user.is_cdm_member&&this.props.overQuotaStatus in[f.OverQuotaStatusTypes.LIMITED_TEAM_USER_OVER_QUOTA,f.OverQuotaStatusTypes.LIMITED_TEAM_TSD_OVER_QUOTA]?S._("More space needed"):S._("Upload to Dropbox")},t.prototype.getAltAction=function(){if("V1"===this.props.expSubgrowthProNearquotaUploadModal){if(this.state.fileList.some(function(e){return e.status===f.FileStatusTypes.COMPLETE})&&this.props.overQuotaStatus===f.OverQuotaStatusTypes.BASIC_NEAR_QUOTA)return s.createElement(h.NearquotaUploadAltAction,null)}return null},t.prototype.render=function(){return s.createElement("div",{ref:"container"},this.renderDropzone(),s.createElement(y.Modal,{ref:"modal",title:this.renderTitle(),showX:!1,clickOutToClose:this.props.clickOutToClose,altAction:this.getAltAction(),buttonComponent:this.renderModalButtons(),onDismiss:this.handleDismiss},this.renderFileList(this.state.fileList.toArray(),this.props.shouldShowDestinationLink),this.renderTimeLeft()))},t})(s.PureComponent);w.defaultProps={dragAndDropEnabled:!0,shouldShowDestinationLink:!0,clickOutToClose:!0,isTeamOnboarding:!1,overQuotaStatus:f.OverQuotaStatusTypes.NONE},t.UploaderModal=w});
//# sourceMappingURL=pkg-file_uploader.min.js-vflbb_wlX.map