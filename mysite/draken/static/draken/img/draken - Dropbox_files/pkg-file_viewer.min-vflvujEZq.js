define("modules/clean/abuse/report_flag",["require","exports","tslib","external/react","modules/clean/react/title_bubble","modules/clean/react/css","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getHref=function(){var e={};return this.props.sharedLink&&(e.ssu=this.props.sharedLink),new a({scheme:"https",authority:"www.dropbox.com",path:"/report_abuse",query:e}).toString()},t.prototype.render=function(){return o.createElement(i,{content:s._("Report an issue"),position:i.POSITIONS.RIGHT,distanceFromTarget:5,isTargetPositionFixed:!0},o.createElement("div",{className:"report-flag"},o.createElement("a",{href:this.getHref(),rel:"noopener noreferrer",className:"flag-link",target:"_blank",title:s._("Report as issue")}," ")))},t})(o.Component),c=r(l,["/static/css/abuse/report_flag-vflt1ytDn.css"]);t.ReportFlag=c}),define("modules/clean/accounts/api",["require","exports","tslib","modules/clean/ajax_util","modules/clean/api_v2/client"],function(e,t,n,o,i){"use strict";function r(e){return{accounts:e.map(s)}}function s(e){return{accountId:e.account_id,name:{givenName:e.name.given_name,surname:e.name.surname,displayName:e.name.display_name,familiarName:e.name.familiar_name,abbreviatedName:e.name.abbreviated_name},email:e.email,isEmailVerified:e.email_verified,profilePhotoUrl:e.profile_photo_url,isDisabled:e.disabled,isTeammate:e.is_teammate,teamMemberId:e.team_member_id}}function a(e,t){return n.__awaiter(this,void 0,void 0,function(){var s,a,l;return n.__generator(this,function(n){switch(n.label){case 0:return s=new i.ApiV2Client,a=e.id,[4,o.requestWithRetry(function(){return s.rpc(a,"users/get_account_batch",{account_ids:t})})];case 1:return l=n.sent(),[2,r(l)]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAccountsByIds=a}),define("modules/clean/accounts/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AccountsAction={FetchAccountsSuccess:"FetchAccountsSuccess"}}),define("modules/clean/accounts/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.accountsDispatcher=n}),define("modules/clean/accounts/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/accounts/constants","modules/clean/accounts/dispatcher"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){var n=e.call(this,t)||this;return n.accountsById={},n}return n.__extends(t,e),t.prototype.get=function(e){return this.accountsById[e]},t.prototype.handleFetchAccountsSuccess=function(e){var t=this;e.accounts.forEach(function(e){t.accountsById[e.accountId]=e}),this.__emitChange()},t.prototype.__onDispatch=function(e){e.action.type===i.AccountsAction.FetchAccountsSuccess&&this.handleFetchAccountsSuccess(e.action.data)},t})(o);t.accountsStore=new s(r.accountsDispatcher)}),define("modules/clean/activity/activity_user",["require","exports","tslib","external/deep-freeze","modules/clean/comments/lib/type_check","modules/clean/immutability_helper","modules/core/types","modules/core/i18n","modules/core/user_i18n","modules/clean/em_string"],function(e,t,n,o,i,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.id,i=void 0===n?null:n,r=t.fname,s=void 0===r?null:r,a=t.lname,l=void 0===a?null:a,c=t.display_name,u=void 0===c?null:c,p=t.email,d=void 0===p?null:p,h=t.photo_url,_=void 0===h?null:h,m=t.photo_circle_url,f=void 0===m?null:m,v=t.initials,g=void 0===v?null:v,y=t.is_email_verified,E=void 0!==y&&y,S=t.is_signed_in,b=void 0!==S&&S;this.id=i,this.fname=s,this.lname=l,this.display_name=u,this.email=d,this.photo_url=_,this.photo_circle_url=f,this.initials=g,this.is_email_verified=E,this.is_signed_in=b,o(this)}return e.fromDict=function(t){return new e(r.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!!t.id}))},e.fromUser=function(t){return new e(r.merge(t,{initials:l.getInitials(t.display_name),is_signed_in:!0}))},e.fromEmail=function(t){return new e({email:t})},Object.defineProperty(e,"anonymous",{get:function(){return e.__anonymous},enumerable:!0,configurable:!0}),e.prototype.getDisplayIdentity=function(){return null!=this.display_name?c.em_snippet(this.display_name,22):null!=this.email?c.em_snippet(this.email,22):a._("Anonymous user")},e})();u.__anonymous=new u,n.__decorate([i.takes({id:Number,fname:String,lname:String,display_name:String,email:String,photo_url:s.Maybe(String),photo_circle_url:s.Maybe(String)})],u,"fromDict",null),t.ActivityUser=u}),define("modules/clean/activity/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.SHARED_LINK_VIEW=1]="SHARED_LINK_VIEW",e[e.BROWSE_FILE_VIEWER=3]="BROWSE_FILE_VIEWER",e[e.SHARED_CONTENT_LINK_VIEW=7]="SHARED_CONTENT_LINK_VIEW"})(t.ActivityContext||(t.ActivityContext={}))}),define("modules/clean/ajax_util",["require","exports","modules/clean/window_util"],function(e,t,n){"use strict";function o(e){return new Promise(function(t,o){function i(){return e().then(t)}var r=!1;n.onBeforeUnload(function(){r=!0}),i().catch(function(e){r?n.onPageRestore(function(){i().catch(o)}):o(e)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.requestWithRetry=o}),function(){define("modules/clean/annotations/annotation",["external/underscore"],function(e){var t,n,o;return o={MARKER:0,HIGHLIGHT:1,REGION:2},n={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}},t=(function(){function e(e,t,n){null==e&&(e=null),null==t&&(t=null),null==n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n,o;return n=new e,n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=(o=t.viewportCoordinates)?o:[],n.thumbnail_url=t.thumbnail_url,n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e;return e={type:this.type,subtype:this.subtype},this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===o.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){var e;switch(this.type){case o.MARKER:return e=this.getFirstViewportCoordinates(),{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case o.HIGHLIGHT:return this._getViewportBoundingRectangle();case o.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,o){var i;return null==n&&(n=0),null==o&&(o=0),i=this.getBoundingBox(),i.left=i.left-n,i.right=i.right-n,i.top=i.top-o,i.bottom=i.bottom-o,i.top=Math.min(Math.max(i.top,0),t-1),i.right=Math.min(Math.max(i.right,0),e-1),i.bottom=Math.min(Math.max(i.bottom,0),t-1),i.left=Math.min(Math.max(i.left,0),e-1),i},e.prototype._getViewportBoundingRectangle=function(){var e,t,n,o,i,r,s,a,l,c,u;for(l=s=this.getFirstViewportCoordinates().x,c=a=this.getFirstViewportCoordinates().y,u=this.viewportCoordinates,n=0,i=u.length;n<i;n++)for(e=u[n],o=0,r=e.length;o<r;o++)t=e[o],l=Math.min(l,t.x),s=Math.max(s,t.x),c=Math.min(c,t.y),a=Math.max(a,t.y);return{top:c,right:s,bottom:a,left:l}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){var e,t;return null!=(e=this.image_coordinates)&&null!=(t=e[0].coordinates)?t[0]:void 0},e.prototype.getFirstPdfCoordinates=function(){var e;return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=(e=this.pdf_coordinates[0].coordinates)?e[0]:void 0},e.prototype.getFirstPdfPage=function(){var e;return this.isOldCoordinatesFormat()?null!=(e=this.pdf_coordinates)?e.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===o.MARKER?this.annotationSize:null},e})(),{Annotation:t,AnnotationTypes:o,AnnotationSubtypes:n}})}.call(this),function(){define("modules/clean/annotations/annotation_controller",["external/react","external/react-dom","modules/clean/annotations/annotation","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_region","jquery"],function(e,t,n,o,i,r,s){var a,l,c;return n.Annotation,a=n.AnnotationTypes,n.AnnotationSubtypes,c=e.DOM,l="ephemeral-annotation-container",e.createClass({displayName:"AnnotationController",propTypes:{controllerEventHandlers:e.PropTypes.object,onAnnotationPlacedCallback:e.PropTypes.func,onAnnotationHiddenCallback:e.PropTypes.func,onAnnotationStartDragCallback:e.PropTypes.func,onAnnotationEndDragCallback:e.PropTypes.func,onAnnotationScrollCallback:e.PropTypes.func,onAnnotationScaleChangeCallback:e.PropTypes.func,onAnnotationEnterCallback:e.PropTypes.func,onAnnotationLeaveCallback:e.PropTypes.func,isAnnotationMarkerEnabled:e.PropTypes.bool,isAnnotationHighlightEnabled:e.PropTypes.bool,isAnnotationRegionEnabled:e.PropTypes.bool,isAnnotationCreationEnabled:e.PropTypes.bool,parentContainerOffset:e.PropTypes.object,draftAnnotationVersion:e.PropTypes.number},getInitialState:function(){return{activeAnnotationType:null}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},hasVisibleActiveAnnotation:function(){return null!=this.refs.activeAnnotation},componentWillMount:function(){return this.allowAnnotationTypeSwitch=!0,this.isMouseDown=!1,this.positionAtLastMouseDown={}},componentDidMount:function(){var e,t,n,o,i,r;return null!=(e=this.props.controllerEventHandlers)&&(e.onHideAnnotation=this.onHideAnnotation),null!=(t=this.props.controllerEventHandlers)&&(t.onMouseMoveCallback=this.onMouseMoveCallback),null!=(n=this.props.controllerEventHandlers)&&(n.onMouseDownCallback=this.onMouseDownCallback),null!=(o=this.props.controllerEventHandlers)&&(o.onMouseUpCallback=this.onMouseUpCallback),null!=(i=this.props.controllerEventHandlers)&&(i.onScrollCallback=this.onScrollCallback),null!=(r=this.props.controllerEventHandlers)?r.onScaleChangeCallback=this.onScaleChangeCallback:void 0},_getViewerX:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageX:void 0)||0},_getViewerY:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageY:void 0)||0},_getEventPosition:function(e){return{x:e.pageX,y:e.pageY}},_allowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!0},_disallowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!1},_trySetActiveAnnotationType:function(e,t){return e!==this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},(function(e){return function(){return"function"==typeof t?t():void 0}})(this)),!0):("function"==typeof t&&t(),!1)},_isOnRegion:function(e){var n;return n=t.findDOMNode(this.refs.activeAnnotation),null!=n&&(e.target===n||s.contains(n,e.target))},_isAnnotationTypeCreationEnabled:function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case a.MARKER:return this.props.isAnnotationMarkerEnabled;case a.HIGHLIGHT:return this.props.isAnnotationHighlightEnabled;case a.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},_isOnText:function(e){var t,n,o,i,r,a,l,c;if(o=s(e.target),t=o.contents(),n=(null!=(c=o.css("cursor"))?c:"").split(","),n=n[n.length-1].trim(),"text"===n||"vertical-text"===n||o.is("a")&&0===t.length)return!0;if("auto"!==n)return!1;for(r=!1,a=0,l=t.length;a<l;a++)i=t[a],i.nodeType===Node.TEXT_NODE&&(r=!0);return r},_deselectAllText:function(){var e,t;return null!=(t=document.selection)&&"function"==typeof t.empty&&t.empty(),"function"==typeof window.getSelection&&"function"==typeof(e=window.getSelection()).removeAllRanges?e.removeAllRanges():void 0},onHideAnnotation:function(){var e;return null!=(e=this.refs.activeAnnotation)?e.hideAnnotation():void 0},onMouseDownCallback:function(e){var t,n;if(!this.isMouseDown)return this.isMouseDown=!0,this.positionAtLastMouseDown={x:e.pageX,y:e.pageY},this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,!this._isOnRegion(e)&&this._isOnText(e)?(t=a.HIGHLIGHT,this._trySetActiveAnnotationType(t,(function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0}})(this))):void 0):null!=(n=this.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0},onMouseMoveCallback:function(e){var t,n;if(this.isMouseDown)return null===this.state.activeAnnotationType&&this.props.isAnnotationCreationEnabled&&this._deselectAllText(),this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,this.isMouseDown&&null===t&&(t=a.REGION),this._trySetActiveAnnotationType(t,(function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0}})(this))):null!=(n=this.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0},onMouseUpCallback:function(e){var t,n,o,i,r,s;if(this.isMouseDown){if(this.isMouseDown=!1,this.allowAnnotationTypeSwitch){if(r=this.state.activeAnnotationType,null===r){if(this._isAnnotationTypeCreationEnabled(a.MARKER))r=a.MARKER;else if(this._isAnnotationTypeCreationEnabled(a.REGION))return void this._trySetActiveAnnotationType(a.REGION,(function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)&&"function"==typeof n.createDefaultRegion?n.createDefaultRegion(e):void 0}})(this))}else r===a.REGION&&this._isAnnotationTypeCreationEnabled(a.MARKER)&&(t={x:e.pageX,y:e.pageY},n=t.x-this.positionAtLastMouseDown.x,o=t.y-this.positionAtLastMouseDown.y,i=Math.sqrt(n*n+o*o),i<=34&&(r=a.MARKER));return this._trySetActiveAnnotationType(r,(function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseUpCallback(e):void 0}})(this))}return null!=(s=this.refs.activeAnnotation)?s.onMouseUpCallback(e):void 0}},onScrollCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScrollCallback(e):void 0},onScaleChangeCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScaleChangeCallback(e):void 0},onAnnotationHiddenCallback:function(){var e;return this.setState({activeAnnotationType:null}),this._allowAnnotationTypeSwitch(),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback():void 0},onAnnotationPlacedCallback:function(e){var t;return this._disallowAnnotationTypeSwitch(),"function"==typeof(t=this.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e):void 0},onAnnotationStartDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(e):void 0},onAnnotationEndDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(e):void 0},onAnnotationScrollCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScrollCallback?t.onAnnotationScrollCallback(e):void 0},onAnnotationScaleChangeCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScaleChangeCallback?t.onAnnotationScaleChangeCallback(e):void 0},onAnnotationEnterCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(e):void 0},onAnnotationLeaveCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(e):void 0},_renderActiveAnnotation:function(){if(null!=this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case a.MARKER:return e.createElement(o,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case a.HIGHLIGHT:return e.createElement(i,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case a.REGION:return e.createElement(r,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,draftAnnotationVersion:this.props.draftAnnotationVersion})}return""},render:function(){return c.div({className:""+l},this._renderActiveAnnotation())}})})}.call(this),function(){define("modules/clean/annotations/annotation_highlight",["jquery","external/react","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o){var i,r,s,a;return i=o.Annotation,s=o.AnnotationTypes,r=o.AnnotationSubtypes,a=t.DOM,t.createClass({displayName:"AnnotationHighlight",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return{isShown:!1}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return this.type=s.HIGHLIGHT,this.subtype=r.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},hideAnnotation:function(){return this._hideAnnotation()},_updateViewportBoundaries:function(){var e,t,n;if(e=window.getSelection(),e.rangeCount>0)return t=this._isBrowserIE()?this._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):this._extractViewportClientRectangles(e.getRangeAt(0)),n=this._consolidateClientRectangles(t),this._setViewportCoordinatesFromRectangles(n)},_extractViewportClientRectangles:function(e){var t,n,o,i;for(t=[],n=e.endContainer,o=e.endOffset,i=e.cloneRange();n!==e.commonAncestorContainer;)i.setStart(n,0),i.setEnd(n,o),Array.prototype.push.apply(t,i.getClientRects()),o=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return i=e.cloneRange(),i.setEnd(n,o),Array.prototype.push.apply(t,i.getClientRects()),t},_extractViewportClientRectanglesIEHack:function(e){var t,n,o;if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();for(t=[],o=e.cloneRange(),o.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,o.getClientRects()),n=e.startContainer.parentNode.nextSibling;n!==e.endContainer.parentNode;)Array.prototype.push.apply(t,n.getClientRects()),n=n.nextSibling;return o.setStart(e.endContainer,0),o.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,o.getClientRects()),t},_isBrowserIE:function(){var e,t,n;return n=window.navigator.userAgent,t=n.indexOf("Trident/"),e=n.indexOf("Edge/"),t>0||e>0},_consolidateClientRectangles:function(e){var t,n,o,i,r,s;for(n=[],o=0,i=e.length;o<i;o++)s=e[o],0!==s.width&&0!==s.height&&(n.length>0&&(r=n[n.length-1],this._isWithinConsolidationVerticalBuffer(r,s)&&this._isWithinConsolidationHorizontalBuffer(r,s))?(t=this._calculateBoundingBox(r,s),r.top=t.top,r.right=t.right,r.bottom=t.bottom,r.left=t.left):n.push({top:s.top,right:s.right,bottom:s.bottom,left:s.left}));return n},_isWithinConsolidationVerticalBuffer:function(e,t){return Math.abs(e.top-t.top)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-t.bottom)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},_isWithinConsolidationHorizontalBuffer:function(e,t){var n,o,i;return n=this._calculateBoundingBox(e,t),o=n.right-n.left,i=t.width+(e.right-e.left),o-i<this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},_calculateBoundingBox:function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},_setViewportCoordinatesFromRectangles:function(e){var t,n,o,i,r;for(r=[],n=0,o=e.length;n<o;n++)i=e[n],t=[],t.push({x:i.left,y:i.top}),t.push({x:i.right,y:i.bottom}),r.push(t);return this.annotation.viewportCoordinates=r},_getPositionRelativeToParentContainer:function(e){return{x:e.x-this.props.parentContainerOffset.left,y:e.y-this.props.parentContainerOffset.top}},_updateHighlightedText:function(){return this.annotation.text_highlight={snippet_before:this._getTextBeforeHighlight(),text:this._getHighlightedText(),snippet_after:this._getTextAfterHighlight()}},_generateAnnotation:function(){return this.annotation=new i(this.type,this.subtype),this._updateViewportBoundaries(),this._updateHighlightedText()},_hideAnnotation:function(){return this._isBrowserIE()&&this.state.isShown&&this.setState({isShown:!1,viewportCoordinates:null}),this.annotation=null,this.props.onAnnotationHiddenCallback()},_updateViewportCoordinatesFromUI:function(){var t,n,o,i,r,s,a,l;if(this.state.isShown){for(r=[],l=e(".annotation-highlight"),o=0,i=l.length;o<i;o++)s=l[o],n=[],t=e(s),a=t.offset(),n.push({x:a.left,y:a.top}),n.push({x:a.left+t.width(),y:a.top+t.height()}),r.push(n);return this.annotation.viewportCoordinates=r}},_getHighlightedText:function(){var e;return e=window.getSelection().toString().trim(),e=e.replace(/\s+/g," ")},_getTextBeforeHighlight:function(){return""},_getTextAfterHighlight:function(){return""},_isTextSelected:function(){return""!==this._getHighlightedText()},onMouseDownCallback:function(e){return{}},onMouseMoveCallback:function(e){return{}},onMouseUpCallback:function(e){return setTimeout((function(e){return function(){var t,n,o,i,r,s,a,l;if(!e._isTextSelected())return e._hideAnnotation();if(e._generateAnnotation(),e.props.onAnnotationPlacedCallback(e.annotation),e._isBrowserIE()){for(l=[],s=e.annotation.viewportCoordinates,o=0,r=s.length;o<r;o++)t=s[o],n=[],i=e._getPositionRelativeToParentContainer(t[0]),a=e._getPositionRelativeToParentContainer(t[1]),n.push({x:i.x,y:i.y}),n.push({x:a.x,y:a.y}),l.push(n);return e.setState({isShown:!0,viewportCoordinates:l})}}})(this),0)},onScrollCallback:function(){var e;if(null!=this.annotation)return this._isBrowserIE()?this._updateViewportCoordinatesFromUI():this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){var e;if(null!=this.annotation)return this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseUp:function(e){return{}},render:function(){var e,t,n,o,i,r,s;return a.div({className:"annotation-highlight-container",ref:"highlightContainer"},function(){var l,c,u;if(this.state.isShown){for(t=[],u=this.state.viewportCoordinates,l=0,c=u.length;l<c;l++)o=u[l],n=o[0].x,s=o[0].y,i=o[1].x,e=o[1].y,r={left:n,top:s,width:i-n,height:e-s},t.push(a.div({className:"annotation-highlight",style:r}));return t}}.call(this))}})})}.call(this),function(){define("modules/clean/annotations/annotation_highlight_ui",["jquery","external/classnames","external/react","external/react-dom","modules/clean/annotations/annotation"],function(e,t,n,o,i){var r,s,a;return r=i.Annotation,i.AnnotationTypes,i.AnnotationSubtypes,a=n.DOM,s=18,n.createClass({displayName:"AnnotationHighlightUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,scaleFactor:n.PropTypes.number,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool,isAnnotationNumberingEnabled:n.PropTypes.bool,annotationNumber:n.PropTypes.number}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getDefaultProps:function(){return{scaleFactor:1}},getInitialState:function(){return{isHover:!1}},componentWillMount:function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=r.createAnnotationFromDict(this.props.annotation)},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onHighlightClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseEnter:function(e){var t;return this.setState({isHover:!0}),clearTimeout(this.mouseLeaveTimeout),this._updateViewportCoordinates(),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseOver:function(e){return{}},_onHighlightMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback&&t.onAnnotationLeaveCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}),this.mouseLeaveTimeout=setTimeout((function(e){return function(){return e.setState({isHover:!1})}})(this),100)},_updateViewportCoordinates:function(){var t,n,i,r,s,a,l,c;for(t=e(o.findDOMNode(this.refs.highlightContainer)),l=[],r=t.children(),s=0,a=r.length;s<a;s++)i=r[s],n=[],c=e(i).offset(),n.push({x:c.left,y:c.top}),n.push({x:c.left+e(i).width(),y:c.top+e(i).height()}),l.push(n);return this.annotation.viewportCoordinates=l},render:function(){var e,n,o,i,r,l,c,u,p,d,h,_,m,f,v,g,y,E;for(c=[],p=null!=(m=this.props.commentActivity)&&null!=(f=m.comment)?f.resolved:void 0,e=t({"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":p,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation()}),r=-1,v=this.initialViewport,u=0,h=v.length;u<h;u++)_=v[u],d=_[0].x,E=_[0].y,g=_[1].x,l=_[1].y,(r===-1||E<r)&&(o=d,r=E),y={left:d*this.props.scaleFactor,top:E*this.props.scaleFactor,width:g-d,height:l-E,transform:"scale("+this.props.scaleFactor,transformOrigin:"top left"},c.push(a.div({className:e,style:y,onClick:this._onHighlightClick,onMouseEnter:this._onHighlightMouseEnter,onMouseOver:this._onHighlightMouseOver,onMouseLeave:this._onHighlightMouseLeave}));return a.div({className:"annotation-highlight-container",ref:"highlightContainer"},c,this.props.options.isAnnotationNumberingEnabled?(i={left:o*this.props.scaleFactor-s/2,top:r*this.props.scaleFactor-s/2},n=t({"annotation-number":!0,"annotation-number--resolved":p,"annotation-number--hover":this.state.isHover}),a.div({className:n,style:i},this.props.options.annotationNumber)):void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_marker",["jquery","external/react","external/react-dom","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o,i){var r,s,a,l;return r=i.Annotation,a=i.AnnotationTypes,s=i.AnnotationSubtypes,l=t.DOM,t.createClass({displayName:"AnnotationMarker",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return this.type=a.MARKER,this.subtype=s.MARKER.CIRCLE,this.size=28,this.isInDragMode=!1,this._resetPositionDelta(),{isToolVisible:!1,viewerX:0,viewerY:0}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return{}},hideAnnotation:function(){return this._hideAnnotation()},_getSelectionText:function(){var e;return e="",window.getSelection&&(e=window.getSelection().toString()),e},_hasSelectedText:function(){return""!==this._getSelectionText()},_resetPositionDelta:function(){return this.positionDelta={x:0,y:0}},_getOffsetPosition:function(e){var t,n,o,i,r,s,a,l;return t=e.offsetX||(null!=(o=e.nativeEvent)?o.offsetX:void 0)||(null!=(i=e.nativeEvent)&&null!=(r=i.originalEvent)?r.layerX:void 0),n=e.offsetY||(null!=(s=e.nativeEvent)?s.offsetY:void 0)||(null!=(a=e.nativeEvent)&&null!=(l=a.originalEvent)?l.layerY:void 0),{x:t-this.annotation.getSize()/2,y:n-this.annotation.getSize()/2}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_calculateMarkerPos:function(e){var t,n;return n=this._getPositionRelativeToParentContainer(e),t=this.size/2,{x:n.x-t-this.positionDelta.x,y:n.y-t-this.positionDelta.y}},_generateAnnotation:function(e){return this.annotation=new r(this.type,this.subtype,this.size),this._updateViewportCoordinatesFromEvent(e),this.annotation},_updateViewportCoordinatesFromEvent:function(e){var t;return t={x:e.clientX-this.positionDelta.x,y:e.clientY-this.positionDelta.y},this.annotation.viewportCoordinates[0]=[t]},_hideAnnotation:function(e){var t;return this.annotation=null,this.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof(t=this.props).onAnnotationHiddenCallback?t.onAnnotationHiddenCallback():void 0},_placeAnnotation:function(e){return this.setState({isToolVisible:!0,viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y},(function(t){return function(){var n;return t._generateAnnotation(e),"function"==typeof(n=t.props).onAnnotationPlacedCallback?n.onAnnotationPlacedCallback(t.annotation):void 0}})(this))},updateViewportCoordinatesFromMarker:function(){var t,o,i,r;return this.state.isToolVisible&&(r=n.findDOMNode(this.refs.annotationMarker),r&&(t=e(r),o=t.offset(),i={x:o.left+this.annotation.getSize()/2,
y:o.top+this.annotation.getSize()/2},this.annotation.viewportCoordinates[0]=[i])),null},_startAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!0,this.positionDelta=this._getOffsetPosition(e),this._updateViewportCoordinatesFromEvent(e),"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(this.annotation):void 0},_endAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!1,this._updateViewportCoordinatesFromEvent(e),this._resetPositionDelta(),"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(this.annotation):void 0},_isOnMarker:function(t){var o;if(this.state.isToolVisible)return o=n.findDOMNode(this.refs.annotationMarker),null!=o&&(t.target===o||e.contains(o,t.target))},onMouseDownCallback:function(e){if(this.state.isToolVisible&&this._isOnMarker(e))return this._startAnnotationDrag(e),e.preventDefault()},onMouseMoveCallback:function(e){if(this.isInDragMode&&this.state.isToolVisible)return this.setState({viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y}),e.preventDefault()},onMouseUpCallback:function(e){return this.state.isToolVisible?this.isInDragMode?this._endAnnotationDrag(e):this._hideAnnotation(e):this._hasSelectedText()?void 0:(this._placeAnnotation(e),e.preventDefault())},onScrollCallback:function(){var e;if(this.state.isToolVisible)return this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){var e;return this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onMarkerMouseUp:function(e){return{}},_onMarkerMouseEnter:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},render:function(){var e;return e=[],this.state.isToolVisible&&(e=[l.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},l.div({className:"annotation-maker-inner"}))]),l.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_marker_ui",["jquery","external/classnames","external/react","external/react-dom"],function(e,t,n,o){var i;return i=n.DOM,n.createClass({displayName:"AnnotationMarkerUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getInitialState:function(){return{}},getDefaultProps:function(){return{options:{}}},componentWillMount:function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onMarkerClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseEnter:function(t){var n,i,r;return n=e(o.findDOMNode(this.refs.annotationMarker)),i=this.props.annotation,null==i.viewportCoordinates&&(i.viewportCoordinates=[]),i.viewportCoordinates[0]=[{x:n.offset().left+i.annotationSize/2,y:n.offset().top+i.annotationSize/2}],"function"==typeof(r=this.props).onAnnotationEnterCallback?r.onAnnotationEnterCallback({annotation:i,commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,n,o,r;return n=null!=(o=this.props.commentActivity)&&null!=(r=o.comment)?r.resolved:void 0,e=t({"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!n,"annotation-marker--resolved":n,"annotation-marker--ghost":this._isGhostAnnotation()}),i.div({className:"annotation-marker-container",ref:"markerContainer"},i.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:e,onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},i.div({className:"annotation-maker-inner"})))}})})}.call(this),define("modules/clean/annotations/annotation_message_transformer",["require","exports"],function(e,t){"use strict";function n(e){var t=e.action,n=e.parameters;switch(t){case"annotation-placed":return _(n);case"annotation-hidden":return m(n);case"annotation-start-drag":return f(n);case"annotation-end-drag":return v(n);case"annotation-enter":return g(n);case"annotation-leave":return y(n);case"annotation-ui-click":return E(n);case"annotation-ui-enter":return S(n);case"annotation-ui-leave":return b(n);case"page-rendered":return h(n);default:return e}}function o(e){var t=e.action,n=e.parameters;switch(t){case"file-preview-scroll-to-annotation":return i(n);case"file-preview-update-annotation-creation":return r(n);case"file-preview-update-annotation-region-creation":return s(n);case"file-preview-remove-annotation":return u(n);case"file-preview-load-annotations":return a(n);case"file-preview-reload-annotations":return l(n);case"file-preview-unload-annotations":return c(n);case"file-preview-remove-annotation-draft":return p(n);case"file-preview-finalize-annotation-draft":return d(n);default:return e}}function i(e){return{action:"scroll-to-annotation",parameters:{commentActivity:{activity_key:e.id},page:e.page}}}function r(e){return{action:e.enabled?"enable-annotation-creation":"disable-annotation-creation",parameters:w}}function s(e){return{action:e.enabled?"enable-region-creation":"disable-region-creation",parameters:w}}function a(e){return{action:"update-annotations",parameters:e}}function l(e){return{action:"update-annotations",parameters:e}}function c(e){return{action:"remove-all-annotations",parameters:w}}function u(e){return{action:"remove-annotation",parameters:{commentActivity:{activity_key:e.id}}}}function p(e){return{action:"remove-annotation",parameters:{commentActivity:{activity_key:e.id}}}}function d(e){return{action:"update-annotations",parameters:e}}function h(e){return{action:"file-preview-ready",parameters:e}}function _(e){return{action:"file-preview-annotation-draft-created",parameters:e}}function m(e){return{action:"file-preview-annotation-draft-removed",parameters:e}}function f(e){return{action:"file-preview-annotation-draft-drag-start",parameters:e}}function v(e){return{action:"file-preview-annotation-draft-drag-end",parameters:e}}function g(e){return{action:"file-preview-annotation-draft-mouse-enter",parameters:e}}function y(e){return{action:"file-preview-annotation-draft-mouse-leave",parameters:e}}function E(e){return{action:"file-preview-annotation-click",parameters:e}}function S(e){return{action:"file-preview-annotation-mouse-enter",parameters:e}}function b(e){return{action:"file-preview-annotation-mouse-leave",parameters:e}}Object.defineProperty(t,"__esModule",{value:!0});var w={};t.transformLegacyChildActions=n,t.transformParentActions=o}),function(){define("modules/clean/annotations/annotation_region",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o,i,r){var s,a,l,c;return s=r.Annotation,l=r.AnnotationTypes,a=r.AnnotationSubtypes,c=n.DOM,n.createClass({displayName:"AnnotationRegion",propTypes:{onAnnotationPlacedCallback:n.PropTypes.func,onAnnotationHiddenCallback:n.PropTypes.func,onAnnotationStartDragCallback:n.PropTypes.func,onAnnotationEndDragCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationScrollCallback:n.PropTypes.func,onAnnotationScaleChangeCallback:n.PropTypes.func,onAnnotationEnterCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,parentContainerOffset:n.PropTypes.object,draftAnnotationVersion:n.PropTypes.number},TYPE:l.REGION,SUBTYPE:a.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},isResizing:!1,getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillReceiveProps:function(e){if(e.draftAnnotationVersion>this.props.draftAnnotationVersion)return this.setState(this.getInitialState())},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e,t,n,o;return o=this.state.rectangle.top+this.props.parentContainerOffset.top,n=this.state.rectangle.right+this.props.parentContainerOffset.left,e=this.state.rectangle.bottom+this.props.parentContainerOffset.top,t=this.state.rectangle.left+this.props.parentContainerOffset.left,this.annotation.viewportCoordinates[0]=[{x:t,y:o},{x:t,y:e},{x:n,y:e},{x:n,y:o}]},_isOnRegion:function(t){var n;return!(!this.state.isToolVisible||(n=o.findDOMNode(this.refs.annotationRegion),null==n))&&(t.target===n||e.contains(n,t.target))},_isModifying:function(){return this.state.isInDragMode||this.isResizing},_showNewRectangle:function(e){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.isResizing=!1,this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:i.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.isResizing=!0,this.setState({isInDragMode:!1,resizeDirections:i.clone(t),anchorRectangle:i.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new s(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){var e;return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){var t,n,o,i;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),o=n.x,i=n.y,t=this.DEFAULT_REGION_SIZE/2,this.isResizing=!1,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:{top:i-t,right:o+t,bottom:i+t,left:o-t}},(function(e){return function(){var t;return e._updateAnnotationFromState(),"function"==typeof(t=e.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e.annotation):void 0}})(this))},onMouseDownCallback:function(e){var t,n;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),this.state.isToolVisible?this._isOnRegion(e)&&!this.isResizing?(this._updateAnnotationFromState(),"function"==typeof(t=this.props).onAnnotationStartDragCallback&&t.onAnnotationStartDragCallback(this.annotation),this._startDragging(n)):void 0:this._showNewRectangle(n)},onMouseMoveCallback:function(e){var t,n,o;return e.preventDefault(),this.state.isToolVisible?this._isModifying()?(o=this._getPositionRelativeToParentContainer(e),t={x:o.x-this.state.anchorMouse.x,y:o.y-this.state.anchorMouse.y},n=i.clone(this.state.anchorRectangle),this.state.isInDragMode?n={top:this.state.anchorRectangle.top+t.y,right:this.state.anchorRectangle.right+t.x,bottom:this.state.anchorRectangle.bottom+t.y,left:this.state.anchorRectangle.left+t.x}:this.isResizing&&(this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?n.top=this.state.anchorRectangle.top+t.y:this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(n.bottom=this.state.anchorRectangle.bottom+t.y),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?n.left=this.state.anchorRectangle.left+t.x:this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(n.right=this.state.anchorRectangle.right+t.x)),n={top:Math.min(n.top,n.bottom),right:Math.max(n.left,n.right),bottom:Math.max(n.top,n.bottom),left:Math.min(n.left,n.right)},this.setState({rectangle:n})):void 0:(o=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(o))},onMouseUpCallback:function(e){var t,n;if(e.preventDefault(),this.state.isToolVisible)return this._isModifying()?(this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof(t=this.props).onAnnotationPlacedCallback&&t.onAnnotationPlacedCallback(this.annotation):"function"==typeof(n=this.props).onAnnotationEndDragCallback&&n.onAnnotationEndDragCallback(this.annotation),this.isResizing=!1,this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})):this.hideAnnotation(e)},onScrollCallback:function(){var e;if(this.state.isToolVisible)return this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0},onScaleChangeCallback:function(){var e;return this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){var t;return this.setState({isHovering:!0}),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){var t;return this.setState({isHovering:!1}),"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){var n,o;return e.preventDefault(),this.isResizing=!0,o=this._getPositionRelativeToParentContainer(e),this._updateAnnotationFromState(),"function"==typeof(n=this.props).onAnnotationStartDragCallback&&n.onAnnotationStartDragCallback(this.annotation),this._startResizing(o,t)},_renderSideHandles:function(){var e;return c.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},function(){var t,n,o,r;for(o=i.values(this.Directions),r=[],t=0,n=o.length;t<n;t++)e=o[t],r.push((function(e){return function(t){return c.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})}})(this)(e));return r}.call(this))},_renderCornerHandles:function(){var e,t,n,o,i,r;for(o=[this.Directions.TOP,this.Directions.BOTTOM],i=[],t=0,n=o.length;t<n;t++)r=o[t],i.push(function(){var t,n,o,i;for(o=[this.Directions.LEFT,this.Directions.RIGHT],i=[],t=0,n=o.length;t<n;t++)e=o[t],i.push((function(e){return function(t,n){return c.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(o){return e._onHandleMouseDown(o,[t,n])}},c.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))}})(this)(r,e));return i}.call(this));return i},render:function(){var e,n;return n=[],this.state.isToolVisible&&(e={"annotation-region":!0,"annotation-region--blue":!0,"is-modifying":this._isModifying(),hover:this.state.isHovering},n=[c.div({key:"annotationRegion",ref:"annotationRegion",className:t(e),onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())]),c.div({className:"annotation-region-container"},this.state.isToolVisible?n:void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_region_ui",["jquery","external/classnames","external/react","external/react-dom"],function(e,t,n,o){var i;return i=n.DOM,n.createClass({displayName:"AnnotationRegionUI",propTypes:{annotation:n.PropTypes.object,scaleFactor:n.PropTypes.number,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool,isAnnotationNumberingEnabled:n.PropTypes.bool,annotationNumber:n.PropTypes.number}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getDefaultProps:function(){return{scaleFactor:1}},getInitialState:function(){return{}},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onRegionClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseEnter:function(t){var n,i,r,s,a,l,c;return n=e(o.findDOMNode(this.refs.annotationRegion)),i=this.props.annotation,null==i.viewportCoordinates&&(i.viewportCoordinates=[]),c=n.offset().top,a=n.offset().left,s=c+n.height(),l=a+n.width(),i.viewportCoordinates[0]=[{x:a,y:c},{x:a,y:s},{x:l,y:s},{x:l,y:c}],"function"==typeof(r=this.props).onAnnotationEnterCallback?r.onAnnotationEnterCallback({annotation:i,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseOver:function(e){return{}},_onRegionMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,n,o,r,s,a;return o=null!=(s=this.props.commentActivity)&&null!=(a=s.comment)?a.resolved:void 0,r=this.props.annotation.getBoundingBox(),e=t({"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":o,"annotation-region--ui--resolved":o,"annotation-region--ghost":this._isGhostAnnotation()}),i.div({className:"annotation-region-container"},i.div({key:"annotationRegion",ref:"annotationRegion",className:e,onClick:this._onRegionClick,onMouseEnter:this._onRegionMouseEnter,onMouseOver:this._onRegionMouseOver,onMouseLeave:this._onRegionMouseLeave,style:{left:r.left*this.props.scaleFactor,top:r.top*this.props.scaleFactor,width:(r.right-r.left)*this.props.scaleFactor,height:(r.bottom-r.top)*this.props.scaleFactor}},i.div({className:"annotation-region-inner"}),this.props.options.isAnnotationNumberingEnabled?(n=t({"annotation-number":!0,"annotation-number--resolved":o}),i.div({className:n},this.props.options.annotationNumber)):void 0))}})})}.call(this),function(){define("modules/clean/annotations/annotation_renderer_utils",["jquery","external/react","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","external/underscore"],function(e,t,n,o,i,r,s){var a,l;return a=n.Annotation,l=n.AnnotationTypes,(function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){var n,o,i,r,a,l,c;if((null!=(a=e.annotations)?a.length:void 0)!==(null!=(l=s.keys(t))?l.length:void 0))return!0;for(c=e.annotations,i=0,r=c.length;i<r;i++)if(o=c[i],n=o.commentActivity.activity_key,!s.isEqual(t[n],o))return!0;return!1},e.prototype.renderAnnotation=function(e,t,n){var s,c,u,p;if(null==e.annotation||null==e.commentActivity)return null;if(s=a.createAnnotationFromDict(e.annotation),u=e.commentActivity,null==(null!=s?s.type:void 0)||t(u.activity_key))return null;switch(c=null,s.type){case l.MARKER:c=i;break;case l.HIGHLIGHT:c=o;break;case l.REGION:c=r}return null==c?null:(p=null!=e.options?e.options:{},n(c,s,u,p))},e})()})}.call(this),function(){define("modules/clean/annotations/preview_image_annotations_toolbar",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/core/dom","modules/core/i18n","modules/clean/keycode","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/constants/comments_panel"],function(e,t,n,o,i,r,s,a,l,c,u,p,d){var h,_,m,f,v,g,y,E;return v=s._,E=s.format_percent,h=a.KeyCode,f=c.UserActionNames,m=c.UserActionContextNames,g=t.createElement,y=t.DOM,_=3e3,t.createClass({displayName:"PreviewImageAnnotationsToolbar",propTypes:{canEnableRegionCreation:t.PropTypes.bool,index:t.PropTypes.number.isRequired,count:t.PropTypes.number.isRequired,zoomPercent:t.PropTypes.number,minimumZoomPercent:t.PropTypes.number,maximumZoomPercent:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func,onFullscreen:t.PropTypes.func,onZoomIn:t.PropTypes.func,onZoomOut:t.PropTypes.func,onZoomOriginalOrFit:t.PropTypes.func,onRegionCreationClick:t.PropTypes.func,onKeyPress:t.PropTypes.func},getInitialState:function(){return{isToolbarVisible:!0}},componentDidMount:function(){return window.addEventListener("mousemove",this._onMouseMove),i(document).bind("keydown",this._handleKeyPress)},componentWillUnmount:function(){return window.removeEventListener("mousemove",this._onMouseMove),clearTimeout(this.hideToolbarTimeout),i(document).unbind("keydown",this._handleKeyPress)},_onMouseMove:function(e){if(this.state.isToolbarVisible||this.setState({isToolbarVisible:!0}),this.state.isToolbarVisible)return clearTimeout(this.hideToolbarTimeout),this.hideToolbarTimeout=setTimeout((function(t){return function(){return t._maybeHideToolbar(e)}})(this),_)},_handleKeyPress:function(e){var t,n,o,i;return!(!r.focus_in_input()&&!r.is_input(e.target))||(i=e.keyCode,i===h.EQUALS||i===h.PLUS_EQUALS_FF||i===h.PLUS_CHROME||i===h.PLUS_EQUALS_FF_GERMAN?("function"==typeof(t=this.props).onZoomIn&&t.onZoomIn(),o=!0):i===h.MINUS_FF_MAC||i===h.MINUS_FF||i===h.MINUS_CHROME?("function"==typeof(n=this.props).onZoomOut&&n.onZoomOut(),o=!0):this.props.onKeyPress&&(o=this.props.onKeyPress(e)),o&&null!=e.preventDefault&&e.preventDefault(),!o)},_maybeHideToolbar:function(e){if(0===i(e.target).closest(n.findDOMNode(this.refs.previewToolbar)).length)return this.setState({isToolbarVisible:!1})},_flipLabelText:function(){return v("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index+1,num_total_files:this.props.count})},_zoomToolTipText:function(){return v(1===this.props.zoomPercent?"Zoom to fit":"View actual size")},_getZoomLabel:function(){return this.props.zoomPercent?E(Math.round(100*this.props.zoomPercent)):""},_onZoomMouseDown:function(e,t){return this.isZooming||l.logUserAction(t.action,t.context),this.isZooming=!0,this._keepZooming(e,400)},_keepZooming:function(e,t){if(this.isZooming)return e(),setTimeout((function(t){return function(){return t._keepZooming(e,75)}})(this),t)},_onZoomMouseUp:function(){return this.isZooming=!1},_onZoomMouseLeave:function(){return this.isZooming=!1},_onClickPrevious:function(){return this.props.onPrevious(),l.logUserAction(f.FLIP_PREV,m.TOOLBAR)},_onClickNext:function(){return this.props.onNext(),l.logUserAction(f.FLIP_NEXT,m.TOOLBAR)},_onClickFullscreen:function(){return this.props.onFullscreen(),l.logUserAction(f.TOGGLE_FULLSCREEN_ON,m.TOOLBAR)},render:function(){var t,n,i;return!!this.state.isToolbarVisible&&(!(this.props.count<=1&&null==this.props.onZoomOut&&null==this.props.onZoomIn&&null==this.props.onFullscreen)&&(i={"zoom-out":!0,disabled:null!=this.props.minimumZoomPercent&&this.props.zoomPercent<=this.props.minimumZoomPercent},n={"zoom-in":!0,disabled:null!=this.props.maximumZoomPercent&&this.props.zoomPercent>=this.props.maximumZoomPercent},t={"enable-region-creation":!0,"image-toolbar__item":!0,"item-w-label":!0,disabled:!this.props.canEnableRegionCreation},y.div({className:"preview-toolbar-overlay-container"},y.div({className:"preview-toolbar-overlay",ref:"previewToolbar"},y.div({className:"preview-toolbar-content image-toolbar"},this.props.count>1&&null!=this.props.onPrevious&&null!=this.props.onNext?y.span({className:"flip-buttons image-toolbar__item"},y.div({className:"flip-button flip-button--previous",onClick:this._onClickPrevious},g(u,{group:"web",name:"s_flip_left",alt:v("Previous")})),y.div({className:"nav-text"},this._flipLabelText()),y.div({className:"flip-button flip-button--next",onClick:this._onClickNext},g(u,{group:"web",name:"s_flip_right",alt:v("Next")}))):void 0,null!=this.props.onZoomOut||null!=this.props.onZoomIn?y.span({className:"flip-buttons image-toolbar__item"},null!=this.props.onZoomOut?y.div({className:e(i),onMouseDown:o.partial(this._onZoomMouseDown,this.props.onZoomOut,{action:f.ZOOM_OUT,context:m.TOOLBAR}),onMouseUp:this._onZoomMouseUp,onMouseLeave:this._onZoomMouseLeave},g(u,{group:"web",name:"zoomout",alt:v("Zoom Out")})):void 0,null!=this.props.onZoomOriginalOrFit?g(p,{content:this._zoomToolTipText(),position:p.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},y.div({ref:"zoomLabel",className:"zoom-label",onClick:this.props.onZoomOriginalOrFit},this._getZoomLabel())):void 0,null!=this.props.onZoomIn?y.div({className:e(n),onMouseDown:o.partial(this._onZoomMouseDown,this.props.onZoomIn,{action:f.ZOOM_IN,context:m.TOOLBAR}),onMouseUp:this._onZoomMouseUp,onMouseLeave:this._onZoomMouseLeave},g(u,{group:"web",name:"zoom",alt:v("Zoom In")})):void 0):void 0,null!=this.props.onFullscreen?y.div({className:"fullscreen image-toolbar__item item-w-label",onClick:this._onClickFullscreen},g(u,{group:"web",name:"fullscreen",alt:v("Fullscreen")}),y.span({className:"item-w-label__label"},v("Fullscreen"))):void 0,d.ALLOW_VIEW_ANNOTATE_MODES?y.div({className:e(t),onClick:this.props.canEnableRegionCreation?this.props.onRegionCreationClick:void 0},g(u,{group:"web",name:"ic_comment_area_large",alt:v("Comment on specific areas")}),y.span({className:"item-w-label__label"},v("Comment"))):void 0)))))}})})}.call(this),define("modules/clean/api_v2/root_aware_client",["require","exports","tslib","external/underscore","modules/clean/api_v2/client","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.rpc=function(t,n,i,s){var a={},l=r.get_viewer().get_user_by_id(t);return l&&l.root_ns_id&&(a["X-Dropbox-Path-Root"]=String(l.root_ns_id)),o.extend(a,s),e.prototype.rpc.call(this,t,n,i,a)},t})(i.ApiV2Client);t.ApiV2RootAwareClient=l;var c=(function(){function e(){this.client=new l}return e.prototype.rpc=function(e,t,n,o,i){return void 0===o&&(o=!1),this.client.rpc(e,t,n,i).catch(function(e){return o&&a.error(e.message||s._("There was a problem completing this request.")),Promise.reject(e)})},e})();t.UserActionsRootAwareClient=c}),define("modules/clean/api_v2/types",["require","exports","tslib","modules/clean/datetime"],function(e,t,n,o){"use strict";function i(e){return o.format_date_utc(e,"yyyy-MM-ddTHH:mm:ssZ")}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,n){this.type=e,this.value=t,this.isScalar=n}return e.parse=function(e){var t=e[".tag"];return 2===Object.keys(e).length&&null!=e[t]?new s(t,e[t]):new a(t,e)},e})();t.Union=r;var s=(function(e){function t(t,n){return void 0===n&&(n=null),e.call(this,t,n,!0)||this}return n.__extends(t,e),t.prototype.toJSON=function(){var e={".tag":this.type};return null!=this.value&&(e[this.type]=this.value),e},t})(r);t.UnionScalar=s;var a=(function(e){function t(t,n){return void 0===n&&(n={}),e.call(this,t,n,!1)||this}return n.__extends(t,e),t.prototype.toJSON=function(){return n.__assign({".tag":this.type},this.value)},t})(r);t.UnionStruct=a;t.formatTimestamp=i}),define("modules/clean/attributions/actions",["require","exports","tslib","external/underscore","modules/clean/accounts/api","modules/clean/accounts/constants","modules/clean/accounts/dispatcher","modules/clean/attributions/api","modules/clean/attributions/constants","modules/clean/attributions/dispatcher"],function(e,t,n,o,i,r,s,a,l,c){"use strict";function u(e,t){return n.__awaiter(this,void 0,void 0,function(){var u,p,d;return n.__generator(this,function(n){switch(n.label){case 0:return[4,a.fetchAttributionsByFile(e,t)];case 1:return u=n.sent().attributions,c.attributionsDispatcher.dispatch({type:l.AttributionsAction.FetchAttributionsSuccess,data:{file:t,attributions:u}}),p=o.uniq(u.map(function(e){return e.accountId})),[4,i.fetchAccountsByIds(e,p)];case 2:return d=n.sent().accounts,s.accountsDispatcher.dispatch({type:r.AccountsAction.FetchAccountsSuccess,data:{accounts:d}}),[2]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadAttributionsForFile=u}),define("modules/clean/attributions/api",["require","exports","tslib","modules/clean/ajax_util","modules/clean/api_v2/client"],function(e,t,n,o,i){"use strict";function r(e){return{attributions:e.attributions.map(s)}}function s(e){return{revisionId:e.revision,accountId:e.account_id,page:e.page,area:a(e.area)}}function a(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}function l(e,t){return n.__awaiter(this,void 0,void 0,function(){var s,a,l,u;return n.__generator(this,function(n){switch(n.label){case 0:return s=new i.ApiV2Client,a=e.id,l=c(t.revision_id),[4,o.requestWithRetry(function(){return s.rpc(a,"file_attribution/list_attributions",{path:l})})];case 1:return u=n.sent(),[2,r(u)]}})})}function c(e){return"rev:"+e}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAttributionsByFile=l}),define("modules/clean/attributions/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionsAction={FetchAttributionsSuccess:"FetchAttributionsSuccess"}}),define("modules/clean/attributions/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attributionsDispatcher=n}),define("modules/clean/attributions/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/attributions/constants","modules/clean/attributions/dispatcher"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){var n=e.call(this,t)||this;return n.attributionsByRevisionId={},n}return n.__extends(t,e),t.prototype.getAttributionsForFile=function(e){return this.attributionsByRevisionId[e.revision_id]||[]},t.prototype.handleFetchAttributionsSuccess=function(e){
this.attributionsByRevisionId[e.file.revision_id]=e.attributions,this.__emitChange()},t.prototype.__onDispatch=function(e){e.action.type===i.AttributionsAction.FetchAttributionsSuccess&&this.handleFetchAttributionsSuccess(e.action.data)},t})(o);t.attributionsStore=new s(r.attributionsDispatcher)}),function(){define("modules/clean/avatar/contact_avatar",["external/react","modules/core/i18n","modules/core/user_i18n","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/contacts/contact","modules/clean/contacts/types"],function(e,t,n,o,i,r,s,a){var l,c,u,p,d;return p=t._,l=r.AVATAR_DIMENSION_BY_SIZE,u=r.VALID_AVATAR_DIMENSIONS,c=s.Contact,d=e.createElement,e.createClass({displayName:"ContactAvatar",propTypes:{dimension:e.PropTypes.oneOf(u).isRequired,contact:e.PropTypes.instanceOf(c).isRequired,optionalClass:e.PropTypes.string},render:function(){var e,t,r,s,c,u,h;return r=this.props.contact,c=r.name||r.email,u=r.photo_url,r.type===a.FB&&(u="https://graph.facebook.com/"+r.fb_id+"/picture"),s="",this.props.dimension!==l.XSMALL&&(s=n.getInitials(c)),r.type===a.NEW_STYLE_GROUP?(e=p("Group"),h="SQUARE"):(e=p("User"),h="CIRCLE"),t={alt:e,dimension:this.props.dimension,photoUrl:u,shape:h,optionalClass:this.props.optionalClass,defaultAvatar:d(i,{alt:e,dimension:this.props.dimension,name:c,initials:s,shape:h,optionalClass:this.props.optionalClass})},d(o,t)}})})}.call(this),define("modules/clean/average_counter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t=e.reduce(function(e,t){return e+t}),n=this.count+e.length;this.average=(this.average*this.count+t)/n,this.count=n},e})();t.AverageCounter=n}),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/beacon",["external/underscore","jquery","modules/clean/beacon_nodeps","modules/clean/bolt_nodeps","modules/core/exception"],function(t,n,o,i,r){var s,a;return a=(function(o){function i(e,o,s){this._token=e,this._authn_cb=o,this._authz_cb=s,i.__super__.constructor.call(this,this._token,this._authn_cb,this._authz_cb,"beacon.dropbox.com",n.ajax,t,r)}return e(i,o),i})(o.Transmitter),s=(function(o){function s(e,o,a){s.__super__.constructor.call(this,e,o,a,i,"thunder.dropbox.com",n.ajax,t,r)}return e(s,o),s})(o.Receiver),{Agent:o.Agent,AgentStatus:o.AgentStatus,Platforms:o.Platforms,PresenceParams:o.PresenceParams,PresenceType:o.PresenceType,Receiver:s,Source:o.Source,Transmitter:a,UserAppPresence:o.UserAppPresence,UserContextPresence:o.UserContextPresence}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/beacon_nodeps",[],function(){var t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b,w,C;return i=5e3,r=12e4,c=6e4,u="invalid_agent",t="authorization_error",p=32,f=64,d=64,m=32,h=128,_=32,s="-",a="|",v={WEB:0,IOS:1,ANDROID:2,DESKTOP:3},S=(function(){function e(e,t,n){var o,i,r,s;this.platform=e,this.surface=t,this.identifier=null!=n?n:null,i=!1;for(o in v)if(s=v[o],this.platform===s){i=!0;break}if(!i)throw new Error("platform must be from Beacon.Platforms");if(this.surface.length>m||0===this.surface.length)throw new Error("surface must be populated and <= "+m+" chars.");if((null!=(r=this.identifier)?r.length:void 0)>h)throw new Error("identifier must be <= "+h+" chars.");null===this.identifier&&(this.identifier="")}return e.from_json=function(t){return new e(t.platform,t.surface,t.identifier)},e})(),n=(function(){function e(e,t,n,o){if(this.user_id=e,this.app=t,this.context=n,this.source=o,this.user_id.length>f)throw new Error("user_id must be <= "+f+" chars.");if(this.app.length>p||0===this.app.length)throw new Error("app must be populated and <= "+p+" chars.");if(this.context.length>d||0===this.context.length)throw new Error("context must be populated and <= "+d+" chars.")}return e.from_json=function(t){var n;return n=S.from_json(t.source),new e(t.user_id,t.app,t.context,n)},e})(),o=(function(){function e(e,t,n){if(this.agent=e,this.status=t,this.auth_key=null!=n?n:null,this.status.length>_)throw new Error("status must be <= "+_+" chars")}return e.from_json=function(t){return new e(n.from_json(t.agent),t.status)},e})(),y={UserContext:"UserContext",UserApp:"UserApp",Context:"Context"},g=(function(){function e(e,t,n,o,i){var r,s;if(this.type=e,this.user_id=t,this.app=n,this.context=o,this.token=i,this.type!==y.UserContext&&this.type!==y.UserApp&&this.type!==y.Context)throw new Error("Unsupported type: "+this.type+".");if((null!=(r=this.user_id)?r.length:void 0)>f)throw new Error("user_id must be <= "+f+" chars.");if(this.app.length>p)throw new Error("app must be <= "+p+" chars.");if((null!=(s=this.context)?s.length:void 0)>d)throw new Error("context must be <= "+d+" chars.")}return e})(),C=(function(){function e(e,t){this.presence_params=e,this.agents=t}return e})(),w=(function(){function e(e,t){this.presence_params=e,this.status=t}return e.Status={Offline:1,Online:2},e})(),l=(function(){function e(e,t,n){this.presence_params=e,this.snapshot=t,this.delta=n}return e})(),b=(function(){function o(t,n,o,i,r,s,a){this._token=t,this._authn_cb=n,this._authz_cb=o,this._beacon_server=i,this._ajax=r,this._u=s,this._exclog=null!=a?a:null,this._handle_heartbeat_error=e(this._handle_heartbeat_error,this),this._handle_heartbeat_success=e(this._handle_heartbeat_success,this),this._heartbeat=e(this._heartbeat,this),this._started=!1,this._heartbeat_xhr=null,this._timeout_id=null,this._presence_data=[],this._offline_agents=[],this._has_changes=!1}return o.prototype.start=function(){if(!this._started)return this._backoff_window=i,this._started=!0,this._has_changes=!1,this._heartbeat()},o.prototype.stop=function(){return this._started=!1,this._heartbeat_xhr=null,window.clearTimeout(this._timeout_id),this._timeout_id=null},o.prototype.add_or_update_agents=function(e){var t,n,o;for(n=0,o=e.length;n<o;n++)t=e[n],this._has_changes|=this._add_or_update_agent(t);if(!this._heartbeat_xhr&&this._started)return window.clearTimeout(this._timeout_id),this._timeout_id=window.setTimeout(this._heartbeat,0)},o.prototype.update_token=function(e){this._token=e},o.prototype._add_or_update_agent=function(e){var t,n,o,i,r;for(r=this._presence_data,n=t=0,o=r.length;t<o;n=++t)if(i=r[n],this._u.isEqual(i.agent,e.agent))return(i.status!==e.status||i.auth_key!==e.auth_key)&&(this._presence_data[n]=e,!0);return this._presence_data.push(e),!0},o.prototype._heartbeat=function(){if(this._started&&0!==this._presence_data.length)return this._offline_agents=this._presence_data.filter(function(e){return""!==e.status}).map(function(e){return e.agent}),this._has_changes=!1,this._heartbeat_xhr=this._ajax({url:"https://"+this._beacon_server+"/1/update",type:"POST",data:JSON.stringify({token:this._token,updates:this._presence_data}),contentType:"application/json; charset=utf-8",dataType:"json",timeout:5e3,success:this._handle_heartbeat_success,error:this._handle_heartbeat_error,xhrFields:{withCredentials:!0}})},o.prototype._handle_heartbeat_success=function(e,o,r){var s,a,l,p,d,h,_,m,f,v,g,y,E,S,b,w,C,T,A;if(this._heartbeat_xhr=null,this._started){for(p=[],w=e.agent_errors||[],m=0,y=w.length;m<y;m++)a=w[m],h=a.error,s=n.from_json(a.agent),h===t?p.push(s):h===u&&null!=(C=this._exclog)&&C.reportStack("Input error: "+a),this._presence_data=this._presence_data.filter((function(e){return function(t){return!e._u.isEqual(t.agent,s)}})(this));for(p.length&&(d=this._authz_cb,window.setTimeout((function(e){return function(){return d(p)}})(this),0)),T=this._offline_agents,v=0,E=T.length;v<E;v++)for(b=T[v],A=this._presence_data,f=g=0,S=A.length;g<S;f=++g)if(l=A[f],this._u.isEqual(l.agent,b)&&""===l.status){this._presence_data.splice(f,1);break}return _=this._has_changes?0:c,this._backoff_window=i,this._timeout_id=window.setTimeout(this._heartbeat,_)}},o.prototype._handle_heartbeat_error=function(e,t,n){var o,i;if(this._heartbeat_xhr=null,this._started){if(e.status>=400&&e.status<500){if(401===e.status)return window.setTimeout(this._authn_cb,0),void this.stop();400===e.status&&null!=(i=this._exclog)&&i.reportStack("Bad request: "+e.responseText)}return o=Math.random()*this._backoff_window,this._backoff_window=Math.min(2*this._backoff_window,r),this._timeout_id=window.setTimeout(this._heartbeat,o)}},o})(),E=(function(){function t(t,n,o,i,r,s,a,l){var c,u;this._presence_params=t,this._update_callback=n,this._refresh_callback=o,this._bolt=i,this._thunder_hostname=r,this._ajax=s,this._u=a,this._exclog=null!=l?l:null,this._on_refresh=e(this._on_refresh,this),this._on_update=e(this._on_update,this),this._compact_context_updates=e(this._compact_context_updates,this),c=function(){var e,t,n,o;for(n=this._presence_params,o=[],e=0,t=n.length;e<t;e++)u=n[e],o.push(this._presence_params_to_bolt_channel(u));return o}.call(this),this._thunder_client=new this._bolt.ThunderClient(c,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._u,this._exclog)}return t.prototype.start=function(){return this._thunder_client.start()},t.prototype.stop=function(){return this._thunder_client.unsubscribe()},t.prototype.add_presence_params=function(e){var t,n,o;return o=this._presence_params.length,this._presence_params=this._u.union(e,this._presence_params),this._presence_params.length!==o&&(this._thunder_client.unsubscribe(),t=function(){var e,t,o,i;for(o=this._presence_params,i=[],e=0,t=o.length;e<t;e++)n=o[e],i.push(this._presence_params_to_bolt_channel(n));return i}.call(this),this._thunder_client=new this._bolt.ThunderClient(t,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._u,this._exclog),this._thunder_client.start(),!0)},t.prototype._presence_params_to_bolt_channel=function(e){switch(e.type){case y.UserContext:return new this._bolt.SignedChannelState("beacon_uc"+s+e.app,""+e.user_id+a+e.context,"0",e.token);case y.UserApp:return new this._bolt.SignedChannelState("beacon_ua"+s+e.app,e.user_id,"0",e.token);case y.Context:return new this._bolt.SignedChannelState("beacon_c"+s+e.app,e.context,"0",e.token);default:throw new Error("Unknown type: "+e.type)}},t.prototype._bolt_channel_to_presence_params=function(e){var t,n,o,i,r,l;if(n=e.app_id.split(s),r=e.unique_id.split(a),2!==n.length)throw new Error("Unexpected format of Bolt app_id: "+e.app_id+".");switch(t=n[1],l="",o="",n[0]){case"beacon_uc":if(2!==r.length)throw new Error("Unexpected format of beacon_uc: "+e.unique_id+".");i=y.UserContext,l=r[0],o=r[1];break;case"beacon_ua":if(1!==r.length)throw new Error("Unexpected format of beacon_ua: "+e.unique_id+".");i=y.UserApp,l=r[0];break;case"beacon_c":if(1!==r.length)throw new Error("Unexpected format of beacon_c: "+e.unique_id+".");i=y.Context,o=r[0];break;default:throw new Error("Unknown Bolt app_id: "+e.app_id+".")}return new g(i,l,t,o,null)},t.prototype._compact_context_updates=function(e,t){var n,o,i,r,s,a,c,u,p,d,h,_,m,f,v,g;for(a=!1,n=[],r=0,p=t.length;r<p;r++)if(g=t[r],null!=g.snapshot)a=!0,n=g.snapshot;else if(null!=g.delta)for(f=g.delta,c=0,d=f.length;c<d;c++){for(_=f[c],i=!1,s=u=0,h=n.length;u<h;s=++u)if(m=n[s],this._u.isEqual(m.agent,_.agent)){i=!0,n[s]=_;break}i||n.push(_)}return a?(v=n,o=null):(v=null,o=n),new l(e,v,o)},t.prototype._on_update=function(e){var t,i,r,s,a,l,c,u,p,d,h,_,m;for(m=[],c=0,p=e.length;c<p;c++)s=e[c],a=s.channel_state,r=new this._bolt.ChannelId(a.app_id,a.unique_id),u=this._bolt_channel_to_presence_params(r),m.push(function(){switch(u.type){case y.UserContext:return h=s.payloads.slice(-1)[0].payload,i=null!=h.agents?(function(){var e,n,i,r;for(i=h.agents,r=[],e=0,n=i.length;e<n;e++)t=i[e],r.push(o.from_json(t));return r})():[],new C(u,i);case y.UserApp:return h=s.payloads.slice(-1)[0].payload,new w(u,h.status);case y.Context:return l=function(e){var i;return i=S.from_json(e.source),t=new n(e.user_id,u.app,u.context,i),new o(t,e.status)},d=function(e){var t,n,o;return{snapshot:null!=(null!=(n=e.snapshot)?n.agents:void 0)?(function(){var n,o,i,r;for(i=e.snapshot.agents,r=[],n=0,o=i.length;n<o;n++)t=i[n],r.push(l(t));return r})():void 0,delta:null!=(null!=(o=e.delta)?o.agents:void 0)?(function(){var n,o,i,r;for(i=e.delta.agents,r=[],n=0,o=i.length;n<o;n++)t=i[n],r.push(l(t));return r})():void 0}},_=(function(){var e,t,n,o;for(n=s.payloads,o=[],e=0,t=n.length;e<t;e++)h=n[e],o.push(d(h.payload));return o})(),this._compact_context_updates(u,_)}}.call(this));return this._update_callback(m)},t.prototype._on_refresh=function(e){var t;return this._refresh_callback(function(){var n,o,i;for(i=[],n=0,o=e.length;n<o;n++)t=e[n],i.push(this._bolt_channel_to_presence_params(t));return i}.call(this))},t})(),{Agent:n,AgentStatus:o,Platforms:v,PresenceParams:g,PresenceType:y,Receiver:E,Source:S,Transmitter:b,UserAppPresence:w,UserContextPresence:C}})}.call(this),function(){var e=[].slice;define("modules/clean/comments/action_creators",["external/underscore","external/react","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/annotations/annotation","modules/clean/comments/action_creators_helpers","modules/clean/comments/actions","modules/clean/comments/events","modules/clean/comments/logged_out_utils","modules/clean/comments/models/comment","modules/clean/comments/models/comment_activity","modules/clean/comments/revisions","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/file_activity/clients/file_activity_data_source","modules/clean/file_activity/models/file_activity","modules/clean/immutability_helper","modules/clean/react/file_comments/onboarding","modules/clean/react/file_comments/shared_link_signup_modals","modules/clean/react/file_viewer/actions","modules/clean/react/modal","modules/clean/storage","modules/constants/legacy","modules/constants/comments_panel","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/revisions/file_revisions_iterator"],function(t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b,w,C,T,A,I,P,R,O){var N,L,M,k,F,x,D,U,B,H,V,W,q,z,j,K,G,Y,Q,Z,X,assert,J,$,ee,te,ne,oe,ie,re,se,ae,le,ce,ue,pe,de,he,_e;return x=o.EmailVerification,F=r.CommentsVortexLogger,N=s.Annotation,M=c.CommentsEvents,p.CommentMetadata,L=d.CommentActivity,oe=h.isRevisionOlderThan,te=h.getFileWithRevision,g.FileActivity,se=y.merge,k=S.CommentsSharedLinkSignupModals,U=w.Modal,D=C.LocalStorage,assert=I.assert,B=P._,G=function(e,t){var n;return n=v.getInstance().commitOptimisticUpdate(t),e.then(function(e){return v.getInstance().rebase(n),e}),e.catch(function(e){return v.getInstance().rollbackOptimisticUpdate(n),Promise.reject(e)})},q=function(e){var t,n,o,i,r,s,a,l,c;return c=e.targetActivityKey,r=e.pendingCommentActivity,n=_.state.activity.activity_key,o=c===n?null:c,l=r.comment,a=l.raw_comment_text,t=l.comment_metadata,s=f.addComment({actorId:_.state.actorId,context:_.state.viewing.context,contextData:_.state.viewing.contextData,commentActivityKey:o,text:a,metadata:null!=t?t.toDict():void 0,oref:_.state.oref}),i=v.getInstance().commitOptimisticUpdate(function(e){return e.appendComment(c,r)}),s.then(function(e){var t;return t=v.getInstance(),t.rollbackOptimisticUpdate(i),t.rebase(function(t){return t.appendComment(c,e)})}),[s,i]},W=function(e,t){return se(e,{status:"FAILED",activity_key:t})},H=function(e){var t,n,o,i,r,s,l,c,u,p,d,h;return d=e.targetActivityKey,n=e.body,t=e.annotation,o=m.getActivityUser(_.state.actorId),i=_.state.activity,i.activity_key,h=null!=(u=n.text)?u:"",r=a.buildCommentMetadata(n,t),l=L.createLocalInstance({commenter:o,rawCommentText:h,metadata:r,status:"POSTING"}),p=q({targetActivityKey:d,pendingCommentActivity:l}),c=p[0],s=p[1],c.catch(function(e){var t;return t=v.getInstance(),t.rollbackOptimisticUpdate(s),t.commitOptimisticUpdate(function(e,t){var n;return n=W(l,t),e.appendComment(d,n)}),Promise.reject(e)}),[l,c]},Y=function(e,t,n){var o,r,s;return o=m.getActivityUser(_.state.actorId),s=_.state.activity.activity_key,o.is_signed_in?!!o.is_email_verified||(r=x.get_for_user(o),x.set_should_use_simple_ui(!1),r.show_verify_modal(null,i.ADD_COMMENT),!1):(u.saveActionCreator({name:e,fileActivityKey:s,args:t}),M.emit("show-sign-up-modal",{fileActivityKey:s,variant:k.POST_COMMENT_VARIANT}),u.logSignUpModal({fileActivityKey:s,commentActivityKey:n,originType:T.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.POST_BUTTON}),D.set("tmp-file-comment",null),!1)},ae=function(e){var t,n,o,i,r;return r=e.targetActivityKey,n=e.pendingCommentActivity,F.log("retry-post-attempt"),v.getInstance().rollbackOptimisticUpdate(n.activity_key),n=n.setStatus("POSTING"),i=q({targetActivityKey:r,pendingCommentActivity:n}),o=i[0],t=i[1],o.catch(function(e){var o;return o=v.getInstance(),o.rollbackOptimisticUpdate(t),o.commitOptimisticUpdate(function(e){var o;return o=W(n,t),e.appendComment(r,o)}),Promise.reject(e)}),l.addedComment(),o.then(function(){return F.log("retry-post-success")})},Q=function(e){var t,n,o;if(Y("addFileComment",[e]))return F.log("add-comment-attempt"),o=_.state.activity.activity_key,n=H({targetActivityKey:o,body:e}),n[0],t=n[1],l.addedComment(),t.then(function(){return F.log("add-comment-success")})},Z=function(e){var t,n,o,i;if(t=_.state.createAnnotation.annotation,null!=t&&Y("addInlineAnnotation",[e]))return F.log("add-annotation-attempt"),i=H({targetActivityKey:_.state.activity.activity_key,body:e,annotation:t}),n=i[0],o=i[1],V(n),l.addedComment(),o.then(function(){return F.log("add-annotation-success")})},X=function(e){var t,n,o,i,r;if(r=e.targetActivityKey,t=e.body,Y("addReply",[{targetActivityKey:r,body:t}]))return F.log("add-reply-attempt"),i=H({targetActivityKey:r,body:t}),n=i[0],o=i[1],V(n),l.addedComment(),o.then(function(){return F.log("add-reply-success")})},V=function(e){return t.defer(function(){return ce({activityKey:e.activity_key,expandConversation:!1})})},J=function(e){var t,n;return t=e.commentActivityKey,F.log("delete-comment-attempt"),assert(null!=_.state.activity.findCommentByKey(t),"Comment activity to delete does not exist: "+t),n=f.deleteComment({actorId:_.state.actorId,context:_.state.viewing.context,contextData:_.state.viewing.contextData,commentActivityKey:t,oref:_.state.oref}),G(n,function(e){return e.purgeCommentByKey(t)}),n.then(function(){return F.log("delete-comment-success")})},ue=function(e){var t,n,o,i,r;return n=e.commentActivityKey,r=e.resolved,F.log("set-resolved-attempt"),t=_.state.activity.findCommentByKey(n),assert(null!=t,"Comment activity to resolve/unresolve does not exist: "+n),i=f.updateResolveComment({actorId:_.state.actorId,context:_.state.viewing.context,contextData:_.state.viewing.contextData,commentActivityKey:n,resolved:r,oref:_.state.oref}),o=t.comment.resolved?function(e){return e.unresolveCommentByKey(n)}:function(e){return e.resolveCommentByKey(n)},G(i,o),i.then(function(){return F.log("set-resolved-success")})},de=function(e){var t,n,o;return t=e.enabled,F.log("set-enabled-attempt"),o=f.updateCommentSetting({actorId:_.state.actorId,context:_.state.viewing.context,contextData:_.state.viewing.contextData,enableComment:t,oref:_.state.oref}),n=_.state.activity.feedback_off?function(e){return e.enableCommenting()}:function(e){return e.disableCommenting()},G(o,n),t?l.enableCommenting():l.disableCommenting(),o.then(function(){return F.log("set-enabled-success")})},pe=function(t){var n,o,r,s,a;return a=t.subscribed,n=m.getActivityUser(_.state.actorId),r=_.state.activity.activity_key,n.is_signed_in?n.is_email_verified?(F.log("set-subscribed-attempt"),s=f.updateFileActivitySubscription({actorId:_.state.actorId,context:_.state.viewing.context,contextData:_.state.viewing.contextData,targetUserEmail:null,subscribed:a,oref:_.state.oref}),a?s.then(function(){return R.success(B("You have been subscribed."))}).catch(function(e){return R.error(B("We failed to unsubscribe you.")),Promise.reject(e)}):s.then(function(){return R.success(B("You have been unsubscribed."))}).catch(function(e){return R.error(B("We failed to unsubscribe you.")),Promise.reject(e)}),s.then(function(){return F.log("set-subscribe-success")})):(o=x.get_for_user(n),x.set_should_use_simple_ui(!1),void o.show_verify_modal(null,i.SUBSCRIBE_TO_COMMENTS)):(u.saveActionCreator({name:"setCommentSubscribed",fileActivityKey:r,args:e.call(arguments)}),M.emit("show-sign-up-modal",{fileActivityKey:r,variant:k.SUBSCRIBE_VARIANT}),void u.logSignUpModal({fileActivityKey:r,originType:T.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.SUBSCRIBE_BUTTON}))},re=function(e){var n,o,i,r,s,a,l;if(r=_.state.activity,o=r.findConversationByKey(e),n=m.getActivityUser(_.state.actorId),null!=o&&n.is_signed_in&&(s=function(e){return!(e.is_pending||e.is_seen)},i=o.comment_activities.filter(s),s(o)&&i.push(o),i.length>0))return F.log("mark-conversation-seen-attempt"),a=t.pluck(i,"activity_key"),l=f.markCommentSeenBatch({isBackgroundRequest:!0,actorId:_.state.actorId,context:_.state.viewing.context,contextData:_.state.viewing.contextData,commentActivityKeys:a}),G(l,function(e){return r.markCommentSeenByKeyBatch(a)}),l.then(function(){return F.log("mark-conversation-seen-success")})},ce=function(e){var t,n;return t=e.activityKey,n=e.expandConversation,M.emit("reveal-comment-in-pane",{activityKey:t,expandConversation:n})},le=function(e){var t,n,o,i,r,s,a;if(i=_.state.activity,null!=i&&(o=i.findConversationByKey(e),null!=o&&null!=(r=o.comment.comment_metadata)?r.annotation:void 0))return s=o.comment.comment_metadata,n=s.annotation,a=s.revision,t=N.createAnnotationFromDict(n),null!=a&&l.switchRevision({revision:a,commentActivity:o}),M.emit("reveal-annotation",{page:t.getFirstPdfPage(),commentActivity:o})},z=function(e){var t,n,o;if(o=_.state.activity,t=m.getActivityUser(_.state.actorId),_.state.viewing.file&&o&&e&&oe(o.latest_revision,e.latest_revision)&&(n=te(_.state.viewing.file,e.latest_revision),b.fastForwardRevision(n)),l.receiveFileActivity(e),t.is_signed_in&&null==o&&null!=e&&u.replayActionCreators({actionCreators:$,fileActivityKey:e.activity_key}),_.state.isPreviewReady&&null==o)return M.emit("preview-and-comments-ready")},K=function(){var e,t;return e=_.state.actorId,t=n.createElement(E,{onOpen:function(){return l.setShouldShowOnboarding(!1),f.markCommentingOnboardingSeen({actorId:e}).catch(function(){})}}),U.showInstance(t)},_e=function(){var e,t,n,o,i,r;if(e=_.state.actorId,r=_.state.shouldShowOnboarding,i=_.state.viewing,t=i.context,n=i.file,o=m.getPreviewType(t,null!=n?n.preview_type:void 0),null!=e&&null!=o){if(null==r)return f.shouldShowCommentingOnboarding({actorId:e}).then(function(e){if(l.setShouldShowOnboarding(e),e)return K()}).catch(function(){});if(r===!0)return K()}},he=function(){if(F.log("show-comments-attempt"),_.areCommentsHidden())return j(!0),l.showComments(),F.log("show-comments-success")},ne=function(){if(F.log("hide-comments-attempt"),!_.areCommentsHidden())return j(!1),l.hideComments(),F.log("hide-comments-success")},j=function(e){return null!=_.state.actorId?f.setCommentingPaneVisibility({actorId:_.state.actorId,shouldShow:e}):f.setSessionCommentingPaneVisibility({shouldShow:e})},ie=function(){return f.setShowCommentsTutorial({actorId:_.state.actorId,shouldShow:!1})},ee=function(e){var t,n;return t=new O(e,_.state.actorId),n=t.next(),n.done(function(e){return l.receiveRevisions(e.revisions)})},M.on("file-activity-updated",z),$=t.extend({},l,{addReply:X,addFileComment:Q,addInlineAnnotation:Z,retryPostingComment:ae,deleteComment:J,setCommentResolved:ue,setCommentSubscribed:pe,setCommentsEnabled:de,markConversationSeen:re,showOnboardingIfNecessary:_e,revealCommentInPane:ce,revealAnnotationInPreview:le,markCommentsTutorialAsDone:ie,showComments:he,hideComments:ne,fetchRevisions:ee})})}.call(this),define("modules/clean/comments/action_creators_helpers",["require","exports","modules/clean/comments/models/comment","modules/clean/comments/store"],function(e,t,n,o){"use strict";function i(e,t){if(e.stickerId||t){var i=t?o.state.activity.latest_revision:null,r=t?t.toMetadataDict():null;return new n.CommentMetadata({revision:i,annotation:r,sticker_id:e.stickerId})}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.buildCommentMetadata=i}),function(){define("modules/clean/comments/actions",["external/underscore","external/reflux"],function(e,t){return t.createActions(e.object(e.map(["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","revealAnnotation","receiveFileActivity","showComments","hideComments","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused","updateAnnotationConversationHover","updateAnnotationUiHover","setRegionCreationEnabled","setShowTutorial","setCurrentTutorialStep","setExpandedComment","setMentionedContact","addedComment","enableCommenting","disableCommenting","cancelAnnotationComment","receiveRevisions"],function(e){return[e,{sync:!0}]})))})}.call(this),define("modules/clean/comments/components/ui_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT=220,t.TUTORIAL_INITIATOR="tutorialInitiator",t.TUTORIAL_CREATE_ANNOTATION="tutorialCreateAnnotation",t.TUTORIAL_CREATE_ANNOTATION_SUCCESS="tutorialCreateAnnotationSuccess",t.TUTORIAL_REPLY="tutorialReply",t.TUTORIAL_REPLY_SUCCESS="tutorialReplySuccess",t.TUTORIAL_MENTION="tutorialMention",t.TUTORIAL_MENTION_SUCCESS="tutorialMentionSuccess"}),define("modules/clean/comments/constants",["require","exports","modules/constants/legacy"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileActivityLogEventType=n.FILE_ACTIVITY_LOG_EVENT_TYPE,t.FileActivityLogClientOriginType=n.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE;(function(e){e[e.MARKER=0]="MARKER",e[e.HIGHLIGHT=1]="HIGHLIGHT",e[e.REGION=2]="REGION"})(t.AnnotationTypes||(t.AnnotationTypes={})),t.AnnotationSubtypes={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}}}),define("modules/clean/comments/demo_action_creators",["require","exports","external/immutable","external/underscore","modules/clean/activity/activity_user","modules/clean/comments/action_creators","modules/clean/comments/action_creators_helpers","modules/clean/comments/actions","modules/clean/comments/models/comment","modules/clean/comments/models/comment_activity","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/contacts/demo_contacts","modules/clean/immutability_helper","modules/core/notify","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m){"use strict";function f(e){var t=g(e);a.receiveFileActivity(t)}function v(e){for(var t,n=/@\[(dbid:demo\-data\-[0-9]+):.+?\]/g,o=[];null!=(t=n.exec(e));)o.push(t[1]);return o}function g(e){if(0===Object.keys(k).length)for(var t=0,o=d.demoContacts;t<o.length;t++){var r=o[t];k[r.dbx_account_id]=i.ActivityUser.fromDict({id:parseInt(r.dbx_account_id.split("-").slice(-1)[0],10),fname:r.fname,lname:r.lname,display_name:r.name,email:r.email})}for(var s=n.Set(),a=0,l=e.comment_activities;a<l.length;a++){var c=l[a],u=c.comment.raw_comment_text;s=s.union(v(u))}var _=[];return s.forEach(function(e){return _.push(k[String(e)])}),_.push(p.getActivityUser(-1)),h.set(e,"users_to_notify",_)}function y(e,t,n){var i=t.text,r=u.state.activity,d=s.buildCommentMetadata(t,n),h=new l.Comment({comment_gid:o.uniqueId("demo-data-"),commenter:p.getActivityUser(-1),comment_text:i,raw_comment_text:i,when_mses:1e3*Date.now(),resolved:!1,comment_metadata:d}),_=new c.CommentActivityPermissions({user_ids_who_can_delete:[-1]}),m=new c.CommentActivity({activity_key:o.uniqueId("demo-data-"),comment_activities:[],users_to_notify:[],is_seen:!0,highlight_as_unread:!1,comment:h,permissions:_,status:"POSTED"}),v=r.appendComment(e,m);return a.addedComment(),f(v),m}function E(e){y(u.state.activity.activity_key,e,null)}function S(e){o.defer(function(){O(e.activity_key,!1)})}function b(e){S(y(e.targetActivityKey,e.body,null))}function w(e){var t=u.state.createAnnotation.annotation;if(t){S(y(u.state.activity.activity_key,e,t))}}function C(e){}function T(e){f(u.state.activity.purgeCommentByKey(e.commentActivityKey))}function A(e){var t,n=u.state.activity,o=e.commentActivityKey,i=e.resolved;t=i?n.resolveCommentByKey(o):n.unresolveCommentByKey(o),f(t)}function I(e){var t=u.state.activity,n=t.users_to_notify,o=[],i=p.getActivityUser(-1);if(e.subscribed)o=h.push(n,i),_.success(m._("You have been subscribed."));else{for(var s=0,a=0,l=n;a<l.length;a++){s=l[a].id!==i.id?s++:s}o=h.splice(n,s,1),_.success(m._("You have been unsubscribed."))}var c=h.set(t,"users_to_notify",o);r.receiveFileActivity(c)}function P(e){}function R(){}function O(e,t){r.revealCommentInPane({activityKey:e,expandConversation:t})}function N(e){r.revealAnnotationInPreview(e)}function L(){}function M(){}var k={};return o.extend({},a,{addFileComment:E,addReply:b,addInlineAnnotation:w,retryPostingComment:C,deleteComment:T,setCommentResolved:A,setCommentSubscribed:I,markConversationSeen:P,showOnboardingIfNecessary:R,revealCommentInPane:O,revealAnnotationInPreview:N,markCommentsTutorialAsDone:L,fetchRevisions:M})}),define("modules/clean/comments/demo_file_activity",["require","exports","external/underscore","modules/core/i18n"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Date.now(),r={dbx_account_id:"dbid:demo_user",initials_url:"",id:-1,photo_url:null,display_name:"Demo User",lname:"User",role:"personal",photo_circle_url:null,fname:"Demo",email:"",unique_id:"dbid:demo_user"};t.demoFileActivity={activity_key:n.uniqueId("demo-data-"),feedback_off:!1,can_edit_feedback:!0,users_to_notify:[r],latest_revision:{direct_blockserver_link:"//dl-web.dropbox.com/get/sample%27%60~%24%25%26%E5%8F%89%E7%87%92.docx?_subject_uid=1&cached=False&generate_preview=True&sjid=3&w=AABUizp6_6TII8-KN2rtsYW-2K5nhkGsEru5G06jfc5sgA&get_preview=True&revision_id=AADPqDXmAC_HT_jbF5QOIC2JkAnqkcMedYLMvB8IL_DAa4Om1dCo2-GyFIkc9ampdt5eNvg8yJG84ocUW1MiUMFScACtdFgtxIqWx9NXrrxsxg",rev_owner:null,preview_link:null,when:i,revision_id:"demo_revision_id"},comment_activity_dicts:[{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[r],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:r,comment_text:o._("Hi there! This sample doc is a space for you to try out Dropbox’s commenting feature."),raw_comment_text:o._("Hi there! This sample doc is a space for you to try out Dropbox’s commenting feature."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[-1]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[r],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:r,comment_text:o._("Keep discussions and feedback all in one place, right next to the file you’re working on."),raw_comment_text:o._("Keep discussions and feedback all in one place, right next to the file you’re working on."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[-1]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[r],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:r,comment_text:o._("You can comment on the entire file by typing in the box at the top of the comment pane."),
raw_comment_text:o._("You can comment on the entire file by typing in the box at the top of the comment pane."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:null},permissions:{user_ids_who_can_delete:[-1]}},{activity_key:n.uniqueId("demo-data-"),comment_activity_dicts:[],users_to_notify:[r],is_seen:!0,highlight_as_unread:!1,comment:{comment_gid:n.uniqueId("demo-data-"),commenter_dict:r,comment_text:o._("You can also add comments to anywhere on the file, like this one."),raw_comment_text:o._("You can also add comments to anywhere on the file, like this one."),when_mses:1e3*Date.now(),resolved:!1,comment_meta_json:{annotation:{type:2,subtype:0,thumbnail_url:"",pdf_coordinates:[{coordinates:[{x:279.1885714285714,y:755.8628571428573},{x:279.1885714285714,y:720.8914285714286},{x:314.16,y:720.8914285714286},{x:314.16,y:755.8628571428573}],page:1,page_size:{height:792,width:612}}]},revision:{revision_id:"demo_revision_id",when:i}}},permissions:{user_ids_who_can_delete:[-1]}}]}}),define("modules/clean/comments/events",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentsEvents=new n,t.CommentsEventsMixin={onCommentsEvent:function(e,n,o){this.__commentsEvents.push([e,n,o]),t.CommentsEvents.on(e,n,o)},componentWillMount:function(){this.__commentsEvents=[]},componentWillUnmount:function(){this.__commentsEvents.forEach(function(e){var n=e[0],o=e[1],i=e[2];t.CommentsEvents.off(n,o,i)}),this.__commentsEvents=null}}}),define("modules/clean/comments/lib/type_check",["require","exports","modules/core/types"],function(e,t,n){"use strict";function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,o,i){i.value=n.takes.apply(void 0,e.concat([i.value]))}}function i(e){return function(t,o,i){i.value=n.returns(e,i.value)}}Object.defineProperty(t,"__esModule",{value:!0}),t.takes=o,t.returns=i}),function(){define("modules/clean/comments/logged_out_utils",["modules/clean/react/file_comments/logger","modules/clean/storage","modules/constants/legacy"],function(e,t,n){var o,i,r,s,a,l,c,u;return a=t.SessionStorage,o=n.FILE_ACTIVITY_LOG_EVENT_TYPE,i="commenting_actions",s="v1",r=i+":"+s,l=function(t){var n,i,r,s;return i=t.fileActivityKey,n=null!=(s=t.commentActivityKey)?s:null,r=t.originType,e.log_event(o.CLIENT_SIGN_UP_MODAL,i,n,r)},u=function(e){var t,n,o,i,s,l,c;s=e.name,i=e.fileActivityKey,n=e.args;try{return c=r+":"+i,t=null!=(l=a.get(c))?l:[],t.push({name:s,args:n}),a.set(c,t)}catch(e){o=e,console.error(o)}},c=function(e){var t,n,o,i,s,l;t=e.actionCreators,i=e.fileActivityKey;try{return l=r+":"+i,n=null!=(s=a.get(l))?s:[],a.set(l,null),n.forEach(function(e){var n,o;return o=e.name,n=e.args,t[o].apply(t,n)})}catch(e){o=e,console.error(o)}},{logSignUpModal:l,saveActionCreator:u,replayActionCreators:c}})}.call(this),define("modules/clean/comments/logging",["require","exports","modules/clean/comments/store","modules/clean/react/file_comments/logger"],function(e,t,n,o){"use strict";function i(e,t){var i=n.state,r=i.actorId,s=i.activity,a=i.viewing.context;try{o.log_event(e,s.activity_key,null,t,r,a)}catch(e){console.warn("logEvent failed",e)}}function r(e,t){var i=n.state,r=i.actorId,s=i.activity,a=i.viewing.context,l=s.findCommentByKey(t);try{o.log_annotation_event(e,s.activity_key,t,r,a,l.comment.comment_metadata.annotation)}catch(e){console.warn("logAnnotationEvent failed",e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.logEvent=i,t.logAnnotationEvent=r}),define("modules/clean/comments/models/comment",["require","exports","tslib","external/underscore","external/deep-freeze","modules/core/types","modules/clean/immutability_helper","modules/clean/comments/lib/type_check","modules/clean/activity/activity_user"],function(e,t,n,o,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){var t=void 0===e?{}:e,n=t.revision,o=void 0===n?null:n,r=t.annotation,s=void 0===r?null:r,a=t.sticker_id,l=void 0===a?null:a,c=t.thumbnail_url,u=void 0===c?null:c;this.revision=o,this.annotation=s,this.sticker_id=l,this.thumbnail_url=u,i(this)}return e.fromDict=function(t){return new e({revision:t.revision,annotation:t.annotation,sticker_id:t.stickers&&t.stickers.id,thumbnail_url:t.thumbnail_url})},e.prototype.toDict=function(){return o.pick({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},e.prototype.hasRevisionData=function(){return null!=this.revision},e.prototype.hasAnnotationData=function(){return null!=this.annotation},e.prototype.hasStickerData=function(){return null!=this.sticker_id},e.prototype.hasThumbnailUrl=function(){return null!=this.thumbnail_url},e.prototype.getStickerId=function(){return this.sticker_id},e})();n.__decorate([a.takes({revision:r.Any,annotation:r.Any,stickers:r.Maybe({id:Number}),thumbnail_url:r.Maybe(String)})],c,"fromDict",null),t.CommentMetadata=c;var u=(function(){function e(e){var t=void 0===e?{}:e,n=t.comment_gid,o=void 0===n?"":n,r=t.commenter,s=void 0===r?l.ActivityUser.anonymous:r,a=t.comment_text,c=void 0===a?"":a,u=t.raw_comment_text,p=void 0===u?"":u,d=t.when_mses,h=void 0===d?0:d,_=t.resolved,m=void 0!==_&&_,f=t.comment_metadata,v=void 0===f?null:f;this.comment_gid=o,this.commenter=s,this.comment_text=c,this.raw_comment_text=p,this.when_mses=h,this.resolved=m,this.comment_metadata=v,i(this)}return e.fromDict=function(t){var n=t.comment_meta_json;return new e({comment_gid:t.comment_gid,commenter:l.ActivityUser.fromDict(t.commenter_dict),comment_text:t.comment_text,raw_comment_text:t.raw_comment_text,when_mses:t.when_mses,resolved:t.resolved,comment_metadata:n?c.fromDict(n):null})},e.prototype.hasMetadata=function(){return null!=this.comment_metadata},e.prototype.resolve=function(){return s.set(this,"resolved",!0)},e.prototype.unresolve=function(){return s.set(this,"resolved",!1)},e})();n.__decorate([a.takes({comment_gid:String,commenter_dict:r.Any,comment_text:String,raw_comment_text:String,when_mses:Number,resolved:Boolean,comment_meta_json:r.Maybe(Object)})],u,"fromDict",null),t.Comment=u}),define("modules/clean/comments/models/comment_activity",["require","exports","tslib","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment"],function(e,t,n,o,i,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(e){var t=(void 0===e?{}:e).user_ids_who_can_delete,n=void 0===t?[]:t;this.user_ids_who_can_delete=n,o(this)}return e.fromDict=function(t){return t.user_ids_who_can_delete.forEach(function(e){if(!i.isNumber(e))throw TypeError(e+" in user_ids_who_can_delete is not a number")}),new e(t)},e})();n.__decorate([l.takes({user_ids_who_can_delete:Array})],u,"fromDict",null),t.CommentActivityPermissions=u;var p=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,i=void 0===n?"":n,r=t.comment_activities,s=void 0===r?[]:r,a=t.users_to_notify,l=void 0===a?[]:a,p=t.is_seen,d=void 0!==p&&p,h=t.highlight_as_unread,_=void 0!==h&&h,m=t.comment,f=void 0===m?new c.Comment:m,v=t.permissions,g=void 0===v?new u:v,y=t.status,E=void 0===y?"POSTED":y;this.activity_key=i,this.comment_activities=s,this.users_to_notify=l,this.is_seen=d,this.highlight_as_unread=_,this.comment=f,this.permissions=g,this.status=E,o(this)}return e.createLocalInstance=function(t){var n=t.activityKey,o=void 0===n?i.uniqueId("local-comment-activity-"):n,r=t.commenter,s=t.rawCommentText,a=t.metadata,l=void 0===a?null:a,u=t.status,p=void 0===u?"POSTING":u;return new e({activity_key:o,comment:new c.Comment({comment_gid:i.uniqueId("pending-comment-gid-"),commenter:r,comment_text:s,raw_comment_text:s,when_mses:(new Date).getTime(),resolved:!1,comment_metadata:l}),is_seen:!0,highlight_as_unread:!1,status:p})},e.fromDict=function(t){return new e({activity_key:t.activity_key,comment_activities:t.comment_activity_dicts.map(e.fromDict),users_to_notify:(t.users_to_notify||[]).map(a.ActivityUser.fromDict),is_seen:t.is_seen,highlight_as_unread:t.highlight_as_unread,comment:c.Comment.fromDict(t.comment),permissions:u.fromDict(t.permissions)})},Object.defineProperty(e.prototype,"when_mses",{get:function(){return this.comment.when_mses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_pending",{get:function(){return"POSTED"!==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_resolved",{get:function(){return this.comment.resolved},enumerable:!0,configurable:!0}),e.prototype.shouldHighlightAsUnread=function(){return!!this.highlight_as_unread||this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},e.prototype.resolve=function(){return s.set(this,"comment",this.comment.resolve())},e.prototype.unresolve=function(){return s.set(this,"comment",this.comment.unresolve())},e.prototype.setStatus=function(e){return s.set(this,"status",e)},e.prototype.markSeen=function(){return s.merge(this,{is_seen:!0,highlight_as_unread:!1})},e})();n.__decorate([l.takes({activity_key:String,comment_activity_dicts:Array,users_to_notify:r.Maybe(Array),is_seen:Boolean,highlight_as_unread:Boolean,comment:Object,permissions:Object})],p,"fromDict",null),t.CommentActivity=p}),function(){define("modules/clean/comments/models/loading_spinner",[],function(){return function(e,t){return(null==t||t.comment_activities.length>0)&&e}})}.call(this),function(){define("modules/clean/comments/models/preview_types",[],function(){return{PDF:0,IMAGE:1}})}.call(this),function(){define("modules/clean/comments/revisions",["external/underscore"],function(e){var t,n,o,i,r;return n=function(t,n){return null!=t.set?t.merge({preview_url:n.preview_link,direct_blockserver_link:n.direct_blockserver_link}):e.extend({},t,{preview_url:n.preview_link,direct_blockserver_link:n.direct_blockserver_link})},t=function(e,t){return t.when-e.when},r=function(e,n){return t(e,n)>0},i=function(e,n){return t(e,n)<0},o=function(e,n){return 0===t(e,n)},{getFileWithRevision:n,compareRevision:t,isRevisionOlderThan:r,isRevisionNewerThan:i,isRevisionEqual:o}})}.call(this),function(){define("modules/clean/comments/store",["external/underscore","external/reflux","modules/constants/comments_panel","modules/constants/legacy","modules/core/exception","modules/core/i18n","modules/clean/annotations/annotation","modules/clean/annotations/annotation","modules/clean/comments/actions","modules/clean/comments/demo_file_activity","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/comments/components/ui_constants","modules/clean/file_activity/models/file_activity","modules/clean/react/file_viewer/actions","modules/clean/react/file_comments/logger"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f){var v,g,y,E,S,b,w,C,T,assert,A;return assert=i.assert,r._,s.Annotation,a.AnnotationTypes,A=c.demoFileActivity,v=u.CommentsEvents,S=h.TUTORIAL_INITIATOR,C=h.TUTORIAL_REPLY,T=h.TUTORIAL_REPLY_SUCCESS,b=h.TUTORIAL_MENTION,w=h.TUTORIAL_MENTION_SUCCESS,y=h.TUTORIAL_CREATE_ANNOTATION,E=h.TUTORIAL_CREATE_ANNOTATION_SUCCESS,g=_.FileActivity,t.createStore({listenables:l,init:function(){return this.state=this.getInitialState()},getInitialState:function(){return{actorId:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,regionCreationEnabled:!1,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},shouldShowOnboarding:void 0,showTutorial:n.SHOW_COMMENTS_TUTORIAL,currentTutorialStep:S,showCommentsPref:n.SHOW_COMMENTS_PANEL,revisions:null}},setState:function(t){return e.extend(this.state,t),this.trigger(this.state)},replaceState:function(e){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){var t,n,o,i,r;if(null!=(o=this.state.activity)?o.users_to_notify:void 0)for(i=this.state.activity.users_to_notify,t=0,n=i.length;t<n;t++)if(r=i[t],r.id===e)return!0;return!1},isCommentingEnabled:function(){return this.state.activity?!this.state.activity.feedback_off:null==this.state.viewing.file||!this.state.viewing.file.feedback_off},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){var e;return null!=(e=this.state.activity)?e.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},hasUnreadComments:function(){var e;return!!(null!=(e=this.state.activity)?e.comment_activities.some(function(e){return e.shouldHighlightAsUnread()}):void 0)},areCommentsHidden:function(){return null!=this.state.viewing.showCommentsOverride?!this.state.viewing.showCommentsOverride:this.state.showCommentsPref===!1?!this.hasUnreadComments():!this.isCommentingEnabled()},unreadCommentCount:function(){var e,t;return null==this.state.activity?null:(e=function(e){return e.highlight_as_unread&&!e.comment.resolved},t=function(t,n){return n.comment.resolved?t:(e(n)&&(t+=1),t+=n.comment_activities.filter(e).length)},this.state.activity.comment_activities.reduce(t,0))},isTutorialShown:function(){return null!=this.state.viewing.showTutorialOverride?this.state.viewing.showTutorialOverride:this.state.showTutorial},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latest_revision),this.setState({activity:e})},onStartViewingComments:function(e){var t,n,o,i,r,s,a,l;return t=e.actorId,n=e.context,o=e.contextData,r=e.oref,i=e.file,e.previewSelector,s=e.showCommentsOverride,l=e.showTutorialOverride,a=null===this.state.contextData||p(this.state.showLoadingSpinner,this.state.activity),this.setState({actorId:t,viewing:{context:n,contextData:o,file:i,revision:null,showCommentsOverride:s,showTutorialOverride:l},oref:r,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:a,annotationText:null,annotationReplyTextByKey:{}})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null,showTutorialOverride:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,annotationText:null,annotationReplyTextByKey:{},revisions:null})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onNotifyPreviewReady:function(){if(this.setState({isPreviewReady:!0}),null!=this.state.activity)return v.emit("preview-and-comments-ready")},onUpdateAnnotationConversationHover:function(t){var n;if(null!=this.state.viewAnnotation)return n=e.extend({},this.state.viewAnnotation,{conversationHover:t}),this.setState({viewAnnotation:n})},onUpdateAnnotationUiHover:function(t){var n;if(null!=this.state.viewAnnotation)return n=e.extend({},this.state.viewAnnotation,{annotationHover:t}),this.setState({viewAnnotation:n})},onShowAnnotationConversation:function(e){var t,n;return n=e.annotation,t=e.activityKey,assert(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),assert(null!=n,"Invalid annotation to show"),assert(null!=this.state.activity.findConversationByKey(t),"Invalid inline comment to show: "+t),this.setState({viewAnnotation:{annotation:n,activityKey:t,replyFocused:!1,annotationHover:!0,conversationHover:!1}})},onHideAnnotationConversation:function(){return this.setState({viewAnnotation:null})},onUpdateAnnotationReplyFocused:function(t){var n;if(null!=this.state.viewAnnotation)return n=e.extend({},this.state.viewAnnotation,{replyFocused:t}),this.setState({viewAnnotation:n})},onStartAnnotationCreation:function(e){var t;return t=e.annotation,this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}}),this._updateTutorial()},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(t){var n,o,i,r;return n=t.activityKey,r=t.text,n in this.state.annotationReplyTextByKey&&!r?(o=e.omit(this.state.annotationReplyTextByKey,n),this.setState({annotationReplyTextByKey:o})):(o=e.extend({},this.state.annotationReplyTextByKey,(i={},i[""+n]=r,i)),this.setState({annotationReplyTextByKey:o}))},onShowAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}})},onHideAnnotationInput:function(){if(null!=this.state.createAnnotation)return this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}})},onSwitchRevision:function(t){var n,i,r,s,a;if(a=t.revision,n=t.commentActivity,assert(null!=a,"Revision to switch to must not be null!"),assert(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),!d.isRevisionEqual(a,this.state.viewing.revision))return d.isRevisionEqual(a,this.state.activity.latest_revision)?(i=o.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION,m.restoreRevision()):(i=o.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION,r=d.getFileWithRevision(this.state.viewing.file,a),m.switchRevision(r)),this.setState({viewing:e.extend({},this.state.viewing,{revision:a}),isPreviewReady:!1}),v.emit("revision-did-change"),f.log_annotation_event(i,this.state.activity.activity_key,null!=n?n.activity_key:void 0,this.state.actorId,this.state.viewing.context,null!=n&&null!=(s=n.comment.comment_metadata)?s.annotation:void 0)},onShowComments:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!0}),showCommentsPref:!0})},onHideComments:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!1}),viewAnnotation:null,createAnnotation:null,showCommentsPref:!1})},onSetRegionCreationEnabled:function(e){return this.setState({regionCreationEnabled:e,viewAnnotation:null,createAnnotation:null})},onAddedComment:function(){return this.onShowComments(),this.onCancelAnnotationComment()},onCancelAnnotationComment:function(){var e;return null!=this.state.createAnnotation?(this.onStopAnnotationCreation(),this.onUpdateAnnotationText(null)):null!=this.state.viewAnnotation?(e=this.state.viewAnnotation.activityKey,this.onHideAnnotationConversation(),this.onUpdateAnnotationReplyText({activityKey:e,text:null})):void 0},onEnableCommenting:function(){return this.onShowComments()},onDisableCommenting:function(){},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})},onSetShowTutorial:function(t){return n.SHOW_COMMENTS_TUTORIAL=t,this.setState({showTutorial:t,viewing:e.extend(this.state.viewing,{showTutorialOverride:null})})},onSetCurrentTutorialStep:function(e){return this.setState({currentTutorialStep:e})},onSetExpandedComment:function(e){return this.setState({expandedComment:e}),this._updateTutorial()},onSetMentionedContact:function(e){return this.setState({mentionedContact:e}),this._updateTutorial()},_updateTutorial:function(){return this.state.currentTutorialStep===y&&null!=this.state.createAnnotation?this.setState({currentTutorialStep:E}):this.state.currentTutorialStep===C&&this.state.expandedComment?this.setState({currentTutorialStep:T}):this.state.currentTutorialStep===b&&this.state.mentionedContact?this.setState({currentTutorialStep:w}):void 0},onReceiveRevisions:function(e){return this.setState({revisions:e})},demoLoadData:function(){return this.onReceiveFileActivity(g.fromDict(A))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/utils",["modules/clean/annotations/annotation","modules/clean/activity/constants","modules/clean/activity/activity_user","modules/clean/comments/models/preview_types","modules/clean/comments/revisions","modules/clean/comments/store","modules/clean/react/file_viewer/store","modules/clean/viewer","modules/constants/comments_panel","modules/core/exception","modules/core/i18n"],function(t,n,o,i,r,s,a,l,c,u,p){var d,h,_,m,f,v,g,y,E,S,b,w;return t.Annotation,d=n.ActivityContext,h=o.ActivityUser,S=r.isRevisionEqual,_=a.FileViewerStore,p._,g=function(e){var t;return e===-1?new h({id:-1,fname:"Demo",lname:"User",display_name:"Demo User",email:"demo_user@example.com",initials:"DU",is_email_verified:!0,is_signed_in:!0}):(t=l.get_viewer(),null!=e?h.fromUser(t.get_user_by_id(e)):t.work_user||t.personal_user?h.fromUser(t.work_user||t.personal_user):t.is_signed_in?void 0:new h)},y=function(t,n){var o;if(o=[d.BROWSE_FILE_VIEWER,d.SHARED_LINK_VIEW,d.SHARED_CONTENT_LINK_VIEW],e.call(o,t)>=0&&null!=n){if("photo"===n)return i.IMAGE;if("doc"===n||"adobecs"===n)return i.PDF}return null},f=function(e){return g(e.actorId).is_signed_in},m=function(){var e;return!!s.isFileActivityReady()&&(e=s.isCommentingEnabled(),c.ALLOW_VIEW_ANNOTATE_MODES||(e=e&&!s.areCommentsHidden()),e)},v=function(e){var t;return!!s.isFileActivityReady()&&(t=f(s.state),null==e&&(e=_.instance.getIsFullscreen()),t&&m()&&!e&&S(s.state.viewing.revision,s.state.activity.latest_revision))},E=function(){return!!v()&&(c.ALLOW_VIEW_ANNOTATE_MODES?s.state.regionCreationEnabled:!s.areCommentsHidden())},w=function(){return!s.areCommentsHidden()&&m()},b=function(){return this.keyCode||this.which||this.charCode},{normalizedKeyCode:b,canAnnotate:v,getActivityUser:g,getPreviewType:y,isRegionCreationEnabled:E,shouldShowExistingAnnotations:w}})}.call(this),define("modules/clean/contacts/bloodhound_contacts_v2",["require","exports","external/bloodhound","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/profile_services/profile_services_link","modules/clean/viewer","modules/core/cookies"],function(e,t,n,o,i,r,s,a){"use strict";function l(e,t){c(e,t.includeForUser(e.id).contacts)}function c(e,t){if(e.id in p){var n=p[e.id];t=t.filter(i.ContactCommon.is_valid),n.clearRemoteCache(),n.clear(),n.add(t)}}function u(e){var t=document.createElement("a");t.href=e;var n=t.hostname||window.location.hostname;if(n.indexOf(".dropbox.com",n.length-".dropbox.com".length)===-1)throw new Error("Cannot send the CSRF token to "+n);return e}Object.defineProperty(t,"__esModule",{value:!0});var p={};t.BloodhoundContactsV2={getOrCreateForUser:function(e){if(e.id in p)return p[e.id];var t,c=o.getSearchConfigForUser(e);if(c.remoteEndpoint){var d=String(e.id);t={url:u(c.remoteEndpoint),prepare:function(e,t){return t.type="POST",t.headers={"X-CSRF-Token":a.read("__Host-js_csrf"),"X-Dropbox-Uid":d},t.data={query:JSON.stringify(e)},t.data._subject_uid=d,t},rateLimitBy:"debounce",rateLimitWait:c.remoteDebounceWait}}var h=new n({datumTokenizer:i.ContactCommon.get_index_tokens,queryTokenizer:n.tokenizers.whitespace,identify:i.ContactCommon.get_key,sufficient:c.sufficientResults,sorter:i.ContactCommon.sorter,local:[],remote:t});if(p[e.id]=h,s.get_viewer().is_user_signed_in(e)){var _=c.localCacheStore.getOrCreateForUser(e);_.load_contacts(!1,function(t){l(e,t),_.register_for_updates("bloodhound_contacts_v2",function(t){l(e,t)})})}return r.LinkedProfileServices.get_linked_profile_services_for_user(e.id).register_for_service_changes("bloodhound_contacts_v2",function(e){h.clearRemoteCache()}),p[e.id]},search:function(e,n,i,r){var s=t.BloodhoundContactsV2.getOrCreateForUser(e),a=o.getSearchConfigForUser(e);if(!n)return i([]),void(r&&a.remoteEndpoint&&r([]));var l=a.localCacheStore.getOrCreateForUser(e);l.is_loaded()?s.search(n,i,r):l.load_contacts(!1,function(e){s.search(n,i,r)}),l.refresh_contacts(!1)}}}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},t=function(e,t){return function(){return e.apply(t,arguments)}},n=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},o={}.hasOwnProperty;define("modules/clean/contacts/cache",["jquery","modules/core/browser","modules/core/exception","modules/clean/ajax","modules/clean/bolt","modules/clean/contacts/cache_type","modules/clean/contacts/list","modules/clean/profile_services/profile_services_constants","modules/clean/user","modules/clean/viewer","modules/constants/contacts"],function(o,i,r,s,a,l,c,u,p,d,h){var _,m,f,v,g,assert;return assert=r.assert,m=l.CONTACT_CACHE_TYPE_TO_CONFIG,f=l.ContactCacheType,1e3,v=(function(){function t(e){this.callbacks={},this.one_time_callbacks=[],this.cached_contacts=null,this._cache_download_name=e,this.should_force_refresh=!1,this.request_perf_records=[],this._config=null}return t.MAX_REQUEST_PERF_RECORDS=20,t.prototype.register_for_updates=function(e,t){return this.callbacks[e]=t},t.prototype.unregister_for_updates=function(e){if(null!=this.callbacks[e])return delete this.callbacks[e]},t.prototype.get_contacts_count=function(){return null!=this.cached_contacts?this.cached_contacts.length():0},t.prototype.get_downloaded_time=function(){var e,t;return e=null!=(t=i.performance())&&"function"==typeof t.getEntriesByName?t.getEntriesByName(this._get_contacts_downloaded_mark_name()):void 0,e&&e.length?e[0].startTime:null},t.prototype.get_request_perf_records=function(){return this.request_perf_records},t.prototype._is_contact_get_or_check_ajax_request=function(e){var t,n;return t=e.initiatorType,n=e.name,"xmlhttprequest"===t&&n.endsWith(this._config.getUrl)},t.prototype._find_last_perf_entry=function(e){var t,n,o,r,s;if(null==e&&(e=500),s=null!=(r=i.performance())&&"function"==typeof r.getEntriesByType?r.getEntriesByType("resource"):void 0,null!=s?s.length:void 0)for(o=Math.min(s.length-1,e),t=n=o;n>=0;t=n+=-1)if(this._is_contact_get_or_check_ajax_request(s[t]))return s[t];return null},t.prototype._record_perf_stats=function(e){var n;if(null==e&&(e={}),n=this._find_last_perf_entry(),n&&(e.ttfb=n.responseStart-n.requestStart,e.downloading_time=n.responseEnd-n.responseStart,e.duration=n.duration,this.request_perf_records.push(e),this.request_perf_records.length>t.MAX_REQUEST_PERF_RECORDS))return this.request_perf_records=this.request_perf_records.slice(this.request_perf_records.length-1)},t.prototype._fetch_contacts=function(){return s.BackgroundRequest({url:this._get_request_url(),data:this._get_request_params(),success:(function(e){return function(t,n,o){var i;if(i=JSON.parse(t),e._contacts_loaded_callback(i),e._schedule_fetch)return e._schedule_fetch()}})(this)})},t.prototype._get_versioned_params=function(e,t){var n;return null==t&&(t=!0),n={version:e},t&&(n.force_refresh=this.should_force_refresh,this.should_force_refresh=!1),null!=this.digest&&(n.digest=this.digest),null!=this.limit&&(n.limit=this.limit),n},t.prototype._get_contacts_downloaded_mark_name=function(){return this._cache_download_name+"-"+this.instance},t.prototype._is_page_hidden=function(){return null!=window.document.visibilityState&&window.document.hidden},t.prototype._add_one_time_callback=function(t){if(null!=t&&e.call(this.one_time_callbacks,t)<0)return this.one_time_callbacks.push(t)},t.prototype._invoke_all_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0),this._invoke_callbacks(this.callbacks,e,!1)},t.prototype._invoke_one_time_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0)},t.prototype._invoke_callbacks=function(e,t,n){var o,i,r,s,a;for(s=Object.keys(e),a=[],o=0,r=s.length;o<r;o++)i=s[o],e[i](t),n?a.push(delete e[i]):a.push(void 0);return a},t})(),_=(function(o){function r(e,n,o){this.cache_type=e,this.limit=null!=n?n:null,this.user_id=null!=o?o:null,this.bolt_refresh_callback=t(this.bolt_refresh_callback,this),this.bolt_update_callback=t(this.bolt_update_callback,this),r.__super__.constructor.call(this,"BoltContactsCache download"),this.instance=r.INSTANCE++,this.loading_state=r.BOLT_NEED_TO_SEND_REQUEST,this._config=m[f[this.cache_type]],this.current_bolt_states=null,this._notified_states={},this._bolt=null,this._last_refresh_ts=null}return n(r,o),r.INSTANCE=0,r.BOLT_NEED_TO_SEND_REQUEST=0,r.BOLT_REQUEST_SENT=1,r.REFRESH_THRESHOLD=36e5,r.prototype.load_contacts=function(e,t){if(d.get_viewer().is_signed_in)return this._add_one_time_callback(t),(this.loading_state===r.BOLT_NEED_TO_SEND_REQUEST||e)&&(this.loading_state=r.BOLT_REQUEST_SENT,e&&(this.should_force_refresh=!0),this._fetch_contacts()),!this._should_update_contacts()&&this.is_loaded()?this._invoke_one_time_callbacks(this.cached_contacts):void 0},r.prototype.refresh_contacts=function(e){var t,n;if(null==e&&(e=!1),t=null!=(n=i.performance())&&"function"==typeof n.now?n.now():void 0,this._last_refresh_ts||(e=!0),!(!e&&this._last_refresh_ts&&t-this._last_refresh_ts<r.REFRESH_THRESHOLD))return s.BackgroundRequest({url:this._get_refresh_url(),data:this._get_refresh_params({force_refresh:e})}),this._last_refresh_ts=t},r.prototype.is_loaded=function(){return null!=this.cached_contacts},r.prototype.bolt_update_callback=function(t){var n,o,i,s;for(o=0,i=t.length;o<i;o++)n=t[o],s=n.unique_id,(e.call(this._notified_states,s)<0||+this._notified_states[n.unique_id].revision<+n.revision)&&(this._notified_states[n.unique_id]=n);return this._should_update_contacts()&&(this.loading_state=r.BOLT_NEED_TO_SEND_REQUEST),this.load_contacts()},r.prototype.bolt_refresh_callback=function(e){var t;if(null!=(t=this._bolt)&&t.unsubscribe(),this._bolt=null,this.loading_state=r.BOLT_NEED_TO_SEND_REQUEST,!this._is_page_hidden())return this.load_contacts()},r.prototype._contacts_loaded_callback=function(e){var t,n,o;if(!this._is_old_contacts(e.bolt_info)&&(t=this._is_new_contacts(e.bolt_info),this.current_bolt_states=e.bolt_info,null==this._bolt&&this._subscribe_to_bolt(),t&&(null!=(n=e.contacts)?n.length:void 0)))return this._record_perf_stats({num_contacts:e.contacts.length}),this.digest=e.digest,this._create_contacts_list(e.contacts),this._invoke_all_callbacks(this.cached_contacts),null!=(o=i.performance())&&"function"==typeof o.mark?o.mark(this._get_contacts_downloaded_mark_name()):void 0},r.prototype._create_contacts_list=function(e){return this.cached_contacts=c.create_contacts_list(e)},r.prototype._subscribe_to_bolt=function(){var e,t,n,o;t=[],n=this.current_bolt_states;for(o in n)e=n[o],t.push(new a.SignedChannelState(this._config.boltAppId,o.toString(),e.revision,e.token));return this._bolt=new a.BoltClient(t,this.bolt_update_callback,this.bolt_refresh_callback),this._bolt.start()},r.prototype._is_new_contacts=function(e){return this._first_contacts_are_newer(e,this.current_bolt_states)},r.prototype._is_old_contacts=function(e){return this._first_contacts_are_newer(this.current_bolt_states,e)},r.prototype._first_contacts_are_newer=function(e,t){var n,o,i,r;if(!t)return!0;for(i in t){r=t[i];for(n in e)if(o=e[n],n===i&&+r.revision<+o.revision)return!0}return!1},r.prototype._should_update_contacts=function(){return this._is_new_contacts(this._notified_states)},r.prototype._get_request_params=function(){return this._get_versioned_params(1)},r.prototype._get_request_url=function(){return this._config.getUrl},r.prototype._get_refresh_params=function(e){return null==e&&(e={}),e},r.prototype._get_refresh_url=function(){return this._config.refreshUrl},r})(v),g=(function(e){function t(e,n){this.cache_type=e,this.user=n,assert(null!=this.user.id),t.__super__.constructor.call(this,this.cache_type,null)}return n(t,e),t.prototype._get_request_params=function(){var e;return e=this._get_versioned_params(1),e._subject_uid=this.user.id,e},t.prototype._get_refresh_params=function(e){return null==e&&(e={}),e._subject_uid=this.user.id,e},t.prototype._create_contacts_list=function(e){
return this.cached_contacts=c.create_per_user_contacts_list(e,this.user.id)},t})(_),{BoltContactsCache:_,ContactsCacheProto:v,PerUserBoltContactsCache:g}})}.call(this),define("modules/clean/contacts/cache_store",["require","exports","tslib","modules/clean/contacts/cache_type","modules/clean/contacts/cache","modules/constants/contacts","modules/clean/viewer"],function(e,t,n,o,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(e){this.cacheType=e}return e})();t.BoltContactsCacheStore=a;var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getOrCreateForUser=function(e){if(!s.get_viewer().is_uid_associated(e.id))throw new Error("Requested contacts cache for a user not associated with the current viewer.");return this.getOrCreateForViewer()},t.prototype.getOrCreateForViewer=function(){return null==this.contactsCache&&(this.contactsCache=new i.BoltContactsCache(this.cacheType)),this.contactsCache},t})(a);t.PerViewerBoltContactsCacheStore=l;var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uidToContactsCache={},t}return n.__extends(t,e),t.prototype.getOrCreateForUser=function(e){return e.id in this.uidToContactsCache||(this.uidToContactsCache[e.id]=new i.PerUserBoltContactsCache(this.cacheType,e)),this.uidToContactsCache[e.id]},t})(a);t.PerUserBoltContactsCacheStore=c,t.DefaultContactsCacheStore=new l(o.ContactCacheType.ALL);var u=t.DefaultContactsCacheStore;"OFF"!==r.LEGACY_CACHE_LIMIT&&(u=new l(o.ContactCacheType.ALL),u.contactsCache=new i.BoltContactsCache(o.ContactCacheType.ALL,+r.LEGACY_CACHE_LIMIT)),t.LegacyContactsCacheStore=u,t.IndividualContactsCacheStore=new c(o.ContactCacheType.INDIVIDUAL)}),define("modules/clean/contacts/cache_type",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.ALL=0]="ALL",e[e.INDIVIDUAL=1]="INDIVIDUAL"})(t.ContactCacheType||(t.ContactCacheType={})),t.CONTACT_CACHE_TYPE_TO_CONFIG={ALL:{getUrl:"/contacts/get",refreshUrl:"/contacts/refresh",boltAppId:"contacts_cache_notify"},INDIVIDUAL:{getUrl:"/contacts/get_individual_for_user",refreshUrl:"/contacts/refresh_individual_for_user",boltAppId:"individual_contacts_cache_notify"}}}),define("modules/clean/contacts/config",["require","exports","modules/constants/contacts","modules/clean/contacts/cache_store"],function(e,t,n,o){"use strict";function i(e){return n.MERGE_SEARCH_ALLOWED[e.id]?s.INDIVIDUAL_LOCAL_TEAM_REMOTE:s.ALL_LOCAL}function r(e){return t.CONTACTS_SEARCH_MODE_TO_CONFIG[s[i(e)]]}Object.defineProperty(t,"__esModule",{value:!0});var s;(function(e){e[e.ALL_LOCAL=0]="ALL_LOCAL",e[e.INDIVIDUAL_LOCAL_TEAM_REMOTE=1]="INDIVIDUAL_LOCAL_TEAM_REMOTE"})(s=t.ContactsSearchMode||(t.ContactsSearchMode={})),t.LOCAL_ONLY_SEARCH_MODES=[s.ALL_LOCAL],t.CONTACTS_SEARCH_PREEMPTED_THRESHOLD=300,t.CONTACTS_SEARCH_DEBOUNCE_WAIT=10,t.CONTACTS_SEARCH_MODE_TO_CONFIG={ALL_LOCAL:{localCacheStore:o.DefaultContactsCacheStore,sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT},INDIVIDUAL_LOCAL_TEAM_REMOTE:{localCacheStore:o.IndividualContactsCacheStore,remoteEndpoint:"/team/search_contacts",remoteBatchEndpoint:"/team/search_contacts_batch",sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT}},t.getSearchModeForUser=i,t.getSearchConfigForUser=r}),define("modules/clean/contacts/contact",["require","exports","modules/clean/contacts/types","modules/core/exception"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(){}return e.sorter=function(e,t){return t.domain_contact&&!e.domain_contact?-1:e.domain_contact&&!t.domain_contact?1:e.sort_key||t.sort_key?e.sort_key?t.sort_key?e.sort_key>t.sort_key?-1:e.sort_key<t.sort_key?1:0:-1:1:0},e.is_valid=function(e){return e.dbx_account_id?e.type===n.DBX_ID||e.type===n.EMAIL:e.group_id?e.type===n.NEW_STYLE_GROUP:!!e.email&&e.type===n.EMAIL},e.get_key=function(t){return o.assert(e.is_valid(t),"invalid contact: type: "+t.type),t.dbx_account_id?"DBX_USER-"+t.dbx_account_id:t.group_id?"DBX_GROUP-"+t.group_id:"CONTACT-"+t.type+"-"+t.email},e.get_index_tokens=function(e){var t=[];return e.name&&t.push(e.name),e.email&&t.push(e.email),e.fname&&t.push(e.fname),e.lname&&t.push(e.lname),e.name_tokens&&(t=t.concat(e.name_tokens)),t},e})();t.ContactCommon=i;var r=(function(){function e(e){var t=e.dbx_account_id,n=e.type,o=e.name,i=e.email,r=e.fb_id,s=e.group_id,a=e.group_size,l=e.photo_url,c=e.members,u=e.avatar_url,p=e.invalid,d=e.on_team,h=e.domain_contact,_=e.dbx_team_id,m=e.nameMatch,f=e.emailMatch,v=e.pending,g=e.query;this.dbx_account_id=t,this.type=n,this.name=o,this.email=i,this.fb_id=r,this.group_id=s,this.group_size=a,this.photo_url=l,this.members=c,this.avatar_url=u,this.invalid=p,this.on_team=d,this.domain_contact=h,this.dbx_team_id=_,this.nameMatch=m,this.emailMatch=f,this.pending=v,this.query=g,this.unique_key=this.name+"-"+this.getContactID()+"-"+this.dbx_account_id,this.team=this.on_team}return e.prototype.getKey=function(){return i.get_key(this)},e.prototype.getContactID=function(){switch(this.type){case n.FB:return this.fb_id;case n.NEW_STYLE_GROUP:return this.group_id;default:return this.email}},e})();t.Contact=r}),define("modules/clean/contacts/data_v2",["require","exports","modules/clean/ajax","modules/clean/contacts/bloodhound_contacts_v2","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/contacts/types","modules/clean/fuzzy"],function(e,t,n,o,i,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(e,t,n){void 0===n&&(n=!0),this.query=this.search,this.query_batch=this.searchBatch,this.user=e,this.filterFunc=t,this.excludeDomainContacts=n,this.searchConfig=i.getSearchConfigForUser(e),this.searchMode=i.getSearchModeForUser(e),this.searchModeName=i.ContactsSearchMode[this.searchMode],o.BloodhoundContactsV2.getOrCreateForUser(this.user)}return e.prototype.search=function(e,t,n){var i=this;if(e=this.normalizeQuery(e),""===e)return t([]),void(n&&n([]));var r=function(n){return i.processMatches(n,t,e)},s=function(t){return i.processMatches(t,n,e)};o.BloodhoundContactsV2.search(this.user,e,r,s)},e.prototype.searchBatch=function(e,t,n){var o=this,i=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);if(i.is_loaded())return this.searchBatchInternal(e,t,n);i.load_contacts(!0,function(i){return o.searchBatchInternal(e,t,n)})},e.prototype.searchBatchInternal=function(e,t,n){for(var i=this,s=e.map(this.normalizeQuery).filter(function(e){return e.length>0}),a={},l=function(e){var t=function(t){a[e]=i.processMatches(t)};o.BloodhoundContactsV2.search(c.user,e,t)},c=this,u=0,p=s;u<p.length;u++){l(p[u])}if(t(a),this.searchConfig.remoteBatchEndpoint){var d=function(e){if(n){var t={},o=function(n){if(e.hasOwnProperty(n)){var o=a[n].map(r.ContactCommon.get_key),s=e[n].filter(function(e){var t=r.ContactCommon.get_key(e);return o.every(function(e){return e!==t})});t[n]=i.processMatches(s)}};for(var s in e)o(s);n(t)}};this.searchRemoteBatch(s,d)}},e.prototype.normalizeQuery=function(e){return e.trim().toLowerCase()},e.prototype.isSearchLocalOnly=function(){return i.LOCAL_ONLY_SEARCH_MODES.indexOf(this.searchMode)!==-1},e.prototype.getStats=function(){var e=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);return{numLocalContacts:e.get_contacts_count(),localContactsDownloadedTime:e.get_downloaded_time()}},e.prototype.searchRemoteBatch=function(e,t){n.WebRequest({url:this.searchConfig.remoteBatchEndpoint,type:"post",subject_user:this.user.id,dataType:"json",data:{queries:JSON.stringify(e)},success:t})},e.prototype.isTeamContact=function(e){return this.user.is_team&&null!=e.team&&e.team},e.prototype.processMatches=function(e,t,n){for(var o=[],i=0,l=e;i<l.length;i++){var c=l[i];n&&(c.nameMatch=a.match(n,c.name||""),c.emailMatch=a.match(n,c.email||"")),c.on_team=!(c.type===s.FB||!this.isTeamContact(c));var u=new r.Contact(c);u.pending=!1,this.excludeDomainContacts&&u.domain_contact||this.filterFunc&&!this.filterFunc(u)||o.push(u)}return t&&t(o),o},e})();t.ContactsDataSourceV2=l}),define("modules/clean/contacts/demo_contacts",["require","exports","external/bloodhound","external/underscore","modules/clean/contacts/types","modules/clean/static_urls"],function(e,t,n,o,i,r){"use strict";function s(e,t){return{dbx_account_id:o.uniqueId("dbid:demo-data-"),fname:e,lname:t,name:e+" "+t,name_tokens:[e,t],email:e.toLowerCase()+"."+t.toLowerCase()+"@example.com",type:i.EMAIL,priority:1,photo_url:r.static_url("/static/images/commenting/demoavatars/"+e+"-"+t+".jpg")}}Object.defineProperty(t,"__esModule",{value:!0}),t.demoContacts=[s("Angela","Zhang"),s("Ann","Thompson"),s("Anthony","Abate"),s("Anthony","Davis"),s("Daniel","Smith"),s("David","Zheng"),s("Jay","Singh"),s("Jonathan","Costa"),s("Joshua","Miller"),s("Justin","Anderson"),s("Kimberly","Williams"),s("Michelle","Wallace"),s("Patricia","Johnson"),s("Robert","Anderson"),s("Robert","Haobyan"),s("Wendy","Jones"),s("William","Jackson")],t.demoBloodhound=new n({datumTokenizer:function(e){return[e.name,e.email,e.fname,e.lname].concat(e.name_tokens)},queryTokenizer:function(e){return[e]},local:[]}),t.demoBloodhound.add(t.demoContacts)}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/list",["jquery","modules/clean/em_string","modules/clean/contacts/types"],function(n,o,i){return(function(){function n(t,n){var o;this.contacts=t,this.owningUserId=n,this._lowercaseContact=e(this._lowercaseContact,this),this._excludeType=e(this._excludeType,this),this.sortByTeamFirst=e(this.sortByTeamFirst,this),this.excludeSuspended=e(this.excludeSuspended,this),this.excludeNonTeamActive=e(this.excludeNonTeamActive,this),this.excludeNonTeam=e(this.excludeNonTeam,this),this.excludePairedUserDuplicates=e(this.excludePairedUserDuplicates,this),this.excludeTeamMembers=e(this.excludeTeamMembers,this),this.excludeFacebook=e(this.excludeFacebook,this),this.excludeNewStyleGroups=e(this.excludeNewStyleGroups,this),this.excludeMe=e(this.excludeMe,this),this.excludeByEmail=e(this.excludeByEmail,this),this.includeForViewer=e(this.includeForViewer,this),this.includeForUser=e(this.includeForUser,this),this.slice=e(this.slice,this),this.length=e(this.length,this),this.filterContacts=e(this.filterContacts,this),this.lcontacts=function(){var e,t,n,i;for(n=this.contacts,i=[],e=0,t=n.length;e<t;e++)o=n[e],i.push(this._lowercaseContact(o));return i}.call(this)}return n.create_contacts_list=function(e){return new n(e,null)},n.create_per_user_contacts_list=function(e,t){return new n(e,t)},n.prototype.filterContacts=function(e){var t;return t=this.contacts.filter(e),new n(t,this.owningUserId)},n.prototype.length=function(){return this.contacts.length},n.prototype.slice=function(e,t){return new n(this.contacts.slice(e,t),this.owningUserId)},n.prototype.includeForUser=function(e){return null!=this.owningUserId?this.owningUserId===e?this:new n([],e):(this.owningUserId=e,this.filterContacts(function(t){return t.owning_user_id===e}))},n.prototype.includeForViewer=function(e){var n;return n=e.get_user_ids(),this.filterContacts(function(e){var o;return o=e.owning_user_id,t.call(n,o)>=0})},n.prototype.excludeByEmail=function(e){return e=e?e.toLowerCase():"",this.filterContacts(function(t){return!(e===t.email.toLowerCase())})},n.prototype.excludeMe=function(){return this.filterContacts(function(e){return!e.is_owner})},n.prototype.excludeNewStyleGroups=function(){return this._excludeType(i.NEW_STYLE_GROUP)},n.prototype.excludeFacebook=function(){return this._excludeType(i.FB)},n.prototype.excludeTeamMembers=function(){return this.filterContacts(function(e){return!e.team})},n.prototype.excludePairedUserDuplicates=function(){return this.filterContacts(function(e){return!e.paired_user_duplicate})},n.prototype.excludeNonTeam=function(){return this.filterContacts(function(e){return e.team})},n.prototype.excludeNonTeamActive=function(){return this.filterContacts(function(e){return e.team&&"active"===e.join_state})},n.prototype.excludeSuspended=function(){return this.filterContacts(function(e){return"suspended"!==e.join_state})},n.prototype.sortByTeamFirst=function(){return new n(n.sortContactsByTeamFirst(this.contacts),this.owningUserId)},n.sortContactsByTeamFirst=function(e){var t,n,o,i,r;for(r=[],i=[],n=0,o=e.length;n<o;n++)t=e[n],t.team?r.push(t):i.push(t);return r.concat(i)},n.prototype._excludeType=function(e){return this.filterContacts(function(t){return t.type!==e})},n.prototype._lowercaseContact=function(e){var t,n,o;n={};for(t in e)o=e[t],("string"==typeof o||o instanceof String)&&(o=o.toLowerCase()),n[t]=o;return n},n})()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/tokenizer",["external/classnames","external/react","external/underscore","modules/core/browser","modules/core/i18n","modules/clean/analytics","modules/clean/avatar/contact_avatar","modules/clean/contacts/config","modules/clean/contacts/contact","modules/clean/contacts/data_v2","modules/clean/contacts/typeahead","modules/clean/contacts/types","modules/clean/em_string","modules/clean/tokenizer","modules/clean/validators/validators","modules/constants/contacts","jquery"],function(t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v){var g,y,E,S,b,w,C,T,A,I,P,R,O,N,L,M,k;return R=r._,y=s.ContactSearchLogger,g=c.Contact,b=u.ContactsDataSourceV2,T=p.ContactsTypeaheadSelector,P=_.Tokenizer,O=n.createElement,N=n.DOM,I=16,A=100,k=m.check(m.create(["EmailValidator"])),E={invalid:"invalid",warn:"warn",pending:"pending",ok:"ok"},w=n.createClass({displayName:"ContactsToken",propTypes:{customClass:n.PropTypes.string,className:n.PropTypes.string,contact:n.PropTypes.object.isRequired,onRemove:n.PropTypes.func,tabIndex:n.PropTypes.number,tokenState:n.PropTypes.oneOf((function(){var e;e=[];for(L in E)M=E[L],e.push(M);return e})()).isRequired},render:function(){var e,n;return n={"tokenizer-token":!0,"contact-token":!0,invalid:this.props.tokenState===E.invalid,warned:this.props.tokenState===E.warn,pending:this.props.tokenState===E.pending},n[this.props.customClass]=null!=this.props.customClass,n[this.props.className]=null!=this.props.className,e=t(n),N.a(v.extend({tabIndex:-1},this.props,{className:e}),this._renderInput(),this._renderIcon(),this._renderText(),this._makeCloseButton())},_getTokenName:function(){switch(this.props.contact.type){case d.FB:return"fb_ids";case d.EMAIL:return"emails";case d.NEW_STYLE_GROUP:return"new_style_group_ids";default:return"invalids"}},_getTokenValue:function(){switch(this.props.contact.type){case d.FB:return this.props.contact.fb_id;case d.NEW_STYLE_GROUP:return this.props.contact.group_id;default:return this.props.contact.email}},_renderIcon:function(){return this.props.contact.type===d.FB?N.img({className:"token-icon",src:"/static/images/icons/fb_16-vflbiYTkC.png"}):this.props.contact.type===d.NEW_STYLE_GROUP||this.props.contact.dbx_account_id?O(a,{dimension:I,contact:this.props.contact,optionalClass:"token-icon"}):""},_renderInput:function(){return N.input({type:"hidden",name:this._getTokenName(),value:this._getTokenValue()})},_renderText:function(){var e,t;return e=22,t=this.props.contact.name||this.props.contact.email,h.em_snippet(t,e)},_makeCloseButton:function(){return this.props.onRemove?N.span({className:"tokenizer-token-close",onClick:(function(e){return function(){return e.props.onRemove(e.props.contact),!1}})(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),S={basic:function(e){var t;return t=e.name&&!e.invalid&&e.email!==e.name,{state:e.invalid?E.invalid:E.ok,msg:t?e.email:null}},warn:function(e){return{state:e.pending?E.pending:e.on_team?E.ok:e.invalid?E.invalid:E.warn,msg:null}},forbid:function(e){return{state:e.pending?E.pending:e.on_team?E.ok:E.invalid,msg:null}}},C=n.createClass({displayName:"ContactsTokenizer",propTypes:{user:n.PropTypes.object.isRequired,context:n.PropTypes.string,customClass:n.PropTypes.string,customContactFilter:n.PropTypes.func,excludeDomainContacts:n.PropTypes.bool,customContactValidator:n.PropTypes.func,focusOnMount:n.PropTypes.bool,id:n.PropTypes.string,onContentsChange:n.PropTypes.func,placeholder:n.PropTypes.string,populatedInputData:n.PropTypes.shape({tokens:n.PropTypes.array,value:n.PropTypes.string}),tabIndex:n.PropTypes.number,showContactImport:n.PropTypes.bool,shouldLogContactSearch:n.PropTypes.bool,teamGroupInfo:n.PropTypes.shape({id:n.PropTypes.string,name:n.PropTypes.string}),tokenSpacing:n.PropTypes.number},getDefaultProps:function(){return{customContactFilter:function(e){return!0},customContactValidator:S.basic,excludeDomainContacts:!0,focusOnMount:!1,id:null,placeholder:R("Invite more people"),populatedInputData:{tokens:[],value:""},tokenSpacing:4,showContactImport:!1,shouldLogContactSearch:!1,teamGroupInfo:null}},_initContactsDataSource:function(e,t,n){return new b(e,t,n)},componentWillReceiveProps:function(e){var t;e.user===this.props.user&&e.customContactFilter.toString()===this.props.customContactFilter.toString()||(this.contactsDataSource=this._initContactsDataSource(e.user,e.customContactFilter,e.excludeDomainContacts)),this._validateTokens(null!=(t=e.populatedInputData)?t.tokens:void 0)},componentWillMount:function(){var e;this.contactsDataSource=this._initContactsDataSource(this.props.user,this.props.customContactFilter,this.props.excludeDomainContacts),this._validateTokens(null!=(e=this.props.populatedInputData)?e.tokens:void 0,!0)},componentDidMount:function(){var e,t,n,o,i,r;if(this.props.shouldLogContactSearch&&(this.contact_search_logger=new y(this._getLoggingContext(),this.contactsDataSource.searchModeName),this.unfinished_contact_search_queries={}),(null!=(t=this.props.populatedInputData.tokens)?t.length:void 0)>0||(null!=(n=this.props.populatedInputData.value)?n.length:void 0)>0)return o=this.serializeInputData(),i=o.tokens,r=o.value,"function"==typeof(e=this.props).onContentsChange?e.onContentsChange(i,r):void 0},_validateTokens:function(e,t){var n,o,i,r;if(null==t&&(t=!1),(null!=e?e.length:void 0)>0){for(i=[],n=0,o=e.length;n<o;n++)r=e[n],r.type===d.EMAIL&&(r.invalid=!k(r.email)),t?(r.query=r.query||r.email||r.name,i.push(r.pending=!0)):i.push(void 0);return i}},finishLogging:function(e){var t;if(t=this.contactsDataSource.getStats().numLocalContacts,this._flush_unfinished_queries_cache(),this.props.shouldLogContactSearch)return this.contact_search_logger.log_records(this.props.user.id,e,t)},_logTokenChangeEvent:function(e,t,n){var o,r;if(null==t&&(t=!1),null==n&&(n={}),this.contact_search_logger){if(t)return this.contact_search_logger.flag_record_as_removed(e.getContactID());o={context:this._getLoggingContext(),contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null,event_ts:null!=(r=i.performance())&&"function"==typeof r.now?r.now():void 0};for(L in n)M=n[L],o[L]=M;return this.contact_search_logger.add_record(o)}},_logSearchComplete:function(e,t,n){var o,r,s,a;if(null==n&&(n=!0),this._shouldLogSearch()&&e&&(s=i.performance().now(),a=this.unfinished_contact_search_queries[e]))return o=a.begin_time,!("ttfr"in a)&&t>0&&(a.ttfr=Math.floor(s-o)),n?(a.local_duration=Math.floor(s-o),a.num_local_results=t):(a.remote_duration=Math.floor(s-o),a.num_additional_remote_results=t),a.num_results+=t,r=(function(e){return function(){return e.contactsDataSource.isSearchLocalOnly()&&n||!n}})(this),r()?(a=this._prepareSearchStatsForLogging(a,e,s,!0),this.contact_search_logger.add_timing_record(a),this.contact_search_logger.count_search(a.is_slow),delete this.unfinished_contact_search_queries[e]):void 0},_logSearchBegin:function(e){var t;if(this._shouldLogSearch()&&e)return t=i.performance().now(),this._flush_unfinished_queries_cache(t),this.unfinished_contact_search_queries[e]={begin_time:t,num_results:0}},_shouldLogSearch:function(){var e;return this.props.shouldLogContactSearch&&null!=this.contact_search_logger&&null!=(null!=(e=i.performance())?e.now:void 0)},_flush_unfinished_queries_cache:function(e){var t,n,o;if(this._shouldLogSearch()){null==e&&(e=i.performance().now()),n=this.unfinished_contact_search_queries;for(t in n)o=n[t],e-o.begin_time<l.CONTACTS_SEARCH_PREEMPTED_THRESHOLD&&(o.is_preempted=!0),o=this._prepareSearchStatsForLogging(o,t,e,!1),this.contact_search_logger.add_timing_record(o),this.contact_search_logger.count_search(o.is_slow);return this.unfinished_contact_search_queries={}}},_prepareSearchStatsForLogging:function(e,t,n,o){var i,r;return i=e.begin_time,e.duration=Math.floor(n-i),"ttfr"in e?e.is_slow=e.ttfr>A:o&&0===e.num_results?e.is_slow=!1:e.is_slow=e.duration>A,r=this.contactsDataSource.getStats().localContactsDownloadedTime,e.started_before_download=null==r||i<r,"is_preempted"in e||(e.is_preempted=!1),e.context=this._getLoggingContext(),e.query_length=t.length,e.is_finished=o,e},_getLoggingContext:function(){var e;return e="react_tokenizer",null!=this.props.context&&(e+="_"+this.props.context),e},addExternalContacts:function(e){return this.refs.tokenizer.addExternalTokens(e)},render:function(){return O(P,{ref:"tokenizer",dataSource:this.contactsDataSource,customClass:this.props.customClass,initialInputText:this.props.populatedInputData.value,placeholderText:this.props.placeholder,renderSelector:(function(e){return function(){return O(T,{showContactImport:e.props.showContactImport,teamGroupInfo:e.props.teamGroupInfo,user:e.props.user})}})(this),renderInput:(function(e){return function(){return N.textarea({className:"contacts-tokenizer-input",id:e.props.id,rows:1})}})(this),renderToken:this._renderToken,renderTokenHover:this._renderTokenHover,onContentsChange:this.props.onContentsChange,onTokensAdd:this._queryTokens,stringTokenizer:this.tokenizeEmails,populatedTokenData:this.props.populatedInputData.tokens,tabIndex:this.props.tabIndex,tokenSpacing:this.props.tokenSpacing,focusOnMount:this.props.focusOnMount,logSearchBegin:this._logSearchBegin,logSearchComplete:this._logSearchComplete,logTokenChangeEvent:this._logTokenChangeEvent},this.props.children)},_renderToken:function(e){return O(w,{contact:e,tokenState:this.props.customContactValidator(e).state})},_renderTokenHover:function(e){return this.props.customContactValidator(e).msg},_autoSelectMatch:function(e,t){var n,o,i,r,s,a,l,c,u,p;if(!t||!e)return null;for(e=this.contactsDataSource.normalizeQuery(e),i={email:[],name:[]},r=0,a=t.length;r<a;r++)c=t[r],n=c.email?this.contactsDataSource.normalizeQuery(c.email):null,u=c.name?this.contactsDataSource.normalizeQuery(c.name):null,e===n?i.email.push(c):e===u&&i.name.push(c);for(p=["email","name"],s=0,l=p.length;s<l;s++)if(o=p[s],1===i[o].length)return i[o][0];return null},_queryTokens:function(t,n){var o,i,r,s,a,l;if(r=t.filter(function(e){return e.pending&&e.query}),r.length)return s=(function(){var e,t,n;for(n=[],e=0,t=r.length;e<t;e++)l=r[e],n.push(l.query);return n})(),i=(function(o){return function(i){var r,s,a,l,c,u,p,d;for(s=[],t=[],r=o.serializeInputData(n).tokens,a=0,l=r.length;a<l;a++)u=r[a],c=u,u.pending&&u.query&&(p=o.contactsDataSource.normalizeQuery(u.query),d=o._autoSelectMatch(p,i[p]),d&&(c=d)),L=c.getKey(),e.call(s,L)>=0||(s.push(L),t.push(c));return n.replaceTokens(t)}})(this),a=i,o=i,this.contactsDataSource.searchBatch(s,a,o)},tokenizeEmails:function(e,t){var n,o,i,r,s,a,l,c,u,p;for(null==t&&(t=!1),n=/[,|;\n]+/,o=/[,|;\n ]+/,a=e.split(o),2===a.length&&k(a[0]+a[1])?(c=[a[0]+a[1]],t=!0):c=2===a.length&&k(a[0])&&""===a[1]?a:e.split(n),p="",t||(p=c.pop()),u=[],i=0,r=c.length;i<r;i++)l=c[i],s=l.trim(),""!==s&&u.push(new g({name:s,email:s,type:d.EMAIL,invalid:!k(s),on_team:!1,pending:!0,query:s}));return{tokens:u,value:p}},serializeInputData:function(e){return e=e||this.refs.tokenizer,e.serializeInputData()},getContacts:function(){var e,t,n,o;return e=this.serializeInputData(),n=e.tokens,o=e.value,t=this.tokenizeEmails(o,!0),n.concat(t.tokens)},tokenizeAll:function(){return this.refs.tokenizer.tokenizeAll()}}),{ContactsTokenizer:C,ContactTokenValidator:S,ContactTokenState:E,SLOW_CONTACT_SEARCH_THRESHOLD:A}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/typeahead",["jquery","external/classnames","external/react","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/avatar/contact_avatar","modules/clean/contacts/util","modules/clean/css","modules/clean/profile_services/popup_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/contacts/types","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/paging_list","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/clean/static_urls","modules/clean/typeahead","modules/clean/em_string"],function(t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b){var w,C,T,A,I,P,R,O,N,L,M,k,F,assert,x,D,U,B,H;return assert=r.assert,k=s._,F=p.addAuthCompleteListener,B=p.removeAuthCompleteListener,P=h.LinkedProfileServices,R=h.ProfileServicesLinkingHandler,H=E.static_url,M=S.TypeaheadSelectorMixin,D=o.DOM,x=o.createElement,U=function(e,t){return i.extend({},e,t)},O=32,C=U(M,{getOptions:function(){var e,t,n;return null==this.props.queryOptions?[]:this.state.importsExpanded?function(){var e,n,o,i;for(o=d.importable_contact_services(),i=[],e=0,n=o.length;e<n;e++)t=o[e],i.push(new N({provider:t,connected:this.profile_services.service_is_connected(t)}));return i}.call(this):(e=this.props.queryOptions.slice(0),this.props.teamGroupInfo?e.push(c.teamGroupInfoToContact(this.props.teamGroupInfo)):(null!=(n=this.profile_services)?n.has_unconnected_services(!0):void 0)&&e.push(new A),e)},renderOption:function(e){return e instanceof A?x(I):e instanceof N?x(L,{import:e}):this.props.renderQueryOption(e)},onSelect:function(t){var n,o;return t instanceof A?(this._changeSelectionIndex(0),this.setState({importsExpanded:!0})):t instanceof N?(assert((o=t.provider,e.call(d.importable_contact_services(),o)>=0),"invalid party contact provider "+t.provider),this.profile_services.service_is_connected(t.provider)?(n=k("You're already connected to %(service_name)s").format({service_name:d.to_name(t.provider)}),void a.success(n)):this.link_handler.auth_service_with_user(t.provider,this.props.user.id,(function(e){return function(e){return R.show_import_notifications(e)}})(this))):this.props.onSelect(t)},reset:function(){return this._changeSelectionIndex(0),this.setState({importsExpanded:!1})}}),w=o.createClass({displayName:"ContactsTypeaheadSelector",mixins:[C],propTypes:{customClass:o.PropTypes.string,onSelect:o.PropTypes.func.isRequired,queryOptions:o.PropTypes.array,renderQueryOption:o.PropTypes.func.isRequired,showContactImport:o.PropTypes.bool,teamGroupInfo:o.PropTypes.shape({id:o.PropTypes.string,name:o.PropTypes.string}),user:o.PropTypes.object.isRequired},componentWillMount:function(){if(this.link_handler=new R,this.profile_services=null,null===this.props.teamGroupInfo&&this.props.showContactImport&&null!=this.props.user)return this.profile_services=P.get_linked_profile_services_for_user(this.props.user.id)},componentWillReceiveProps:function(e){var t,n;return 0===(null!=(t=e.queryOptions)?t.length:void 0)?this._changeSelectionIndex(-1):(null!=(n=e.queryOptions)?n.length:void 0)>0&&this.state.selectionIndex===-1?this._changeSelectionIndex(0):void 0},shouldComponentUpdate:function(e,t){return!i.isEqual(e,this.props)||!i.isEqual(t,this.state)},getDefaultProps:function(){return{showContactImport:!1,teamGroupInfo:null,onSelect:function(e){},renderQueryOption:function(e){return x(T,{contact:e})}}},onSelectionIndexChange:function(e){var t;return null!=(t=this.refs.pagingList)?t.scrollAround(e):void 0},render:function(){var e;return u.require_css("/static/css/react/contacts_typeahead-vfl-C8Z8J.css"),this.getOptions().length?(e={"typeahead-selector":!0,"contacts-selector":!0},e[this.props.customClass]=null!=this.props.customClass,x(v,{customClass:n(e),pageSize:4,itemSize:54,ref:"pagingList"},this.renderOptions())):D.div({})}}),T=o.createClass({displayName:"ContactsTypeaheadSelectorOption",propTypes:{contact:o.PropTypes.object.isRequired,customClass:o.PropTypes.string},render:function(){var e,t,o,r,s;return e={"contacts-typeahead-option":!0},e[this.props.customClass]=null!=this.props.customClass,null!=this.props.className&&(e[this.props.className]=!0),o={primary:this._renderPrimary(),secondary:this._renderSecondary()},o=i.pick(o,function(e){return""!==e}),D.li(U(this.props,{className:n(e)}),x(m.Flag,{leftAttachment:this._renderIcon(),rightAttachment:this.props.contact.domain_contact?this._renderDomainTooltip():void 0},(function(){var a;a=[];for(r in o)s=o[r],e={"option-only":1===i.size(o)},e["option-"+r]=!0,a.push(t=D.div({className:n(e),key:"option-"+r},s));return a})()))},_renderPrimary:function(){return this._renderMatch(this.props.contact.name,this.props.contact.nameMatch)},_renderSecondary:function(){switch(this.props.contact.type){case _.EMAIL:return this.props.contact.email===this.props.contact.name?"":this._renderMatch(this.props.contact.email,this.props.contact.emailMatch);case _.FB:return k("Facebook message");case _.NEW_STYLE_GROUP:return this.props.contact.members;default:return""}},_renderMatch:function(e,t){var n,o,i,r,s,a,l,c,u,p,d,h;if(n=22,e&&(e=b.em_snippet(e,n)),!t)return e;for(p=e.indexOf("…"),a=0,u=[],d=t.highlighted,r=0,l=d.length;r<l;r++)h=d[r],s=h[0],c=h[1],s>a&&u.push(e.slice(a,s)),o=s+c,o>p&&p!==-1&&(o=p),i=e.slice(s,o),u.push(D.strong({key:"highlight-"+i+"-"+s},i)),a=o;return a<e.length&&u.push(e.slice(a)),u},_renderIcon:function(){return D.div({className:"u-pad-right-xs"},x(l,{dimension:O,contact:this.props.contact,optionalClass:"contact-icon"}))},_renderDomainTooltip:function(){return D.div({className:"u-pad-right-xs"},x(y,{content:k("Suggested contact from your domain"),position:y.POSITIONS.BOTTOM},x(g,{group:"web",name:"info",alt:k("Domain contact")})))}}),A=(function(){function e(){}return e.prototype.getKey=function(){return"expand-importer"},e})(),I=o.createClass({displayName:"ExpandImportOption",render:function(){var e;return e={"expand-imports-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),D.li(U(this.props,{className:n(e)}),x(m.Flag,{leftAttachment:x(f,{className:"u-pad-right-xs",src:H("/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:H("/static/images/icons/icon-import@2x-vfluE8TBO.png")})},D.div({className:"option-primary option-only"},k("Import contacts"))))}}),N=(function(){function e(e){this.provider=e.provider,this.connected=e.connected}return e.prototype.getKey=function(){return"third-party-import"+this.provider},e})(),L=o.createClass({displayName:"ThirdPartyImportOption",getInitialState:function(){return{showSpinner:!1}},propTypes:{import:o.PropTypes.object.isRequired},componentDidMount:function(){return this.authCompleteListenerToken=F(this.show_contact_import_spinner)},componentWillUnmount:function(){return B(this.authCompleteListenerToken)},show_contact_import_spinner:function(e){if(this.props.import.provider===e.provider)return this.setState({showSpinner:!0})},render:function(){var e,t,o,i,r,s;return s=this.props.import,i=s.provider,t=s.connected,r=d.to_name(i),!t&&this.state.showSpinner&&(r=k("Importing %(service_name)s Contacts").format({service_name:r})),o=t?k("Connected"):"",e={"third-party-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),D.li(U(this.props,{className:n(e)}),!t&&this.state.showSpinner?D.div({className:"option-spinner"},D.img({src:"/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif"})):void 0,x(m.Flag,{spacing:"xs",leftAttachment:x(f,{alt:"",
src:H(d.to_img(i)[0]),srcHiRes:H(d.to_img(i)[1])})},D.div({className:n({"option-primary":!0,"option-only":!t})},r,t?D.div({className:"option-secondary u-font-meta"},o):void 0)))}}),{ContactsTypeaheadSelector:w,ContactsTypeaheadSelectorOption:T,ExpandImportOption:I,ThirdPartyImportOption:L}})}.call(this),define("modules/clean/contacts/types",["require","exports"],function(e,t){"use strict";var n;return(function(e){e[e.EMAIL=0]="EMAIL",e[e.FB=1]="FB",e[e.INVALID_ID=2]="INVALID_ID",e[e.NEW_STYLE_GROUP=4]="NEW_STYLE_GROUP",e[e.DBX_ID=5]="DBX_ID"})(n||(n={})),n}),function(){define("modules/clean/contacts/util",["modules/clean/contacts/contact","modules/clean/contacts/types"],function(e,t){var n;return n=e.Contact,(function(){function e(){}return e.activityUserToContact=function(e,n){return null==n&&(n=0),{dbx_account_id:e.unique_id,fname:e.fname,lname:e.lname,name:e.display_name,name_tokens:[e.fname,e.lname],email:e.email,type:t.DBX_ID,priority:n,photo_url:e.photo_circle_url}},e.teamGroupInfoToContact=function(e){return new n({group_id:e.id,group_size:e.group_size,type:t.NEW_STYLE_GROUP,name:e.name,on_team:!0,pending:!1})},e})()})}.call(this),function(){define("modules/clean/crypto",["external/sjcl"],function(e){var t;return t={},t.getRandomValues=function(t){var n,o,i,r;for(r=e.random.randomWords(t.length),n=o=0,i=t.length;0<=i?o<i:o>i;n=0<=i?++o:--o)t[n]=r[n];return t},t})}.call(this),function(){define("modules/clean/file_activity/api",["external/underscore","modules/core/types","modules/clean/ajax","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/file_activity"],function(e,t,n,o,i){var r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b,w,C,T,A,I,P,R,O,N,L,M,k,F,x,D,U,B,H,V;return U=t.takes,L=t.returns,h=t.Maybe,t.Either,s=o.CommentActivity,p=i.FileActivity,g={actorId:h(Number),oref:h(String),isBackgroundRequest:h(Boolean)},w=function(t){var o,i,r,s,a,l,c,u;return u=t.url,c=t.type,i=t.data,o=t.actorId,s=t.oref,r=t.isBackgroundRequest,l=r?n.SilentBackgroundRequestOref:n.WebRequestOref,a=new Promise(function(t,n){return l({url:u,type:c,data:e.extend({oref:s},i),subject_user:o,success:t,error:function(e,t,o){return n(Error(o))}})}),a.then(JSON.parse)},E=function(e){var t,n,o;if("error"===e.status)throw n=null!=(o=e.payload)?o.error_text:void 0,t=Error(n),t.payload=e.payload,t.error_text=n,t;return e.payload},S=function(e){var t,n;return n=E(e),t=e.bolt_data,[n,t]},y=function(e){return p.fromDict(e)},r=e.extend({commentActivityKey:h(String),context:Number,contextData:String,text:String,metadata:h(Object)},g),C=U(r,L(Promise,function(e){var t,n,o,i,r,a,l,c;return t=e.actorId,n=e.commentActivityKey,o=e.context,i=e.contextData,c=e.text,a=e.metadata,l=e.oref,r=e.isBackgroundRequest,w({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:o,activity_context_data:i,comment_text:c,comment_metadata_json:JSON.stringify(a),target_comment_activity_key:n},oref:l,isBackgroundRequest:r}).then(E).then(s.fromDict)})),a=e.extend({commentActivityKey:String,context:Number,contextData:String},g),T=U(a,L(Promise,function(e){var t,n,o,i,r,s;return t=e.actorId,n=e.commentActivityKey,o=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,w({actorId:t,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:n,activity_context:o,activity_context_data:i},oref:s,isBackgroundRequest:r}).then(E)})),m=e.extend({enableComment:Boolean,context:Number,contextData:String},g),B=U(m,L(Promise,function(e){var t,n,o,i,r,s;return t=e.actorId,i=e.enableComment,n=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,w({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:n,activity_context_data:o,feedback_off:!i},oref:s,isBackgroundRequest:r}).then(E)})),f=e.extend({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},g),V=U(f,L(Promise,function(e){var t,n,o,i,r,s,a;return t=e.actorId,a=e.resolved,n=e.commentActivityKey,o=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,w({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:n,activity_context:o,activity_context_data:i,resolved:a},oref:s,isBackgroundRequest:r}).then(E)})),d=e.extend({commentActivityKeys:Array,context:Number,contextData:String},g),O=U(d,L(Promise,function(e){var t,n,o,i,r,s;return t=e.actorId,n=e.commentActivityKeys,o=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,w({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:o,activity_context_data:i},oref:s,isBackgroundRequest:r}).then(E)})),u=e.extend({context:Number,contextData:String},g),b=function(e){var t,n,o,i,r;return t=e.actorId,n=e.context,o=e.contextData,r=e.oref,i=e.isBackgroundRequest,w({actorId:t,url:"/file_activity/file_activity",type:"GET",data:{activity_context:n,activity_context_data:o},oref:r,isBackgroundRequest:i})},P=U(u,L(Promise,function(e){return b(e).then(E).then(y)})),R=U(u,L(Promise,function(e){return b(e).then(S).then(function(e){var t,n;return t=e[0],n=e[1],[y(t),n]})})),c=e.extend({context:Number,contextDataList:Array},g),I=U(c,L(Promise,function(t){var n,o,i,r,s;return n=t.actorId,o=t.context,i=t.contextDataList,s=t.oref,r=t.isBackgroundRequest,w({actorId:n,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:o,activity_context_data_batch:JSON.stringify(i)},oref:s,isBackgroundRequest:r}).then(function(t){return e.mapObject(t,y)})})),v=e.extend({targetUserEmail:h(String),subscribed:Boolean,context:Number,contextData:String},g),H=U(v,L(Promise,function(e){var t,n,o,i,r,s,a;return t=e.actorId,a=e.targetUserEmail,s=e.subscribed,n=e.context,o=e.contextData,r=e.oref,i=e.isBackgroundRequest,w({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:n,activity_context_data:o,subscribed:s,target_user_identifier:a},oref:r,isBackgroundRequest:i}).then(E)})),l=e.extend({context:Number,contextDataList:Array},g),A=U(l,L(Promise,function(t){var n,o,i,r,s;return n=t.actorId,o=t.context,i=t.contextDataList,s=t.oref,r=t.isBackgroundRequest,w({actorId:n,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:o,activity_context_data_batch:JSON.stringify(i)},oref:s,isBackgroundRequest:r}).then(E).then(function(t){return e.mapObject(t,function(e){var t,n,o;return n=e.feedback_off,t=e.comment_count,o=e.unresolved_comment_count,{feedback_off:n,comment_count:t,unresolved_comment_count:o}})})})),_=e.extend({feedbackText:String,context:Number,contextData:String},g),D=U(_,L(Promise,function(e){var t,n,o,i,r,s;return t=e.actorId,i=e.feedbackText,n=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,w({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:n,activity_context_data:o,feedback_text:i},oref:s,isBackgroundRequest:r}).then(E)})),N=U({actorId:Number},L(Promise,function(e){var t,o;return t=e.actorId,o=new Promise(function(e,o){return n.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:o,subject_user:t})}),o.then(JSON.parse).then(E)})),x=U({actorId:Number},L(Promise,function(e){var t,o;return t=e.actorId,o=new Promise(function(e,o){return n.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:o,subject_user:t})}),o.then(JSON.parse).then(E)})),M=U({actorId:Number,shouldShow:Boolean},L(Promise,function(e){var t,n;return t=e.actorId,n=e.shouldShow,w({actorId:t,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:n}}).then(E)})),k=U({shouldShow:Boolean},L(Promise,function(e){var t;return t=e.shouldShow,w({url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:t}}).then(E)})),F=U({actorId:Number,shouldShow:Boolean},L(Promise,function(e){var t,n;return t=e.actorId,n=e.shouldShow,w({actorId:t,url:"/file_activity/set_show_comments_tutorial",type:"POST",data:{show_tutorial:n}}).then(E)})),{markCommentingOnboardingSeen:N,shouldShowCommentingOnboarding:x,setCommentingPaneVisibility:M,setSessionCommentingPaneVisibility:k,setShowCommentsTutorial:F,addComment:C,deleteComment:T,updateResolveComment:V,updateCommentSetting:B,markCommentSeenBatch:O,fetchCommentStatusBatch:A,fetchFileActivity:P,fetchFileActivityWithBoltData:R,fetchFileActivities:I,updateFileActivitySubscription:H,submitProductFeedback:D}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/file_activity/clients/file_activity_bolt_client",["external/underscore","modules/core/exception","modules/core/types","modules/clean/analytics","modules/clean/bolt","external/eventemitter3","modules/clean/file_activity/api","modules/clean/optimistic_update","modules/clean/storage"],function(n,o,i,r,s,a,l,c,u){var p,d,h,_,m,f,v;return v=i.takes,d=i.Maybe,p=r.CommentsVortexLogger,h=c.Optimist,_=u.SessionStorage,m=function(e,t){return new s.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},f=function(e){var t,n;return t=e.revision,n=e.token,{revision:t,token:n}},(function(n){function i(){return this._onBoltRefresh=e(this._onBoltRefresh,this),this._onBoltUpdate=e(this._onBoltUpdate,this),r.apply(this,arguments)}var r;return t(i,n),r=v({actorId:d(Number),context:Number,contextData:String,oref:d(String)},function(e){var t,n,o,i;return t=e.actorId,n=e.context,o=e.contextData,i=e.oref,this.__requestOptions={actorId:t,context:n,contextData:o,oref:i,isBackgroundRequest:!0},this.__optimist=new h(null),this.__isLive=!1,this.__isReady=!1,this.__canInit=!0}),i.prototype.getFileActivity=function(){return this.__optimist.getValue()},i.prototype.isReady=function(){return this.__isReady},i.prototype.isLive=function(){return this.__isLive},i.prototype.rebase=function(e){var t;return o.assert(this.__isReady,"Cannot rebase when server data is not ready"),t=this.getFileActivity(),this.__optimist.rebase(e),this.emit("updated",this.getFileActivity(),t)},i.prototype.commitOptimisticUpdate=function(e){var t,n;return o.assert(this.__isReady,"Cannot commit optimistic update when server data is not ready"),n=this.getFileActivity(),t=this.__optimist.commit(e),this.emit("updated",this.getFileActivity(),n),t},i.prototype.rollbackOptimisticUpdate=function(e){var t;if(o.assert(this.__isReady,"Cannot rollback optimistic update when server data is not ready"),t=this.getFileActivity(),this.__optimist.rollback(e))return this.emit("updated",this.getFileActivity(),t)},i.prototype.init=function(){o.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then((function(e){return function(){if(p.log("load-comments-success"),e.__isLive)return e._doStartLiveUpdate()}})(this)).catch((function(e){return function(){return e.__canInit=!0}})(this))},i.prototype.startLiveUpdate=function(){return o.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},i.prototype.stopLiveUpdate=function(){var e;return this.__isLive=!1,null!=(e=this.__boltClient)?e.unsubscribe():void 0},i.prototype._doStartLiveUpdate=function(){var e;return e=m(this.getFileActivity(),this.__boltData),this.__boltClient=new s.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},i.prototype._pullFromServer=function(){var e;return _.set("reload-timestamp",(new Date).getTime()),e=l.fetchFileActivityWithBoltData(this.__requestOptions),e.then((function(e){return function(t){var n,o,i;return o=t[0],n=t[1],e.__boltData=n,i=e.__optimist.getValue(),e.__optimist.rebase(function(){return o}),o=e.__optimist.getValue(),e.__isReady?e.emit("updated",o,i):(e.__isReady=!0,e.emit("ready",o))}})(this)),e.catch((function(e){return function(t){return e.emit("error",t)}})(this)),e},i.prototype._onBoltUpdate=function(e){var t;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.getFileActivity().activity_key)return t=e[0],this.__boltData=f(t),this._pullFromServer().then((function(e){return function(){if(e.__isLive)return t=m(e.getFileActivity(),e.__boltData),e.__boltClient.update_states([t])}})(this))},i.prototype._onBoltRefresh=function(e){return this._pullFromServer().then((function(e){return function(){if(e.__isLive)return e.stopLiveUpdate(),e.startLiveUpdate()}})(this))},i})(a)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/file_activity/clients/file_activity_data_source",["external/underscore","external/lru","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","modules/core/exception"],function(t,n,o,i,r,s){var a,assert,l;return a=o.CommentsEvents,assert=s.assert,l=function(e,t,n,o){return null==o&&(o=""),e=null!=e?e:"",e+":"+t+":"+n+":"+o},(function(){function o(t){this._cache=t._cache,this._unsubscribeStore=t._unsubscribeStore,this._sendFileActivity=t._sendFileActivity,this._state=t._state,this.onClientUpdated=e(this.onClientUpdated,this),this.onStoreUpdate=e(this.onStoreUpdate,this)}return o.initInstance=function(){var e;if(e=o,null==e.__instance)return e.__instance=e.create(i,function(e){return a.emit("file-activity-updated",e)})},o.getInstance=function(){var e;return e=o,assert(null!=e.__instance),e.__instance},o.create=function(e,t,i){var r,s;return null==i&&(i=10),r=new n(i),r.shift=function(){var e,t;return t=n.prototype.shift.call(this),e=t.value,null!=e&&e.removeAllListeners(),null!=e&&e.stopLiveUpdate(),t},s=new o({_cache:r,_state:{},_sendFileActivity:t}),s._unsubscribeStore=e.listen(s.onStoreUpdate),s.onStoreUpdate(e.state),s},o.prototype.dispose=function(){return this._unsubscribeStore()},o.prototype.resetCache=function(){return this._cache.removeAll()},o.prototype.replaceState=function(e){var t;if(this.shouldUpdate(e))return this.willUpdate(e),t=this._state,this._state=e,this.didUpdate(t)},o.prototype.getState=function(){return this._state},o.prototype.onStoreUpdate=function(e){var t,n,o,i,r,s;return t=e.actorId,r=e.oref,s=e.viewing,n=s.context,o=s.contextData,i={oref:r,actorId:t,context:n,contextData:o},this.replaceState(i)},o.prototype.shouldUpdate=function(e){return!t.isEqual(this._state,e)},o.prototype.willUpdate=function(e){var t;if(t=this.getCurrentClient(),null!=t)return this.deactivateClient(t)},o.prototype.didUpdate=function(e){var t;if(t=this.getCurrentFetchKey(),!this.isFetching(t)&&(this.sendActivity(null),!this.isNullState(this._state)))return this.fetchAndSend(this._state)},o.prototype.getFetchKey=function(e){var t,n,o,i;return t=e.actorId,n=e.context,o=e.contextData,i=e.oref,l(t,n,o,i)},o.prototype.getCurrentFetchKey=function(){return this.getFetchKey(this._state)},o.prototype.getCurrentClient=function(){var e;return e=this.getCurrentFetchKey(),this._cache.get(e)},o.prototype.isFetching=function(e){var t;return t=this._cache.find(this.getFetchKey(e)),null!=t&&!t.isReady()},o.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},o.prototype.activateClient=function(e){if(e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady())return this.onClientUpdated(e.getFileActivity())},o.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},o.prototype.deactivateCurrentClient=function(){var e;if(e=this.getCurrentClient(),null!=e)return this.deactivateClient(e)},o.prototype.fetchAndSend=function(e){var t,n,o,i,r,s,a;return t=e.actorId,i=e.context,r=e.contextData,a=e.oref,s=l(t,i,r,a),n=this._cache.get(s),null!=n?this.activateClient(n):(o=this.createFileActivityBoltClient({actorId:t,context:i,contextData:r,oref:a}),o.init(),this._cache.set(s,o),this.activateClient(o))},o.prototype.onClientUpdated=function(e){return this.sendActivity(e)},o.prototype.onClientError=function(e){throw e},o.prototype.sendActivity=function(e){return this._sendFileActivity(e)},o.prototype.createFileActivityBoltClient=function(e){return new r(e)},o.prototype.rebase=function(e){var t;return t=this.getCurrentClient(),null!=t&&t.rebase(e)},o.prototype.commitOptimisticUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?t.commitOptimisticUpdate(e):null},o.prototype.rollbackOptimisticUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t&&t.rollbackOptimisticUpdate(e)},o})()})}.call(this),define("modules/clean/file_activity/models/file_activity",["require","exports","tslib","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(e,t,n,o,i,r,s,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(){function e(e){var t=void 0===e?{}:e,n=t.activity_key,i=void 0===n?"":n,r=t.feedback_off,s=void 0!==r&&r,a=t.can_edit_feedback,l=void 0===a||a,c=t.comment_activities,u=void 0===c?[]:c,p=t.users_to_notify,d=void 0===p?[]:p,h=t.latest_revision,_=void 0===h?null:h;this.activity_key=i,this.feedback_off=s,this.can_edit_feedback=l,this.comment_activities=u,this.users_to_notify=d,this.latest_revision=_,o(this)}return e.fromDict=function(t){return new e({activity_key:t.activity_key,feedback_off:t.feedback_off,can_edit_feedback:t.can_edit_feedback,comment_activities:t.comment_activity_dicts.map(c.CommentActivity.fromDict),users_to_notify:(t.users_to_notify||[]).map(a.ActivityUser.fromDict),latest_revision:t.latest_revision})},e.prototype.enableCommenting=function(){return s.set(this,"feedback_off",!1)},e.prototype.disableCommenting=function(){return s.set(this,"feedback_off",!0)},e.prototype._withMutations=function(e){var t=s.thaw(this),n=this.comment_activities.map(s.thaw);return t.comment_activities=n,t.comment_activities.forEach(function(e){e.comment_activities=e.comment_activities.map(s.thaw)}),e(t),o(t)},e.prototype._reapComments=function(e){var t=this.comment_activities.slice();return this.comment_activities.forEach(function(e){t.push.apply(t,e.comment_activities)}),e?t.filter(e):t},e.prototype._findCommentPath=function(e,t){void 0===t&&(t=!1);for(var n=i.matches({activity_key:e}),o=0;o<this.comment_activities.length;o++){var r=this.comment_activities[o];if(n(r))return["comment_activities",o];if(!t)for(var s=0;s<r.comment_activities.length;s++)if(n(r.comment_activities[s]))return["comment_activities",o,"comment_activities",s]}return null},e.prototype._updateComment=function(e,t){return e?s.updateIn(this,e,t):this},e.prototype._updateConversations=function(e){return s.update(this,"comment_activities",e)},e.prototype._updateReplies=function(e,t){var n=this._findCommentPath(e,!0);return n?(n.push("comment_activities"),s.updateIn(this,n,t)):this},e.prototype.findCommentByKey=function(e){for(var t=i.matches({activity_key:e}),n=0;n<this.comment_activities.length;n++){var o=this.comment_activities[n];if(t(o))return o;for(var r=0;r<o.comment_activities.length;r++){var s=o.comment_activities[r];if(t(s))return s}}return null},e.prototype.findConversationByKey=function(e){return i.findWhere(this.comment_activities,{activity_key:e})},e.prototype.purgeCommentByKey=function(e){var t=this._findCommentPath(e);if(t){var n=t.pop();return s.updateIn(this,t,function(e){return s.splice(e,n,1)})}return this},e.prototype.appendComment=function(e,t){var n=function(e){return s.push(e,t)};return this.activity_key===e?this._updateConversations(n):this._updateReplies(e,n)},e.prototype.resolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.resolve()})},e.prototype.unresolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.unresolve()})},e.prototype.setCommentStatusByKey=function(e,t){var n=this._findCommentPath(e);return this._updateComment(n,function(e){return e.setStatus(t)})},e.prototype.markCommentSeenByKeyBatch=function(e){return 0===e.length?this:this._withMutations(function(t){t._reapComments(function(t){return i.contains(e,t.activity_key)}).forEach(function(e){e.is_seen=!0,e.highlight_as_unread=!1})})},e})();n.__decorate([l.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:r.Maybe(Array),latest_revision:u.RevisionShape})],p,"fromDict",null),t.FileActivity=p}),define("modules/clean/file_activity/models/revision",["require","exports","modules/core/types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RevisionShape=Object.freeze({revision_id:String,when:Number,preview_link:n.Maybe(String),direct_blockserver_link:n.Maybe(String)})}),define("modules/clean/frame_messenger/frame_messenger_base",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e){var t=this;this._window=window,this.handleUntrustedMessage=function(e){if(t.isOriginAllowed(e.origin)){var n;try{n=JSON.parse(e.data)}catch(e){return}n.action&&t.dispatchMessage(e,n)}},this.allowedOrigins=e}return e.prototype.getWindow=function(){return this._window},e.prototype.setWindow=function(e){this._window=e},e.prototype.startListening=function(){this.getWindow().addEventListener("message",this.handleUntrustedMessage)},e.prototype.stopListening=function(){this.getWindow().removeEventListener("message",this.handleUntrustedMessage)},e.prototype.regexIn=function(e,t){if(t.indexOf(e)>-1)return!0;for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i instanceof RegExp&&e.match(i))return!0}return!1},e.stripStandardPort=function(e){return"http://"===e.substr(0,7)?e.replace(/:80/,""):"https://"===e.substr(0,8)?e.replace(/:443$/,""):e},e.prototype.isOriginAllowed=function(t){return this.regexIn(e.stripStandardPort(t),this.allowedOrigins)},e.prototype.packagePostMessage=function(e,t){var n={action:e,parameters:t};return JSON.stringify(n)},e})();t.FrameMessengerBase=n}),define("modules/clean/frame_messenger/frame_messenger_client",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,o){"use strict";function i(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedOriginForPosting=null,t._validActions=[],t._parentMessageQueue=[],t._onParentReady=null,t}return n.__extends(t,e),t.prototype.configureParentMessaging=function(e,t,n){void 0===n&&(n=null),this._trustedOriginForPosting=null,this._validActions=t,this._trustedMessageHandler=e,this._onParentReady=n},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.requestParentOrigin()},t.prototype.postMessageToParent=function(e,t){void 0===t&&(t={});var n=this.packagePostMessage(e,t);null===this._trustedOriginForPosting?this._parentMessageQueue.push(n):this.getWindow().parent.postMessage(n,this._trustedOriginForPosting)},t.prototype.dispatchMessage=function(e,t){"parent-ready"===t.action?this.updateParentOrigin(e.origin):i(t.action,this._validActions)&&null!==this._trustedMessageHandler&&this._trustedMessageHandler(t)},t.prototype.resetOriginsForPosting=function(){this._trustedOriginForPosting=null},t.prototype.updateParentOrigin=function(e){var t=this._trustedOriginForPosting;if(!this.isOriginAllowed(e))return!1;if(this._trustedOriginForPosting=e,this._parentMessageQueue.length>0){for(var n=0;n<this._parentMessageQueue.length;n++){var o=this._parentMessageQueue[n],i=JSON.parse(o);this.postMessageToParent(i.action,i.parameters)}this._parentMessageQueue=[]}return null!=this._trustedOriginForPosting&&null==t&&null!==this._onParentReady&&this._onParentReady(),!0},t.prototype.requestParentOrigin=function(){var e=this;this.getWindow().parent.postMessage('{"action": "child-requesting-parent-origin"}',"*");var n=function(){null===e._trustedOriginForPosting&&e.requestParentOrigin()};this.getWindow().setTimeout(n,t._REQUEST_PARENT_ORIGIN_POLL_DELAY)},t})(o.FrameMessengerBase);r._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,t.FrameMessengerClient=r}),define("modules/clean/frame_messenger/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_base"],function(e,t,n,o){"use strict";function i(e,t){return t.indexOf(e)>=0}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._trustedChildOriginForPosting=null,t._validActionsFromChild=[],t.getChildIframes=function(){return[]},t}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){if("string"==typeof e){var o=e;this.getChildIframes=function(){return[].slice.call(document.querySelectorAll(o),0)}}else this.getChildIframes=e;this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},t.prototype.startListening=function(){e.prototype.startListening.call(this),this.postMessageToChildren("parent-ready")},t.prototype.getTrustedChildOriginForPosting=function(){if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(var e=this.getChildIframes(),t=0,n=e;t<n.length;t++){var o=n[t],i=""+o.getAttribute("src"),r=this.getOriginFromUrl(i);if(this.isOriginAllowed(r)){this.updateChildOrigin(r);break}}return this._trustedChildOriginForPosting},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._isNumber=function(e){return!isNaN(parseInt(e,10))},t.prototype.getOriginFromUrl=function(e){var t=document.createElement("a");t.href=e;var n=t.origin;if(n)return"null"===n?"*":n;var o=this._isNumber(t.port)?":"+t.port:"";return t.protocol+"//"+t.hostname+o},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={});var n=this.getChildIframes();this.postMessageToChildElements(n,e,t)},t.prototype.resetOriginsForPosting=function(){this._trustedChildOriginForPosting=null},t.prototype.updateChildOrigin=function(e){"null"===e&&(e="*"),this._trustedChildOriginForPosting=e},t.prototype.dispatchMessage=function(e,t){this.updateChildOrigin(e.origin),"child-requesting-parent-origin"===t.action&&this.postMessageToChildren("parent-ready"),i(t.action,this._validActionsFromChild)&&null!=this._trustedMessageFromChildHandler&&this._trustedMessageFromChildHandler(t)},t.prototype.postMessageToChildElements=function(e,t,n){void 0===n&&(n={});var o=this.getTrustedChildOriginForPosting();if(null!==o){var i=this.packagePostMessage(t,n);e.forEach(function(e){return e.contentWindow.postMessage(i,o)})}},t})(o.FrameMessengerBase);t.FrameMessengerHost=r}),define("modules/clean/frame_messenger/frame_messenger_proxy",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t){this.childMessenger=e,this.parentMessenger=t}return e.prototype.postToParentMessenger=function(e){this.parentMessenger.postMessageToParent(e.action,e.parameters)},e.prototype.postToChildMessenger=function(e){this.childMessenger.postMessageToChildren(e.action,e.parameters)},e})();t.FrameMessengerProxy=n}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_annotations",["jquery","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer","modules/clean/image_preview_util"],function(t,n,o,i){return(function(){function r(){this.onResize=e(this.onResize,this),this._onScroll=e(this._onScroll,this),this._handleMessage=e(this._handleMessage,this)}return r.prototype.onImageLoad=function(e){return null==e&&(e=null),this.reset(),this.resizeImageCallback=e,this._prepareAnnotations()},r.prototype._prepareAnnotations=function(){return this._prepareAnnotationInterface(),this.annotationRenderer=new o,window.addEventListener("resize",this.onResize),i.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("message",this._handleMessage),this._postPageRendered()},r.prototype._prepareAnnotationInterface=function(){var e,o;return 0===i.getAnnotationContainer().length&&(e=i.getPreviewImageWrapper(),o=t("<div class='"+i.ANNOTATION_CONTAINER+"' />"),this.$annotationContainer=o.appendTo(e)),this._resizeAnnotationContainer(),this.annotationInterface=new n,i.getAnnotationContainer().on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout((function(e){return function(){var t;return e._resizeAnnotationContainer(),null!=(t=e.annotationInterface)?t.onScaleChangeCallback():void 0}})(this),0)},r.prototype._handleMessage=function(e){var t,n,o,i,r,s,a,l,c,u,p;try{n=JSON.parse(e.data)}catch(e){return void e}switch(n.action){case"update-annotations":return this._resizeAnnotationContainer(),null!=(o=this.annotationInterface)&&o._updateOffset(),null!=(i=this.annotationRenderer)?i.updateAnnotations(n.parameters):void 0;case"remove-annotation":return t=n.parameters.commentActivity,null!=(r=this.annotationRenderer)?r.removeAnnotation(t):void 0;case"remove-all-annotations":return null!=(s=this.annotationRenderer)&&s.removeAllAnnotations(),this._resizeAnnotationContainer(),null!=(a=this.annotationInterface)?a._updateOffset():void 0;case"enable-annotation-creation":return null!=(l=this.annotationInterface)?l.enableAnnotationCreation():void 0;case"disable-annotation-creation":return null!=(c=this.annotationInterface)?c.disableAnnotationCreation():void 0;case"enable-region-creation":return this._setRegionCreationEnabled(!0);case"disable-region-creation":return this._setRegionCreationEnabled(!1);case"hide-annotation":return null!=(u=this.annotationInterface)?u.onHideAnnotation():void 0;case"scroll-to-annotation":return t=n.parameters.commentActivity,null!=(p=this.annotationRenderer)?p.highlightAnnotation(t):void 0;case"file-feedback-ui-ready":return this._postPageRendered()}},r.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},r.prototype._postMessage=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},r.prototype._setRegionCreationEnabled=function(e){var t,n,o;return e?null!=(t=this.annotationInterface)&&t.enableRegionCreation():null!=(n=this.annotationInterface)&&n.disableRegionCreation(),this._resizeAnnotationContainer(),null!=(o=this.annotationInterface)?o._updateOffset():void 0},r.prototype._onScroll=function(){var e;return null!=(e=this.annotationInterface)?e.onScrollCallback():void 0},r.prototype.onResize=function(e){var t,n;return null==e&&(e=!0),null!=(t=this.annotationRenderer)&&t.removeAllAnnotations(),this._postMessage("scale-change"),n=(function(e){return function(){var t;return e._resizeAnnotationContainer(),e._postPageRendered(),null!=(t=e.annotationInterface)&&t.onScaleChangeCallback(),"function"==typeof e.resizeImageCallback?e.resizeImageCallback():void 0}})(this),clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(n,100):n()},r.prototype._resizeAnnotationContainer=function(){var e,t,n,o,r,s,a,l,c,u,p,d,h;if(e=i.getPreviewImage(),null!=e&&null!=e.offset()&&null!=(null!=(o=e.offsetParent())?o.offset():void 0))return n=e.offset().top-e.offsetParent().offset().top,t=e.offset().left-e.offsetParent().offset().left,n<0&&(n=0),t<0&&(t=0),null!=(r=this.$annotationContainer)&&r.css("margin-top",n),null!=(s=this.$annotationContainer)&&s.css("margin-bottom",n),null!=(a=this.$annotationContainer)&&a.css("margin-left",t),
null!=(l=this.$annotationContainer)&&l.css("margin-right",t),(null!=(c=this.annotationInterface)?c.isAnnotationRegionEnabled:void 0)?(null!=(u=this.$annotationContainer)&&u.height(e.height()),null!=(p=this.$annotationContainer)?p.width(e.width()):void 0):(null!=(d=this.$annotationContainer)&&d.height(0),null!=(h=this.$annotationContainer)?h.width(0):void 0)},r.prototype.removeAnnotations=function(){var e;return null!=(e=this.annotationRenderer)?e.removeAllAnnotations():void 0},r.prototype.reset=function(){var e,t;return null!=(e=this.annotationRenderer)&&e.reset(),null!=(t=this.annotationInterface)&&t.reset(),i.getAnnotationContainer().off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),i.getPreviewImageWrapper().off("scroll",this._onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),this._postMessage("reset-file-feedback-ui")},r})()})}.call(this),function(){define("modules/clean/image_preview_util",["jquery","modules/clean/annotations/annotation"],function(e,t){return t.Annotation,t.AnnotationTypes,t.AnnotationSubtypes,{PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CONTAINER:"db-annotation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return e("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return e("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationContainer:function(){return e("."+this.ANNOTATION_CONTAINER)},getAnnotationLayers:function(){return e("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return e("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){var t,n,o,i,r,s,a,l,c,u,p,d,h,_,m;for(u=[],t=this.getPreviewImageElement(),s=t.clientWidth,r=t.clientHeight,_=e.image_coordinates,i=0,l=_.length;i<l;i++){for(n=_[i],o=[],m=n.coordinates,a=0,c=m.length;a<c;a++)h=m[a],p=h.x*s,d=h.y*r,o.push({x:p,y:d});u.push(o)}return u},convertAnnotationViewportCoordinatesToImagePoints:function(e){var t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v;for(p=[],t=this.getPreviewImageElement(),r=t.getBoundingClientRect(),_=r.left,m=r.top,a=t.clientWidth,s=t.clientHeight,v=e.viewportCoordinates,i=0,c=v.length;i<c;i++){for(n=v[i],o=[],l=0,u=n.length;l<u;l++)f=n[l],d=(f.x-_)/a,h=(f.y-m)/s,o.push({x:d,y:h});p.push({coordinates:o})}return p}}})}.call(this),define("modules/clean/image_size",["require","exports"],function(e,t){"use strict";function n(e,t){for(var n=0,i=o;n<i.length;n++){var r=i[n],s=r[0],a=r[1],l=r[2];if(a>=e||l>=t)return s}return o[o.length-1][0]}Object.defineProperty(t,"__esModule",{value:!0});var o=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]];t.imageBestFitSize=n}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_interface",["jquery","external/react","external/react-dom","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util"],function(t,n,o,i,r){return(function(){function s(){this.onAnnotationLeaveCallback=e(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=e(this.onAnnotationEnterCallback,this),this.onAnnotationScaleChangeCallback=e(this.onAnnotationScaleChangeCallback,this),this.onAnnotationScrollCallback=e(this.onAnnotationScrollCallback,this),this.onAnnotationEndDragCallback=e(this.onAnnotationEndDragCallback,this),this.onAnnotationStartDragCallback=e(this.onAnnotationStartDragCallback,this),this.onAnnotationPlacedCallback=e(this.onAnnotationPlacedCallback,this),this.onAnnotationHiddenCallback=e(this.onAnnotationHiddenCallback,this),this.onScaleChangeCallback=e(this.onScaleChangeCallback,this),this.onScrollCallback=e(this.onScrollCallback,this),this.onKeyDownCallback=e(this.onKeyDownCallback,this),this.onMouseUpCallback=e(this.onMouseUpCallback,this),this.onMouseMoveCallback=e(this.onMouseMoveCallback,this),this.onMouseDownCallback=e(this.onMouseDownCallback,this),this.onHideAnnotation=e(this.onHideAnnotation,this),this._prepareAnnotationCoords=e(this._prepareAnnotationCoords,this),this._refreshAnnotationController=e(this._refreshAnnotationController,this),this._prepareAnnotationController=e(this._prepareAnnotationController,this),this.controllerEventHandlers={onMouseMoveCallback:t.noop,onMouseDownCallback:t.noop,onMouseUpCallback:t.noop,onHideAnnotation:t.noop,onScrollCallback:t.noop,onScaleChangeCallback:t.noop,onKeyDownCallback:t.noop},this.isAnnotationRegionEnabled=!1,this.isAnnotationCreationEnabled=!1,this._prepareAnnotationController()}return s.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},s.prototype._isOnAnnotationUI=function(e){return t(e.target).parents(".db-annotation-layer").length>0},s.prototype._isOnAnnotationOverlay=function(e){return t(e.target).parents("#annotation-overlay").length>0},s.prototype._destroyAnnotationController=function(){var e;if(e=r.getAnnotationLCanvasLayer(),(null!=e?e.length:void 0)>0)return o.unmountComponentAtNode(e[0]),e.remove()},s.prototype._prepareAnnotationController=function(){var e,n;if(e=r.getAnnotationContainer(),0===e.find("."+r.ANNOTATION_CANVAS_LAYER_CSS).length)return n=t("<div class='"+r.ANNOTATION_CANVAS_LAYER_CSS+"' />"),this.$parentContainerEl=n.appendTo(e),this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController()},s.prototype._refreshAnnotationController=function(e){var t;if(null!=(t=this.$parentContainerEl)?t.get(0):void 0)return this.annotationController=o.render(n.createElement(i,{parentContainerOffset:this.parentContainerOffset,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:!1,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}),this.$parentContainerEl.get(0),e)},s.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this._addTranslatedImagePoints(e)),e},s.prototype._addTranslatedImagePoints=function(e){return e.image_coordinates=r.convertAnnotationViewportCoordinatesToImagePoints(e),e},s.prototype._updateOffset=function(e){if(this.$parentContainerEl)return this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController(e)},s.prototype.enableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!0,this._refreshAnnotationController()},s.prototype.disableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!1,this._refreshAnnotationController()},s.prototype.enableRegionCreation=function(){return t("html").addClass("region-creation"),this.isAnnotationRegionEnabled=!0,this._refreshAnnotationController()},s.prototype.disableRegionCreation=function(){return t("html").removeClass("region-creation"),this.isAnnotationRegionEnabled=!1,this._refreshAnnotationController()},s.prototype.reset=function(){return this.disableRegionCreation(),this._destroyAnnotationController(),r.getAnnotationContainer().remove()},s.prototype.onHideAnnotation=function(){var e;return null!=(e=this.controllerEventHandlers)?e.onHideAnnotation():void 0},s.prototype.onMouseDownCallback=function(e){var t;if(!this._isOnAnnotationUI(e)&&!this._isOnAnnotationOverlay(e))return null!=(t=this.controllerEventHandlers)?t.onMouseDownCallback(e):void 0},s.prototype.onMouseMoveCallback=function(e){var t;return null!=(t=this.controllerEventHandlers)?t.onMouseMoveCallback(e):void 0},s.prototype.onMouseUpCallback=function(e){var t;return null!=(t=this.controllerEventHandlers)?t.onMouseUpCallback(e):void 0},s.prototype.onKeyDownCallback=function(e){var t;return t=e.keyCode||e.which||e.charCode,this._sendToParent("on-keydown",{keyCode:t})},s.prototype.onScrollCallback=function(e){var t,n;if(this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onScrollCallback():void 0),!(null!=(n=this.annotationController)?n.hasVisibleActiveAnnotation():void 0))return this._sendToParent("scroll")},s.prototype.onScaleChangeCallback=function(e){var t;return this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onHideAnnotation:void 0),this._sendToParent("scale-change",e)},s.prototype.onAnnotationHiddenCallback=function(){return this._sendToParent("annotation-hidden")},s.prototype.onAnnotationPlacedCallback=function(e){return this._sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationStartDragCallback=function(e){return this._sendToParent("annotation-start-drag")},s.prototype.onAnnotationEndDragCallback=function(e){return this._sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationScrollCallback=function(e){return this._sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationScaleChangeCallback=function(e){return this._sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationEnterCallback=function(){return this._sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},s.prototype.onAnnotationLeaveCallback=function(){return this._sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},s})()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_renderer",["jquery","external/react","external/react-dom","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util"],function(t,n,o,i,r,s,a,l){var c;return c=new a,(function(){function i(){this.onAnnotationLeaveCallback=e(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=e(this.onAnnotationEnterCallback,this),this.onAnnotationClickCallback=e(this.onAnnotationClickCallback,this),this._renderAnnotation=e(this._renderAnnotation,this),this.updateAnnotations=e(this.updateAnnotations,this),this.removeAnnotation=e(this.removeAnnotation,this),this._annotationsByActivityKey={}}return i.prototype._isAnnotationAlreadyRendered=function(e){return t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e+"']").length>0},i.prototype.removeAnnotation=function(e){var n;if(this._isAnnotationAlreadyRendered(e.activity_key))return n=t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']").get(0),o.unmountComponentAtNode(n),n.remove()},i.prototype.removeAllAnnotations=function(){return this.reset()},i.prototype.reset=function(){var e,t,n,i;for(t=l.getAnnotationLayers(),n=0,i=t.length;n<i;n++)e=t[n],o.unmountComponentAtNode(e);return t.remove(),this._annotationsByActivityKey={}},i.prototype.highlightAnnotation=function(e){var n;if(this._isAnnotationAlreadyRendered(e.activity_key))return n=t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']"),n.removeClass("start-highlight-animation"),n.width(n.width()),n.addClass("start-highlight-animation")},i.prototype.updateAnnotations=function(e){var t,n,o,i,r,s;if(c.shouldUpdateAnnotations(e,this._annotationsByActivityKey)){for(this.removeAllAnnotations(),r=e.annotations,s=[],o=0,i=r.length;o<i;o++)n=r[o],c.renderAnnotation(n,this._isAnnotationAlreadyRendered,this._renderAnnotation),t=n.commentActivity.activity_key,s.push(this._annotationsByActivityKey[t]=n);return s}},i.prototype._renderAnnotation=function(e,i,r,s){var a,c,u;if(c=l.getAnnotationContainer(),(null!=c?c.length:void 0)>0)return i.viewportCoordinates=l.convertAnnotationImagePointsToViewportCoordinates(i),u=t("<div class='"+l.ANNOTATION_LAYER_CSS+"' />"),u.attr({"data-comment-activity-key":r.activity_key}),a=u.appendTo(c).get(0),o.render(n.createElement(e,{annotation:i,commentActivity:r,options:s,onAnnotationClickCallback:this.onAnnotationClickCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationOverCallback:this.onAnnotationOverCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}),a)},i.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},i.prototype.onAnnotationClickCallback=function(e){return this._sendToParent("annotation-ui-click",e)},i.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},i.prototype.onAnnotationOverCallback=function(e){return{}},i.prototype.onAnnotationLeaveCallback=function(e){return this._sendToParent("annotation-ui-leave",e)},i})()})}.call(this),define("modules/clean/loggers/file_preview_logger",["require","exports","tslib","external/underscore","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],function(e,t,n,o,i,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d={};d[r.EventTypes.FILE_PREVIEW_SESSION_ENDED]="preview_session_ended",d[r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED]="preview_attempted",d[r.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED]="support_confirmed",d[r.EventTypes.FILE_PREVIEW_SUPPORT_DENIED]="support_denied",d[r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]="download_attempted",d[r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]="download_succeeded",d[r.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED]="download_failed",d[r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED]="render_succeeded",d[r.EventTypes.FILE_PREVIEW_RENDER_FAILED]="render_failed",d[r.EventTypes.FILE_PREVIEW_VIDEO_STALLED]="video_stalled",d[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED]="quality_popup_asked",d[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED]="quality_popup_answered",d[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED]="quality_popup_dismissed",d[r.EventTypes.FILE_PREVIEW_USER_ACTION]="user_action",d[r.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED]="file_downloaded",d[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED]="show_contents_attempted",d[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED]="show_contents_failed",d[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED]="show_contents_succeeded";var h=(function(){function e(){this._eventHandlers={}}return e.prototype._getSerializedTimeline=function(e){return null},e.prototype.addEventHandlers=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,o=e;n<o.length;n++){var i=o[n],r=i[0],s=i[1];this._eventHandlers[r]=s}},e.prototype._log=function(e,t,n){void 0===n&&(n={});var o=this._getSerializedTimeline(t),r={device_type:t.fileViewerSession.deviceType,event_name:d[e],extra:JSON.stringify(n),file_viewer_session_id:t.fileViewerSession.id,file_preview_session_id:t.id,file_ns_id:t.file.ns_id,file_sjid:t.file.sjid,file_preview_timeline:o?JSON.stringify(o):null,file_preview_size:t.previewSize};i.SilentBackgroundRequest({url:"/log/file_preview",data:r})},e.prototype.listenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.addListener(t,n)}},e.prototype.unlistenTo=function(e){for(var t in this._eventHandlers)if(this._eventHandlers.hasOwnProperty(t)){var n=this._eventHandlers[t];e.removeListener(t,n)}},e})(),_=(function(e){function t(){var t=e.call(this)||this;return t._logAnswers=function(e,n,i){void 0===i&&(i={}),o.each(n,function(e,t){return i[l.getQuestionLoggerKey(t)]=e}),t._log(r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,e,i)},t._logQuestion=function(e,n){for(var o={},i=0,s=n;i<s.length;i++){var a=s[i];o[l.getQuestionLoggerKey(a)]="1"}t._log(r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,e,o)},t._logDismissed=function(e,n){var o={stage:a.getPopupStageLoggerKey(n)};t._log(r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,e,o)},t.addEventHandlers([r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,t._logQuestion],[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,t._logAnswers],[r.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,t._logDismissed]),t}return n.__extends(t,e),t.prototype._log=function(t,n,o){void 0===o&&(o={}),o._client_time=+Date.now();var i=n.sourceContext,r=n.sourceAction;i&&(o._source_context=s.getPreviewSourceContextKey(i)),r&&(o._source_action=s.getPreviewSourceActionKey(r)),e.prototype._log.call(this,t,n,o)},t})(h);t.FilePreviewQualityPopupLogger=_;var m=(function(e){function t(t){var n=e.call(this)||this;return n._handleFilePreviewAttemptStarted=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,e,t)},n._handleFilePreviewSupportConfirmed=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,e,t)},n._handleFilePreviewSupportDenied=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,e,t)},n._handleFilePreviewDownloadAttempted=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,e,t)},n._handleFilePreviewDownloadSucceeded=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,e,t)},n._handleFilePreviewDownloadFailed=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED,e,t)},n._handleFilePreviewRenderSucceeded=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED,e,t)},n._handleFilePreviewRenderFailed=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_RENDER_FAILED,e,t)},n._handleFilePreviewSessionEnded=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_SESSION_ENDED,e,t)},n._handleFilePreviewVideoStalled=function(e,t){n._handleEvent(r.EventTypes.FILE_PREVIEW_VIDEO_STALLED,e,t)},n._filePreviewSessionId=t,n.addEventHandlers([r.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,n._handleFilePreviewAttemptStarted],[r.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,n._handleFilePreviewSupportConfirmed],[r.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,n._handleFilePreviewSupportDenied],[r.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,n._handleFilePreviewDownloadAttempted],[r.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,n._handleFilePreviewDownloadSucceeded],[r.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED,n._handleFilePreviewDownloadFailed],[r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED,n._handleFilePreviewRenderSucceeded],[r.EventTypes.FILE_PREVIEW_RENDER_FAILED,n._handleFilePreviewRenderFailed],[r.EventTypes.FILE_PREVIEW_SESSION_ENDED,n._handleFilePreviewSessionEnded],[r.EventTypes.FILE_PREVIEW_VIDEO_STALLED,n._handleFilePreviewVideoStalled]),n}return n.__extends(t,e),t.prototype._handleEvent=function(e,t,n){if(void 0===n&&(n={}),this._filePreviewSessionId===t.id){n.preview_type=t.file.preview_type,n.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),n.web_timing_logger_req_id=u.REQUEST_ID,n.source_context=s.getPreviewSourceContextKey(t.sourceContext),n.source_action=s.getPreviewSourceActionKey(t.sourceAction),n.is_mounted=t.isMounted,null!=t.primaryMarkTs&&(n.primary_mark_ts=t.primaryMarkTs,n.time_to_primary_mark=t.timeToPrimaryMark()),null!=t.secondaryMarkTs&&(n.secondary_mark_ts=t.secondaryMarkTs,n.time_to_secondary_mark=t.timeToSecondaryMark());var i=c.start_time();if(void 0!==i&&(n.navigation_start=i),null!=t.pageCount&&(n.page_count=t.pageCount),null!=t.firstPageRendered&&(n.first_page_rendered=t.firstPageRendered),null!=t.previewThumbnailInfo&&(n.preview_thumbnail_info=JSON.stringify(t.previewThumbnailInfo)),t.didFallbackToPdfjs&&(n.fallback_pdfjs=!0),t.isSSR&&(n.is_ssr="1"),null!=t.lastEvent&&(n.last_event=d[t.lastEvent]),o.isEmpty(t.ssrTimestamps)||(n.ssr_timestamps=JSON.stringify(t.ssrTimestamps)),o.isEmpty(t.ssrTiming)||(n.ssr_timing=JSON.stringify(t.ssrTiming)),t.sourceAction===s.PreviewSourceAction.VISIT){var a=c.time_since_start();if(null!=a&&(n.time_to_event=a),e===r.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED){var l=c.time_to_view();null!=l&&null!=i&&(n.time_to_render=l-i,n.ttv_ts=l);var h=c.time_to_interactive();null!=h&&null!=i&&(n.time_to_interactive=h-i);var _=p.performance();if(null!=_){var m=_.timing;null!=m&&null!=i&&(n.time_to_first_byte=m.responseStart-i,n.web_timing_data=JSON.stringify(m))}window._timingData&&(window._timingData.pdfjs&&(n.pdfjs_timing_data=JSON.stringify(window._timingData.pdfjs)),window._timingData.img&&(delete window._timingData.img.dl_error_finish,n.img_timing_data=JSON.stringify(window._timingData.img)))}}e===r.EventTypes.FILE_PREVIEW_SESSION_ENDED&&(n.pages_rendered=JSON.stringify(t.pagesRendered),n.images_fetched=JSON.stringify(t.fileViewerSession.imagesFetched),n.zoom_scales=JSON.stringify(t.zoomScales),n.password_needed=t.passwordNeeded),this._log(e,t,n)}},t.prototype._getSerializedTimeline=function(e){var t={};for(var n in e.previewTimeline)if(e.previewTimeline.hasOwnProperty(n)){var o=e.previewTimeline[n],i=this._timelineKey(n);t[i]=o.timestamp}return t},t.prototype._timelineKey=function(e){return d[e]+"_ts"},t})(h);t.FilePreviewTimelineLogger=m;var f=(function(e){function t(){var t=e.call(this)||this;return t._logDownload=function(e,n){t._log(r.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED,e,n)},t._logShowContentsAttempted=function(e,n){t._log(r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED,e,n)},t._logShowContentsFailed=function(e,n){t._log(r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED,e,n)},t._logShowContentsSucceeded=function(e,n){t._log(r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED,e,n)},t.addEventHandlers([r.EventTypes.FILE_PREVIEW_FILE_DOWNLOADED,t._logDownload],[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED,t._logShowContentsAttempted],[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_FAILED,t._logShowContentsFailed],[r.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED,t._logShowContentsSucceeded]),t}return n.__extends(t,e),t})(h);t.FilePreviewArchiveLogger=f;var v=(function(e){function t(){var t=e.call(this)||this;return t._logUserAction=function(e,n,o,i){i.action=n,i.context=o,t._log(r.EventTypes.FILE_PREVIEW_USER_ACTION,e,i)},t.addEventHandlers([r.EventTypes.FILE_PREVIEW_USER_ACTION,t._logUserAction]),t}return n.__extends(t,e),t})(h);t.FilePreviewUserActionLogger=v}),function(){define("modules/clean/loggers/file_viewer_logger",["jquery","modules/constants/python","modules/clean/analytics","modules/clean/previews/util"],function(e,t,n,o){var i;return i=t.FileViewPlatformType,t.FileViewTargetType,(function(){function t(){}return t.start=function(){return n.UserActivityLogger.start("web","file_view_first_page_rendered"),n.PreviewActivityLogger.start("file_view_first_page_rendered"),n.FileViewLogger.start()},t.logPageRendered=function(t,i){var r,s,a,l,c,u,p;for(t=t,r=o.get_extension(t),l=e.extend(i.attributes,{total_time:-1,file_ext:r,source:"file-viewer",originalSize:null!=t.bytes?t.bytes:0}),u=i.stats,s=0,a=u.length;s<a;s++)p=u[s],c=(function(){switch(p.name){case"Page Request":return"viewer_page_request_time";case"Rendering":return"viewer_rendering_time";case"Overall":return"viewer_overall_time"}})(),l[c]=p.end-p.start;return n.UserActivityLogger.stop("web","file_view_first_page_rendered",l),n.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:r,extra:JSON.stringify(l)})},t.logView=function(e,t,r,s,a,l,c,u,p){var d;return null==c&&(c=1),null==u&&(u=!1),null==p&&(p=!1),d={user_id:null!=t?t.id:void 0,target:r,platform:i.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:s,action:a,shared_link_url:l,extra:{file_ext:o.get_extension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,time_taken:-1,in_progress:u,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),file_view_attempts:c,is_ndsl:p}},n.FileViewLogger.stop(d)},t})()})}.call(this),define("modules/clean/loggers/pass_facepile_logger",["require","exports","modules/clean/ajax","modules/clean/react/file_viewer/models","modules/clean/react/pass/constants"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};r[i.EventTypes.PASS_SHOWN]="pass_shown",r[i.EventTypes.PASS_HOVER]="pass_hover",r[i.EventTypes.PASS_CLICK]="pass_click";var s=(function(){function e(){this.eventToHandlerStack={};for(var e=0,t=[i.EventTypes.PASS_SHOWN,i.EventTypes.PASS_HOVER,i.EventTypes.PASS_CLICK];e<t.length;e++){var n=t[e];this.eventToHandlerStack[n]=[]}}return e.prototype._log=function(e,t,i,s){void 0===s&&(s={});var a=t?"BROWSE_FILE_FACEPILE":"PREVIEW_PAGE_FACEPILE";if(!t){var l=o.FilePreviewSession.currentSession;s.file_viewer_session_id=l.fileViewerSession.id,s.file_preview_session_id=l.id}var c=new Date,u={event_name:r[e],file_ns_id:i.ns_id,file_sjid:i.sjid,origin:a,extra:JSON.stringify(s),client_ts:c.getTime()/1e3};n.SilentBackgroundRequest({url:"/log/pass_facepile",data:u})},e.prototype.listenTo=function(e){this._unlistenToTopOfHandlersStack(e),this._pushHandlers(),this._listenToTopOfHandlersStack(e)},e.prototype.unlistenTo=function(e){this._unlistenToTopOfHandlersStack(e),this._popHandlers(),this._listenToTopOfHandlersStack(e)},e.prototype._unlistenToTopOfHandlersStack=function(e){for(var t in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(t)){if(0===this.eventToHandlerStack[t].length)continue;var n=this.eventToHandlerStack[t].slice(-1)[0];e.removeListener(t,n)}},e.prototype._listenToTopOfHandlersStack=function(e){for(var t in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(t)){if(0===this.eventToHandlerStack[t].length)continue;var n=this.eventToHandlerStack[t].slice(-1)[0];e.addListener(t,n)}},e.prototype._pushHandlers=function(){for(var e in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(e)){var t=this._createHandlerFn(e);this.eventToHandlerStack[e].push(t)}},e.prototype._popHandlers=function(){for(var e in this.eventToHandlerStack)this.eventToHandlerStack.hasOwnProperty(e)&&this.eventToHandlerStack[e].pop()},e.prototype._createHandlerFn=function(e){var t=this;return function(n,o,i){t._log(e,n,o,{num_accessors:i.numAccessors,num_current_viewers:i.numCurrentViewers,num_viewers:i.numViewers})}},e})();t.passFacepileLogger=new s}),function(){define("modules/clean/multiaccount_login",["jquery","modules/core/browser","modules/core/controller_helpers","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/viewer","modules/clean/dbmodal","modules/clean/teams/team_assume_user_personal_locked_modal"],function(e,t,n,o,i,r,s,a,l){var c,u,p,assert;return assert=o.assert,p=i._,c=a.DBModal,u=(function(){function o(){}return o.$element=function(){return e("#db-modal-multiaccount-login-modal")},o.set_during_login_callback=function(e){return assert(!this._during_login_callback,"already have a during_login_callback"),this._during_login_callback=e},o.show_modal=function(o){var i,a,l,u,d;return null==o&&(o={}),s.get_viewer().is_team_assume_user_session?this.show_personal_account_disabled_modal():(this.$element=e.isFunction(this.$element)?this.$element():this.$element,assert(null!=(a=this.$element)?a.length:void 0,"MultiaccountLogin needs its @$element to be set"),assert(!(null!=o.on_success&&null!=o.success_href),"on_success and success_href are mutually exclusive"),null!=o.user?d=o.user:null!=o.user_id?d=s.get_viewer().get_user_by_id(o.user_id,!0):null!=o.role&&(d=s.get_viewer().get_user_by_role(o.role,!0)),assert(null!=d,"invalid user"),l=d.role,assert(!s.get_viewer().is_user_signed_in(d),"called MultiaccountLogin for a user that's already signed in"),u="personal"===l?p("Sign in to your personal Dropbox"):p("Sign in to your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name}),i=this.$element.find("form"),n.get_controller(i).reset(),n.get_controller(i).set_input_value("login_email",d.email),this.auth_success_callback=(function(e){return function(){var n;return s.get_viewer()._sign_in_all_users(),n=function(n){return null!=n?(r.error(n),s.get_viewer()._sign_out_user_by_id(d.id),void e.modal.hide()):null!=o.success_href?t.get_uri().toString()!==o.success_href?t.redirect(o.success_href):t.reload():(e.modal.hide(),"function"==typeof o.on_success?o.on_success():void 0)},null!=e._during_login_callback&&null==o.success_href?e._during_login_callback(d,n):n(),!1}})(this),e(document).off("db:multilogin:success"),e(document).on("db:multilogin:success",this.auth_success_callback),this.modal=new c({element_id:"multiaccount-login-modal"}),this.modal.show(),this.modal.set_title(u),this.$element.find('input[name="login_password"]').focus())},o.show_page_login_modal=function(e){var t,n,o,i,r,a,l;for(l=s.get_viewer(),o=null,r=l.get_users(!0),t=0,n=r.length;t<n;t++)if(a=r[t],!l.is_user_signed_in(a)){o=a;break}if(o)return i={user:o},"string"==typeof e?i.success_href=e:"function"==typeof e&&(i.on_success=e),this.show_modal(i),!1},o.show_personal_account_disabled_modal=function(){var e;return e=s.get_viewer(),l.AssumePersonalLockedModal.show({displayName:e.display_name,teamName:e.team_name}),!1},o})(),INLINE_JS.MultiaccountLogin=u,u})}.call(this),define("modules/clean/open_in_app/actions",["require","exports","modules/clean/open_in_mobile_app","modules/constants/file_viewer"],function(e,t,n,o){"use strict";function i(){var e=navigator.userAgent||"",t=e.match(/OS (\d+)_(\d+)_?(\d+)?/);return!t||parseInt(t[1],10)>=9}function r(e){return e.platform===u.IPAD||e.platform===u.IPHONE}function s(e){return e.platform===u.ANDROID_MARKET}function a(e,t){var o=t.onAppNeeded,a=t.onAppInstalled;r(e)?n.open_ios(e.iOSAppUrl,e.iOSAppStoreUrl,i(),o,a):s(e)&&n.open_android_intent(e.androidAppUrl)}function l(e){var t;if(r(e))t=e.iOSAppUrl;else{if(!s(e))return;t=e.androidAppUrl}var n=document.createElement("iframe");n.setAttribute("class","open-in-app-transport"),n.setAttribute("src",t),n.setAttribute("style","display: none"),document.body.appendChild(n)}function c(){n.cleanup()}Object.defineProperty(t,"__esModule",{value:!0});var u=o.OpenInMobileAppPlatform;t.openInApp=a,t.openImmediately=l,t.cleanUp=c}),function(){define("modules/clean/open_in_mobile_app",["jquery","modules/clean/analytics","modules/core/exception","modules/core/i18n"],function(e,t,n,o){var i,assert;return assert=n.assert,i=o._,(function(){function n(){}return n.vischange_listener=null,n.open_app_mode=!0,n._onOpenLoggingHandler=function(){},n._onInstallLoggingHandler=function(){},n.try_open_ios_9=function(e,t,o,i){return null==o&&(o=function(){}),null==i&&(i=function(){}),n.vischange_listener||(n.vischange_listener=function(e){return n.open_app_mode=!0,i()},document.addEventListener("visibilitychange",n.vischange_listener)),n.open_app_mode?(n.open_app_mode=!1,n._onOpenLoggingHandler(),o(),window.location=e):(n._onInstallLoggingHandler(),window.location=t)},n.fallback_will_launch=!1,n.try_open=function(o,i,r){var s,a,l,c,u,p,d,h;if(n._onOpenLoggingHandler(),!n.fallback_will_launch)return s=e("body"),h=function(){var t;return t=e("<iframe />",{src:o,style:"display: none;"}),s.append(t)},u=!1,d=function(e){return u=!0},document.addEventListener("visibilitychange",d),l=!1,c=function(e){return l=!0},window.addEventListener("pagehide",c),null!=r&&t.ShareTibEventLogger.log_unauth("CLICK_MOBILE_OPEN","WEB_MOBILE",{scl_url:r}),h(),p=Date.now(),a=function(){if(n.fallback_will_launch=!1,
document.removeEventListener("visibilitychange",d),window.removeEventListener("pagehide",c),!l&&!u&&Date.now()<p+4700)return null!=r&&t.ShareTibEventLogger.log_unauth("CLICK_MOBILE_INSTALL","WEB_MOBILE",{scl_url:r}),window.location.replace(i)},setTimeout(a,3200),n.fallback_will_launch=!0},n.registerLoggingHandlers=function(e,t){return this._onOpenLoggingHandler=e,this._onInstallLoggingHandler=t},n.open_on_click=function(t,n,o,r,s,a){var l;return null==a&&(a=null),l=(function(o){return function(l){var c;return l.preventDefault(),s?(r||(r=e("<div/>")),c=r.text(),o.try_open_ios_9(t,n,function(){return r.text(i("Install app?"))},function(){return r.text(c)})):o.try_open(t,n,a)}})(this),e(o).on("click",l)},n.open_ios=function(e,t,n,o,i){return null==o&&(o=function(){}),null==i&&(i=function(){}),n?this.try_open_ios_9(e,t,o,i):this.try_open(e,t)},n.open_android_intent=function(e){var t;return t="intent://www.dropbox.com/sm/launch_intent_or_fallback_page",assert(e&&e.startsWith(t),"intentUrl must use intent:// protocol"),window.location.href=e},n.redirect_on_load=function(e,t){return this.try_open(e,t)},n.cleanup=function(){if(this.vischange_listener)return document.removeEventListener("visibilitychange",this.vischange_listener)},n})()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/open_with",["external/underscore","modules/clean/browse_interface","modules/clean/filepath","modules/core/uri"],function(t,n,o,i){return(function(){function r(){}var s,a,l;return r.PRELOAD_URLS={},r.MAX_SUPPORTED_FILE_SIZE_B=157286400,s=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"],a=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"},{id:"wopitest",ext:["wopitest"],icon:"word",name:"WopiTest"}],l=function(n){var i,r;return r=o.filename(n),i=o.file_extension(r),t.find(a,function(t){return e.call(t.ext,i)>=0})},r.get_open_handler_for=function(e,t){var o,s;return s=l(e.fq_path),s&&r.is_app_supported(s.id)?(o=i.encode_parts(e.fq_path),{icon:s.icon,name:s.name,uri:"/ow/msft/edit"+n.get_browse_root(t)+o}):null},r.file_supported=function(e){return!!l(e.fq_path)},r.is_adobe_app=function(t){return e.call(s,t)>=0},r.is_app_supported=function(e){switch(e){case"word":return!0;case"excel":return!0;case"powerpoint":return!0;case"wopitest":return!1;case"wopitest-unsupported":return!1;default:return!1}},r})()})}.call(this),define("modules/clean/optimistic_update",["require","exports","external/underscore"],function(e,t,n){"use strict";function o(e){return n.isString(e)}Object.defineProperty(t,"__esModule",{value:!0});var i={},r=(function(){function e(e){this._base=e,this._journal=[],this._head=i}return e.prototype.getValue=function(){return this._head===i&&(this._head=this._journal.reduce(function(e,t){return t.patch(e,t.id)},this._base)),this._head},e.prototype.commit=function(e){var t=n.uniqueId("optimist-patch-");return this._head=i,this._journal.push({id:t,patch:e}),t},e.prototype.rollback=function(e){return null!==this._removeJournalEntry(e)},e.prototype.rebase=function(e){if(o(e)){var t=this._removeJournalEntry(e);return!!t&&(this._head=i,this._base=t.patch(this._base,e),!0)}return this._head=i,this._base=e(this._base),!0},e.prototype._removeJournalEntry=function(e){var t=n.findIndex(this._journal,function(t){return t.id===e});return t<0?null:(this._head=i,this._journal.splice(t,1)[0])},e})();t.Optimist=r}),define("modules/clean/previews/actions",["require","exports","modules/clean/previews/file_view_rams_common","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/store","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r,s,a,l){"use strict";function c(e,n){var o=l.parse(e||a.get_href());o.setQuery({preview:"1"});var i=l.parse(n).getAuthority();return t.tryNativePdfPrint(o,i)}function u(e){if(null!=e.preview_type){var n=e;if(!(["doc","adobecs"].indexOf(n.preview_type)>-1))return!1;var i=o.get_progressive_url("doc",n.href),r=i.getAuthority();return t.tryNativePdfPrint(i,r)}return!1}function p(){return i.openFullscreen(),!1}function d(){return i.closeFullscreen(),!1}function h(){return s.FileViewerStore.instance.getIsFullscreen()}function _(){return i.broadcastPreviewRenderStatus(r.PreviewRenderStatuses.SUCCEEDED)}Object.defineProperty(t,"__esModule",{value:!0}),t.tryNativePdfPrint=function(e,t){var o=n.getNativePrintUrl(e,t);return null!=o&&(window.open(o,"_blank"),!0)},t.nativePdfPrintFromSharedLink=c,t.nativePdfPrint=u,t.enterFullscreen=p,t.exitFullscreen=d,t.isFullscreen=h,t.broadcastRenderSucceeded=_}),define("modules/clean/previews/file_view_rams_common",["require","exports","modules/core/browser","modules/core/uri"],function(e,t,n,o){"use strict";function i(e){return e=e.toLowerCase(),a.indexOf(e)>-1}function r(){return n.chrome||n.safari}function s(e,t){if(!r())return null;if(!i(t))return null;var n=e.clone();n.updateQuery({disable_range:"1",from_native_print:"1"});var s=o.parse("https://"+t+"/nativeprint");return s.updateQuery({file:n.toString()}),s.toString()}Object.defineProperty(t,"__esModule",{value:!0});var a=["dl-doc.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","dl-doc.dropboxusercontent.com"];t.getNativePrintUrl=s}),define("modules/clean/previews/pdf_loader",["require","exports","external/underscore","modules/clean/ajax","modules/clean/previews/util","modules/clean/react/previews/frame_messenger_host","modules/constants/file_viewer","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=["exit-parent-fullscreen","failed","pagerendered","viewer-initialized","downloading","loaded","fully-loaded","viewer-ready","page-already-opened","page-rendered","page-repositioned","password-needed","zoomed-in","zoomed-out"],u=(function(){function e(e){var t=this;this.options={},this.handleTrustedMessageFromChild=function(e){switch(e.action){case"viewer-initialized":t.onViewerInitialized();break;case"viewer-ready":t.isFullscreen&&t.sendEnterFullscreenAction();break;case"exit-parent-fullscreen":t.isFullscreen=!1,null!=t.exitFullscreenCallback&&t.exitFullscreenCallback();break;case"downloading":t.onLoadAttempted();break;case"failed":t.onFailed(e.parameters);break;case"pagerendered":t.onFirstPageRendered(e.parameters);break;case"loaded":case"fully-loaded":t.onLoaded(e.parameters);break;case"page-already-opened":t.onPagePreloaded(e.parameters);break;case"page-rendered":null!=t.onPageRendered&&t.onPageRendered(e.parameters);break;case"page-repositioned":t.onPageRepositioned(e.parameters);break;case"password-needed":t.onPasswordNeeded();break;case"zoomed-in":case"zoomed-out":null!=t.onZoom&&t.onZoom(e.parameters)}},this.onLoadAttempted=function(){t.onDownloadAttempted&&t.onDownloadAttempted()},this.onPagePreloaded=function(e){if(t.onLoadAttempted(),e.isLoaded&&(t.onLoaded(e),e.isRendered)){var n={attributes:e};t.onFirstPageRendered(n)}e.isPasswordNeeded&&t.onPasswordNeeded(),e.hasFailed&&t.onFailed(e.failureParameters)},this.frameMessenger=e?e:new r.PreviewFrameMessengerHost,this.isFullscreen=!1,this.ducId=i.generateDucId(64)}return e.prototype.startListening=function(){this.frameMessenger.configureChildMessaging("iframe.pdfjs",this.handleTrustedMessageFromChild,c),this.frameMessenger.startListening()},e.prototype.stopListening=function(){this.frameMessenger.stopListening()},e.prototype.setExitFullscreenCallback=function(e){this.exitFullscreenCallback=e},e.prototype.setIsFullscreen=function(e){this.isFullscreen=e},e.prototype.setOnDownloadAttempted=function(e){this.onDownloadAttempted=e},e.prototype.setOnDownloadSucceeded=function(e){this.onDownloadSucceeded=e},e.prototype.setOnDownloadFailed=function(e){this.onDownloadFailed=e},e.prototype.setOnFirstRenderSucceeded=function(e){this.onFirstRenderSucceeded=e},e.prototype.setOnPageRendered=function(e){this.onPageRendered=e},e.prototype.setOnZoom=function(e){this.onZoom=e},e.prototype.setOnRenderFailed=function(e){this.onRenderFailed=e},e.prototype.setOnPageRepositioned=function(e){this.onPageRepositioned=e},e.prototype.setOnPasswordNeeded=function(e){this.onPasswordNeeded=e},e.prototype.repositionFile=function(e){null!=e&&this.frameMessenger.postMessageToChildren("reposition-file",{scrollPosition:e})},e.prototype.openFile=function(e,t){var i=this;if(void 0===t&&(t={}),this.hasDocumentDownloaded=!1,null!=e){var r=l.parse(e),c=r.getQuery(),u=null;"duc_id"in c||(u=this.ducId),n.defaults(t,{disableRange:!!a.safari_version_at_most(8),chunkSizeGandalf:"64000",minRangeSizeGandalf:s.DOCPREVIEW_DOC_RANGE_REQUEST,presentationMode:!1,dropboxDucId:u,renderAtFirstPage:s.WEB_PDF_LOAD_FIRST_PAGE_ENABLED});var p="",d="";if(s.DOCPREVIEW_DEBUG_FORCE_TEST_PDF?p="test.pdf":s.DOCPREVIEW_DEBUG_FORCE_TEST_DECK_PDF?p="test-deck.pdf":"password_protected"===s.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION?d="riviera_exception_password":"too_big"===s.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION&&(d="riviera_exception_too_big"),""!==p?(c.canned_file_name=p,r.setQuery(c)):""!==d&&(c.canned_exception=d,r.setQuery(c)),0===r.getPath().toString().indexOf("/pri")){var h=r.getPath().toString().slice(8);r.setPath("/pri/get_content_url"),o.WebRequest({url:r.toString(),data:{path:h},success:function(e){var n=JSON.parse(e);i.finishOpenFile(n.url,t)}})}else this.finishOpenFile(r,t)}},e.prototype.finishOpenFile=function(e,t){void 0===t&&(t={}),this.isNewFileUrl(e)&&(this.fileUrl=e.toString(),this.options=t,this.sendOpenFileAction())},e.prototype.isNewFileUrl=function(e){return e.toString()!==this.fileUrl},e.prototype.sendOpenFileAction=function(){this.frameMessenger.postMessageToChildren("open-file",{fileUrl:this.fileUrl,options:this.options})},e.prototype.sendEnterFullscreenAction=function(){this.frameMessenger.postMessageToChildren("enter-fullscreen")},e.prototype.onViewerInitialized=function(){this.sendOpenFileAction()},e.prototype.onLoaded=function(e){null!=this.onDownloadSucceeded&&this.onDownloadSucceeded({size:e.size,pageCount:e.pageCount}),this.hasDocumentDownloaded=!0},e.prototype.onFirstPageRendered=function(e){void 0===e&&(e={});var t=void 0;null!=e.attributes&&(t=e.attributes.page),null!=this.onFirstRenderSucceeded&&this.onFirstRenderSucceeded({pageRendered:t})},e.prototype.onFailed=function(e){if(this.hasDocumentDownloaded)null!=this.onRenderFailed&&this.onRenderFailed();else{var t=void 0;null!=e&&(t=e.rivieraStatus);var n={rivieraStatus:t};null!=this.onDownloadFailed&&this.onDownloadFailed(n)}},e})();t.PdfLoader=u}),define("modules/clean/previews/pending_upload_watcher",["require","exports","modules/clean/ajax","modules/clean/react/file_viewer/actions","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e,t,n){void 0===n&&(n=""),this.linkType=e,this.pollUrl=new r({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:n}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);if(t.hasOwnProperty("upload_status")&&"complete"===t.upload_status)return void o.pendingFileUploaded();setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():i.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;n.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=s}),define("modules/clean/previews/preview_toolbar_actions",["require","exports","external/reflux"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarActions=n.createActions(["hideToolbar","showToolbar"])}),define("modules/clean/previews/preview_toolbar_store",["require","exports","external/reflux","modules/clean/previews/preview_toolbar_actions"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarStore=n.createStore({listenables:o.PreviewToolbarActions,init:function(){this.state=this.getInitialState()},getInitialState:function(){return{hideToolbar:!1}},onHideToolbar:function(){this.state.hideToolbar=!0,this.trigger(this.state)},onShowToolbar:function(){this.state.hideToolbar=!1,this.trigger(this.state)}})}),define("modules/clean/previews/util",["require","exports","modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","modules/constants/file_viewer","modules/constants/static","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,c,u){"use strict";function p(){return".react-file-viewer__preview iframe"}function d(e){return void 0===e&&(e=""),y(e)&&l.DOCPREVIEW_EXCEL2}function h(e){return null!=e&&e.is_team&&l.FILE_VIEWER_PASS_ENABLED}function _(){return l.PASS_FA_INTEGRATION_ENABLED}function m(e){return null!=e&&l.FILE_VIEWER_PASS_GA_RECEIVE_ENABLED}function f(e){return!h(e)&&!m(e)}function v(e){return e?"flv"===e?t.FLV_CONTAINER:"webm"===e?"video/webm":"application/vnd.apple.mpegurl":g()?"application/vnd.apple.mpegurl":t.FLV_CONTAINER}function g(){return l.FILE_VIEWER_VIDEO_USE_HLS}function y(e){return["xls","csv","ods"].indexOf(e.substring(0,3))>-1}function E(e){var t=s.isBrowseFile(e)?e.fq_path:e.filename;return r.file_extension(t)}function S(e){var t=s.isBrowseFile(e)?e.fq_path:e.filename;return r.filename(t)}function b(e){if("indd"===e)return e;var t=e.substring(0,3);switch(t){case"rtf":case"odt":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}}function w(e,t){var n,o=b(e),i=u.parse(t);return"xls"!==o||d(o)||(n="xls/preview"),null!=n&&(i.setPath(i.getPath().replace("/pri/get/","/get/")),i.setPath(i.getPath().replace("/get/","/"+n+"/"))),i=i.updateQuery({get_preview:"1"})}function C(e){return d(e)?u.parse(c.static_url_pdfjs_excel):u.parse(c.static_url_pdfjs_viewer)}function T(e){if(e.ts)return i.getActingTime(1e3*e.ts)}function A(e){return e=e.updateQuery({annotation_highlight:"1"}),e=e.updateQuery({annotation_region:"1"})}function I(e,t){var n={};return n._subject_uid=String(t),e.updateQuery(n)}function P(e,t){return I(new u({path:"/history"+e.fq_path}),t.id)}function R(e,t){o.UserActivityLogger.log("web","view_version_history");var i=P(e,t);n.redirect(i.toString())}function O(e){return t.VALID_PREVIEW_TYPES.indexOf(e.preview_type)>-1}function N(e){var t=E(e),n=e.bytes,o=Number.MAX_VALUE;return"pdf"===t?o=Number(83886080):"archive"===e.preview_type?o=268435456:"text"===e.preview_type?o=Number(4194304):"linkfile"===e.preview_type?o=Number(10240):n=0,n<o}function L(e){return 0===e.bytes}function M(e){return O(e)&&N(e)}function k(e){var t=E(e);return M(e)&&F(t)}function F(e){var t=b(e);return["doc","ppt","xls","key","eps","ai","indd"].indexOf(t)>-1}function x(e){return["excel","text","doc"].indexOf(e)>-1}function D(e){var t=a.ErrorTypes.LOAD_ERROR;return e===a.RivieraPreviewResponseTypes.UNSUPPORTED_FORMAT?t=a.ErrorTypes.EXTENSION_ERROR:e===a.RivieraPreviewResponseTypes.TOO_BIG?t=a.ErrorTypes.FILE_SIZE_ERROR:e===a.RivieraPreviewResponseTypes.PASSWORD_PROTECTED&&(t=a.ErrorTypes.PASSWORD_PROTECTED_ERROR),t}function U(){return{overflow:"auto","-webkit-overflow-scrolling":"touch"}}Object.defineProperty(t,"__esModule",{value:!0});t.getIframeQuery=p,t.use_excel2_for_extension=d,t.is_pass_enabled=h,t.is_pass_fa_integration_enabled=_,t.is_pass_ga_receive_enabled=m,t.is_pass_opted_out=f;t.FLV_CONTAINER="video/flv";t.video_type=v,t.use_hls_video=g,t.is_excel2_file=y,t.get_extension=E,t.get_filename=S,t.normalize_extension=b,t.get_progressive_url=w,t.get_pdf_js_url=C,t.getModifierString=T,t.update_url_for_annotation=A,t.update_url_with_user_id=I,t.getVersionHistoryUrl=P,t.redirectToVersionHistory=R,t.VALID_PREVIEW_TYPES=["photo","video","linkfile","adobecs","doc","excel","html","text","audio","archive","cloud_content"],t.extensionSupported=O,t.filesizeSupported=N,t.isEmptyFile=L,t.isPreviewable=M,t.canGeneratePreview=k,t.extCanGeneratePreview=F,t.usesFrameMessenger=x,t.mapRivieraStatusToErrorType=D,t.extractLastNumberFromVariant=function(e){var t=e.lastIndexOf("_");return t>=0?parseInt(e.substr(t+1),10)||null:null},t.generateDucId=function(e){var t,n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";try{t=crypto.getRandomValues(new Uint8Array(e))}catch(e){t=[]}null==t&&(t=[]);for(var o="",i=0;i<e;++i){var r=void 0;r=e===t.length?t[i]%n.length:Math.floor(Math.random()*n.length),o+=n[r]}return o},t.iOSIframeScrollStyles=U}),define("modules/clean/react/breadcrumb/trail",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/react/bubble_menu","modules/clean/react/css","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BreadcrumbOverflowPositions=r.BubbleMenu.POSITIONS;var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSegmentClicked=function(e,n){t.onCrumbClicked(e,n)},t.onMenuClicked=function(e,n,o){t.onCrumbClicked(e,n)},t}return n.__extends(t,e),t.prototype.getSplitCrumbs=function(){var e=this.props.crumbs;if(1===e.length)return{overflowCrumbs:[],inlineCrumbs:e};for(var t=this.getMaxInlineTrailWidth(!0),n=e.map(function(e){return new i(e.label).length}),o=1,r=n[e.length-1],s=e.length-2;s>=0;s--){var a=1.64+n[s];if(r+a>t)break;o+=1,r+=a}var l=e.length-o;return{overflowCrumbs:e.slice(0,l),inlineCrumbs:e.slice(l)}},t.prototype.getMaxInlineTrailWidth=function(e){return e?25.375:28},t.prototype.onCrumbClicked=function(e,t){this.props.onChange&&this.props.onChange(e,t,this.props.crumbs.indexOf(t))},t.prototype.render=function(){var e,t=this,n=this.getSplitCrumbs(),i=n.overflowCrumbs,r=n.inlineCrumbs,s=this.getMaxInlineTrailWidth(i.length>0),a=this.props.crumbs[this.props.crumbs.length-1];i.length>0&&(e=o.createElement(h,{crumbs:i,onChange:this.onMenuClicked,overflowDropdownPosition:this.props.overflowDropdownPosition}));var l=r.map(function(e,n){var i=e===a;return o.createElement(m,{key:n,crumb:e,isLastCrumb:i,onClick:t.onSegmentClicked,maxWidth:s})});return o.createElement("span",null,o.createElement("h1",{className:"ax-visually-hidden"},a.label),o.createElement("nav",{className:"breadcrumb-trail u-l-fl","aria-label":c._("Folder Hierarchy"),role:"navigation"},e,l))},t})(o.Component),p=s(u,["/static/css/breadcrumbs-vflLiyKQ8.css"]);t.BreadcrumbTrail=p;var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement(a,{group:"web",name:"chevron",className:"breadcrumb-separator",alt:""})},t})(o.Component),h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e,n){t.props.onChange&&t.props.onChange(e,n,t.props.crumbs.indexOf(n))},t}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.crumbs.slice();t.reverse();var n=o.createElement("button",{className:"u-unbutton breadcrumb-overflow-button u-l-fl"},o.createElement(a,{group:"web",name:"folder_arrow_32",alt:c._("Show parent folders (descending)")})),i=t.map(function(t,n){return o.createElement(_,{key:n,crumb:t,onClick:e.onClick})});return o.createElement("span",{className:"breadcrumb-menu-container"},o.createElement(r.BubbleMenu,{position:this.props.overflowDropdownPosition,targetButton:n,targetFixed:!0,items:i}),o.createElement(d,null))},t})(o.Component),_=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){t.props.onClick&&t.props.onClick(e,t.props.crumb)},t}return n.__extends(t,e),t.prototype.render=function(){var e=i.em_snippet(this.props.crumb.label,37);return o.createElement(r.BubbleMenuItem,{className:"breadcrumb-menu-item",href:this.props.crumb.href,onClick:this.onClick},o.createElement("span",{className:"force-no-break"},o.createElement(l,{group:"web",name:"folder_32",alt:"",text:e})))},t})(o.Component),m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){t.props.onClick&&t.props.onClick(e,t.props.crumb)},t}return n.__extends(t,e),t.prototype.getLabel=function(){return i.em_snippet(this.props.crumb.label,this.props.maxWidth)},t.prototype.render=function(){var e=this.getLabel();return this.props.isLastCrumb?o.createElement("span",{className:"breadcrumb-segment"},e):o.createElement("span",null,o.createElement("a",{className:"breadcrumb-segment",href:this.props.crumb.href,onClick:this.onClick},e),o.createElement(d,null))},t})(o.Component)}),function(){define("modules/clean/react/copy_to_dropbox/actions",["modules/clean/react/copy_to_dropbox/api","modules/core/browser"],function(e,t){return new((function(){function n(){}return n.prototype.copySharedFile=function(n,o,i){return e.copySharedFile(n,o,i).then(function(e){return t.redirect(e)})},n})())})}.call(this),function(){define("modules/clean/react/copy_to_dropbox/api",["modules/clean/ajax"],function(e){var t;return t={},t.copySharedFile=function(t,n,o){var i;return i={link_type:t.linkType,link_key:t.linkKey,subpath:t.subPath,secure_hash:t.secureHash,is_package:t.isPackage},t.itemId&&(i.item_id=t.itemId),new Promise(function(t){return e.WebProgressRequest({url:"/sm/c2d",data:i,progress_text:o,subject_user:n,success:t})})},t})}.call(this),function(){define("modules/clean/react/copy_to_dropbox/modal",["external/react","modules/clean/analytics","modules/clean/em_string","modules/clean/react/copy_to_dropbox/actions","modules/clean/react/modal","modules/clean/viewer","modules/constants/file_viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l){var c,u,p,d;return u=t.WebMiscActivityLogger,c=i.Modal,p=a._,d=e.DOM.p,c=e.createFactory(c),e.createClass({displayName:"CopyToDropboxModal",propTypes:{shareToken:e.PropTypes.object.isRequired,fileOrFolder:e.PropTypes.object.isRequired,role:e.PropTypes.string.isRequired,userId:e.PropTypes.number,onDismiss:e.PropTypes.func},componentDidMount:function(){return u.log("show-c2d-modal",{filename:this.props.fileOrFolder.filename})},_getTitle:function(){var e,t,o,i,s;if(s=r.get_viewer(),e=this.props.fileOrFolder.filename,!s.is_paired)return t=15,e=n.em_snippet(e,t),p("Save ‘%(filename)s’ to my Dropbox").format({filename:e});switch(this.props.role){case"personal":return t=10,e=n.em_snippet(e,t),p("Save ‘%(filename)s’ to my personal Dropbox").format({filename:e});case"work":return o=s.team_name,i=new n(o).length,t=Math.max(10,15-i),e=n.em_snippet(e,t),p("Save ‘%(filename)s’ to my %(team_name)s Dropbox").format({filename:e,team_name:o})}},_getBodyText:function(){var e;if(e=r.get_viewer(),!e.is_paired)return p(this.props.fileOrFolder.is_dir?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.");switch(this.props.role){case"personal":return p(this.props.fileOrFolder.is_dir?"This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.");case"work":return this.props.fileOrFolder.is_dir?p("This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name}):p("This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name})}},_getAcceptButtonText:function(){var e;if(e=r.get_viewer(),s.MAESTRO_ENABLED)return p("Save");if(!e.is_paired)return p("Save to my Dropbox");switch(this.props.role){case"personal":return p("Save to my personal Dropbox");case"work":return p("Save to my %(team_name)s Dropbox").format({team_name:e.team_name})}},_getProgressMessage:function(){var e;if(e=r.get_viewer(),!e.is_paired)return p("Saving to your Dropbox...");switch(this.props.role){case"personal":return p("Saving to your personal Dropbox...");case"work":return p("Saving to your %(team_name)s Dropbox...").format({team_name:e.team_name})}},_handleAccept:function(){var e;return e=this._getProgressMessage(),l.success(e),o.copySharedFile(this.props.shareToken,this.props.userId,e)},_getStyle:function(){return s.MAESTRO_ENABLED?"default-maestro":"default"},render:function(){return c({title:this._getTitle(),acceptButtonText:this._getAcceptButtonText(),dismissButtonText:p("Cancel"),onAccept:this._handleAccept,onDismiss:this.props.onDismiss,style:this._getStyle()},d({className:"db-modal-message"},this._getBodyText()))}})})}.call(this),define("modules/clean/react/deprecated/copyright_flag",["require","exports","tslib","external/react","modules/clean/react/title_bubble","modules/clean/react/css","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getCopyrightHref=function(){var e;if(this.props.sharedLink)e={ssu:this.props.sharedLink};else{var t=this.props.shareToken;e={link_key:t.linkKey,link_type:t.linkType,spath:t.subPath,shash:t.secureHash}}return new a({scheme:"https",authority:"www.dropbox.com",path:"/copyright_complaint",query:e}).toString()},t.prototype.render=function(){return o.createElement(i,{content:s._("Flag for copyright"),position:i.POSITIONS.RIGHT,distanceFromTarget:5,isTargetPositionFixed:!0},o.createElement("div",{className:"react-copyright-complaint-flag"},o.createElement("a",{href:this.getCopyrightHref(),className:"flag-link",title:s._("Flag for copyright"),rel:"nofollow"}," ")))},t})(o.Component),c=r(l,["/static/css/deprecated/copyright_flag-vflTru2S1.css"]);t.CopyrightFlag=c}),define("modules/clean/react/file_action_button_type",["require","exports","modules/core/i18n"],function(e,t,n){"use strict";function o(e){return e&&r[e]?r[e]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.FileActionButtonType={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"};var i=function(){return{comment:"BUTTON"}},r=(s={},s[t.FileActionButtonType.COMMENT]=n._("Comment",i()),s[t.FileActionButtonType.COPY]=n._("Copy…",i()),s[t.FileActionButtonType.DELETE]=n._("Delete…",i()),s[t.FileActionButtonType.DOWNLOAD]=n._("Download",i()),s[t.FileActionButtonType.MOVE]=n._("Move…",i()),s[t.FileActionButtonType.OPEN]=n._("Open",i()),s[t.FileActionButtonType.PREVIOUS_VERSIONS]=n._("Version history",i()),s[t.FileActionButtonType.REMOVE_LINK]=n._("Remove link",i()),s[t.FileActionButtonType.RENAME]=n._("Rename",i()),s[t.FileActionButtonType.SHARE]=n._("Share",i()),s[t.FileActionButtonType.ENABLE_COMMENTS]=n._("Enable comments",i()),s[t.FileActionButtonType.DISABLE_COMMENTS]=n._("Disable comments",i()),s[t.FileActionButtonType.SHOW_RESOLVED_COMMENTS]=n._("Show resolved comments",i()),s[t.FileActionButtonType.HIDE_RESOLVED_COMMENTS]=n._("Hide resolved comments",i()),s[t.FileActionButtonType.SUBSCRIBE]=n._("Subscribe to notifications",i()),s[t.FileActionButtonType.UNSUBSCRIBE]=n._("Unsubscribe from notifications",i()),s);t.getFileActionButtonText=o;var s}),function(){define("modules/clean/react/file_comments/logger",["modules/clean/ajax","modules/clean/annotations/annotation","modules/core/exception"],function(e,t,n){var o,i;return o=t.Annotation,i=(function(){function t(){this.disabled=!1}return t.prototype.set_disabled=function(e){return this.disabled=e},t.prototype.log_event=function(t,o,i,r,s,a,l,c,u){if(null==l&&(l=null),null==c&&(c=null),null==u&&(u=null),!this.disabled)return n.assert(t,"event_type not provided"),n.assert(o,"file_activity_key not provided"),e.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:t,file_activity_key:o,comment_activity_key:i,client_origin_type:r,activity_context:a,annotation_type:l,annotation_subtype:c,annotation_page:u},subject_user:s})},t.prototype.log_annotation_event=function(e,t,n,i,r,s){var a,l,c,u;return null==s&&(s=null),null!=s&&(a=o.createAnnotationFromDict(s),u=a.type,c=a.subtype,l=a.getFirstPdfPage()),this.log_event(e,t,n,null,i,r,u,c,l)},t})(),new i})}.call(this),function(){var e=[].slice;define("modules/clean/react/file_comments/onboarding",["external/classnames","external/react","modules/core/i18n","modules/clean/react/image","modules/clean/react/onboarding_modal","modules/clean/static_urls"],function(t,n,o,i,r,s){var a,l,c,u,p,d,h,_;return d=o._,_=s.static_url,h=n.DOM,c=[{src:_("/static/images/commenting/onboarding_step1-vflB01-Fx.png"),srcHiRes:_("/static/images/commenting/onboarding_step1@2x-vflyooTgN.png")},{src:_("/static/images/commenting/onboarding_step2-vflQHsmaO.png"),srcHiRes:_("/static/images/commenting/onboarding_step2@2x-vflEm4vmD.png")},{src:_("/static/images/commenting/onboarding_step3-vflvKl_oO.png"),srcHiRes:_("/static/images/commenting/onboarding_step3@2x-vfljsqrRb.png")}],l=n.createFactory(r),a=n.createFactory(i),p=n.createClass({displayName:"Slide",mixins:[n.addons.PureRenderMixin],statics:{slideImages:c},propTypes:{heading:n.PropTypes.string.isRequired,subheading:n.PropTypes.string.isRequired,image:n.PropTypes.shape({src:n.PropTypes.string.isRequired,srcHiRes:n.PropTypes.string.isRequired}).isRequired,className:n.PropTypes.string},render:function(){return h.div({className:t("comment-onboarding-slide",this.props.className)},a({src:this.props.image.src,srcHiRes:this.props.image.srcHiRes,className:"comment-onboarding-illustration"}),h.h1({className:"comment-onboarding-heading"},this.props.heading),h.h2({className:"comment-onboarding-subheading"},this.props.subheading))}}),u=n.createFactory(p),n.createClass({displayName:"CommentingOnboardingModal",mixins:[n.addons.PureRenderMixin],propTypes:{onOpen:n.PropTypes.func,onClose:n.PropTypes.func},componentDidMount:function(){var e;return"function"==typeof(e=this.props).onOpen?e.onOpen():void 0},getSlides:function(){return[u({className:"comment-slide-1",heading:d("Annotate your files"),subheading:d("Give clear, focused feedback that’s faster than email."),image:c[0]}),u({className:"comment-slide-2",heading:d("Point to what you’re talking about"),subheading:d("Just click anywhere inside the doc, or drag around a specific area."),image:c[1]}),u({className:"comment-slide-3",heading:d("Never lose track of feedback"),subheading:d("Conversations stay with the file, and you can view on any device."),image:c[2]})]},render:function(){return l.apply(null,[{className:"comment-onboarding-modal",slideWidth:600,onClose:this.props.onClose}].concat(e.call(this.getSlides())))}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_comments/shared_link_signup_modals",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/clean/react/file_comments/logger","modules/constants/legacy","modules/core/browser","modules/core/i18n","modules/core/notify"],function(t,n,o,i,r,s,a,l){var c,u,p;return u=o.DBModal,p=a._,c=(function(){function t(){this._toggle_form=e(this._toggle_form,this),
this._prepare_form=e(this._prepare_form,this),this._reload=e(this._reload,this),this.before_modal=e(this.before_modal,this),this.show_sign_in_modal=e(this.show_sign_in_modal,this),this.show_sign_up_modal=e(this.show_sign_up_modal,this),this.hide_modal=e(this.hide_modal,this),this.init_modals=e(this.init_modals,this),this.show_register=!1,this.init_modals()}return t.POST_COMMENT_VARIANT="post_comment_variant",t.SUBSCRIBE_VARIANT="subscribe_variant",t.prototype.init_modals=function(){return this.default_signup_modal=new u({element_id:"shared-link-default-comments-signup-modal"}),this.default_signup_modal.before_show=this.before_modal},t.prototype.hide_modal=function(){return this.default_signup_modal.hide()},t.prototype.show_sign_up_modal=function(e){return this.show_register=!0,this.variant=e,this.default_signup_modal.show()},t.prototype.show_sign_in_modal=function(e){return this.show_register=!1,this.variant=e,this.default_signup_modal.show()},t.prototype.set_activity_key=function(e){return this.activity_key=e},t.prototype.before_modal=function(e){var t,n;if(this._prepare_form(e),e.find(".toggle-form-link").click((function(t){return function(){return t._toggle_form(e)}})(this)),n=e.find(".register-form"),n.length&&n.on("db:register:success",(function(e){return function(t,n){return e.user=n,l.success(p("Successfully signed up for Dropbox")),i.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}})(this)),t=e.find(".login-form"),t.length)return n.length&&n.on("db:register:user_exists",(function(n){return function(o){var i,r,s,a,l;for(n._toggle_form(e),a=o.prefill,l=i=0,s=a.length;i<s;l=++i)r=a[l],t.find(r).val(l);return t.find(o.focus).focus()}})(this)),t.on("db:login:success",(function(e){return function(t,n){return e.user=n,l.success(p("Successfully signed in to Dropbox")),i.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}})(this))},t.prototype._reload=function(){return s.reload()},t.prototype._prepare_form=function(e){switch(e.find(".form-component").hide(),e.find(".text-variant").hide(),this.show_register?e.find(".register-form-component").show():e.find(".login-form-component").show(),this.variant){case t.POST_COMMENT_VARIANT:return e.find(".text-variant.post-comment-variant").show();case t.SUBSCRIBE_VARIANT:return e.find(".text-variant.subscribe-variant").show();default:return e.find(".text-variant.default-variant").show()}},t.prototype._toggle_form=function(e){var t,n,o;return o=e.find(".register-form-component"),n=e.find(".login-form-component"),o.is(":visible")?(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_MODAL,o.fadeOut({complete:function(){return n.show()}})):(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,n.fadeOut({complete:function(){return o.show()}})),i.log_event(t,this.activity_key,null,r.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.MODAL_TOGGLE_BUTTON)},t})(),{CommentsSharedLinkSignupModals:c}})}.call(this),define("modules/clean/react/file_sidebar/constants",["require","exports","external/react"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_KEY="fileSidebarStore",t.STORE_SHAPE=n.PropTypes.shape({dispatch:n.PropTypes.func.isRequired,getState:n.PropTypes.func.isRequired,subscribe:n.PropTypes.func.isRequired})}),define("modules/clean/react/file_sidebar/file_sidebar_provider",["require","exports","tslib","external/react","modules/clean/react/file_sidebar/constants","modules/constants/file_activity_stream"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o.PropTypes,a=(function(t){function s(n){var o=t.call(this,n)||this,i=e.defined("modules/clean/react/file_sidebar/store/instance"),r=i?e("modules/clean/react/file_sidebar/store/instance").store:void 0;return o.state={loaded:i,store:r},o}return n.__extends(s,t),s.prototype.getChildContext=function(){return e={},e[i.STORE_KEY]=this.state.store,e;var e},s.prototype.componentWillMount=function(){var t=this;r.IS_ON&&!this.state.loaded&&e(["modules/clean/react/file_sidebar/store/instance"],function(e){var n=e.store;t.setState({loaded:!0,store:n})})},s.prototype.componentWillUnmount=function(){var e=this.state.store;e&&e.dispatch({type:"::RESET"})},s.prototype.render=function(){return o.Children.only(this.props.children)},s})(o.Component);a.propTypes={children:s.element.isRequired},a.childContextTypes=(l={},l[i.STORE_KEY]=i.STORE_SHAPE,l),t.FileSidebarProvider=a;var l}),define("modules/clean/react/file_viewer/actions",["require","exports","modules/clean/downloads","modules/clean/flux/dispatcher","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r,s,a,l){"use strict";function c(e,t,n,r){void 0===r&&(r={}),o.dispatch({type:i.ActionTypes.SETUP,data:{files:e,currentIndex:t,user:n,sharedLinkInfos:r.sharedLinkInfos,shareTokens:r.shareTokens,sharePermissions:r.sharePermissions,disableFlipping:r.disableFlipping}})}function u(){o.dispatch({type:i.ActionTypes.CLEANUP})}function p(e){o.dispatch({type:i.ActionTypes.UPDATE_FILES,data:{files:e}})}function d(){o.dispatch({type:i.ActionTypes.FLIP_NEXT})}function h(){o.dispatch({type:i.ActionTypes.FLIP_PREVIOUS})}function _(){o.dispatch({type:i.ActionTypes.OPEN_FULLSCREEN})}function m(){o.dispatch({type:i.ActionTypes.CLOSE_FULLSCREEN})}function f(e){o.dispatch({type:i.ActionTypes.SWITCH_REVISION,data:{file:e}})}function v(){o.dispatch({type:i.ActionTypes.RESTORE_REVISION})}function g(e){o.dispatch({type:i.ActionTypes.FAST_FORWARD_REVISION,data:{file:e}})}function y(e){var t=l.parse(e.href);t.updateQuery({dl:"1"}),n.get({url:t.toString(),__do_not_use_expected_domain:"dl.dropboxusercontent.com"})}function E(e,t,n){void 0===n&&(n={}),null!=s.FilePreviewSession.currentSession&&r.filePreviewEventEmitter.emit(i.EventTypes.FILE_PREVIEW_USER_ACTION,s.FilePreviewSession.currentSession,e,t,n)}function S(){a.reload(!0)}function b(e){o.dispatch({type:i.ActionTypes.BROADCAST_RENDER_STATUS,data:{newStatus:e}})}function w(){o.dispatch({type:i.ActionTypes.HIDE_OPEN_IN_APP_BANNER})}function C(){o.dispatch({type:i.ActionTypes.CLOSE_PREVIEW_QUALITY_POPUP})}Object.defineProperty(t,"__esModule",{value:!0}),t.setup=c,t.cleanup=u,t.updateFiles=p,t.flipNext=d,t.flipPrevious=h,t.openFullscreen=_,t.closeFullscreen=m,t.switchRevision=f,t.restoreRevision=v,t.fastForwardRevision=g,t.download=y,t.logUserAction=E,t.pendingFileUploaded=S,t.broadcastPreviewRenderStatus=b,t.hideOpenInAppBanner=w,t.closePreviewQualityPopup=C}),define("modules/clean/react/file_viewer/coach_mark",["require","exports","tslib","external/react","modules/clean/css","modules/clean/react/flag","modules/clean/react/image","modules/clean/sharing/views/hover_close_button"],function(e,t,n,o,i,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentWillMount=function(){i.require_css("/static/css/legacy_packages/components-vflfWNhxV.css"),i.require_css("/static/css/components/coach_mark-vflQ6U-F8.css")},t.prototype.componentDidMount=function(){this.props.onShown&&this.props.onShown()},t.prototype.renderCloseButton=function(){return this.props.showClose?o.createElement(a,{className:"c-coach-mark__x",onClick:this.props.onCloseButtonClick}):null},t.prototype.renderCoachMarkImage=function(){return o.createElement(s,{className:"c-coach-mark__img u-pad-right-xs",src:this.props.imageUrl,srcHiRes:this.props.imageUrl2x,alt:this.props.imageAlt})},t.prototype.renderCoachMarkMessage=function(){return o.createElement("div",{className:"coach-mark_message"},o.createElement("div",{className:"c-coach-mark__header"},this.renderCloseButton(),o.createElement("h4",null,this.props.title)),o.createElement("p",null,this.props.children),o.createElement("button",{className:"button-primary button-small c-coach-mark__button",onMouseUp:this.props.onButtonClick},this.props.buttonText))},t.prototype.render=function(){return o.createElement("div",{className:"c-coach-mark bubble-dropdown top-right"},o.createElement(r.Flag,{leftAttachment:this.renderCoachMarkImage()},this.renderCoachMarkMessage()),o.createElement("div",{className:"bubble-arrow-border"}),o.createElement("div",{className:"bubble-arrow"}))},t})(o.Component);l.defaultProps={onCloseButtonClick:function(){},showCloseButton:!1},t.CoachMark=l}),define("modules/clean/react/file_viewer/comments_demo_actions",["require","exports","tslib","external/react","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/title_bar/controls_container"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){},a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement(r.TitleBarControlsContainer,null,o.createElement(i.MoreDropdown,{file:this.props.file,isPrivate:!1,sizeClass:this.props.sizeClass,onRemoveShareLink:s}))},t})(o.Component);t.CommentsDemoActions=a}),define("modules/clean/react/file_viewer/constants",["require","exports","modules/clean/react/size_class/constants"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes={SETUP:"SETUP",CLEANUP:"CLEANUP",UPDATE_FILES:"UPDATE_FILES",FLIP_NEXT:"FLIP_NEXT",FLIP_PREVIOUS:"FLIP_PREVIOUS",OPEN_FULLSCREEN:"OPEN_FULLSCREEN",CLOSE_FULLSCREEN:"CLOSE_FULLSCREEN",SWITCH_REVISION:"SWITCH_REVISION",RESTORE_REVISION:"RESTORE_REVISION",FAST_FORWARD_REVISION:"FAST_FORWARD_REVISION",BROADCAST_RENDER_STATUS:"BROADCAST_RENDER_STATUS",HIDE_OPEN_IN_APP_BANNER:"HIDE_OPEN_IN_APP_BANNER",CLOSE_PREVIEW_QUALITY_POPUP:"CLOSE_PREVIEW_QUALITY_POPUP"};(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SUCCEEDED=1]="SUCCEEDED"})(t.PreviewRenderStatuses||(t.PreviewRenderStatuses={})),t.EventTypes={FILE_VIEWER_OPENED:"FILE_VIEWER_OPENED",FILE_PREVIEW_SESSION_ENDED:"FILE_PREVIEW_SESSION_ENDED",FILE_PREVIEW_ATTEMPT_STARTED:"FILE_PREVIEW_ATTEMPT_STARTED",FILE_PREVIEW_SUPPORT_CONFIRMED:"FILE_PREVIEW_SUPPORT_CONFIRMED",FILE_PREVIEW_SUPPORT_DENIED:"FILE_PREVIEW_SUPPORT_DENIED",FILE_PREVIEW_DOWNLOAD_ATTEMPTED:"FILE_PREVIEW_DOWNLOAD_ATTEMPTED",FILE_PREVIEW_DOWNLOAD_SUCCEEDED:"FILE_PREVIEW_DOWNLOAD_SUCCEEDED",FILE_PREVIEW_DOWNLOAD_FAILED:"FILE_PREVIEW_DOWNLOAD_FAILED",FILE_PREVIEW_RENDER_SUCCEEDED:"FILE_PREVIEW_RENDER_SUCCEEDED",FILE_PREVIEW_RENDER_FAILED:"FILE_PREVIEW_RENDER_FAILED",FILE_PREVIEW_PASS_SHOWN:"FILE_PREVIEW_PASS_SHOWN",FILE_PREVIEW_PASS_HOVER:"FILE_PREVIEW_PASS_HOVER",FILE_PREVIEW_PASS_CLICK:"FILE_PREVIEW_PASS_CLICK",BROWSE_PASS_SHOWN:"BROWSE_PASS_SHOWN",BROWSE_PASS_HOVER:"BROWSE_PASS_HOVER",BROWSE_PASS_CLICK:"BROWSE_PASS_CLICK",FILE_PREVIEW_QUALITY_POPUP_ASKED:"FILE_PREVIEW_QUALITY_POPUP_ASKED",FILE_PREVIEW_QUALITY_POPUP_ANSWERED:"FILE_PREVIEW_QUALITY_POPUP_ANSWERED",FILE_PREVIEW_QUALITY_POPUP_DISMISSED:"FILE_PREVIEW_QUALITY_POPUP_DISMISSED",FILE_PREVIEW_FILE_DOWNLOADED:"FILE_PREVIEW_FILE_DOWNLOADED",FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED:"FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED",FILE_PREVIEW_SHOW_CONTENTS_FAILED:"FILE_PREVIEW_SHOW_CONTENTS_FAILED",FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED:"FILE_PREVIEW_SHOW_CONTENTS_SUCCEEDED",FILE_PREVIEW_USER_ACTION:"FILE_PREVIEW_USER_ACTION",FILE_PREVIEW_VIDEO_STALLED:"FILE_PREVIEW_VIDEO_STALLED"},t.PathContext={BROWSE:"BROWSE",SHARED_LINK_FILE:"SHARED_LINK_FILE",SHARED_LINK_FOLDER:"SHARED_LINK_FOLDER",SHARED_LINK_COLLECTION:"SHARED_LINK_COLLECTION",VERSION_HISTORY:"VERSION_HISTORY"},t.CannedTestFilenames={EXCEL_HTML:"test-workbook.html"};(function(e){e[e.TITLE_BAR=0]="TITLE_BAR",e[e.PREVIEW_CONTENT=1]="PREVIEW_CONTENT",e[e.SIDEBAR=2]="SIDEBAR"})(t.FileViewerPane||(t.FileViewerPane={})),t.UserActionNames={SHARE:"share",DOWNLOAD:"download",SAVE_TO_DROPBOX:"save_to_dropbox",SAVE_TO_DROPBOX_PERSONAL:"save_to_dropbox_personal",SAVE_TO_DROPBOX_WORK:"save_to_dropbox_work",OPEN_IN_OFFICE_ONLINE:"open_in_office_online",OPEN_IN_UNITY:"open_in_unity",OPEN_IN_UNITY_FOLDER:"open_in_unity_folder",REMOVE_LINK:"remove_link",VIEW_REVISIONS:"view_revisions",CLICK_DROPBOX_LOGO:"click_dropbox_logo",CLICK_CUSTOM_LOGO:"click_custom_logo",TOGGLE_COMMENTS_ON:"toggle_comments_on",TOGGLE_COMMENTS_OFF:"toggle_comments_off",SIGN_IN:"sign_in",CLICK_NOTIFICATIONS:"click_notifications",CLICK_ACCOUNT_MENU:"click_account_menu",TOGGLE_FULLSCREEN_ON:"toggle_fullscreen_on",TOGGLE_FULLSCREEN_OFF:"toggle_fullscreen_off",PRINT:"print",INLINE_SEARCH:"inline_search",FLIP_NEXT:"flip_next",FLIP_PREV:"flip_prev",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out"},t.UserActionContextNames={TITLE_BAR_MAIN:"title_bar_main",TITLE_BAR_SPLIT_BUTTON:"title_bar_open_split_button",TITLE_BAR_MORE:"title_bar_more",PREVIEW_CONTENT_MAIN:"preview_content_main",PREVIEW_CONTENT_SPLIT_BUTTON:"preview_content_open_split_button",TOOLBAR:"toolbar",VIDEO_PLAYER:"video_player",LIGHTBOX_FRAME:"lightbox_frame",LIGHTBOX_TOOLBAR:"lightbox_toolbar",LIGHTBOX_CLOSE_BUTTON:"lightbox_close_button",SIDEBAR:"sidebar",KEYBOARD:"keyboard",BROWSER:"browser",UNKNOWN:"unknown"};(function(e){e[e.MAIN=0]="MAIN",e[e.SPLIT=1]="SPLIT"})(t.SplitButtonActionLocation||(t.SplitButtonActionLocation={}));t.SizeClassFilenameLengthMap=(o={},o[n.SizeClass.Small]=12,o[n.SizeClass.Medium]=25,o[n.SizeClass.Large]=35,o),t.ResponsiveClassName="responsive-enabled";var o}),define("modules/clean/react/file_viewer/controller",["require","exports","tslib","external/react","external/react-dom","modules/clean/activity/constants","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_viewer","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","modules/constants/file_viewer","modules/constants/python","modules/core/browser","modules/core/dom"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m){"use strict";function f(e,t,r,l,u){if(!y()){T=l;var p=E(u),d={disableFlipping:!!p.disableFlipping,sharedLinkInfos:p.sharedLinkInfos,shareTokens:p.shareTokens,sharePermissions:p.sharePermissions};a.setup(e,t,r,d),s.start(),m.scroll_lock_document();var h=document.getElementById(T);C=i.render(o.createElement(c.FileViewer,n.__assign({},p)),h)}}function v(e){y()&&a.updateFiles(e)}function g(){if(y()){var e=document.getElementById(T);i.unmountComponentAtNode(e),a.cleanup(),m.scroll_unlock_document(),C=null}}function y(){return null!=C}function E(e){var t=n.__assign({},e);if(t.canClose=!0,t.activityContext=S(t.fileViewTarget),null==t.initialPreviewSourceContext&&(t.initialPreviewSourceContext=b()),null==t.initialPreviewSourceAction&&(t.initialPreviewSourceAction=w()),d.RESPONSIVE_FILE_VIEWER_ENABLED){var o=_.is_supported_mobile_browser();t.isMobileUserAgent=o,o&&(t.hideComments=!0)}var i=t.onCloseViewer;return t.onCloseViewer=function(){return g(),"function"==typeof i?i():void 0},t}function S(e){return e===h.FileViewTargetType.SHARED_LINK?r.ActivityContext.SHARED_LINK_VIEW:e===h.FileViewTargetType.SHARED_CONTENT_LINK?r.ActivityContext.SHARED_CONTENT_LINK_VIEW:r.ActivityContext.BROWSE_FILE_VIEWER}function b(){var e=u.determinePathContext();return e===l.PathContext.SHARED_LINK_COLLECTION?p.PreviewSourceContext.SHARED_LINK_COLLECTION:e===l.PathContext.VERSION_HISTORY?p.PreviewSourceContext.VERSION_HISTORY:p.PreviewSourceContext.BROWSE}function w(){var e=u.determinePathContext();return[l.PathContext.SHARED_LINK_FILE,l.PathContext.SHARED_LINK_FOLDER].includes(e)?p.PreviewSourceAction.VISIT:p.PreviewSourceAction.CLICK}Object.defineProperty(t,"__esModule",{value:!0});var C=null,T="";t.open=f,t.updateFiles=v,t.close=g,t.isShown=y}),define("modules/clean/react/file_viewer/empty_seen_state_facepile",["require","exports","tslib","external/classnames","external/react","modules/clean/react/pass/constants"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.facepileClassName=function(){return o((e={},e[r.FACEPILE_CLASSNAME]=!0,e[r.PRESENCE_RECEIVED_CLASSNAME]=this.props.hasPresence,e));var e},t.prototype.render=function(){return i.createElement("div",{className:this.facepileClassName()})},t})(i.Component);s.displayName="EmptySeenStateFacepile",s.defaultProps={hasPresence:!1},t.EmptySeenStateFacepile=s}),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","external/react","modules/clean/react/css","modules/constants/payments","modules/core/i18n","modules/clean/react_format"],function(e,t,n,o,i,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=r.OUT_OF_SPACE_URL+"?oqa=oq_fp";return o.createElement("div",{className:"fileviewer-upsell-banner"},a.reactFormat(s._("Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"),{a:o.createElement("a",{href:e})}))},t})(o.Component);t.ExpFileViewerUpsellBannerV2=i(l,["/static/css/exp_file_preview_upsell-vfl39Fjiu.css"])}),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","external/react","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/size_class/constants","modules/clean/react/file_viewer/utils","modules/clean/react/gutter_attributions/controller","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_error","modules/clean/react/previews/archive/preview_archive","modules/clean/react/previews/audio/preview_audio","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image_with_annotations","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/preview_video","modules/clean/react/previews/preview_pdf","modules/clean/react/previews/preview_pdf_ssr","modules/core/i18n","modules/core/browser","modules/core/exception","modules/constants/file_viewer"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b,w,C,T,A,I,P){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var R=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={fallbackToPdfJs:!1,hasError:!1},t.windowCloseHandler=function(){t.logPreviewSessionEnded(h.PreviewSessionEndReasons.BEFORE_UNLOAD)},t.startLogger=function(){t.frameMessenger=new _.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",t.onFrameMessage,["pagerendered"]),t.frameMessenger.startListening()},t.stopLogger=function(){t.frameMessenger.stopListening()},t.onFrameMessage=function(e){switch(e.action){case"pagerendered":r.logPageRendered(t.props.file,e.parameters)}},t.logView=function(e){if(void 0===e&&(e=!1),null!==t.props.file.ns_id){t.viewAttempts++;var n=!1;t.props.sharePermissions&&t.props.sharePermissions.canDownloadRoles&&(n=0===t.props.sharePermissions.canDownloadRoles.length),p.determinePathContext()!==a.PathContext.SHARED_LINK_COLLECTION&&r.logView(t.props.file,t.props.user,t.props.fileViewTarget,t.props.fileViewOrigin,t.props.fileViewAction,t.props.sharedLinkUrl,t.viewAttempts,e,n)}},t.logPreviewSessionEnded=function(e){void 0===e&&(e=h.PreviewSessionEndReasons.UNKNOWN);var n={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:h.getSessionEndReasonLoggingKey(e)};t.state.filePreviewSession.recordEvent(a.EventTypes.FILE_PREVIEW_SESSION_ENDED,n)},t.onContextMenu=function(e){e.preventDefault()},t.triggerError=function(e){t.setState({hasError:!0,errorType:e})},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){p.areFilesEqual(e.file,this.props.file)||(this.setState({hasError:!1,errorType:void 0}),this.viewAttempts=0,this.logPreviewSessionEnded(h.PreviewSessionEndReasons.NEW_FILE),this.startNewFilePreviewSession(e))},t.prototype.componentWillMount=function(){this.startNewFilePreviewSession(this.props)},t.prototype.componentDidMount=function(){this.startLogger(),this.viewAttempts=0,this.logView(this.state.hasError),window.addEventListener("beforeunload",this.windowCloseHandler),p.cleanupPrerenderPreview()},t.prototype.componentDidUpdate=function(e,t){e.file===this.props.file&&t.hasError===this.state.hasError||this.logView(this.state.hasError)},t.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(h.PreviewSessionEndReasons.UNMOUNT),this.stopLogger(),this.teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this.windowCloseHandler)},t.prototype.setUpFilePreviewLogger=function(e){this.teardownFilePreviewLogger(),this.filePreviewTimelineLogger=new i.FilePreviewTimelineLogger(e.id),this.filePreviewTimelineLogger.listenTo(l.filePreviewEventEmitter),this.filePreviewUserActionLogger=new i.FilePreviewUserActionLogger,this.filePreviewUserActionLogger.listenTo(l.filePreviewEventEmitter)},t.prototype.startNewFilePreviewSession=function(e){var t=e.file,n=e.sourceContext,o=e.sourceAction,i=new c.FilePreviewSession({fileViewerSession:c.FileViewerSession.currentSession,file:t,isMounted:!this.props.sharedLinkUrl,sourceContext:n,sourceAction:o});c.FilePreviewSession.currentSession=i,this.setState({filePreviewSession:i}),this.setUpFilePreviewLogger(i),null!==t.ns_id&&i.recordEvent(a.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED)},t.prototype.teardownFilePreviewLogger=function(){null!=this.filePreviewTimelineLogger&&this.filePreviewTimelineLogger.unlistenTo(l.filePreviewEventEmitter),this.filePreviewUserActionLogger&&this.filePreviewUserActionLogger.unlistenTo(l.filePreviewEventEmitter)},t.prototype.renderImagePreview=function(){var e,t=this,i=this.props.file,r=s.get_extension(i),a=i.preview_url||i.thumbnail_url_tmpl;if(null==a)return this.renderUnsupportedErrorPreview();if(this.props.sharePermissions&&this.props.sharePermissions.canViewContextMenuRoles&&0===this.props.sharePermissions.canViewContextMenuRoles.length&&(e=this.onContextMenu),this.props.isFullscreen)return o.createElement(E.PreviewImageZoom,{thumbnailUrlTmpl:a,fileExtension:r,isFlippable:!0,filePreviewSession:this.state.filePreviewSession,onContextMenu:e,fileName:s.get_filename(this.props.file)});var l={"preview-url":a,"file-extension":s.get_extension(i),isFullscreen:this.props.isFullscreen,supportsAnnotations:this.props.shouldDisplayAnnotationsToolbar,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:function(){return t.triggerError(h.ErrorTypes.LOAD_ERROR)},onNext:this.props.onNext,filePreviewSession:this.state.filePreviewSession,onContextMenu:e,commentsActionCreators:this.props.commentsActionCreators,nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:s.get_filename(this.props.file),sizeClass:this.props.sizeClass};return o.createElement(y.PreviewImageWithAnnotations,n.__assign({},l))},t.prototype.renderVideoPreview=function(){var e=this.props.file;return o.createElement(b.PreviewVideo,{previewUrl:e.video_transcode_url,thumbnailUrlTmpl:e.thumbnail_url_tmpl,videoMetadataUrl:e.video_metadata_url,videoContainer:e.video_container,isFullscreen:this.props.isFullscreen,shouldDisplayAnnotationsToolbar:this.props.shouldDisplayAnnotationsToolbar,shouldFocusOnReady:this.props.shouldFocusOnReady,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,filePreviewSession:this.state.filePreviewSession,onError:this.triggerError})},t.prototype.renderLinkfilePreview=function(){var e=this.props.file;return o.createElement(S.PreviewLinkfile,{filename:s.get_filename(e),data:e.linkfile_data,source:e.linkfile_data.authenticated?"browse":"sharedlink",filePreviewSession:this.state.filePreviewSession})},t.prototype.renderPDFPreview=function(){var e,t=this,n=this.props.file;if((P.IS_PDFSSR_ENABLED||this.props.sizeClass===u.SizeClass.Small&&A.is_supported_mobile_browser())&&!this.state.fallbackToPdfJs){e=function(){t.state.filePreviewSession&&(t.state.filePreviewSession.didFallbackToPdfjs=!0),t.setState({fallbackToPdfJs:!0})};var i=o.createElement(C.PreviewPdfSSR,{commentsActionCreators:this.props.commentsActionCreators,fileExtension:s.get_extension(n),fileHref:n.href,filePreviewSession:this.state.filePreviewSession,imageUrl:n.preview_ssr_image_url_tmpl,isFullscreen:this.props.isFullscreen,isSharedLink:null!=this.props.sharedLinkUrl,onCloseViewer:this.props.onCloseViewer,onError:e,previewThumbnailUrl:n.preview_thumbnail_url,previewType:n.preview_type,src:n.direct_blockserver_link,sharePermissions:this.props.sharePermissions,sizeClass:this.props.sizeClass,textUrl:n.preview_ssr_text_url_tmpl});return P.PREVIEW_ATTRIBUTIONS_ENABLED&&(i=o.createElement(d.GutterAttributionsController,{file:this.props.file,viewingUser:this.props.user},i)),i}var r=s.get_extension(n);return o.createElement(w.PreviewPDF,{commentsActionCreators:this.props.commentsActionCreators,fileExtension:r,fileHref:n.href,filePreviewSession:this.state.filePreviewSession,fqPath:p.isBrowseFile(n)?n.fq_path:void 0,isFullscreen:this.props.isFullscreen,isSharedLink:null!=this.props.sharedLinkUrl,onCloseViewer:this.props.onCloseViewer,onError:this.triggerError,previewType:n.preview_type,previewUrl:n.preview_url,src:n.direct_blockserver_link,thumbnailUrl:n.preview_thumbnail_url,userId:null!=this.props.user?this.props.user.id:void 0,sharePermissions:this.props.sharePermissions,sizeClass:this.props.sizeClass})},t.prototype.renderHTMLPreview=function(){var e=this.props.file,t=s.get_extension(e),n=e.direct_blockserver_link;if("excel"===e.preview_type&&n){var i=s.normalize_extension(t);n=s.get_progressive_url(i,n).toString()}else n=e.htmlified_link||n;if(!n)return this.renderUnsupportedErrorPreview();var r=s.usesFrameMessenger(e.preview_type);return o.createElement(g.PreviewHTML,{src:n,filename:s.get_filename(this.props.file),previewType:e.preview_type,isFullscreen:this.props.isFullscreen,onError:this.triggerError,fileExtension:t,usesFrameMessenger:r,sharePermissions:this.props.sharePermissions,filePreviewSession:this.state.filePreviewSession,commentsActionCreators:this.props.commentsActionCreators,sizeClass:this.props.sizeClass})},t.prototype.renderAudioPreview=function(){return o.createElement(v.PreviewAudio,{bytes:this.props.file.bytes,filePreviewSession:this.state.filePreviewSession,onError:this.triggerError,src:this.props.file.direct_blockserver_link})},t.prototype.renderArchivePreview=function(){return o.createElement(f.PreviewArchive,{file:this.props.file,filePreviewSession:this.state.filePreviewSession,onError:this.triggerError,navigationEnabled:P.DOCPREVIEW_ARCHIVE_NAVIGATION_ENABLED,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermissions})},t.prototype.renderCloudContentPreview=function(){return this.props.file.preview_url?(A.replace_location(this.props.file.preview_url),null):this.renderUnsupportedErrorPreview()},t.prototype.renderUnsupportedErrorPreview=function(){return this.renderErrorPreview(h.ErrorTypes.SUPPORT_ERROR)},t.prototype.getErrorMessage=function(e,t){if(t&&"sketch"===s.get_extension(t)&&e===h.ErrorTypes.LOAD_ERROR)return T._("This file can’t be previewed. Previews are                 only available for files created in Sketch v43 and up.")},t.prototype.renderErrorPreview=function(e,t){var n=this.getErrorMessage(e,t),i=this.props.shouldDisplayAnnotationsToolbar&&p.FlippableHelpers.isFlippableFile(this.props.file);return o.createElement(m.PreviewError,{file:this.props.file,maxFilenameEmLength:this.props.maxFilenameEmLength,filePreviewSession:this.state.filePreviewSession,errorType:e,user:this.props.user,areActionablesEnabled:this.props.areActionablesEnabled,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,shouldDisplayAnnotationsToolbar:i,index:this.props.index,isMobileUserAgent:this.props.isMobileUserAgent,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,message:n})},t.prototype.choosePreview=function(){if(null===this.props.file.ns_id)return this.renderErrorPreview(h.ErrorTypes.PENDING_UPLOAD_ERROR);if(this.props.file.is_dir)return this.renderErrorPreview(h.ErrorTypes.EXTENSION_ERROR);if(s.isEmptyFile(this.props.file)&&"cloud_content"!==this.props.file.preview_type)return this.renderErrorPreview(h.ErrorTypes.EMPTY_FILE_ERROR);if(!s.extensionSupported(this.props.file))return this.renderErrorPreview(h.ErrorTypes.EXTENSION_ERROR);if(!s.filesizeSupported(this.props.file))return this.renderErrorPreview(h.ErrorTypes.FILE_SIZE_ERROR);var e=s.get_extension(this.props.file);switch(this.props.file.preview_type){case"photo":return this.renderImagePreview();case"video":return this.renderVideoPreview();case"linkfile":return this.renderLinkfilePreview();case"adobecs":if(this.props.isMobileUserAgent)return this.renderImagePreview();case"doc":return"indd"===e?this.renderErrorPreview(h.ErrorTypes.EXTENSION_ERROR):this.renderPDFPreview();case"excel":return s.use_excel2_for_extension(e)?this.renderPDFPreview():this.renderHTMLPreview();case"html":case"text":return this.renderHTMLPreview();case"audio":return this.renderAudioPreview();case"archive":return this.renderArchivePreview();case"cloud_content":return this.renderCloudContentPreview();default:I.assert(!1,"Preview type "+this.props.file.preview_type+" in VALID_PREVIEW_TYPES but not implemented")}return null},t.prototype.render=function(){return this.state.hasError?this.renderErrorPreview(this.state.errorType,this.props.file):this.choosePreview()},t})(o.Component);R.defaultProps={user:null,isFullscreen:!1,sharePermissions:null,areActionablesEnabled:!0},t.FilePreview=R}),define("modules/clean/react/file_viewer/file_preview_event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filePreviewEventEmitter=new n}),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","external/keymaster","external/react","external/react-dom","external/underscore","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/analytics","modules/clean/comments/action_creators","modules/clean/comments/demo_action_creators","modules/clean/file_activity/clients/file_activity_data_source","modules/clean/history","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/css","modules/clean/react/file_comments/logger","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/store","modules/clean/react/file_viewer/title_bar","modules/clean/react/file_viewer/utils","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/image_helpers","modules/clean/react/previews/quality_popup/preview_quality_popup","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/constants/file_activity_stream","modules/constants/python","modules/core/dom","modules/core/uri","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b,w,C,T,A,I,P,R,O,N,L,M,k,F,x,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var U="",B="",H=(function(t){function m(){var o=null!==t&&t.apply(this,arguments)||this;return o._isMounted=!1,o.state=n.__assign({
fileSidebarLoaded:e.defined("modules/clean/react/file_sidebar/file_sidebar"),previewSourceContext:o.props.initialPreviewSourceContext,previewSourceAction:o.props.initialPreviewSourceAction},o.getStateFromStore()),o.onUpdateFromStore=function(){o.setState(o.getStateFromStore())},o.flipNext=function(){g.flipNext()},o.flipPrevious=function(){g.flipPrevious()},o}return n.__extends(m,t),m.prototype.componentWillMount=function(){var t=this;this.setUpLogging(),this.props.hidePageChrome||(L.IS_ON?e(["modules/clean/react/file_sidebar/file_sidebar","modules/clean/react/file_sidebar/store/instance","modules/clean/react/file_sidebar/store/app/actions"],function(e,n,o){e.FileSidebar;n.store.dispatch(o.setState({hideComments:t.props.hideComments,hidePageChrome:t.props.hidePageChrome,isCommentsDemo:t.props.isCommentsDemo})),t._isMounted&&t.setState({fileSidebarLoaded:!0})}):this.state.fileSidebarLoaded||e(["modules/clean/react/file_sidebar/file_sidebar"],function(){t._isMounted&&t.setState({fileSidebarLoaded:!0})})),this.props.isCommentsDemo?f.set_disabled(!0):p.initInstance()},m.prototype.componentDidMount=function(){this._isMounted=!0,null!=this.props.onComponentDidMount&&this.props.onComponentDidMount(),this.flipNext=s.throttle(this.flipNext,100),this.flipPrevious=s.throttle(this.flipPrevious,100),this.removeStoreListener=w.FileViewerStore.instance.addListener(this.onUpdateFromStore),this.setupPreviewUrl(this.state.currentFile),this.setupKeymaster(),this.preloadImages(this.state.files,this.state.currentIndex),this.setDocumentTitle(_.get_filename(this.state.currentFile),!0),k.scroll_lock_document(),this.focusInViewer(),h.start()},m.prototype.componentWillUpdate=function(e,t){var n=t.currentFile;n!==this.state.currentFile&&(this.updatePreviewUrl(n),this.setDocumentTitle(_.get_filename(n)),this.preloadImages(t.files,t.currentIndex)),o.setScope("fileviewer")},m.prototype.componentWillUnmount=function(){this.removeStoreListener(),this.teardownPreviewUrl(),this.cleanupKeymaster(),this.unsetDocumentTitle(),k.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),this._isMounted=!1},m.prototype.shouldSuppressPassInfo=function(){return this.props.isCommentsDemo||null==this.state.currentFile.ns_id},m.prototype.getStateFromStore=function(){var e={currentIndex:w.FileViewerStore.instance.getCurrentIndex(),currentFile:w.FileViewerStore.instance.getCurrentFile(),files:w.FileViewerStore.instance.getFiles(),isFullscreen:w.FileViewerStore.instance.getIsFullscreen(),sharedLinkInfo:w.FileViewerStore.instance.getSharedLinkInfo(),sharePermissions:w.FileViewerStore.instance.getSharePermissions(),shareToken:w.FileViewerStore.instance.getShareToken(),showOverQuotaUpsell:w.FileViewerStore.instance.shouldShowOQUpsell(),showPreviewQualityPopup:w.FileViewerStore.instance.shouldShowPreviewQualityPopup(),showViewInAppBanner:w.FileViewerStore.instance.shouldShowOpenInAppBanner(),user:w.FileViewerStore.instance.getUser()};return this.state&&!T.areFilesEqual(this.state.currentFile,e.currentFile)&&(e.previewSourceContext=I.PreviewSourceContext.FILE_VIEWER,e.previewSourceAction=I.PreviewSourceAction.CLICK),e},m.prototype.setUpLogging=function(){if(b.FileViewerSession.currentSession=new b.FileViewerSession,this.props.fileViewTarget===M.FileViewTargetType.SHARED_CONTENT_LINK){var e=O.start_time(),t=(new Date).getTime();this.state.user&&l.ShareTibEventLogger.log(this.state.user.id,"PREVIEW_RENDER","PREVIEW_PAGE",{timing:t-e,containing_ns_id:this.state.currentFile.ns_id,sjid:this.state.currentFile.sjid})}},m.prototype.setupPreviewUrl=function(e){this.props.skipOuterRouting||this.setPreviewUrl(e)},m.prototype.updatePreviewUrl=function(e){this.setPreviewUrl(e,!1)},m.prototype.teardownPreviewUrl=function(){this.props.skipOuterRouting||this.unsetPreviewUrl()},m.prototype.setPreviewUrl=function(e,t){if(void 0===t&&(t=!0),!this.props.disableRouting){var n=_.get_filename(e),o=F.parse(d.get_url()),i=F.encode_parts(o.getPath()),r=o.removeQuery("select").updateQuery({preview:n}).getQuery();t?d.push_state(i,r,{immediatelyRestoreState:!1}):d.replace_state(i,r)}},m.prototype.unsetPreviewUrl=function(){if(!this.props.disableRouting){var e=F.parse(d.get_url()),t=F.encode_parts(e.getPath()),n=e.removeQuery("select").removeQuery("preview").getQuery();d.push_state(t,n,{immediatelyRestoreState:!1})}},m.prototype.focusInViewer=function(){if(!this.props.shouldFocusCommentInput){var e=r.findDOMNode(this).querySelector(".button-primary");if(e)e.focus();else{var t=k.getTabbableElementsIn(".react-file-viewer");t.length&&t[0].focus()}}},m.prototype.setupKeymaster=function(){var e=this;T.FlippableHelpers.isFlippableFile(this.state.currentFile)&&(o("left","fileviewer",function(){e.flipPrevious(),g.logUserAction(y.UserActionNames.FLIP_PREV,y.UserActionContextNames.KEYBOARD)}),o("right","fileviewer",function(){e.flipNext(),g.logUserAction(y.UserActionNames.FLIP_NEXT,y.UserActionContextNames.KEYBOARD)})),o("esc","fileviewer",function(t){k.focus_in_input()||k.is_input(t.target)||document.querySelector(".annotation-bubble")||null!=e.props.onCloseViewer&&e.props.onCloseViewer()}),U=o.getScope(),o.setScope("fileviewer")},m.prototype.cleanupKeymaster=function(){o.clearScope("fileviewer"),o.setScope(U)},m.prototype.preloadImages=function(e,t){if(0!==e.length){var n=[];[0,1,2,3,4,5,6,-1,-2].forEach(function(o){var i=(t+o+e.length)%e.length;n.indexOf(i)===-1&&n.push(i)}),n.forEach(function(t){if(e.length>t&&"photo"===e[t].preview_type){var n=e[t],o=n.preview_url||n.thumbnail_url_tmpl;o&&P.preloadImage(o).then(function(e){var n=b.FileViewerSession.currentSession;null==n||t in n.imagesFetched||(n.imagesFetched[t]=e)})}})}},m.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),this.props.isCommentsDemo||(t&&(B=document.title),document.title=e)},m.prototype.unsetDocumentTitle=function(){this.props.isCommentsDemo||""!==B&&(document.title=B)},m.prototype.getCommentsActionCreators=function(){return this.props.isCommentsDemo?u:c},m.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===x.SizeClass.Small)&&(!this.props.hidePageChrome||this.props.isCommentsDemo)},m.prototype.renderFlippableControls=function(){if(T.FlippableHelpers.isFlippableFile(this.state.currentFile)&&!this.state.isFullscreen&&!this.isImagePreviewAnnotationEnabled())return i.createElement(S.FlippableControls,{index:""+(this.state.currentIndex+1),numFlippableFiles:this.state.files.length,onNext:this.flipNext,onPrevious:this.flipPrevious})},m.prototype.renderFilePreview=function(){return i.createElement("div",{className:"react-file-viewer__preview react-file-preview"},i.createElement("div",{className:"flex-preview-container"},this.renderPreviewQualityPopup(),this.state.showViewInAppBanner&&this.props.isMobileUserAgent&&!this.props.hidePageChrome?i.createElement(A.OpenInAppBanner,{urls:this.state.currentFile.open_in_app_data,onClose:g.hideOpenInAppBanner}):null,i.createElement(E.FilePreview,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.state.currentFile.ns_id,commentsActionCreators:this.getCommentsActionCreators(),count:this.state.files.length,file:this.state.currentFile,fileViewAction:this.props.fileViewAction,fileViewTarget:this.props.fileViewTarget,fileViewOrigin:this.props.fileViewOrigin,index:this.state.currentIndex,isFullscreen:this.state.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,maxFilenameEmLength:y.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,onNext:this.flipNext,onPrevious:this.flipPrevious,sharedLinkInfo:this.state.sharedLinkInfo,sharePermissions:this.state.sharePermissions,shareToken:this.state.shareToken,shouldFocusOnReady:!this.props.hidePageChrome,sourceAction:this.state.previewSourceAction,sourceContext:this.state.previewSourceContext,sharedLinkUrl:null!=this.state.sharedLinkInfo?this.state.sharedLinkInfo.url:void 0,shouldDisplayAnnotationsToolbar:this.isImagePreviewAnnotationEnabled(),sizeClass:this.props.sizeClass,user:this.state.user}),this.renderFlippableControls()))},m.prototype.renderSidebar=function(){if(this.state.fileSidebarLoaded&&this.props.sizeClass===x.SizeClass.Large){var t=e("modules/clean/react/file_sidebar/file_sidebar").FileSidebar;return i.createElement(t,{activityContext:this.props.activityContext,currentFile:this.state.currentFile,headerComponent:this.props.sidebarHeaderComponent,hideComments:this.props.hideComments,hidePageChrome:this.props.hidePageChrome,isCommentsDemo:this.props.isCommentsDemo,sharedLinkInfo:this.state.sharedLinkInfo,shouldInitiallyFocusInput:this.props.shouldFocusCommentInput,user:this.state.user})}return null},m.prototype.renderTitleBar=function(){return i.createElement("div",{className:"react-file-viewer__title-bar"},i.createElement(C.TitleBar,{canClose:this.props.canClose,canRestoreRevision:this.props.canRestoreRevision,commentsActionCreators:this.getCommentsActionCreators(),file:this.state.currentFile,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,isDemoMode:this.props.isCommentsDemo,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isVersionHistoryMode:this.props.isVersionHistoryMode,maxFilenameEmLength:y.SizeClassFilenameLengthMap[this.props.sizeClass],onCloseViewer:this.props.onCloseViewer,onRestoreRevision:this.props.onRestoreRevision,sharedLinkInfo:this.state.sharedLinkInfo,sharePermissions:this.state.sharePermissions,shareToken:this.state.shareToken,sizeClass:this.props.sizeClass,user:this.state.user||null}),this.renderUpsellBanner())},m.prototype.shouldAllowFileDonation=function(){return null==this.state.sharedLinkInfo&&(null==this.state.user||this.state.user.home_ns_id===this.state.currentFile.ns_id)},m.prototype.renderPreviewQualityPopup=function(){var e=this.props.sizeClass===x.SizeClass.Small;return this.props.hidePageChrome||!this.state.showPreviewQualityPopup||e?null:i.createElement(R.PreviewQualityPopup,{file:this.state.currentFile,showProbability:N.PREVIEW_QUALITY_POPUP_PROBABILITY,allowFileDonation:this.shouldAllowFileDonation()})},m.prototype.renderViewer=function(){var e=_.get_filename(this.state.currentFile);return this.state.isFullscreen||this.props.hidePageChrome?i.createElement("div",{className:"react-file-viewer",role:"dialog","aria-label":e},this.renderFilePreview()):i.createElement("div",{className:"react-file-viewer",role:"dialog","aria-label":e},this.renderTitleBar(),i.createElement("div",{className:"react-file-viewer__content"},this.renderFilePreview(),this.renderSidebar()))},m.prototype.renderUpsellBanner=function(){return this.state.showOverQuotaUpsell?i.createElement(a.ExpFileViewerUpsellBannerV2,null):null},m.prototype.render=function(){var e=this.renderViewer();return L.IS_ON?i.createElement(v.FileSidebarProvider,null,e):e},m})(i.Component);H.defaultProps={canClose:!1,canRestoreRevision:!1,disableRouting:!1,hideComments:!1,hidePageChrome:!1,isCommentsDemo:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:M.OREF_CONSTANTS.BROWSE_UNKNOWN,shouldFocusCommentInput:!1,sizeClass:x.SizeClass.Large,skipOuterRouting:!1},t.FileViewerWithoutCss=H;var V=D.withSizeClass(H,{isResponsiveEnabled:T.isResponsiveEnabled,responsiveClassName:y.ResponsiveClassName}),W=["/static/css/preview_archive-vflUMeaLl.css","/static/css/preview_image_with_annotations-vflex8M7t.css","/static/css/preview_pdf-vflJ1ngVU.css","/static/css/preview_flexbox_layout-vflHOeSGP.css","/static/css/preview_linkfile-vflLAlKbW.css","/static/css/preview_quality_popup-vflyrlOUZ.css","/static/css/preview_toolbar-vflyy2h8i.css","/static/css/react_file_viewer-vflatRHPl.css","/static/css/react_title_bar-vflWWNnLp.css","/static/css/spectrum/index-vflsJ4Dxr.css"];t.FileViewer=m(V,W)}),define("modules/clean/react/file_viewer/file_viewer_interface_controller",["require","exports","external/eventemitter3","modules/clean/annotations/annotation_message_transformer","modules/clean/comments/models/preview_types","modules/clean/frame_messenger/frame_messenger_proxy","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/frame_messenger_host"],function(e,t,n,o,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=["annotation-hidden","annotation-placed","annotation-start-drag","annotation-end-drag","annotation-ui-enter","annotation-ui-over","annotation-ui-leave","annotation-ui-click","annotation-enter","annotation-leave","page-rendered","scroll","scale-change","on-keydown","mouse-up"],u=["file-preview-scroll-to-annotation","file-preview-update-annotation-creation","file-preview-update-annotation-region-creation","file-preview-remove-annotation","file-preview-reload-annotations","file-preview-unload-annotations","file-preview-load-annotations","file-preview-remove-annotation-draft","file-preview-finalize-annotation-draft","file-preview-change-file"],p=(function(){function e(e,t,r){var l=this;switch(this.setupFilePreviewEventListeners=function(e){var t=l.buildPreviewEventHandler(e,"file-preview-render-succeeded"),n=l.buildPreviewEventHandler(e,"file-preview-render-failed"),o=l.buildPreviewEventHandler(e,"file-preview-download-failed"),i=l.buildPreviewEventHandler(e,"file-preview-support-denied");l.filePreviewEventHandlers[s.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED]=t,l.filePreviewEventHandlers[s.EventTypes.FILE_PREVIEW_RENDER_FAILED]=n,l.filePreviewEventHandlers[s.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED]=o,l.filePreviewEventHandlers[s.EventTypes.FILE_PREVIEW_SUPPORT_DENIED]=i;for(var r in l.filePreviewEventHandlers)if(l.filePreviewEventHandlers.hasOwnProperty(r)){var c=l.filePreviewEventHandlers[r];a.filePreviewEventEmitter.addListener(r,c)}},this.buildPreviewEventHandler=function(e,t){return function(){e.postMessageToParent(t)}},this.handleMessageFromParent=function(e){l.proxyMessageFromParent(e)},this.prepareImageInterface=function(){window.addEventListener("message",l.handleMessageFromWindow)},this.handleMessageFromChild=function(e){l.eventEmitter.emit(e.action,e.parameters),l.frameMessengerProxy&&l.proxyMessageFromChild(e)},this.proxyMessageFromChild=function(e){var t=o.transformLegacyChildActions(e);l.frameMessengerProxy.postToParentMessenger(t)},this.proxyMessageFromParent=function(e){var t=o.transformParentActions(e);l.frameMessengerProxy.postToChildMessenger(t)},this.handleMessageFromWindow=function(e){var t;try{t=JSON.parse(e.data),l.eventEmitter.emit(t.action,t.parameters)}catch(e){}},this.eventEmitter=new n,this.previewType=e,this.previewSelector=t,this.parentFrameMessenger=r,this.filePreviewEventHandlers={},this.parentFrameMessenger&&(this.prepareParentMessenger(this.parentFrameMessenger),this.setupFilePreviewEventListeners(this.parentFrameMessenger)),this.previewType){case i.PDF:this.preparePdfInterface(this.parentFrameMessenger);break;case i.IMAGE:this.prepareImageInterface()}}return e.prototype.cleanupPreviewEventListeners=function(){for(var e in this.filePreviewEventHandlers)if(this.filePreviewEventHandlers.hasOwnProperty(e)){var t=this.filePreviewEventHandlers[e];a.filePreviewEventEmitter.removeListener(e,t)}this.filePreviewEventHandlers={}},e.prototype.addListener=function(e,t){this.eventEmitter.on(e,t)},e.prototype.removeListener=function(e,t){this.eventEmitter.off(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.dispatchEvent=function(e,t){switch(this.previewType){case i.PDF:this.frameMessenger.postMessageToChildren(e,t);break;case i.IMAGE:window.postMessage(JSON.stringify({action:e,parameters:t}),"*")}},e.prototype.destroy=function(){switch(this.eventEmitter.removeAllListeners(),this.parentFrameMessenger&&this.parentFrameMessenger.stopListening(),this.cleanupPreviewEventListeners(),this.previewType){case i.PDF:this.frameMessenger&&this.frameMessenger.stopListening();break;case i.IMAGE:window.removeEventListener("message",this.handleMessageFromWindow)}},e.prototype.preparePdfInterface=function(t){e.frameMessengerFactory?this.frameMessenger=e.frameMessengerFactory():this.frameMessenger=new l.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("#pdf-embed-iframe",this.handleMessageFromChild,c),this.frameMessenger.startListening(),t&&this.prepareMessageProxy(t,this.frameMessenger)},e.prototype.prepareParentMessenger=function(e){e.configureParentMessaging(this.handleMessageFromParent,u),e.startListening()},e.prototype.prepareMessageProxy=function(e,t){this.frameMessengerProxy=new r.FrameMessengerProxy(t,e)},e.setFrameMessengerFactory=function(t){e.frameMessengerFactory=t},e})();t.FileViewerInterfaceController=p}),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePreviousClick=function(){t.props.onPrevious&&t.props.onPrevious()},t.handleNextClick=function(){t.props.onNext&&t.props.onNext()},t}return n.__extends(t,e),t.prototype.getNavText=function(){return r._("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},t.prototype.render=function(){return this.props.numFlippableFiles<=1?null:o.createElement("div",{className:"react-file-viewer__controls"},o.createElement("button",{className:"nav-control",onClick:this.handlePreviousClick},o.createElement(i,{group:"web",name:"s_flip_left",alt:r._("Flip left",{comment:"Flip to the previous file in a series of files"})})),o.createElement("div",{className:"nav-text"},this.getNavText()),o.createElement("button",{className:"nav-control",onClick:this.handleNextClick},o.createElement(i,{group:"web",name:"s_flip_right",alt:r._("Flip right",{comment:"Flip to the next file in a series of files"})})))},t})(o.Component);t.FlippableControls=s}),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","jquery","modules/clean/react/file_viewer/actions"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullscreenHelpers={setupFullscreen:function(e){e&&(n(document).on("fullscreenchange.preview",this._setupExitFullscreenListeners),n(document).on("webkitfullscreenchange.preview",this._setupExitFullscreenListeners),n(document).on("msfullscreenchange.preview",this._setupExitFullscreenListeners),n(document).on("mozfullscreenchange.preview",this._setupExitFullscreenListeners)),this.setBrowserFullscreen(e)},_setupExitFullscreenListeners:function(){n(document).off("fullscreenchange.preview"),n(document).off("webkitfullscreenchange.preview"),n(document).off("msfullscreenchange.preview"),n(document).off("mozfullscreenchange.preview");var e=function(){return o.closeFullscreen()};n(document).on("fullscreenchange.preview",e),n(document).on("webkitfullscreenchange.preview",e),n(document).on("msfullscreenchange.preview",e),n(document).on("mozfullscreenchange.preview",e)},teardownExitFullscreenListeners:function(){n(document).off("fullscreenchange.preview"),n(document).off("webkitfullscreenchange.preview"),n(document).off("msfullscreenchange.preview"),n(document).off("mozfullscreenchange.preview")},setBrowserFullscreen:function(e){var t=n("body")[0];if(e)null!=t.requestFullscreen?t.requestFullscreen():null!=t.msRequestFullscreen?t.msRequestFullscreen():null!=t.mozRequestFullScreen?t.mozRequestFullScreen():null!=t.webkitRequestFullscreen&&t.webkitRequestFullscreen();else{var o=document;o.exitFullscreen?o.exitFullscreen():o.msExitFullscreen?o.msExitFullscreen():o.mozCancelFullScreen?o.mozCancelFullScreen():o.webkitExitFullscreen&&o.webkitExitFullscreen()}}}}),define("modules/clean/react/file_viewer/models",["require","exports","tslib","external/immutable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/constants","modules/clean/uuid","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/core/browser","modules/core/exception"],function(e,t,n,o,i,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d={};d[i.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED]=null,d[i.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED]=i.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,d[i.EventTypes.FILE_PREVIEW_SUPPORT_DENIED]=i.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED,d[i.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]=i.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,d[i.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]=i.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,d[i.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED]=i.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,d[i.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED]=i.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,d[i.EventTypes.FILE_PREVIEW_RENDER_FAILED]=i.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED;var h=o.Record({id:void 0,sourceContext:void 0,isSharedLink:!1}),_=(function(e){function t(t,n){var o=e.call(this,{id:t||a.v4({allowInsecure:!0})})||this;return o.imagesFetched=n||{},o.deviceType=o._deviceTypeString(),o}return n.__extends(t,e),t.prototype._deviceTypeString=function(){return u.is_supported_mobile_browser()?"mobile":u.is_tablet()?"tablet":"desktop"},t})(h);_.currentSession=null,t.FileViewerSession=_;var m=(function(){function e(e){var t=e.id,n=e.fileViewerSession,o=e.file,i=e.sourceContext,r=e.sourceAction,s=e.isMounted;this.ssrTiming={},this.ssrTimestamps={},p.assert(!!n,"FileViewerSession required"),p.assert(!!o,"File required"),this.id=t||a.v4({allowInsecure:!0}),this.fileViewerSession=n,this.file=o,this.sourceContext=i,this.sourceAction=r,this.previewTimeline={},this.lastEvent=null,this.pagesRendered={},this.zoomScales=[],this.passwordNeeded=!1,this.isMounted=s}return e.prototype.recordEvent=function(e,t){if(void 0===t&&(t={}),!(t instanceof Object))throw new Error("extra param of recordEvent should be an object.");if(i.EventTypes.hasOwnProperty(e)&&!this._isEventInTimeline(e)){if(d.hasOwnProperty(e)&&this.lastEvent!==d[e])return void(c.FILE_VIEWER_LOGGER_ERRORS&&p.reportStack("FilePreviewLogger event called out of order",{tags:["file_preview_logger_bad_event_order"],severity:p.SEVERITY.NONCRITICAL,exc_extra:{event:e,sourceContext:this.sourceContext,sourceAction:this.sourceAction,file:this.file}}));this._addToTimeline(e),r.filePreviewEventEmitter.emit(e,this,t),this.lastEvent=e}},e.prototype.markPrimaryEvent=function(){var e;e=window._timingData&&window._timingData.tti?window._timingData.tti.getTime():u.now(),this.primaryMarkTs||(this.primaryMarkTs=e)},e.prototype.markSecondaryEvent=function(){this.primaryMarkTs&&!this.secondaryMarkTs&&(this.secondaryMarkTs=u.now())},e.prototype.timeToPrimaryMark=function(){return this.timeToMark(this.primaryMarkTs)},e.prototype.timeToSecondaryMark=function(){return this.timeToMark(this.secondaryMarkTs)},e.prototype.logSSREvent=function(e){void 0===this.ssrTimestamps[e]&&(this.ssrTimestamps[e]=u.now())},e.prototype.timeToMark=function(e){if(void 0!==e)switch(this.sourceAction){case s.PreviewSourceAction.VISIT:var t=l.start_time();if(void 0!==t)return e-t;return;case s.PreviewSourceAction.CLICK:var n=this.previewTimeline[i.EventTypes.FILE_PREVIEW_ATTEMPT_STARTED];if(!n)return;var o=n.timestamp;if(void 0===o)return;return e-o}},e.prototype._isEventInTimeline=function(e){return e in this.previewTimeline},e.prototype._addToTimeline=function(e){this.previewTimeline[e]={timestamp:u.now()}},e})();m.currentSession=null,t.FilePreviewSession=m}),define("modules/clean/react/file_viewer/more_dropdown",["require","exports","tslib","external/react","external/spectrum/overflow_button","modules/clean/previews/util","external/spectrum/popover","modules/clean/react/file_action_button_type","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_viewer/more_dropdown/views","modules/clean/react/size_class/constants","modules/clean/react/title_bubble","modules/core/browser","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m){"use strict";function f(e,t){return e(t)}Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=t.getStateFromRegistry(),t.onRegistryUpdate=function(){t.setState(t.getStateFromRegistry())},t.handleDownloadClick=function(e){return e.preventDefault(),l.download(t.props.file),l.logUserAction(c.UserActionNames.DOWNLOAD,c.UserActionContextNames.TITLE_BAR_MORE)},t.handleRemoveLinkClick=function(e){e.preventDefault(),t.props.onRemoveShareLink&&(t.props.onRemoveShareLink(),l.logUserAction(c.UserActionNames.REMOVE_LINK,c.UserActionContextNames.TITLE_BAR_MORE))},t.handlePreviousVersionClick=function(e){if(e.preventDefault(),!t.props.user)throw new Error("User not specified");return r.redirectToVersionHistory(t.props.file,t.props.user),l.logUserAction(c.UserActionNames.VIEW_REVISIONS,c.UserActionContextNames.TITLE_BAR_MORE)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.removeRegistryListener=u.moreOptionRegistry.addListener(this.onRegistryUpdate)},t.prototype.componentWillUnmount=function(){this.removeRegistryListener()},t.prototype.getStateFromRegistry=function(){return{registeredItems:u.moreOptionRegistry.getOptionItems()}},t.prototype.getPopoverContent=function(){var e=this.props,t=e.allowRemoveLink,n=e.isPrivate,i=e.onRemoveShareLink,r=e.shareDownloadOptions,l=e.sizeClass,c=[],u=l===d.SizeClass.Small,h=l===d.SizeClass.Medium,_=l===d.SizeClass.Large;if(n&&h&&c.push(o.createElement(s.PopoverContentItem,{className:"more-button__share",key:"more-button__share",value:this.props.onClickShareLink},a.getFileActionButtonText(a.FileActionButtonType.SHARE))),null!=i&&t&&!u&&c.push(o.createElement(s.PopoverContentItem,{className:"more-button__remove",key:"more-button__remove",value:this.handleRemoveLinkClick},a.getFileActionButtonText(a.FileActionButtonType.REMOVE_LINK))),n&&c.push(o.createElement(s.PopoverContentItem,{className:"more-button__download",key:"more-button__download",value:this.handleDownloadClick},a.getFileActionButtonText(a.FileActionButtonType.DOWNLOAD))),r)for(var m=0,f=r;m<f.length;m++){var v=f[m];if(!v.isDisabled){var y="more-button-sl__"+v.userActionName;c.push(o.createElement(g,{handler:v.handler,key:y,text:v.text,userActionName:v.userActionName}))}}if(n&&!u&&c.push(o.createElement(s.PopoverContentItem,{className:"more-button__version-history",key:"more-button__version-history",value:this.handlePreviousVersionClick},a.getFileActionButtonText(a.FileActionButtonType.PREVIOUS_VERSIONS))),_&&c.length&&this.state.registeredItems.length&&c.push(o.createElement(s.PopoverContentSeparator,null)),_){var E=p.getPopoverItemsForMoreOptions(this.state.registeredItems);c=c.concat(E)}return c},t.prototype.render=function(){var e=this.getPopoverContent(),t=!e.length,r={"aria-label":"",className:"u-mar-left-xs more-button",disabled:t,tagName:"span",variant:"borderless"},a=_.is_mobile_or_tablet();return o.createElement(s.Popover,{onSelection:f},o.createElement(s.PopoverTrigger,{"aria-label":m._("More actions"),disabled:t},a?o.createElement(i.OverflowButton,n.__assign({},r)):o.createElement(h,{content:m._("More"),distanceFromTarget:10,isTargetPositionFixed:!0,position:h.POSITIONS.BOTTOM},o.createElement(i.OverflowButton,n.__assign({},r)))),o.createElement("div",{className:"react-file-viewer-dropdown"},o.createElement(s.PopoverContent,{attachment:"right"},e)))},t})(o.Component);t.MoreDropdown=v;var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){var e=t.props,n=e.handler,o=e.userActionName;l.logUserAction(o,c.UserActionContextNames.TITLE_BAR_MORE),n()},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.text;return o.createElement(s.PopoverContentItem,{value:this.handleClick},e)},t})(o.PureComponent)}),define("modules/clean/react/file_viewer/more_dropdown/models",["require","exports","tslib","external/underscore"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(){}return e.prototype.equals=function(e){return o.isEqual(this,e)},e})(),r=(function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return n.className=t.className||null,n.fileActionButtonType=t.fileActionButtonType||null,n.handler=t.handler||o.noop,n}return n.__extends(t,e),t})(i);t.MoreOption=r;var s=(function(e){function t(t){void 0===t&&(t={options:[]});var n=e.call(this)||this;return n.options=t.options,n}return n.__extends(t,e),t})(i);t.MoreOptionGroup=s}),define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["require","exports","tslib","modules/clean/react/file_viewer/more_dropdown/models"],function(e,t,n,o){"use strict";function i(e,t){return e.filter(function(e){return e!==t})}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){this.listeners=[]}return e.prototype.emitChange=function(){return this.listeners.forEach(function(e){return e()})},e.prototype.addListener=function(e){var t=this;return this.listeners.push(e),function(){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)}},e})(),s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.options=[],t}return n.__extends(t,e),t.prototype.isValidMoreOption=function(e){return null!=e.fileActionButtonType},t.prototype.isValidMoreOptionGroup=function(e){var t=this,n=e.options;return n.length&&n.every(function(e){return t.isValidMoreOption(e)})},t.prototype.isValidOption=function(e){return e instanceof o.MoreOption&&this.isValidMoreOption(e)||e instanceof o.MoreOptionGroup&&this.isValidMoreOptionGroup(e)},t.prototype.getOptionItems=function(){return this.options.slice(0)},t.prototype.addOption=function(e){if(!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");this.options=this.options.concat([e]),this.emitChange()},t.prototype.removeOption=function(e){if(null!=e&&!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");var t=this.options.length;this.options=i(this.options,e),this.options.length<t&&this.emitChange()},t.prototype.replaceOption=function(e,t){if(null==t)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this.isValidOption(e)||!this.isValidOption(t))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");if(!e.equals(t)){var n=!1;this.options=this.options.map(function(o){return o===e?(n=!0,t):o}),n&&this.emitChange()}},t})(r);t.MoreOptionRegistry=s,t.moreOptionRegistry=new s}),define("modules/clean/react/file_viewer/more_dropdown/views",["require","exports","external/react","external/spectrum/popover","modules/clean/react/file_action_button_type","modules/clean/react/file_viewer/more_dropdown/models"],function(e,t,n,o,i,r){"use strict";function s(e){return e.length&&e[0].type===o.PopoverContentSeparator?e.slice(1):e}function a(e){return n.createElement(o.PopoverContentItem,{className:e.className,key:"file_action_button_type_"+e.fileActionButtonType,value:e.handler},i.getFileActionButtonText(e.fileActionButtonType))}function l(e){return e instanceof r.MoreOption?[a(e)]:e.options.map(function(e){return a(e)})}function c(e){var t=[],i=r.MoreOption;return e.forEach(function(e){(e instanceof r.MoreOptionGroup||i===r.MoreOptionGroup)&&t.push(n.createElement(o.PopoverContentSeparator,null)),i=e instanceof r.MoreOption?r.MoreOption:r.MoreOptionGroup,t=t.concat(l(e))}),s(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.getPopoverContentItemForMoreOption=a,t.getPopoverItemsForMoreOptions=c}),
define("modules/clean/react/file_viewer/mounted_file_actions",["require","exports","tslib","external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button","modules/clean/react/file_viewer/share_helpers","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dropdown","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/clean/react/size_class/constants","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={linkMetadata:null},t.cancelGetSharedLinkInfo=function(){},t.handleShareClick=function(){l.share(t.props.file,t.props.user,null,"PREVIEW_PAGE"),i.logUserAction(r.UserActionNames.SHARE,r.UserActionContextNames.TITLE_BAR_MAIN)},t.removeShareLink=function(){var e=new d.ShareApiClient({userId:t.props.user.id}),n=t.state.linkMetadata,o=n.name,i=n.url;h.deleteLinkWithConfirm({client:e,contentName:o,onCancel:null,onDeleteLink:function(){return t.setState({linkMetadata:null})},url:i})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setupShare(this.props)},t.prototype.componentWillUnmount=function(){this.cancelGetSharedLinkInfo()},t.prototype.componentWillReceiveProps=function(e){e.file!==this.props.file&&(this.cancelGetSharedLinkInfo(),this.setState({linkMetadata:null}),this.setupShare(e))},t.prototype.setupShare=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,o,i;return n.__generator(this,function(n){switch(n.label){case 0:return t=!1,this.cancelGetSharedLinkInfo=function(){t=!0},o=new d.ShareApiClient({userId:e.user.id}),[4,o.sharedLinkInfo({fileIdOrPath:e.file.fq_path})];case 1:return i=n.sent(),t||this.setState({linkMetadata:i}),this.cancelGetSharedLinkInfo=function(){},[2]}})})},t.prototype.logUserActionInTitleBarFactory=function(e){return function(){return i.logUserAction(e,r.UserActionContextNames.TITLE_BAR_MAIN)}},t.prototype.render=function(){var e=!!this.state.linkMetadata&&this.state.linkMetadata.link_permissions.can_revoke,t=this.props,i=t.file,l=t.sizeClass,d=t.user,h={allowRemoveLink:e,isPrivate:!0,file:i,onClickShareLink:this.handleShareClick,onRemoveShareLink:this.removeShareLink,sizeClass:l,user:d};return l===_.SizeClass.Large?o.createElement(c.TitleBarControlsContainer,null,o.createElement("button",{className:"share-button button-primary control__button",onClick:this.handleShareClick},m._("Share")),o.createElement(a.OpenButton,{file:i,isMaestroDesign:!0,location:r.FileViewerPane.TITLE_BAR,user:d}),o.createElement(s.MoreDropdown,n.__assign({},h)),o.createElement("div",{className:"react-title-bar__divider"}),o.createElement(p.UserNotificationsDropdown,{isPagelet:!1,isMaestroDesign:!0,onClick:this.logUserActionInTitleBarFactory(r.UserActionNames.CLICK_NOTIFICATIONS),bellDesign:u.BellDesignTypes.GRAY_ICON})):o.createElement(s.MoreDropdown,n.__assign({},h))},t})(o.Component);t.MountedFileActions=f}),define("modules/clean/react/file_viewer/open_button",["require","exports","tslib","external/classnames","external/react","modules/clean/open_with","modules/clean/react/bubble_dropdown","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button_coachmark","modules/clean/react/file_viewer/utils","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={coachmarkHidden:!1,unityInfo:null},t.mounted=!1,t.hideCoachmark=function(){t.setState({coachmarkHidden:!0})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,u.UnityHelpers.isUnityEnabled()&&this.setupUnity()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.setupUnity=function(){var e=this;if(this.props.isUnityDisabled)return void this.disableUnity();u.UnityHelpers.getUnityFileInfo(this.props.file.ns_id,this.props.file.ns_path,this.props.user.id,function(t){e.mounted&&e.setState({unityInfo:t})},function(){e.disableUnity()}),window.setTimeout(function(){null===e.state.unityInfo&&e.disableUnity()},1e4)},t.prototype.disableUnity=function(){this.mounted&&this.setState({unityInfo:{can_open_directly:!1,is_locally_available:!1,is_infinite_placeholder:!1}})},t.prototype.hasUnityFolderSupport=function(){return!this.props.isUnityDisabled&&null!==this.state.unityInfo&&(!!this.state.unityInfo.is_locally_available||!!this.state.unityInfo.is_infinite_placeholder)&&u.UnityHelpers.clientSupportsOpenInFileBrowser()},t.prototype.hasUnityFileSupport=function(){return!this.props.isUnityDisabled&&null!==this.state.unityInfo&&!!this.state.unityInfo.is_locally_available&&this.state.unityInfo.can_open_directly!==!1},t.prototype.hasOpenWithSupport=function(){return!this.props.isOpenWithDisabled&&u.OpenWithHelpers.canOpenWith(this.props.file,this.props.user)},t.prototype.getNumEnabled=function(){return(this.hasOpenWithSupport()?1:0)+(this.hasUnityFileSupport()?1:0)+(this.hasUnityFolderSupport()?1:0)},t.prototype.isDropdownDisabled=function(){return this.getNumEnabled()<2},t.prototype.isButtonDisabled=function(){return null===this.state.unityInfo},t.prototype.getFileBrowserLabel=function(){var e=(null!==this.state.unityInfo?this.state.unityInfo.file_browser_display_name:void 0)||h._("File Browser");return h._("Show in %(file_browser)s").format({file_browser:e})},t.prototype.getNativeAppLabel=function(){var e=(null!==this.state.unityInfo?this.state.unityInfo.open_application_name:void 0)||h._("Desktop");return h._("Open in %(app_name)s").format({app_name:e})},t.prototype.onClickAnyOpenButtonType=function(e){this.hideCoachmark(),this.props.onClick&&this.props.onClick(e)},t.prototype.getActionContext=function(e){return null!==this.props.location?u.getSplitButtonUserActionContext(e,this.props.location)||l.UserActionContextNames.UNKNOWN:l.UserActionContextNames.UNKNOWN},t.prototype.handleUnityFileClick=function(e){var t=this;return function(n){t.onClickAnyOpenButtonType(n);var o=t.props.file;u.UnityHelpers.openFile(o.ns_id,o.ns_path,t.props.user.id,!1),a.logUserAction(l.UserActionNames.OPEN_IN_UNITY,t.getActionContext(e)),null!==n&&n.preventDefault()}},t.prototype.handleUnityFolderClick=function(e){var t=this;return function(n){t.onClickAnyOpenButtonType(n);var o=t.props.file;u.UnityHelpers.openFile(o.ns_id,o.ns_path,t.props.user.id,!0),a.logUserAction(l.UserActionNames.OPEN_IN_UNITY_FOLDER,t.getActionContext(e)),null!==n&&n.preventDefault()}},t.prototype.handleOpenWithClick=function(e){var t=this;return function(n){t.onClickAnyOpenButtonType(n),u.OpenWithHelpers.openWith(t.props.file,t.props.user),a.logUserAction(l.UserActionNames.OPEN_IN_OFFICE_ONLINE,t.getActionContext(e)),null!==n&&n.preventDefault()}},t.prototype.handleDownloadClick=function(e){var t=this;return function(n){t.onClickAnyOpenButtonType(n),a.download(t.props.file),a.logUserAction(l.UserActionNames.DOWNLOAD,t.getActionContext(e)),null!==n&&n.preventDefault()}},t.prototype.renderCoachmark=function(e,t){var n=null;return this.state.coachmarkHidden||(n=i.createElement(c,{file:this.props.file,user:this.props.user,inDropdown:t})),i.createElement("div",{className:"c-coach-mark__container"},e,n)},t.prototype.renderMainButton=function(){var e={"button-secondary":!0,"c-btn":this.props.isMaestroDesign,"c-btn--secondary":this.props.isMaestroDesign,"c-split-btn":!this.isDropdownDisabled(),"c-split-btn--left":!this.isDropdownDisabled(),control__button:!0,disabled:this.isButtonDisabled()};if(this.hasUnityFileSupport()){e["open-button__unity"]=!0;var t=i.createElement("button",{className:o(e),onClick:this.handleUnityFileClick(l.SplitButtonActionLocation.MAIN)},h._("Open")),n=void 0;return null!==this.state.unityInfo&&(n=this.state.unityInfo.open_application_identifier),r.is_adobe_app(n)?this.renderCoachmark(t,!1):t}if(this.hasUnityFolderSupport())return e["open-button__unity-folder"]=!0,i.createElement("button",{className:o(e),onClick:this.handleUnityFolderClick(l.SplitButtonActionLocation.MAIN)},h._("Open"));if(this.hasOpenWithSupport()&&!this.isButtonDisabled()){e["open-button__open-with"]=!0;var s=i.createElement("button",{className:o(e),onClick:this.handleOpenWithClick(l.SplitButtonActionLocation.MAIN)},h._("Open"));return this.renderCoachmark(s,!1)}return this.isButtonDisabled()?i.createElement("button",{className:o(e),"aria-label":""}):(e["open-button__download"]=!0,i.createElement("button",{className:o(e),onClick:this.handleDownloadClick(l.SplitButtonActionLocation.MAIN)},h._("Download")))},t.prototype.renderSplitButton=function(){var e=o({"button-secondary":!0,"c-btn":this.props.isMaestroDesign,"c-btn--secondary":this.props.isMaestroDesign,"c-split-btn":!0,"c-split-btn--right":!0,"c-split-btn--dropdown":!0,control__button:!0}),t=i.createElement("button",{className:e},i.createElement(p,{group:"web",name:"control_menu",alt:h._("More options")}));return this.renderCoachmark(this.renderMenu(t),!0)},t.prototype.renderDropdownButton=function(){var e=o({"button-secondary":!0,"c-btn":!0,"c-btn--secondary":!0,"download-button":!0,control__button:!0,disabled:this.isButtonDisabled()}),t=!1,n=null!==this.state.unityInfo?this.state.unityInfo.open_application_identifier:void 0;this.hasUnityFileSupport()&&r.is_adobe_app(n)?t=!0:this.hasOpenWithSupport()&&!this.isButtonDisabled()&&(t=!0);var s=i.createElement("button",{className:e},h._("Open ▾"));return t?this.renderCoachmark(s,!0):s},t.prototype.renderMenu=function(e){var t=u.OpenWithHelpers.getOpenWithHandlerData(this.props.file,this.props.user),n=null;this.hasUnityFileSupport()&&(n=i.createElement("li",null,i.createElement("a",{href:"#",className:"open-button__unity",onClick:this.handleUnityFileClick(l.SplitButtonActionLocation.SPLIT)},i.createElement(d,{group:"web",name:"ow_desktop",text:this.getNativeAppLabel()}))));var o=null;this.hasOpenWithSupport()&&(o=i.createElement("li",null,i.createElement("a",{href:"#",className:"open-button__open-with",onClick:this.handleOpenWithClick(l.SplitButtonActionLocation.SPLIT)},i.createElement(d,{group:"web",name:null!=t?t.icon:void 0,text:null!=t?t.name:void 0}))));var r=null;return this.hasUnityFolderSupport()&&(r=i.createElement("li",null,i.createElement("a",{href:"#",className:"open-button__unity-folder",onClick:this.handleUnityFolderClick(l.SplitButtonActionLocation.SPLIT)},i.createElement(d,{group:"web",name:"ow_folder",text:this.getFileBrowserLabel()})))),i.createElement(s,{targetButton:e,arrow_position:this.props.justifyRight?"top-right":"top",extra_css_class:"react-file-viewer-dropdown",vertical_displacement:4,bubbleDropdownShown:this.hideCoachmark},i.createElement("ul",{className:"dropdown-contents"},n,o,r))},t.prototype.render=function(){if(this.props.isMaestroDesign){var e=void 0;return e=this.isDropdownDisabled()?this.renderMainButton():this.renderMenu(this.renderDropdownButton()),i.createElement("div",{className:"open-button"},e)}var e=null;return this.isDropdownDisabled()||(e=this.renderSplitButton()),i.createElement("div",{className:"c-split-btn-container open-button"},this.renderMainButton(),e)},t})(i.Component);_.defaultProps={isMaestroDesign:!1,isUnityDisabled:!1,isOpenWithDisabled:!1,justifyRight:!0,onClick:null,location:null},t.OpenButton=_}),function(){define("modules/clean/react/file_viewer/open_button_coachmark",["external/react","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/utils","modules/clean/react_format","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i,r,s,a){var l,c,u,p,d,h,_;return c=o.CoachMark,u=i.TooltipHelpers,d=r.reactFormat,_=s.static_url,p=a._,h=function(t){return d(t,{strong:e.DOM.strong()})},l=e.createFactory(c),e.createClass({displayName:"OpenButtonCoachmark",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,inDropdown:e.PropTypes.bool.isRequired},getInitialState:function(){return{vendor:null,application:null}},setCoachmarkConfig:function(e,t){return this.setState({vendor:e,application:t})},clearCoachmarkConfig:function(){return this.setCoachmarkConfig(null,null)},onReceiveTooltipInfo:function(e){var n,o,i,r;if(o=t.get_extension(this.props.file),i=u.getVendorAndApplication(e,o),null!==i)return r=i.vendor,n=i.application,this.setCoachmarkConfig(r,n)},componentDidMount:function(){return u.fetchTooltipInfo(this.props.user.id,this.onReceiveTooltipInfo)},hasCoachmark:function(){return this.state.vendor&&this.state.application},dismissCoachmark:function(){return this.clearCoachmarkConfig()},onCoachmarkShown:function(){var e;return e=t.get_extension(this.props.file),u.logImpression(e,this.props.user.id,this.state.application)},onCoachmarkButtonClick:function(){return this.dismissCoachmark()},_renderCoachmark:function(e){var t,n,o,i,r,s;return s=e.title,o=e.imageUrl,i=e.imageUrl2x,n=e.imageAlt,r=e.openButtonBody,t=e.dropdownBody,l({title:s,imageUrl:o,imageUrl2x:i,imageAlt:n,buttonText:p("Got it."),onButtonClick:this.onCoachmarkButtonClick,onShown:this.onCoachmarkShown},this.props.inDropdown?t:r)},_renderMsftWord:function(){return this._renderCoachmark({title:p("Edit shared docs together"),imageUrl:_("/static/images/file_viewer/coach_mark_docx-vflGsxySJ.png"),imageUrl2x:_("/static/images/file_viewer/coach_mark_docx@2x-vflJZIQKs.png"),imageAlt:p("An illustration of a Word file"),buttonText:p("Got it."),openButtonBody:h(p("Click <strong>open</strong> to edit together in Microsoft Word Online.")),dropdownBody:h(p("Choose <strong>Microsoft Word Online</strong> to edit together."))})},_renderMsftExcel:function(){return this._renderCoachmark({title:p("Edit shared spreadsheets together"),imageUrl:_("/static/images/file_viewer/coach_mark_xlsx-vflaEwaN7.png"),imageUrl2x:_("/static/images/file_viewer/coach_mark_xlsx@2x-vflkU3Ma1.png"),imageAlt:p("An illustration of an Excel file"),openButtonBody:h(p("Click <strong>open</strong> to edit together in Microsoft Excel Online.")),dropdownBody:h(p("Choose <strong>Microsoft Excel Online</strong> to edit together."))})},_renderMsftPowerpoint:function(){return this._renderCoachmark({title:p("Edit shared presentations together"),imageUrl:_("/static/images/file_viewer/coach_mark_pptx-vfltjppV8.png"),imageUrl2x:_("/static/images/file_viewer/coach_mark_pptx@2x-vflpvn3tE.png"),imageAlt:p("An illustration of a Powerpoint file"),openButtonBody:h(p("Click <strong>open</strong> to edit together in Microsoft PowerPoint Online.")),dropdownBody:h(p("Choose <strong>Microsoft PowerPoint Online</strong> to edit together."))})},_renderAdobeAcrobatOrReader:function(){return this._renderCoachmark({title:p("Want to edit this PDF?"),imageUrl:_("/static/images/file_viewer/coach_mark_pdf-vflIMdX1a.png"),imageUrl2x:_("/static/images/file_viewer/coach_mark_pdf@2x-vflUkcAgn.png"),imageAlt:p("An illustration of a PDF file"),openButtonBody:h(p("You’re looking at a preview. To open this file for editing, click <strong>Open</strong>.")),dropdownBody:p("You’re looking at a preview. To open this file for editing, click here.")})},render:function(){if(this.hasCoachmark)switch(this.state.vendor){case"msft":switch(this.state.application){case"word":return this._renderMsftWord();case"excel":return this._renderMsftExcel();case"powerpoint":return this._renderMsftPowerpoint()}break;case"adbe":switch(this.state.application){case"acrobat_or_reader":return this._renderAdobeAcrobatOrReader()}}return null}})})}.call(this),function(){define("modules/clean/react/file_viewer/seen_state_coachmark",["external/react","modules/clean/react/file_viewer/coach_mark","modules/clean/react/pass/data_helpers","modules/clean/react_format","modules/clean/static_urls","modules/clean/zendesk_feedback","modules/core/i18n"],function(e,t,n,o,i,r,s){var a,l,c,u,p,d,h,_,m,f;return l=t.CoachMark,c=n.SeenStateHelpers,h=o.reactFormat,f=i.static_url,m=r.showPASSFeedbackForm,u=s._,a=e.createFactory(l),_=e.DOM,p=_.a,d=_.div,e.createClass({displayName:"SeenStateCoachmark",propTypes:{file:e.PropTypes.object.isRequired,userId:e.PropTypes.number.isRequired,shouldShowFeedbackCoachmark:e.PropTypes.bool,url:e.PropTypes.string},getInitialState:function(){return{coachmarkType:null,showCoachmark:!1}},_getCoachmarkCompletion:function(e){return"none"!==e?this.setState({coachmarkType:e,showCoachmark:!0}):this.setState({showCoachmark:!1})},componentDidMount:function(){return c.getCoachmark(this.props.userId,this.props.file.ns_id,this.props.file.sjid,this.props.url,this._getCoachmarkCompletion)},_onCoachmarkButtonClick:function(){return"feedback"===this.state.coachmarkType&&m(),this.setState({showCoachmark:!1}),c.logCoachmarkInteraction(this.props.userId,this.props.file.ns_id,this.props.file.sjid,this.props.url,this.state.coachmarkType,"accepted")},_onCoachmarkClose:function(){return this.setState({showCoachmark:!1}),c.logCoachmarkInteraction(this.props.userId,this.props.file.ns_id,this.props.file.sjid,this.props.url,this.state.coachmarkType,"dismissed")},_renderFeedbackCoachmark:function(){var e;return this.props.shouldShowFeedbackCoachmark?(e=u("Help us improve Dropbox by answering a few questions."),d({className:"feedback-coach-mark"},a({title:u("Have a moment?"),imageUrl:f("/static/images/file_viewer/coach_mark_docx-vflGsxySJ.png"),imageUrl2x:f("/static/images/file_viewer/coach_mark_docx@2x-vflJZIQKs.png"),imageAlt:u("An illustration explaining the presence and seen state feature"),buttonText:u("Give feedback"),onButtonClick:this._onCoachmarkButtonClick,showClose:!0,onCloseButtonClick:this._onCoachmarkClose},e))):d()},_renderGeneralCoachmark:function(){var e;return e=h(u("You can always turn this off for the files you own. <a>Learn more</a>"),{a:p({className:"plain-link",href:"https://www.dropbox.com/help/9262"})}),d({className:"general-coach-mark"},a({title:u("New! See who viewed this file"),imageUrl:f("/static/images/pass/pass_onboarding_coachmark-vflVCICV4.png"),imageUrl2x:f("/static/images/pass/pass_onboarding_coachmark@2x-vfl16XHDz.png"),imageAlt:u("An illustration explaining the presence and seen state feature"),buttonText:u("Got it"),onButtonClick:this._onCoachmarkButtonClick},e))},render:function(){if(!this.state.showCoachmark)return d();switch(this.state.coachmarkType){case"general":return this._renderGeneralCoachmark();case"feedback":return this._renderFeedbackCoachmark();default:return d()}}})})}.call(this),define("modules/clean/react/file_viewer/seen_state_facepile",["require","exports","tslib","external/classnames","external/react","external/underscore","jquery","modules/clean/components/loading_indicator","modules/clean/loggers/pass_facepile_logger","modules/clean/previews/util","modules/clean/react/css","modules/clean/react/file_viewer/empty_seen_state_facepile","modules/clean/react/file_viewer/seen_state_coachmark","modules/clean/react/file_viewer/share_helpers","modules/clean/react/pass/avatars","modules/clean/react/pass/constants","modules/clean/react/pass/event_emitter","modules/clean/react/pass/types","modules/clean/viewer"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=(function(e){function u(t){var n=e.call(this,t)||this;return n.numUsersToLog=0,n.hasDisplayedAvatars=!1,n.hasPassShownBeenLogged=!1,n.state={sizeMode:n.getSizeMode(),hasHoveredOver:!1,newPresentUserIds:[]},n.onAvatarHover=n.onAvatarHover.bind(n),n.onAvatarClick=n.onAvatarClick.bind(n),n}return n.__extends(u,e),u.prototype.componentWillMount=function(){this.resetLogging(),l.passFacepileLogger.listenTo(f.passEventEmitter),s(window).on("resize.facepile",this.onResize.bind(this))},u.prototype.componentDidMount=function(){this.logFacepileShownEvents()},u.prototype.componentWillReceiveProps=function(e){if(this.props.file.ns_id!==e.file.ns_id||this.props.file.sjid!==e.file.sjid)this.resetLogging(),this.setState({newPresentUserIds:[]});else{if(null==e.presence||null==this.props.presence)return;var t=r.difference(e.presence,this.props.presence),n=r.difference(this.props.presence,e.presence);this.updateNewPresentUserIds(t,n)}},u.prototype.componentDidUpdate=function(e,t){return this.logFacepileShownEvents()},u.prototype.componentWillUnmount=function(){return l.passFacepileLogger.unlistenTo(f.passEventEmitter),s(window).off("resize.facepile")},u.prototype.updateNewPresentUserIds=function(e,t){var n=r.filter(this.state.newPresentUserIds,function(e){return t.indexOf(e)===-1});this.setState({newPresentUserIds:e.concat(n)})},u.prototype.getSizeMode=function(){if(this.props.fromBrowse)return"normal";var e=t.SeenStateFacepile.getViewportWidth();return e<=600?"hidden":e<=680?"compact":"normal"},u.getViewportWidth=function(){return null==document.documentElement?1200:document.documentElement.clientWidth},u.prototype.computeOverflowBasis=function(e){if(!this.props.uniqueMemberCountInfo.data)return e.length;var t=this.props.uniqueMemberCountInfo.data;return e.forEach(function(e){e.incrementOverflowBasis&&t++}),Math.max(t,e.length)},u.prototype.onResize=function(){this.setState({sizeMode:this.getSizeMode()})},u.prototype.resetLogging=function(){this.numUsersToLog=0,this.hasPassShownBeenLogged=!1,this.hasDisplayedAvatars=!1},u.prototype.logFacepileShownEvents=function(){if(this.props.presence&&this.hasDisplayedAvatars&&!this.hasPassShownBeenLogged){var e=m.EventTypes.PASS_SHOWN;this.logPassEvent(e),this.hasPassShownBeenLogged=!0}},u.prototype.logPassEvent=function(e){var t=null!=this.props.uniqueMemberCountInfo.data?Math.max(this.numUsersToLog,this.props.uniqueMemberCountInfo.data):this.numUsersToLog;return f.passEventEmitter.emit(e,this.props.fromBrowse,this.props.file,{numAccessors:t,numViewers:this.getNumViewers(),numCurrentViewers:this.getNumCurrentViewers()})},u.prototype.getNumViewers=function(){var e,t;this.shouldHardcodeCurrentViewer()?(e=1,t=this.seenStateDataWithViewerFiltered(this.getSeenStates())):(e=0,t=this.getSeenStates());for(var n=0,o=t;n<o.length;n++){null!=o[n].when_last_seen&&e++}return e},u.prototype.getNumCurrentViewers=function(){var e=this;if(!this.props.presence)return 0;if(this.shouldHardcodeCurrentViewer()){return 1+this.props.presence.filter(function(t){return t!==e.props.user.account_id}).map(function(e){return e}).length}return this.props.presence.length},u.prototype.userIsAnonymous=function(e){return r.map(this.props.anonymousPresenceInfo,function(e){return e.seen_state_user.user_id}).indexOf(e.user_id)>=0},u.prototype.userIsOnline=function(e){return null!=this.props.presence&&this.props.presence.indexOf(e.user_id)>=0},u.prototype.onAvatarHover=function(){var e=this,t=m.EventTypes.PASS_HOVER;setTimeout(function(){return e.setState({hasHoveredOver:!0})},1e3),this.setState({}),this.logPassEvent(t)},u.prototype.onAvatarClick=function(){var e=this.props.fromBrowse?"BROWSE_FILE_FACEPILE":"PREVIEW_PAGE_FACEPILE",t=m.EventTypes.PASS_CLICK;this.logPassEvent(t),h.share(this.props.file,g.get_viewer().get_user_by_id(this.props.user.id),this.props.url||null,e)},u.prototype.buildUserInfo=function(e){var t=e.seen_state_user.display_name,n=e.seen_state_user.user_id||t,o="link_only"===(null!=e.seen_state_user.sharing_access_type?e.seen_state_user.sharing_access_type.type:void 0);return new v.UserInfo(n,t,this.userIsOnline(e.seen_state_user),!1,o,e.when_last_seen,e.seen_state_user.photo_circle_url)},u.prototype.seenStateDataWithViewerFiltered=function(e){var t=this;return r.filter(e,function(e){return e.seen_state_user.user_id!==t.props.user.account_id})},u.prototype.partitionUserInfoLists=function(e){for(var t=[],n=[],o=[],i=[],r=[],s={},a=0,l=e;a<l.length;a++){var c=l[a],u=this.buildUserInfo(c);this.userIsOnline(c.seen_state_user)?this.isNewPresentUser(u)?s[u.key]=u:this.userIsAnonymous(c.seen_state_user)?o.push(u):n.push(u):null!=c.when_last_seen?i.push(u):r.push(u)}for(var p=0,d=this.state.newPresentUserIds;p<d.length;p++){var h=d[p],u=s[h];u&&t.push(u)}return{newPresentUserInfoList:t,presentUserInfoList:n,anonymousUserInfoList:o,offlineUserInfoList:i,neverViewedUserInfoList:r}},u.prototype.getUserInfoList=function(){var e,t=[],n=this.getMergedSeenStateData();if(this.shouldHardcodeCurrentViewer()){e=this.seenStateDataWithViewerFiltered(n);var o=this.props.user.account_id,i=!this.props.fromBrowse&&e.length<n.length&&this.getSeenStates().some(function(e){var t=e.seen_state_user;return t.user_id===o&&"link_only"===(null!=t.sharing_access_type?t.sharing_access_type.type:void 0)}),r=g.get_viewer().get_user_by_id(this.props.user.id);t.push(new v.UserInfo(this.props.user.account_id,r.display_name,!0,!0,i,void 0,r.photo_url))}else e=n;var s=this.partitionUserInfoLists(e),a=s.newPresentUserInfoList,l=s.presentUserInfoList,c=s.anonymousUserInfoList,u=s.offlineUserInfoList,p=s.neverViewedUserInfoList;return l.sort(function(e,t){return e.displayName.toLowerCase().localeCompare(t.displayName.toLowerCase())}),p.sort(function(e,t){return e.displayName.toLowerCase().localeCompare(t.displayName.toLowerCase())}),t.concat(a,l,c,u,p)},u.prototype.isNewPresentUser=function(e){return this.state.newPresentUserIds.indexOf(e.key)>=0},u.prototype.getMergedSeenStateData=function(){var e=this.getSeenStates(),t=e.map(function(e){return e.seen_state_user.user_id});if(this.props.sharingStorePassInfo.data){for(var n=0,o=this.props.sharingStorePassInfo.data.users;n<o.length;n++){var i=o[n],r=i.seen_state_user.user_id;t.indexOf(r)!==-1||r===this.props.user.account_id&&this.shouldHardcodeCurrentViewer()||e.push(i)}return e.concat(this.props.anonymousPresenceInfo,this.props.sharingStorePassInfo.data.invitees)}return e.concat(this.props.anonymousPresenceInfo)},u.prototype.shouldHardcodeCurrentViewer=function(){var e=!(g.get_viewer().is_assume_user_session||this.props.fromBrowse),t=null!=this.props.presence&&this.props.presence.indexOf(this.props.user.account_id)>=0;return e||t},u.prototype.getSeenStates=function(){return this.props.identifiedSeenStateInfo&&this.props.identifiedSeenStateInfo.seen_states?this.props.identifiedSeenStateInfo.seen_states.slice():[]},u.prototype.haveSeenStateDataToShow=function(e){var t=e.length;return t>=2||1===t&&e[0].key!==this.props.user.account_id},u.prototype.allDataHasLoaded=function(){return m.fetchingStatusSeenStateIsComplete(this.props.passFetchingStatus)&&this.props.sharingStorePassInfo.isLoaded&&this.props.uniqueMemberCountInfo.isLoaded},u.prototype.render=function(){if("hidden"===this.state.sizeMode||!c.is_pass_enabled(this.props.user)&&!c.is_pass_ga_receive_enabled(this.props.user))return this.renderEmptyFacepile();if(c.is_pass_ga_receive_enabled(this.props.user)&&(this.props.isPassPermissionsPending||null==this.props.passPermissions||!this.props.passPermissions.canReadPresence&&!this.props.passPermissions.canReadSeenState))return this.renderEmptyFacepile();if(this.props.passFetchingStatus===m.PASS_FETCHING_STATUS.ERROR)return this.renderEmptyFacepile();if(!this.allDataHasLoaded())return this.props.fromBrowse?i.createElement(a,{style:a.LoadingIndicatorStyle.DOTS}):i.createElement("div",null);var e=[],t="compact"===this.state.sizeMode?m.MAX_FACES_COMPACT:m.MAX_FACES_NORMAL,n=this.getUserInfoList();if(this.numUsersToLog=n.length,this.haveSeenStateDataToShow(n))if(n.length<=t)this.pushUserAvatars(e,n);else{var o=this.computeOverflowBasis(n);this.numUsersToLog=o,t-=1;var r=o-t;n=n.slice(0,t),this.pushUserAvatars(e,n),e.push(i.createElement(_.OverflowAvatar,{key:"overflow-avatar",moreFacepileCount:r,onMouseEnter:this.onAvatarHover}))}return e.length?(this.hasDisplayedAvatars=!0,this.renderAvatarsInReverse(e)):this.renderEmptyFacepile()},u.prototype.renderEmptyFacepile=function(){return i.createElement(p.EmptySeenStateFacepile,{hasPresence:null!=this.props.presence})},u.prototype.facepileClassName=function(){return o((e={},e[m.FACEPILE_CLASSNAME]=!0,e[m.PRESENCE_RECEIVED_CLASSNAME]=null!=this.props.presence,e));var e},u.prototype.pushUserAvatars=function(e,t){var n=this;t.forEach(function(t){e.push(i.createElement(_.UserAvatar,{key:t.key,userInfo:t,inPresenceOnlyMode:m.fetchingStatusIndicatesPresenceOnlyMode(n.props.passFetchingStatus),onMouseEnter:n.onAvatarHover}))})},u.prototype.renderAvatarsInReverse=function(e){e.reverse();var t=i.createElement("div",null);return e.length>=2&&!this.props.fromBrowse&&(t=i.createElement("div",{className:"seen-state-coach-mark__container"},i.createElement(d,{file:this.props.file,userId:this.props.user.id,shouldShowFeedbackCoachmark:this.state.hasHoveredOver,url:this.props.url}))),i.createElement("div",{className:"react-pass__facepile-padding"},i.createElement("div",{className:"react-pass__facepile-wrap"},t,i.createElement("div",{className:this.facepileClassName(),onClick:this.onAvatarClick},e)))},u})(i.Component);y.displayName="SeenStateFacepile",t.SeenStateFacepile=u(y,["/static/css/seen_state_facepile-vflfYwTOL.css"])}),define("modules/clean/react/file_viewer/seen_state_facepile_controller",["require","exports","tslib","external/react","modules/clean/react/file_viewer/empty_seen_state_facepile","modules/clean/react/file_viewer/seen_state_facepile","modules/clean/react/file_viewer/utils","modules/clean/react/pass/constants","modules/clean/react/pass/data_helpers","modules/clean/react/pass/store","modules/clean/react/pass/types","modules/clean/sharing/stores/sharing_info","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.state=n._getStateFromStore(),n.boundUpdate=n._onUpdateFromStore.bind(n),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){c.add_change_listener(this.boundUpdate),p.sharingInfoStore.add_change_listener(this.boundUpdate),l.PassHelpers.setup({user:this.props.user,fileData:this.getPassFileData(),prevFileData:null,shouldWritePresence:this.shouldRegisterPresence()})},t.prototype.componentWillUpdate=function(e,t){var n=t.passInfo;if(n.userIdsWithoutSeenStateInfo.length>0&&a.fetchingStatusIsSuccessful(n.passFetchingStatus)&&e.user){var o=e.file;l.SeenStateHelpers.fetchSeenStateUsers(e.user.id,n.identifiedSeenStateInfo,n.userIdsWithoutSeenStateInfo,o.ns_id,o.sjid)}var i=e.file;if(!s.areFilesEqual(i,this.props.file)){var r={file:i,url:this.urlFromProps(e)};l.PassHelpers.setup({user:this.props.user,fileData:r,prevFileData:this.getPassFileData(),shouldWritePresence:this.shouldRegisterPresence()})}},t.prototype.componentWillUnmount=function(){c.remove_change_listener(this.boundUpdate),p.sharingInfoStore.remove_change_listener(this.boundUpdate),l.PassHelpers.teardown({user:this.props.user,fileData:this.getPassFileData(),async:this.shouldRegisterPresence()})},t.prototype._onUpdateFromStore=function(){this.setState(this._getStateFromStore())},t.prototype._getStateFromStore=function(){return{passInfo:{anonymousPresence:c.anonymousPresence(this.props.file.ns_id,this.props.file.sjid),isPassPermissionsPending:c.isPassPermissionsPending(this.props.file.file_id),passFetchingStatus:c.passFetchingStatus(this.props.file.ns_id,this.props.file.sjid),passPermissions:c.getPassPermissions(this.props.file.file_id),presence:c.presence(this.props.file.ns_id,this.props.file.sjid),identifiedSeenStateInfo:c.identifiedSeenStateInfo(this.props.file.ns_id,this.props.file.sjid),userIdsWithoutSeenStateInfo:c.userIdsWithoutSeenStateInfo(this.props.file.ns_id,this.props.file.sjid)},sharingInfo:this.props.user&&p.sharingInfoStore.getSharingInfo(this.props.user.id,this.props.file.file_id)||void 0}},t.prototype._getAnonymousPassInfo=function(){return null==this.state.passInfo.anonymousPresence?[]:this.state.passInfo.anonymousPresence.map(function(e){return{seen_state_user:{user_id:e,display_name:d._("Guest")},seen_events:[]}})},t.prototype._getMemberInfosInPassFormat=function(e){return{
invitees:this._getInviteeMemberInfos(e),users:this._getUserMemberInfos(e)}},t.prototype._getUserMemberInfos=function(e){return e.members().get("users").valueSeq().toArray().map(function(e){return{seen_state_user:{user_id:e.account_id,display_name:e.account?e.account.display_name:null,photo_url:e.account?e.account.profile_photo_url:null},seen_events:[]}})},t.prototype._getInviteeMemberInfos=function(e){return e.members().get("invitees").valueSeq().toArray().map(function(e){return{seen_state_user:{display_name:e.contact},seen_events:[]}})},t.prototype.getPassFileData=function(){return{file:this.props.file,url:this.urlFromProps()}},t.prototype.shouldRegisterPresence=function(){return!this.props.fromBrowse},t.prototype.urlFromProps=function(e){return void 0===e&&(e=this.props),e.sharedLinkInfo?e.sharedLinkInfo.url:void 0},t.prototype.getPropsFromPassInfo=function(){return{anonymousPresenceInfo:this._getAnonymousPassInfo(),isPassPermissionsPending:this.state.passInfo.isPassPermissionsPending,passFetchingStatus:this.state.passInfo.passFetchingStatus,passPermissions:this.state.passInfo.passPermissions,presence:this.state.passInfo.presence,identifiedSeenStateInfo:this.state.passInfo.identifiedSeenStateInfo}},t.prototype.getPropsFromSharingInfo=function(){var e={uniqueMemberCountInfo:u.FacepileInfo.createNotLoaded(),sharingStorePassInfo:u.FacepileInfo.createNotLoaded()};return this.state.sharingInfo?(null!=this.state.sharingInfo.memberCounts()&&(e.uniqueMemberCountInfo=u.FacepileInfo.create(this.state.sharingInfo.memberCounts().total_unique_users)),this.state.sharingInfo.hasDisplayableMembers()&&(e.sharingStorePassInfo=u.FacepileInfo.create(this._getMemberInfosInPassFormat(this.state.sharingInfo))),e):e},t.prototype.getPropsFromController=function(){return{file:this.props.file,fromBrowse:this.props.fromBrowse,user:this.props.user,url:this.urlFromProps()}},t.prototype.render=function(){if(null==this.props.user)return o.createElement(i.EmptySeenStateFacepile,null);var e=n.__assign({},this.getPropsFromPassInfo(),this.getPropsFromSharingInfo(),this.getPropsFromController());return o.createElement(r.SeenStateFacepile,n.__assign({},e))},t})(o.Component);h.displayName="SeenStateFacepileController",t.SeenStateFacepileController=h}),define("modules/clean/react/file_viewer/share_helpers",["require","exports","modules/clean/previews/util","modules/clean/react/file_viewer/utils"],function(e,t,n,o){"use strict";function i(t,i,r,s){e(["modules/clean/sharing/share_modal_util"],function(e){var a={beaconContext:t.beacon_context,filename:n.get_filename(t),isFolder:!1,nsId:t.ns_id,origin:s,sjid:t.sjid,url:r};o.isBrowseFile(t)&&(a.fqPath=t.fq_path),null!=t.file_id&&(a.fileId=t.file_id),e.showShareModal(i,a)})}Object.defineProperty(t,"__esModule",{value:!0}),t.share=i}),define("modules/clean/react/file_viewer/shared_file_actions",["require","exports","tslib","external/react","external/classnames","modules/clean/abuse/report_flag","modules/clean/react/deprecated/copyright_flag","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/size_class/constants","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button","modules/clean/react/share_download/util","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dropdown","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/constants/abuse_report","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b){"use strict";function w(e){return function(){return a.logUserAction(e,l.UserActionContextNames.TITLE_BAR_MAIN)}}function C(e){var t=e.isPrimaryButton,n=new b({path:"/login",query:{cont:E.get_href()}}).toString(),r=i({"sign-in-link":!0,control__button:!0,"button-secondary":t,"button-primary":!t});return o.createElement("a",{className:r,href:n,onClick:w(l.UserActionNames.SIGN_IN)},S._("Sign in"))}function T(e){var t=e.sharedLinkInfo;return y.REPORT_ENABLED?o.createElement(r.ReportFlag,{sharedLink:t.url}):o.createElement(s.CopyrightFlag,{sharedLink:t.url})}Object.defineProperty(t,"__esModule",{value:!0});var A=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.removeShareLink=function(){var e=new v.ShareApiClient({userId:t.props.sharePermissions.canRemoveLinkUids[0]});return g.deleteLinkWithConfirmLegacy({client:e,contentName:t.props.file.filename,onCancel:null,onDeleteLink:function(){return E.redirect("/home")},tkey:t.getTkey()})},t}return n.__extends(t,e),t.prototype.getTkey=function(){return this.props.sharePermissions&&this.props.sharePermissions.canRemoveLinkUids.length>0?this.props.shareToken.linkKey:null},t.prototype.render=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,i=e.sharePermissions,r=e.shareToken,s=e.showOpenInAppButton,a=e.sizeClass,v=e.user;return a!==u.SizeClass.Large?o.createElement(c.MoreDropdown,{allowRemoveLink:!!this.getTkey(),file:t,isPrivate:!1,onRemoveShareLink:this.removeShareLink,sizeClass:a,shareDownloadOptions:h.getDownloadOptions(i,n,r,t)}):o.createElement(_.TitleBarControlsContainer,null,n.hasPublicAudienceOrVisibility!==!1?o.createElement(T,{sharedLinkInfo:n}):null,s?o.createElement(p.OpenInAppButton,{urls:this.props.file.open_in_app_data}):null,v?null:o.createElement(C,{isPrimaryButton:s}),r&&i?o.createElement(d.ShareDownloadButton,{location:l.FileViewerPane.PREVIEW_CONTENT,fileOrFolder:t,sharedLinkInfo:n,sharePermissions:i,shareToken:r}):null,o.createElement(c.MoreDropdown,{allowRemoveLink:!!this.getTkey(),file:t,isPrivate:!1,onRemoveShareLink:this.removeShareLink,sizeClass:a}),v?o.createElement("div",{className:"react-title-bar__divider"}):null,v?o.createElement(f.UserNotificationsDropdown,{isPagelet:!1,onClick:w(l.UserActionNames.CLICK_NOTIFICATIONS),bellDesign:m.BellDesignTypes.GRAY_ICON}):null)},t})(o.Component);A.defaultProps={user:null},t.SharedFileActions=A}),define("modules/clean/react/file_viewer/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/flux/dispatcher","modules/constants/file_viewer"],function(e,t,n,o,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.files=[],n.currentIndex=0,n.sharedLinkInfos={},n.shareTokens={},n.sharePermissions={},n.isFullscreen=!1,n.renderStatuses={},n.openInAppBannerClosed=!1,n.previewQualityPopupClosed={},n.cachedLatestRevision=null,n.disableFlipping=!1,n.expSubgrowthOverquotaFilePreview=null,n}return n.__extends(t,e),Object.defineProperty(t,"instance",{get:function(){return this.INSTANCE},enumerable:!0,configurable:!0}),t.prototype.getFiles=function(){return this.files},t.prototype.getCurrentIndex=function(){return this.currentIndex},t.prototype.getUser=function(){return this.user},t.prototype.getSharedLinkInfo=function(){return this.sharedLinkInfos[s.revisionKey(this.getCurrentFile())]},t.prototype.getShareToken=function(){return this.shareTokens[s.revisionKey(this.getCurrentFile())]},t.prototype.getSharePermissions=function(){return this.sharePermissions[s.revisionKey(this.getCurrentFile())]},t.prototype.getIsFullscreen=function(){return this.isFullscreen},t.prototype.getCurrentFile=function(){return this.files[this.currentIndex]},t.prototype.getIsViewingLatestRevision=function(){return!this.cachedLatestRevision},t.prototype.renderStatus=function(){return this.getCurrentFile()?this.renderStatuses[s.revisionKey(this.getCurrentFile())]:r.PreviewRenderStatuses.UNKNOWN},t.prototype.shouldShowPreviewQualityPopup=function(){if(l.PREVIEW_QUALITY_POPUP_PROBABILITY<=0)return!1;var e=s.revisionKey(this.getCurrentFile()),t=this.renderStatuses[e]===r.PreviewRenderStatuses.SUCCEEDED,n=this.previewQualityPopupClosed[e]===!1;return t&&n},t.prototype.shouldShowOpenInAppBanner=function(){if(this.openInAppBannerClosed)return!1;var e=this.getCurrentFile();return!!e&&!!e.open_in_app_data},t.prototype.shouldShowOQUpsell=function(){return"V2"===this.expSubgrowthOverquotaFilePreview},t.prototype.setup=function(e){this.user=e.user,this.disableFlipping=e.disableFlipping,void 0!==e.files&&void 0!==e.currentIndex&&this.updateFiles(e.files[e.currentIndex],{files:e.files},e.sharedLinkInfos,e.shareTokens,e.sharePermissions),this.fetchSubgrowthProOverquotaFilePreviewVariant()},t.prototype.updateFiles=function(e,t,n,o,i){if(void 0===n&&(n=[]),void 0===o&&(o=[]),void 0===i&&(i=[]),t.files){this.sharedLinkInfos={},this.shareTokens={},this.sharePermissions={},this.renderStatuses={};for(var a=0;a<t.files.length;a++){var l=s.revisionKey(t.files[a]);n.length>a&&(this.sharedLinkInfos[l]=n[a]),o.length>a&&(this.shareTokens[l]=o[a]),i.length>a&&(this.sharePermissions[l]=i[a]),this.renderStatuses[l]=r.PreviewRenderStatuses.UNKNOWN,this.previewQualityPopupClosed[l]=this.previewQualityPopupClosed[l]||!1}var c=s.FlippableHelpers.isFlippableFile(e),u=this.getFileIndex(t.files,e)>=0;!this.disableFlipping&&c&&u?(this.files=s.FlippableHelpers.filterFlippableFiles(t.files),this.currentIndex=this.getFileIndex(this.files,e)):(this.files=[e],this.currentIndex=0),this.__emitChange()}},t.prototype.cleanup=function(){this.files=[],this.currentIndex=0,this.user=void 0,this.sharedLinkInfos={},this.shareTokens={},this.sharePermissions={},this.renderStatuses={},this.isFullscreen=!1,this.cachedLatestRevision=null},t.prototype.nextFile=function(){this.restoreRevision(),this.currentIndex===this.files.length-1?this.currentIndex=0:this.currentIndex=this.currentIndex+1,this.__emitChange()},t.prototype.previousFile=function(){this.restoreRevision(),0===this.currentIndex?this.currentIndex=this.files.length-1:this.currentIndex=this.currentIndex-1,this.__emitChange()},t.prototype.setIsFullscreen=function(e){this.isFullscreen=e,this.__emitChange()},t.prototype.switchRevision=function(e){this.cachedLatestRevision||(this.cachedLatestRevision=this.files[this.currentIndex]),this.files[this.currentIndex]=e.file,this.__emitChange()},t.prototype.restoreRevision=function(){this.cachedLatestRevision&&(this.files[this.currentIndex]=this.cachedLatestRevision,this.cachedLatestRevision=null,this.__emitChange())},t.prototype.fastForwardRevision=function(e){this.cachedLatestRevision=e.file,this.__emitChange()},t.prototype.updateRenderStatus=function(e){this.getCurrentFile()&&(this.renderStatuses[s.revisionKey(this.getCurrentFile())]=e.newStatus,this.__emitChange())},t.prototype.markPreviewQualityPopupAsClosed=function(){this.previewQualityPopupClosed[s.revisionKey(this.getCurrentFile())]=!0,this.__emitChange()},t.prototype.markOpenInAppBannerAsClosed=function(){this.openInAppBannerClosed=!0,this.__emitChange()},t.prototype.fetchSubgrowthProOverquotaFilePreviewVariant=function(){var e=this;this.user&&i.SilentBackgroundRequest({url:"/get_file_preview_upsell_variant",data:{_subject_uid:this.user.id},success:function(t){try{var n=JSON.parse(t);n&&n.variant&&(e.expSubgrowthOverquotaFilePreview=n.variant,e.__emitChange())}catch(e){}}})},t.prototype.getFileIndex=function(e,t){for(var n=0;n<e.length;n++)if(s.areFilesEqual(t,e[n]))return n;return-1},t.prototype.__onDispatch=function(e){switch(e.action.type){case r.ActionTypes.SETUP:this.setup(e.action.data);break;case r.ActionTypes.CLEANUP:this.cleanup();break;case r.ActionTypes.UPDATE_FILES:this.updateFiles(this.getCurrentFile(),e.action.data);break;case r.ActionTypes.FLIP_NEXT:this.nextFile();break;case r.ActionTypes.FLIP_PREVIOUS:this.previousFile();break;case r.ActionTypes.OPEN_FULLSCREEN:this.setIsFullscreen(!0);break;case r.ActionTypes.CLOSE_FULLSCREEN:this.setIsFullscreen(!1);break;case r.ActionTypes.FAST_FORWARD_REVISION:this.fastForwardRevision(e.action.data);break;case r.ActionTypes.SWITCH_REVISION:this.switchRevision(e.action.data);break;case r.ActionTypes.RESTORE_REVISION:this.restoreRevision();break;case r.ActionTypes.BROADCAST_RENDER_STATUS:this.updateRenderStatus(e.action.data);break;case r.ActionTypes.CLOSE_PREVIEW_QUALITY_POPUP:this.markPreviewQualityPopupAsClosed();break;case r.ActionTypes.HIDE_OPEN_IN_APP_BANNER:this.markOpenInAppBannerAsClosed()}},t})(o);c.INSTANCE=new c(a),t.FileViewerStore=c}),define("modules/clean/react/file_viewer/title_bar",["require","exports","tslib","external/react","modules/clean/filepath","modules/clean/react/file_viewer/utils","modules/constants/python","modules/core/i18n","modules/clean/react/size_class/constants","modules/clean/react/title_bar/base","modules/clean/react/file_viewer/title_bar/controls","modules/clean/react/file_viewer/title_bar/title"],function(e,t,n,o,i,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isSharedFile=function(){return!!t.props.sharedLinkInfo},t.isMountedFile=function(){return!t.isSharedFile()},t.closeButtonTitle=function(){if(t.isMountedFile()){var e=void 0;if(t.props.isVersionHistoryMode)e=a._("Version history");else if(t.props.fileViewOrigin===s.FileViewOriginType.RECENTS)e=a._("Recents");else{if(t.props.fileViewOrigin===s.FileViewOriginType.PHOTOS||t.props.fileViewAction===s.FileViewActionType.SEARCH)return a._("Close");var n=t.props.file;r.isBrowseFile(n)&&n.fq_path&&(e=i.filename(i.parent_dir(n.fq_path)))}if(e)return a._("Back to %(folder)s").format({folder:e})}return a._("Close")},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.canClose,n=e.canRestoreRevision,i=e.commentsActionCreators,r=e.file,s=e.isDemoMode,a=e.isSeenStatesEnabled,d=e.isVersionHistoryMode,h=e.maxFilenameEmLength,_=e.onCloseViewer,m=e.onRestoreRevision,f=e.sharedLinkInfo,v=e.sharePermissions,g=e.shareToken,y=e.sizeClass,E=e.user,S=y===l.SizeClass.Large,b=f?f.ownerTeamLogo:void 0;return o.createElement(c.TitleBarBase,{canClose:t,closeTitle:this.closeButtonTitle(),customLogoUrl:b,file:r,onClose:_,sizeClass:y,title:o.createElement(p.Title,{file:r,maxFilenameEmLength:h,sharedLinkInfo:f,sizeClass:y,user:E}),controls:[S?o.createElement(u.SeenStates,{file:r,isSeenStatesEnabled:a,isVersionHistoryMode:d,sharedLinkInfo:f,user:E}):null,o.createElement(u.FileActions,{canRestoreRevision:n,commentsActionCreators:i,file:r,isDemoMode:s,isSharedFile:this.isSharedFile(),isVersionHistoryMode:d,onRestoreRevision:m,sharedLinkInfo:f,sharePermissions:v,shareToken:g,sizeClass:y,user:E})]})},t})(o.Component);d.defaultProps={canClose:!1,canRestoreRevision:!1,isDemoMode:!1,isSeenStatesEnabled:!0,isVersionHistoryMode:!1},t.TitleBar=d}),define("modules/clean/react/file_viewer/title_bar/controls",["require","exports","external/react","modules/clean/react/file_viewer/comments_demo_actions","modules/clean/react/file_viewer/empty_seen_state_facepile","modules/clean/react/file_viewer/mounted_file_actions","modules/clean/react/file_viewer/seen_state_facepile_controller","modules/clean/react/file_viewer/shared_file_actions","modules/clean/react/file_viewer/version_history_file_actions"],function(e,t,n,o,i,r,s,a,l){"use strict";function c(e){var t=e.file,o=e.isSeenStatesEnabled,r=e.isVersionHistoryMode,a=e.sharedLinkInfo,l=e.user;return!o||r||null===t.ns_id?n.createElement(i.EmptySeenStateFacepile,null):n.createElement(s.SeenStateFacepileController,{file:t,fromBrowse:!1,sharedLinkInfo:a,user:l})}function u(e){var t=e.canRestoreRevision,i=e.commentsActionCreators,s=e.file,c=e.isDemoMode,u=e.isSharedFile,d=e.isVersionHistoryMode,h=e.onRestoreRevision,_=e.sharedLinkInfo,m=e.sharePermissions,f=e.shareToken,v=e.sizeClass,g=e.user;return c?n.createElement(o.CommentsDemoActions,{commentsActionCreators:i,file:s,sizeClass:v}):u?n.createElement(a.SharedFileActions,{commentsActionCreators:i,file:s,sharedLinkInfo:_,sharePermissions:m,shareToken:f,showOpenInAppButton:!(!s.open_in_app_data||!s.preview_type),sizeClass:v,user:g}):d?n.createElement(l.VersionHistoryFileActions,{canRestoreRevision:!!t,file:s,onRestoreRevision:h||p,user:g}):n.createElement(r.MountedFileActions,{commentsActionCreators:i,file:s,sizeClass:v,user:g})}Object.defineProperty(t,"__esModule",{value:!0}),t.SeenStates=c;var p=function(){};t.FileActions=u}),define("modules/clean/react/file_viewer/title_bar/title",["require","exports","tslib","external/classnames","external/react","modules/clean/em_string","modules/clean/previews/util","modules/clean/react/starred/star","modules/clean/react/title_bubble","modules/clean/react/starred/actions","modules/constants/starred","modules/core/i18n","modules/clean/react/size_class/constants","modules/clean/react/home/home_access/home_access_util"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasFetchedStarStatus=!1,t.shouldShowStarred=function(){var e=t.props,n=e.sizeClass,o=e.sharedLinkInfo;return n===d.SizeClass.Large&&!o&&h.isHomeEnabled()},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.fetchStarred()},t.prototype.componentWillReceiveProps=function(){this.fetchStarred()},t.prototype.fetchStarred=function(){var e=this;this.shouldShowStarred()&&!this.hasFetchedStarStatus&&(this.hasFetchedStarStatus=!0,setTimeout(function(){e.props.user&&e.props.file.file_id&&c.StarredActions.fetchStatuses(e.props.user.role,[{id:e.props.file.file_id,type:u.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID}])},0))},t.prototype.render=function(){var e=this.props,t=e.file,n=e.maxFilenameEmLength,c=e.sharedLinkInfo,p=e.sizeClass,h=e.user,_=p===d.SizeClass.Large,v=_&&!!c&&!!c.ownerTeamName,g=_&&!c&&!!t.ts,y=o({fileinfo:!0,"u-pad-top-xxs":v||g,"u-pad-right-xs":!0});return i.createElement("div",{className:y},i.createElement("h1",{className:"filename"},r.em_snippet(s.get_filename(t),n),this.shouldShowStarred()?i.createElement(a.Star,{id:t.file_id,idType:u.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,ref:"Star",role:h.role,tooltipPosition:l.POSITIONS.BOTTOM}):null),v?i.createElement(m,{sharedLinkInfo:c}):null,g?i.createElement(f,{file:t,user:h}):null)},t})(i.Component);t.Title=_;var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"ownerText",{get:function(){var e=this.props.sharedLinkInfo,t=e.ownerName,n=e.ownerTeamName;return t?p._("from %(owner)s (%(team)s)").format({owner:r.em_snippet(t,24),team:r.em_snippet(n,18)}):p._("from %(team)s").format({team:r.em_snippet(n,18)})},enumerable:!0,configurable:!0}),t.prototype.render=function(){return i.createElement("span",{className:"file-modifier"},this.ownerText)},t})(i.Component),f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getModifierString=function(){var e=t.props.file,n=e.last_modified_name;return 2!==e.event_type?p._("Modified ",{comment:"Like 'Modified just now"}):n?p._("%(modifier)s edited ",{comment:"Like 'John Smith edited just now'"}).format({modifier:n}):p._("You edited ",{comment:"Like 'You edited just now'"})},t.redirectToVersionHistory=function(){var e=t.props,n=e.file,o=e.user;if(!o)throw new Error("no user set");s.redirectToVersionHistory(n,o)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.file;return i.createElement("span",{className:"file-modifier"},this.getModifierString(),i.createElement(l,{content:p._("View version history"),position:l.POSITIONS.BOTTOM,isTargetPositionFixed:!0},i.createElement("a",{className:"file-modifier",onClick:this.redirectToVersionHistory,href:"#"},s.getModifierString(e))))},t})(i.Component)}),define("modules/clean/react/file_viewer/utils",["require","exports","modules/clean/ajax","modules/clean/open_with","modules/clean/react/file_viewer/constants","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/constants/file_viewer","modules/core/browser"],function(e,t,n,o,i,r,s,a,l){"use strict";function c(e,t){return e.ns_id===t.ns_id&&e.sjid===t.sjid}function u(e){return e.ns_id+":"+e.sjid}function p(e){return"fq_path"in e}function d(e){return N.indexOf(e.preview_type)>-1}function h(e){return Array.isArray(e)?e.filter(function(e){return d(e)}).map(function(e){return e}):[]}function _(e,t){return a.WOPI_BUTTON_VISIBLE&&e.bytes<=o.MAX_SUPPORTED_FILE_SIZE_B&&null!==o.get_open_handler_for(e,t)}function m(e,t){return o.get_open_handler_for(e,t)}function f(e,t){var n=m(e,t),o=n.uri+"?hpt_click_ts="+Date.now();l.redirect(o)}function v(e,t){n.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})}function g(e,t){for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];for(var i in o)if(o.hasOwnProperty(i)){var r=o[i],s=r.extensions;if(s.indexOf(t)>-1)return{vendor:n,application:i}}}return null}function y(e,t,o){"acrobat_or_reader"===o?n.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:o,extension:e},subject_user:t}):n.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:o,extension:e},subject_user:t})}function E(){return null!=s}function S(e,t){return!!r.is_cached_and_locally_available(e,t)}function b(){return s.client_supports_open_in_file_browser()}function w(e,t){return r.get(e,t)}function C(e,t){var n=function(n){e.file_browser_display_name=n,t(e)},o=function(){return t(e)};s.file_browser_display_name(n,o)}function T(e,t,n,o,i){var r=function(e){e.is_locally_available?C(e,o):o(e)};s.check_file(e,t,n,r,i)}function A(e,n,o,i,r){if(t.UnityHelpers.isFileInUnityCache(e,n)){var s=t.UnityHelpers.getFileInfoFromUnityCache(e,n);s.is_locally_available&&null==s.file_browser_display_name?C(s,i):i(s)}else t.UnityHelpers.fetchUnityFileInfo(e,n,o,i,r)}function I(e,t,n,o){s.open_file(e,t,n,s.standard_open_file_handler,function(e){return s.standard_open_file_handler(!1)},o)}function P(e,t){if(e===i.SplitButtonActionLocation.MAIN){if(t===i.FileViewerPane.TITLE_BAR)return i.UserActionContextNames.TITLE_BAR_MAIN;if(t===i.FileViewerPane.PREVIEW_CONTENT)return i.UserActionContextNames.PREVIEW_CONTENT_MAIN}else if(e===i.SplitButtonActionLocation.SPLIT){if(t===i.FileViewerPane.TITLE_BAR)return i.UserActionContextNames.TITLE_BAR_SPLIT_BUTTON;if(t===i.FileViewerPane.PREVIEW_CONTENT)return i.UserActionContextNames.PREVIEW_CONTENT_SPLIT_BUTTON}return i.UserActionContextNames.UNKNOWN}function R(){var e=l.get_uri().path;return/^\/(home|work|personal|search)/.test(e)?i.PathContext.BROWSE:/^\/(s|scl\/fi)\//.test(e)?i.PathContext.SHARED_LINK_FILE:/^\/(sh|scl\/fo)\//.test(e)?i.PathContext.SHARED_LINK_FOLDER:/^\/sc\//.test(e)?i.PathContext.SHARED_LINK_COLLECTION:/^\/history/.test(e)?i.PathContext.VERSION_HISTORY:""}function O(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,function(e){e.style.display="none"})}Object.defineProperty(t,"__esModule",{value:!0});var N=["photo","video"];t.areFilesEqual=c,t.revisionKey=u,t.isBrowseFile=p,t.FlippableHelpers={isFlippableFile:d,filterFlippableFiles:h},t.OpenWithHelpers={canOpenWith:_,getOpenWithHandlerData:m,openWith:f},t.TooltipHelpers={fetchTooltipInfo:v,getVendorAndApplication:g,logImpression:y},t.UnityHelpers={isUnityEnabled:E,isFileInUnityCache:S,clientSupportsOpenInFileBrowser:b,getFileInfoFromUnityCache:w,fetchUnityFileInfo:T,getUnityFileInfo:A,openFile:I},t.getSplitButtonUserActionContext=P,t.determinePathContext=R,t.isResponsiveEnabled=function(){var e=R();return e!==i.PathContext.VERSION_HISTORY&&e!==i.PathContext.SHARED_LINK_COLLECTION&&(!(e===i.PathContext.BROWSE&&!a.RESPONSIVE_FILE_VIEWER_ENABLED)&&(!(e===i.PathContext.SHARED_LINK_FOLDER&&!a.RESPONSIVE_FOLDER_SHARED_LINK_ENABLED)&&!(e===i.PathContext.SHARED_LINK_FILE&&!a.RESPONSIVE_SHARED_LINK_ENABLED)))},t.cleanupPrerenderPreview=O}),define("modules/clean/react/file_viewer/version_history_file_actions",["require","exports","tslib","external/react","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button","modules/clean/react/title_bar/controls_container","modules/constants/file_viewer","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e;return this.props.canRestoreRevision&&(e=o.createElement("button",{ref:"restoreButton",className:"button-primary control__button restore-button",onClick:this.props.onRestoreRevision},l._("Restore"))),o.createElement(s.TitleBarControlsContainer,null,e,o.createElement(r.OpenButton,{file:this.props.file,user:this.props.user,isUnityDisabled:!0,isOpenWithDisabled:!0,location:i.FileViewerPane.TITLE_BAR,isMaestroDesign:a.MAESTRO_ENABLED}))},t})(o.Component);t.VersionHistoryFileActions=c}),define("modules/clean/react/gutter_attributions/attribution",["require","exports","tslib","external/react","modules/clean/avatar/style"],function(e,t,n,o,i){"use strict";function r(e){return 100*e+"%"}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"top",{get:function(){return r(this.props.attribution.area.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return r(this.props.attribution.area.height)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this.props.account?i.colorValueForAvatarName(this.props.account.name.displayName):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initials",{get:function(){return this.props.account?this.props.account.name.abbreviatedName:null},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e={top:this.top,height:this.height,color:this.color};return o.createElement("div",{className:"gutter-attributions-attribution",style:e},this.initials)},t})(o.Component);t.GutterAttributionsAttribution=s}),define("modules/clean/react/gutter_attributions/container",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/gutter_attributions/attribution"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.attributions.map(function(t,n){var i=e.props.accounts[t.accountId];return o.createElement(r.GutterAttributionsAttribution,{key:n,attribution:t,account:i})});return o.createElement("div",{className:"preview-document-page-gutter"},o.createElement("div",{className:"gutter-attributions-container"},t))},t})(o.Component),a=i(s,["/static/css/preview/gutter_attributions-vfl5ihuF3.css"]);t.GutterAttributionsContainer=a}),define("modules/clean/react/gutter_attributions/controller",["require","exports","tslib","external/react","modules/clean/accounts/store","modules/clean/attributions/actions","modules/clean/attributions/store","modules/clean/comments/models/preview_types","modules/clean/react/file_viewer/file_viewer_interface_controller"],function(e,t,n,o,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.onUpdateFromStore=function(){n.setState(n.getStateFromStore())},n.state=n.getStateFromStore(),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.unsubscribeFromAttributions=s.attributionsStore.addListener(this.onUpdateFromStore),this.unsubscribeFromAccounts=i.accountsStore.addListener(this.onUpdateFromStore),this.props.viewingUser&&r.loadAttributionsForFile(this.props.viewingUser,this.props.file)},t.prototype.componentDidMount=function(){this.fileViewerInterfaceController=new l.FileViewerInterfaceController(a.PDF,".react-file-viewer__preview .flex-preview-container"),this.sendAnnotations()},t.prototype.componentWillUpdate=function(e){e.viewingUser&&e.file!==this.props.file&&r.loadAttributionsForFile(e.viewingUser,e.file)},t.prototype.componentDidUpdate=function(e,t){this.sendAnnotations()},t.prototype.componentWillUnmount=function(){this.unsubscribeFromAttributions(),this.unsubscribeFromAccounts()},t.prototype.getStateFromStore=function(){var e=s.attributionsStore.getAttributionsForFile(this.props.file);return{attributions:e,accounts:e?e.map(function(e){return i.accountsStore.get(e.accountId)}).filter(function(e){return!!e}):[]}},t.prototype.sendAnnotations=function(){this.fileViewerInterfaceController.dispatchEvent("set-attributions",{attributions:this.state.attributions,accounts:this.state.accounts})},t.prototype.render=function(){return this.props.children?o.Children.only(this.props.children):null},t})(o.Component);t.GutterAttributionsController=c}),function(){define("modules/clean/react/onboarding_modal",["external/classnames","external/react","modules/core/i18n","modules/core/exception","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/slider"],function(e,t,n,o,i,r,s){var a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b,assert;return b=n._,assert=o.assert,l=i.button,h=r.Modal,p=s.IndicatorGroup,S=s.Slides,y=s.Slider,m=s.NavButtonGroup,t.DOM,d=t.createFactory(h),a=t.createFactory(l),g=t.createFactory(y),E=t.createFactory(S),u=t.createFactory(p),_=t.createFactory(m),c=640,v=t.createClass({displayName:"OnboardingSlider",mixins:[t.addons.PureRenderMixin],propTypes:{width:t.PropTypes.number.isRequired,height:t.PropTypes.number,className:t.PropTypes.string,onSlideChange:t.PropTypes.func,onSlideEnd:t.PropTypes.func,initialSlideIndex:t.PropTypes.number,children:function(e,n,o){var i;return i=t.Children.count(e[n]),assert(i>0,o+" has no slide to show")}},getDefaultProps:function(){return{initialSlideIndex:0}},getInitialState:function(){return{currentSlideIndex:this.props.initialSlideIndex}},isAtLastSlide:function(){return this.state.currentSlideIndex+1===this.getSlideCount()},getSlideCount:function(){return t.Children.count(this.props.children)},gotoSlide:function(e){if(e!==this.state.currentSlideIndex)return assert(0<=e&&e<this.getSlideCount(),"Invalid slide index: "+e),this.setState({currentSlideIndex:e},(function(t){return function(){var n;return"function"==typeof(n=t.props).onSlideChange?n.onSlideChange(e):void 0}})(this))},prevSlide:function(){return this.gotoSlide(this.state.currentSlideIndex-1)},nextSlide:function(){return this.gotoSlide(this.state.currentSlideIndex+1)},render:function(){return g({className:this.props.className},E({width:this.props.width,height:this.props.height,currentSlideIndex:this.state.currentSlideIndex},this.props.children),u({slideCount:this.getSlideCount(),currentSlideIndex:this.state.currentSlideIndex,onIndicatorClick:this.gotoSlide}),_(null,this.isAtLastSlide()?a({className:"is-done",onClick:this.props.onSlideEnd},b("Got it")):a({className:"is-next",onClick:this.nextSlide},b("Next"))))}}),f=t.createFactory(v),t.createClass({displayName:"OnboardingModal",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string,onClose:t.PropTypes.func,slideWidth:t.PropTypes.number,slideHeight:t.PropTypes.number,initialSlideIndex:t.PropTypes.number},getDefaultProps:function(){return{slideWidth:c}},closeModal:function(){var e;return h.close(),"function"==typeof(e=this.props).onClose?e.onClose():void 0},render:function(){return d({acceptButtonText:null,onDismiss:this.props.onClose,style:"clean",className:this.props.className,clickOutToClose:!1},f({initialSlideIndex:this.props.initialSlideIndex,width:this.props.slideWidth,height:this.props.slideHeight,onSlideEnd:this.closeModal},this.props.children))}})})}.call(this),define("modules/clean/react/open_in_app/banner",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/open_in_app/actions","modules/core/i18n"],function(e,t,n,o,i,r,s){"use strict"
;Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleAppRedirect=function(){r.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){r.cleanUp()},t.prototype.render=function(){return o.createElement("div",{className:"open-in-app-banner-container"},o.createElement("button",{className:"button-as-link open-in-app-banner-text",onClick:this.handleAppRedirect},this.state.showInstallAppText?s._("Get the Dropbox App"):s._("View In App")),o.createElement("button",{className:"button-as-link open-in-app-banner-close",onClick:this.props.onClose},o.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("title",null,"Close"),o.createElement("path",{d:"M12 10.586l-4.95-4.95L5.636 7.05l4.95 4.95-4.95 4.95 1.414 1.414 4.95-4.95 4.95 4.95 1.414-1.414-4.95-4.95 4.95-4.95-1.414-1.414z",fill:"#ffffff",fillRule:"evenodd"}))))},t})(o.Component),l=["/static/css/open_in_app/banner-vflrVdKzC.css"];t.OpenInAppBanner=i(a,l)}),define("modules/clean/react/open_in_app/button",["require","exports","tslib","external/react","modules/clean/open_in_app/actions","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){var n=e.call(this,t)||this;return n.handleClick=function(){i.openInApp(n.props.urls,{onAppNeeded:function(){return n.setState({showInstallAppText:!0})},onAppInstalled:function(){return n.setState({showInstallAppText:!1})}})},n.state={showInstallAppText:!1},n}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){i.cleanUp()},t.prototype.render=function(){return o.createElement("button",{className:"button-primary control__button open-in-app-button",onClick:this.handleClick},this.state.showInstallAppText?r._("Install app?"):r._("Open in app"))},t})(o.Component);t.OpenInAppButton=s}),define("modules/clean/react/pass/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/pass/constants"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(){}return e.passPermissionRequest=function(e,t,i){n.dispatch({type:o.ActionTypes.PASS_PERMISSION_REQUEST,data:{fileId:e,nsId:t,sjid:i}})},e.setPassPermissions=function(e,t){n.dispatch({type:o.ActionTypes.SET_PASS_PERMISSIONS,data:{fileId:e,passPermissionObject:t}})},e.fetchPassRequest=function(e,t){n.dispatch({type:o.ActionTypes.FETCH_PASS_REQUEST,data:{nsId:e,sjid:t}})},e.fetchPassError=function(e,t){n.dispatch({type:o.ActionTypes.FETCH_PASS_ERROR,data:{nsId:e,sjid:t}})},e.fetchPassConcluded=function(e,t){n.dispatch({type:o.ActionTypes.FETCH_PASS_CONCLUDED,data:{nsId:e,sjid:t}})},e.receivePresenceDelta=function(e,t,i,r,s){n.dispatch({type:o.ActionTypes.RECEIVE_PRESENCE_DELTA,data:{userId:e,nsId:t,sjid:i,onlineUniqueUsers:r,offlineUniqueUsers:s}})},e.receivePresenceSnapshot=function(e,t,i,r){n.dispatch({type:o.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT,data:{userId:e,nsId:t,sjid:i,onlineUniqueUsers:r}})},e.resetPassInfo=function(e,t){n.dispatch({type:o.ActionTypes.RESET_PASS_INFO,data:{nsId:e,sjid:t}})},e.updateSeenStateInfo=function(e,t,i,r){n.dispatch({type:o.ActionTypes.UPDATE_SEEN_STATE_INFO,data:{nsId:e,sjid:t,seenStateInfo:i,seenStateCursor:r}})},e.updateSeenStateInfoContinue=function(e,t,i,r){n.dispatch({type:o.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE,data:{nsId:e,sjid:t,seenStateInfo:i,seenStateCursor:r}})},e.discontinueSeenStateInfo=function(e,t){n.dispatch({type:o.ActionTypes.DISCONTINUE_SEEN_STATE_INFO,data:{nsId:e,sjid:t}})},e.updateSeenStateUnavailable=function(e,t,i){n.dispatch({type:o.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE,data:{userId:e,nsId:t,sjid:i}})},e})();t.PassActions=i}),define("modules/clean/react/pass/avatars",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/style","modules/clean/avatar/viewer_avatar","modules/clean/datetime","modules/clean/em_string","modules/clean/react/pass/constants","modules/clean/react/title_bubble","modules/clean/react_format","modules/core/browser","modules/core/user_i18n","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getTooltipBackgroundColor=function(){},t.prototype.render=function(){var e=this.wrapAvatarWithTooltip();return o.createElement("div",{className:"react-pass__face-container"},e)},t.prototype.wrapAvatarWithTooltip=function(){return o.createElement(d,{content:this.getTooltipElement(),position:d.POSITIONS.BOTTOM,distanceFromTarget:9,isTargetPositionFixed:!0,onMouseEnter:this.props.onMouseEnter,className:this.getTooltipClass(),backgroundColor:this.getTooltipBackgroundColor()},o.createElement("button",{className:"pass-facepile-avatar"},this.getAvatar()))},t})(o.Component),g=(function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.offlineTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s",{comment:'Format like "userName <newline> Viewed 5 days ago"'}).replace("%(ago)s",c.ago(1e3*this.props.userInfo.whenLastSeen,!1,!0,!0))},t.prototype.onlineTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Viewing now",{comment:'Format like "user_name <newline> Viewing now"'})},t.prototype.hasAccessTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Has access")},t.prototype.neverViewedTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Never viewed")},t.prototype.ownerTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Owner",{comment:'Format like "user_name <newline> Owner"'})},t.prototype.canEditTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Can edit",{comment:'Format like "user_name <newline> Can edit"'})},t.prototype.canCommentTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Can comment",{comment:'Format like "user_name <newline> Can comment"'})},t.prototype.canViewTooltipTemplate=function(){return f._("<b>%(user_name)s</b> <newline/> Can view",{comment:'Format like "user_name <newline> Can view"'})},t.prototype.getUserAvatarProps=function(){var e=this.props.userInfo,t=e.displayName,i=e.photoUrl,a=e.isActive,l={dimension:32,initials:m.getInitials(t),name:t,shape:"CIRCLE"},c=s;a||(l.optionalClass="c-avatar--inactive",_.msie&&(c=r,l.color="#7B8994"));var u=o.createElement(c,n.__assign({},l));return a||(u=o.createElement("span",{className:"c-avatar-initials-wrapper"},u)),{dimension:32,photoUrl:i,defaultAvatar:u,optionalClass:l.optionalClass}},t.prototype.getAvatar=function(){var e=this.getUserAvatarProps();return this.props.userInfo.isViewer?o.createElement(l,n.__assign({},e)):o.createElement(i,n.__assign({},e))},t.prototype.getTooltipClass=function(){return"seen-state-title-bubble"},t.prototype.getTooltipBackgroundColor=function(){return a.colorValueForAvatarName(this.props.userInfo.displayName)},t.prototype.getTooltipElement=function(){var e;e=this.props.userInfo.isActive?this.onlineTooltipTemplate():this.props.inPresenceOnlyMode?this.hasAccessTooltipTemplate():null!=this.props.userInfo.whenLastSeen?this.offlineTooltipTemplate():this.neverViewedTooltipTemplate();var t=h.reactFormat(e,{user_name:u.em_snippet(this.props.userInfo.displayName,10),b:o.createElement("b",{key:"thebold"}),newline:o.createElement("br",{key:"thenewline"})});return o.createElement("span",null,t)},t})(v);t.UserAvatar=g;var y=(function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.prototype.getDisplayNum=function(){return this.props.moreFacepileCount>=p.MAX_OVERFLOW_BUTTON_INDICATOR?p.MAX_OVERFLOW_BUTTON_INDICATOR:this.props.moreFacepileCount},t.prototype.getMoreFacepileCountText=function(){return this.props.moreFacepileCount>=p.MAX_OVERFLOW_BUTTON_INDICATOR?p.MAX_OVERFLOW_BUTTON_INDICATOR+"+":""+this.props.moreFacepileCount},t.prototype.getAvatar=function(){return o.createElement(r,{dimension:32,initials:this.getMoreFacepileCountText(),color:"#7B8994",shape:"CIRCLE",optionalClass:"c-avatar--overflow"})},t.prototype.getTooltipClass=function(){return"seen-state-title-bubble facepile-overflow"},t.prototype.getTooltipElement=function(){return f.ungettext("%(display_num)s other","%(display_num)s others",this.getDisplayNum()).format({display_num:this.getMoreFacepileCountText()})},t})(v);t.OverflowAvatar=y}),define("modules/clean/react/pass/constants",["require","exports"],function(e,t){"use strict";function n(e){return[a.SEEN_STATE_SUCCESS,a.SEEN_STATE_DISALLOWED,a.PASS_SUCCESS,a.PASS_MIXED_SUCCESS,a.CONCLUDED].indexOf(e)!==-1}function o(e){return[a.PASS_SUCCESS,a.PASS_MIXED_SUCCESS,a.CONCLUDED].indexOf(e)!==-1}function i(e){return[a.PASS_SUCCESS,a.PASS_MIXED_SUCCESS,a.ERROR,a.CONCLUDED].indexOf(e)!==-1}function r(e){return[a.SEEN_STATE_DISALLOWED,a.PASS_MIXED_SUCCESS].indexOf(e)!==-1}function s(e){return e===a.ERROR}Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes={PASS_PERMISSION_REQUEST:"PASS_PERMISSION_REQUEST",SET_PASS_PERMISSIONS:"SET_PASS_PERMISSIONS",FETCH_PASS_CONCLUDED:"FETCH_PASS_CONCLUDED",FETCH_PASS_REQUEST:"FETCH_PASS_REQUEST",FETCH_PASS_ERROR:"FETCH_PASS_ERROR",RECEIVE_PRESENCE_DELTA:"RECEIVE_PRESENCE_DELTA",RECEIVE_PRESENCE_SNAPSHOT:"RECEIVE_PRESENCE_SNAPSHOT",RESET_PASS_INFO:"RESET_PASS_INFO",UPDATE_SEEN_STATE_INFO:"UPDATE_SEEN_STATE_INFO",UPDATE_SEEN_STATE_INFO_CONTINUE:"UPDATE_SEEN_STATE_INFO_CONTINUE",DISCONTINUE_SEEN_STATE_INFO:"DISCONTINUE_SEEN_STATE_INFO",UPDATE_SEEN_STATE_UNAVAILABLE:"FETCH_SEEN_STATE_UNAVAILABLE"},t.EventTypes={PASS_CLICK:"PASS_CLICK",PASS_SHOWN:"PASS_SHOWN",PASS_HOVER:"PASS_HOVER"};var a;(function(e){e[e.FETCHING=1]="FETCHING",e[e.ERROR=2]="ERROR",e[e.SEEN_STATE_SUCCESS=3]="SEEN_STATE_SUCCESS",e[e.SEEN_STATE_DISALLOWED=4]="SEEN_STATE_DISALLOWED",e[e.PRESENCE_SUCCESS=5]="PRESENCE_SUCCESS",e[e.PASS_SUCCESS=6]="PASS_SUCCESS",e[e.PASS_MIXED_SUCCESS=7]="PASS_MIXED_SUCCESS",e[e.CONCLUDED=8]="CONCLUDED"})(a=t.PASS_FETCHING_STATUS||(t.PASS_FETCHING_STATUS={})),t.fetchingStatusSeenStateIsComplete=n,t.fetchingStatusIsSuccessful=o,t.fetchingStatusIsComplete=i,t.fetchingStatusIndicatesPresenceOnlyMode=r,t.fetchingStatusIsError=s,t.MAX_FACES_NORMAL=5,t.MAX_FACES_COMPACT=2,t.MAX_OVERFLOW_BUTTON_INDICATOR=99,t.FACEPILE_CLASSNAME="react-pass__facepile",t.PRESENCE_RECEIVED_CLASSNAME="facepile-presence-received"}),define("modules/clean/react/pass/data_helpers",["require","exports","jquery","external/underscore","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/clean/api_v2/error","modules/clean/api_v2/types","modules/clean/beacon","modules/clean/react/file_viewer/utils","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/store","modules/clean/react/pass/actions","modules/clean/react/pass/store","modules/clean/react/pass/constants","modules/clean/sharing/actions/sharing_actions","modules/clean/uuid","modules/clean/viewer","modules/constants/file_viewer","modules/constants/python"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S){"use strict";function b(e,t){_.PassActions.resetPassInfo(e,t),_.PassActions.fetchPassError(e,t)}function w(e,t){_.PassActions.resetPassInfo(e,t),_.PassActions.fetchPassConcluded(e,t)}function C(e,t,n,o,i,a){return e?new s.ApiV2RootAwareClient(i,a).rpc(e.id,t,o):new r.ApiV2Client(i,a).rpc(null,n,o)}function T(e){return"sjid:"+e.toString()}function A(e,t,n){return{ns_id:e,file_identifier:T(t),url:n}}Object.defineProperty(t,"__esModule",{value:!0});var I=f.MAX_FACES_NORMAL+f.MAX_OVERFLOW_BUTTON_INDICATOR+1,P=(function(){function e(){}return e.setup=function(t){var n=this,o=t.user,i=t.fileData,r=t.prevFileData,s=t.shouldWritePresence,a=void 0===s||s,l=t.limit,c=void 0===l?103:l;u.determinePathContext()!==d.PathContext.SHARED_LINK_COLLECTION&&setTimeout(function(){var t=i.file,s=t.file_id,l=t.ns_id,u=t.sjid;if(p.is_pass_enabled(o)){var d={canReadPresence:!0,canReadSeenState:!0,canWritePresence:a,canWriteAnonymousPresence:!1};_.PassActions.fetchPassRequest(l,u),n.kickoffPassRequests({user:o,fileData:i,prevFileData:r,passPermissionObject:d,limit:c})}else n.shouldUseGaBehavior(o,a)&&(_.PassActions.passPermissionRequest(s,l,u),e.fetchPassStatus({user:o,fileData:i,prevFileData:r,shouldWritePresence:a,limit:c}))},0)},e.teardown=function(e){var t=e.user,o=e.fileData,i=e.async,r=e.shouldWritePresence,s=void 0===r||r,a=o.file,l=o.url;if(p.is_pass_enabled(t)||this.shouldUseGaBehavior(t,s)){if(this.shouldUseGaBehavior(t,s)){var c=a.file_id,u=m.getPassPermissions(c),d=m.isPassPermissionsPending(c);if(null==u||d||!u.canWritePresence&&!u.canWriteAnonymousPresence)return}n(window).off("beforeunload.passpresence");var h=t&&t.account_id,_=new R(a,h,l);O.shutdown({beaconFileData:_,user:t,async:i,shouldWritePresence:s})}},e.shouldUseGaBehavior=function(e,t){return p.is_pass_ga_receive_enabled(e)||null==e&&t},e.fetchPassStatus=function(e){var t=this,n=e.user,o=e.fileData,i=e.prevFileData,r=e.shouldWritePresence,s=void 0===r||r,l=e.limit,c=void 0===l?103:l,u=o.file.ns_id,p=o.file.sjid,d=o.url;return C(n,"seen_state/get_pass_status","seen_state/logged_out/get_pass_status",{file_infos:[{ns_id:u,file_identifier:T(p),url:d}]}).then(function(e){var r=e[0],a={canReadPresence:r.can_read_presence,canReadSeenState:r.can_read_seen_state,canWritePresence:r.can_write_presence,canWriteAnonymousPresence:r.can_write_anonymous_presence};t.kickoffPassRequests({user:n,fileData:o,prevFileData:i,passPermissionObject:a,limit:c,shouldWritePresence:s})}).catch(a.catchApiError(function(){b(u,p)}))},e.kickoffPassRequests=function(e){var t=this,o=e.user,i=e.fileData,r=e.prevFileData,s=e.passPermissionObject,a=e.limit,l=e.shouldWritePresence,c=void 0===l||l,u=i.file,p=i.url;_.PassActions.setPassPermissions(u.file_id,s);var d=u.file_id||u.fq_path,h=o&&o.account_id,m=new R(u,h,p);if(o&&(d&&s.canReadPresence&&(v.SharingActions.fetchFileMemberCount({user:o,contentId:d,limit:I,countGroupsAsMembers:!1,url:p}),v.SharingActions.listMembers({user:o,contentId:d,isFolder:!1,limit:6,url:p})),s.canReadSeenState?N.fetchSeenStateInfo(o,u.ns_id,u.sjid,a,p):_.PassActions.updateSeenStateUnavailable(o.id,u.ns_id,u.sjid),s.canReadPresence&&O.receiveBeaconData({beaconFileData:m,user:o})),c&&(s.canWritePresence||s.canWriteAnonymousPresence)){var f=r&&new R(r.file,h,r.url),g=!s.canWritePresence;O.transmitBeaconData({beaconFileData:m,prevBeaconFileData:f,accountId:h,isAnonymous:g}),n(window).off("beforeunload.passpresence"),n(window).on("beforeunload.passpresence",function(e){t.teardown({user:o,fileData:i,async:!1,shouldWritePresence:!0}),e.returnValue=void 0})}s.canReadPresence||s.canReadSeenState||w(u.ns_id,u.sjid)},e})();t.PassHelpers=P;var R=(function(){function e(e,t,n){var o=n||"",i=t||"";this.authKey="pass~"+i+"~"+o,this.nsId=e.ns_id,this.sjid=e.sjid,this.context=e.beacon_context}return e})();t.BeaconFileData=R;var O=(function(){function e(){}return e.shutdown=function(e){for(var t=e.beaconFileData,n=e.user,o=e.async,i=e.shouldWritePresence,r=void 0===i||i,s=[],a=0,l=[this.anonTransmitterData,this.identifiedTransmitterData];a<l.length;a++){var c=l[a];c&&(s.push([c.beaconUserId,c.identifier]),c.transmitter.stop())}delete this.anonTransmitterData,delete this.identifiedTransmitterData,s.length>0&&!y.get_viewer().is_assume_user_session&&r&&N.updateSeenStateOnResign(n,t,o,s),this.receiver&&(this.receiver.stop(),delete this.receiver)},e.receiveBeaconData=function(e){var t=this,n=e.beaconFileData,o=e.user;i.SilentBackgroundRequest({url:"/get_pass_receiver_token",type:"GET",dataType:"json",data:{account_id:o.account_id,auth_key:n.authKey,context:n.context},success:function(e){if(e.error)b(n.nsId,n.sjid);else{var i=e.token,r=[new c.PresenceParams(c.PresenceType.Context,o.account_id,t.APP,n.context,i)];t.receiver&&t.receiver.stop(),t.receiver=new c.Receiver(r,function(e){return t.onUpdate(e,o.id,n)},function(){return t.receiveBeaconData({beaconFileData:n,user:o})}),t.receiver.start()}}})},e.onUpdate=function(e,t,n){var o=e[0];if(o.delta){var i=this.parseBeaconUpdates(o.delta);_.PassActions.receivePresenceDelta(t,n.nsId,n.sjid,i.onlineUniqueUsers,i.offlineUniqueUsers)}else if(o.snapshot){var i=this.parseBeaconUpdates(o.snapshot);_.PassActions.receivePresenceSnapshot(t,n.nsId,n.sjid,i.onlineUniqueUsers)}},e.parseBeaconUpdates=function(e){for(var t={},n={},o=0,i=e;o<i.length;o++){var r=i[o],s=r.agent,a=s.user_id,l=s.source.identifier;r.status===S.BEACON_ONLINE_STATUS?(a in t||(t[a]={}),t[a][l]=!0):r.status===S.BEACON_OFFLINE_STATUS&&(a in n||(n[a]={}),n[a][l]=!0)}return{onlineUniqueUsers:t,offlineUniqueUsers:n}},e.transmitBeaconData=function(e){var t=e.beaconFileData,n=e.prevBeaconFileData,o=e.accountId,i=e.isAnonymous,r=void 0!==i&&i;if(!y.get_viewer().is_assume_user_session){var s=r?this.anonTransmitterData:this.identifiedTransmitterData;if(s){var a=[];n&&a.push(this.getAgentStatusForFile(s,n,S.BEACON_OFFLINE_STATUS)),a.push(this.getAgentStatusForFile(s,t,S.BEACON_ONLINE_STATUS)),s.transmitter.add_or_update_agents(a)}else this.fetchTransmitterToken(o,t,r)}},e.getAgentStatusForFile=function(e,t,n){var o=new c.Source(this.PLATFORM,this.SURFACE,e.identifier),i=new c.Agent(e.beaconUserId,this.APP,t.context,o);return new c.AgentStatus(i,n,t.authKey)},e.fetchTransmitterToken=function(e,t,n){var r=this;i.SilentBackgroundRequest({url:"/get_pass_transmitter_token",type:"GET",dataType:"json",data:{account_id:e,context:t.context,auth_key:t.authKey},success:function(i){if(i.error)b(t.nsId,t.sjid);else{var s=i.token,a=n?r.anonTransmitterData:r.identifiedTransmitterData;a?a.transmitter.update_token(s):(a={identifier:g.v4({allowInsecure:!0}),beaconUserId:i.beacon_user_id,transmitter:new c.Transmitter(s,function(){return r.fetchTransmitterToken(e,t,n)},o.noop)},n?r.anonTransmitterData=a:r.identifiedTransmitterData=a),t&&a.transmitter.add_or_update_agents([r.getAgentStatusForFile(a,t,S.BEACON_ONLINE_STATUS)]),a.transmitter.start()}}})},e})();O.APP="harmony",O.PLATFORM=c.Platforms.WEB,O.SURFACE="file_viewer",O.receiver=null,O.anonTransmitterData=null,O.identifiedTransmitterData=null,t.BeaconPresenceHelpers=O,t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT=9e3;var N=(function(){function e(){}return e.constructFakeSeenStateInfo=function(e,t,n){for(var i=n.seen_states,r=[],s=0,a=i;s<a.length;s++){var l=a[s];r.push(l.seen_state_user.user_id)}for(var c=0,u=e;c<u.length;c++){var d=u[c];if(!o.contains(r,d.user_id)){d.sharing_access_type&&(d.sharing_access_type=this.convertToUnion(d.sharing_access_type));var h=p.is_pass_fa_integration_enabled()?[{ts:t}]:[],_={seen_state_user:d,when_last_seen:t,seen_events:h};i.unshift(_)}}return n.seen_states=i,n},e.convertToUnion=function(e){return e?l.Union.parse(e):null},e.fetchSeenStateUsers=function(e,t,n,o,i){var r=this,l=Date.now()/1e3,c=void 0;return h.FileViewerStore.instance.getCurrentFile()&&h.FileViewerStore.instance.getSharedLinkInfo()&&(c=h.FileViewerStore.instance.getSharedLinkInfo().url),(new s.ApiV2RootAwareClient).rpc(e,"seen_state/get_seen_state_users",{user_ids:n,file_info:A(o,i,c)}).catch(a.catchApiError(function(){return b(o,i),Promise.reject(void 0)})).then(function(e){var n=r.constructFakeSeenStateInfo(e,l,t);_.PassActions.updateSeenStateInfo(o,i,n)})},e.processAndUpdateSeenStateInfo=function(e,t,n,o,i){var r=o[0],s=r.seen_state_error;if(s)"seen_state_disabled"===l.Union.parse(s).type?_.PassActions.updateSeenStateUnavailable(e.id,t,n):i?_.PassActions.discontinueSeenStateInfo(t,n):b(t,n);else{for(var a=r.seen_state_info,c=0,u=a.seen_states;c<u.length;c++){var p=u[c];p.seen_state_user.sharing_access_type=this.convertToUnion(p.seen_state_user.sharing_access_type)}var d=r.seen_state_cursor;i?_.PassActions.updateSeenStateInfoContinue(t,n,a,d):_.PassActions.updateSeenStateInfo(t,n,a,d)}},e.fetchSeenStateInfo=function(e,t,n,o,i){var r=this;return(new s.ApiV2RootAwareClient).rpc(e.id,"seen_state/get_seen_state_info",{file_infos:[A(t,n,i)],limit:o}).catch(a.catchApiError(function(){return b(t,n),Promise.reject(void 0)})).then(function(o){r.processAndUpdateSeenStateInfo(e,t,n,o,!1)})},e.fetchSeenStateInfoContinue=function(e,t,n,o,i,r){var l=this;return(new s.ApiV2RootAwareClient).rpc(e.id,"seen_state/get_seen_state_info/continue",{file_infos:[A(t,n,r)],cursor:o,limit:i}).catch(a.catchApiError(function(){return _.PassActions.discontinueSeenStateInfo(t,n),Promise.reject(void 0)})).then(function(o){l.processAndUpdateSeenStateInfo(e,t,n,o,!0)})},e.getCoachmark=function(e,t,n,o,i){return(new s.ApiV2RootAwareClient).rpc(e,"seen_state/get_coachmark_info",{file_info:A(t,n,o)}).catch(a.catchApiError(function(){return Promise.reject(void 0)})).then(function(e){i(e.type_with_data[".tag"])})},e.logCoachmarkInteraction=function(e,t,n,o,i,r){return(new s.ApiV2RootAwareClient).rpc(e,"seen_state/log_coachmark_interaction",{type:i,interaction:r,file_info:A(t,n,o)}).catch(a.catchApiError(function(){return Promise.reject(void 0)}))},e.updateSeenStateOnResign=function(e,n,o,i){var r=o?"async":"sync",s=void 0;o||(s=E.PASS_RESIGN_ONBEFOREUNLOAD_TIMEOUT||t.DEFAULT_SYNCHRONOUS_MODE_TIMEOUT);for(var a=[],l=0,c=i;l<c.length;l++){var u=c[l],p=u[0],d=u[1];a.push({beacon_user_id:p,context:n.context,auth_key:n.authKey,identifier:d})}return C(e,"seen_state/update_timestamps_and_mark_offline","seen_state/logged_out/mark_offline",{beacon_infos:a},r,s)},e})();t.SeenStateHelpers=N}),define("modules/clean/react/pass/event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passEventEmitter=new n}),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},o=[].slice;define("modules/clean/react/pass/store",["external/underscore","modules/clean/flux/base_store","modules/clean/previews/util","modules/clean/react/file_viewer/store","modules/clean/react/pass/constants","modules/clean/react/pass/types","modules/clean/react/pass/utils","modules/clean/sharing/action_types","modules/core/exception"],function(t,i,r,s,a,l,c,u,p){var d,h,_,m,f;return s.FileViewerStore,d=a.ActionTypes,_=a.PASS_FETCHING_STATUS,m=l.PASS_PERMISSION_PENDING_STATUS,h=c.AnonymousViewerUtils,u.ShareModalActionTypes,f=(function(){function e(){this._userIdToUniqueIds={}}return e.prototype.addUniqueUser=function(e,t){return e in this._userIdToUniqueIds||(this._userIdToUniqueIds[e]={}),this._userIdToUniqueIds[e][t]=!0},e.prototype.removeUniqueUser=function(e,t){if(e in this._userIdToUniqueIds&&t in this._userIdToUniqueIds[e]&&(delete this._userIdToUniqueIds[e][t],!Object.keys(this._userIdToUniqueIds[e]).length))return delete this._userIdToUniqueIds[e]},e.prototype.getOnlineUserIds=function(){return Object.keys(this._userIdToUniqueIds)},e})(),new((function(i){function s(e){s.__super__.constructor.call(this,e),this._seenStateInfos={},this._seenStateCursors={},this._presenceInfos={},this._passFetchingStatusMap={},this._userIdsWithoutSeenStateInfo={},this._passPermissions={}}return e(s,i),s.prototype.presence=function(e,t){var n;return n=this._fileKey(e,t),n in this._presenceInfos?this._presenceInfos[n].getOnlineUserIds():null},s.prototype.seenStateInfo=function(e,t){var n;return n=this._fileKey(e,t),this._seenStateInfos[n]||null},s.prototype.identifiedSeenStateInfo=function(e,n){var o,i;return o=this._fileKey(e,n),o in this._seenStateInfos?(i=t.reject(this._seenStateInfos[o].seen_states,h.isAnonymousSeenState),{seen_states:i}):null},s.prototype.seenStateCursorHasNext=function(e,t){var n;return n=this._fileKey(e,t),n in this._seenStateCursors?this._seenStateCursors[n].has_next:null},s.prototype.seenStateCursorState=function(e,t){var n;return n=this._fileKey(e,t),n in this._seenStateCursors?this._seenStateCursors[n].cursor_state:null},s.prototype.passFetchingStatus=function(e,t){var n;return n=this._fileKey(e,t),this._passFetchingStatusMap[n]||null},s.prototype.getLinkAndGroupInfo=function(e,t){var n,o,i,r,s,a,l,c,u,p,d,_,m;if(n=this._fileKey(e,t),_=this._seenStateInfos[n],!_)return[null,null];for(u=[],r={},p=this._seenStateInfos[n].seen_states,s=0,l=p.length;s<l;s++)if(m=p[s],!h.isAnonymousSeenState(m))switch(null!=(d=m.seen_state_user.sharing_access_type)?d.type:void 0){case"link_only":u.push(m);break;case"member_access":for(i=m.seen_state_user.sharing_access_type.value||[],a=0,c=i.length;a<c;a++)o=i[a],o in r||(r[o]=[]),r[o].push(m)}return[u,r]},s.prototype.anonymousPresence=function(e,t){var n;return n=this._fileKey(e,t),n in this._presenceInfos?h.getAnonymousUserIds(this._presenceInfos[n].getOnlineUserIds()):null},s.prototype.userIdsWithoutSeenStateInfo=function(e,t){return this._userIdsWithoutSeenStateInfo[this._fileKey(e,t)]||[]},s.prototype.isPassPermissionsPending=function(e){return this._passPermissions[e]===m},s.prototype.getPassPermissions=function(e){return this._passPermissions[e]},s.prototype._resetPassInfo=function(e,t){var n;return n=this._fileKey(e,t),delete this._seenStateInfos[n],delete this._seenStateCursors[n],delete this._presenceInfos[n],delete this._passFetchingStatusMap[n],delete this._passPermissions[n],delete this._userIdsWithoutSeenStateInfo[n],this.emit_change()},s.prototype._fileKey=function(e,t){return e+":"+t},s.prototype._setPassPermissionRequest=function(e,t,n){return this._passPermissions[e]=m,this._setPassFetchingStatus(t,n,_.FETCHING)},s.prototype._setPassPermissions=function(e,t){return this._passPermissions[e]=t,this.emit_change()},s.prototype._receivePresenceDelta=function(e,t,n,o,i){var r,s,a;return p.assert((a=this.passFetchingStatus(t,n))!==_.FETCHING&&null!==a,"Before handling a presence delta, you must call _assurePresenceSuccessRegistered"),r=this._fileKey(t,n),s=this._getOnlineUsersForFileKey(r),this._updatePresenceInfos(r,o,i),this._updateUserIdsWithoutSeenStateInfo(e,t,n,s),this.emit_change()},s.prototype._receivePresenceSnapshot=function(e,t,n,o){var i,r,s;return p.assert((s=this.passFetchingStatus(t,n))!==_.FETCHING&&null!==s,"Before handling a presence snapshot, you must call _assurePresenceSuccessRegistered"),i=this._fileKey(t,n),r=this._getOnlineUsersForFileKey(i),this._presenceInfos[i]=new f,this._updatePresenceInfos(i,o,[]),this._updateUserIdsWithoutSeenStateInfo(e,t,n,r),this.emit_change()},s.prototype._getOnlineUsersForFileKey=function(e){return e in this._presenceInfos||(this._presenceInfos[e]=new f),this._presenceInfos[e].getOnlineUserIds()},s.prototype._updatePresenceInfos=function(e,t,n){var o,i,r,s,a,l;for(i in n){l=n[i];for(a in l)o=l[a],this._presenceInfos[e].removeUniqueUser(i,a)}s=[];for(r in t)l=t[r],s.push(function(){var t;t=[];for(a in l)o=l[a],t.push(this._presenceInfos[e].addUniqueUser(r,a));return t}.call(this));return s},s.prototype._updateUserIdsWithoutSeenStateInfo=function(e,n,o,i){var r,s,a,l,c,u,p,d,m,f;return a=this._fileKey(n,o),m=h.filterAnonymousUserIds(this._getOnlineUsersForFileKey(a)),c=h.filterAnonymousUserIds(i),s=t.difference(c,m),l=t.difference(m,c),a in this._seenStateInfos?(u=this.passFetchingStatus(n,o))===_.SEEN_STATE_DISALLOWED||u===_.PASS_MIXED_SUCCESS?(p=this._createMinimalBaseSeenStateInfo(a,m),f=p.userIdsWithoutSeenStateInfo,r=p.baseSeenStateInfo,this._updateSeenStateInfo(n,o,r)):(d=this._makeSeenStateAgreeWithUpdatedPresence(a,m,s,l),f=d.userIdsWithoutSeenStateInfo,r=d.baseSeenStateInfo):f=[],this._userIdsWithoutSeenStateInfo[a]=f},s.prototype._makeSeenStateAgreeWithUpdatedPresence=function(e,t,i,s){var a,l,c,u,p,d,h,_,m,f,v,g,y;for(g=[],a=this._seenStateInfos[e],y=a.seen_states,_=[],d=[],p=[],h=Date.now()/1e3,c=l=0,u=y.length;l<u;c=++l)f=y[c],v=f.seen_state_user.user_id,g.push(v),n.call(s,v)>=0?(f.when_last_seen=h,r.is_pass_fa_integration_enabled()&&(f.seen_events=f.seen_events||[],f.seen_events.push({ts:h})),d.push(f)):n.call(i,v)>=0?(f.when_last_seen=h,r.is_pass_fa_integration_enabled()&&(f.seen_events=f.seen_events||[],f.seen_events.push({ts:h})),p.push(f)):_.push(f);return a.seen_states=o.call(d).concat(o.call(p),o.call(_)),{userIdsWithoutSeenStateInfo:(function(){var e,o,i;for(i=[],e=0,o=t.length;e<o;e++)m=t[e],n.call(g,m)<0&&i.push(m);return i})(),baseSeenStateInfo:a}},s.prototype._createMinimalBaseSeenStateInfo=function(e,o){var i,r,s,a,l,c,u,p;for(r=[],i=[],l=this._seenStateInfos[e].seen_states,s=0,a=l.length;s<a;s++)c=l[s],u=c.seen_state_user.user_id,n.call(o,u)>=0&&(r.push(c),i.push(u));return p=t.difference(o,i),{userIdsWithoutSeenStateInfo:p,baseSeenStateInfo:{seen_states:r}}},s.prototype._updateSeenStateInfo=function(e,t,n,o){var i,r;return null==o&&(o=!1),p.assert(null!==(r=this.passFetchingStatus(e,t))&&r!==_.FETCHING,"Before updating seen state info, you must call _assureSeenStateSuccessRegistered or _onFetchSeenStateDisabled"),i=this._fileKey(e,t),o&&i in this._seenStateInfos?this._seenStateInfos[i].seen_states=this._seenStateInfos[i].seen_states.concat(n.seen_states):this._seenStateInfos[i]=n,this._userIdsWithoutSeenStateInfo[i]=[],this.emit_change()},s.prototype._updateSeenStateInfoWithEmptyData=function(e,t){var n;return n={seen_states:[]},this._updateSeenStateInfo(e,t,n)},s.prototype._setPassFetchingStatus=function(e,t,n){var o;return o=this._fileKey(e,t),this._passFetchingStatusMap[o]=n,this.emit_change()},s.prototype._updateSeenStateCursor=function(e,t,n){var o;if(o=this._fileKey(e,t),n)return this._seenStateCursors[o]=n,this.emit_change()},s.prototype._assureSeenStateSuccessRegistered=function(e,t){switch(this.passFetchingStatus(e,t)){case _.FETCHING:return this._setPassFetchingStatus(e,t,_.SEEN_STATE_SUCCESS);case _.PRESENCE_SUCCESS:return this._setPassFetchingStatus(e,t,_.PASS_SUCCESS);case _.SEEN_STATE_DISALLOWED:case null:return p.reportStack("Debugging T123456: pass fetching status is null",{severity:p.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this._passFetchingStatusMap[this._fileKey(e,t)]}})}},s.prototype._onFetchSeenStateDisabled=function(e,t){switch(this.passFetchingStatus(e,t)){case _.PRESENCE_SUCCESS:return this._setPassFetchingStatus(e,t,_.PASS_MIXED_SUCCESS);case _.FETCHING:return this._setPassFetchingStatus(e,t,_.SEEN_STATE_DISALLOWED);case null:return p.reportStack("Debugging T123456: pass fetching status is null",{severity:p.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this._passFetchingStatusMap[this._fileKey(e,t)]}})}},s.prototype._assurePresenceSuccessRegistered=function(e,t){switch(this.passFetchingStatus(e,t)){case _.SEEN_STATE_SUCCESS:return this._setPassFetchingStatus(e,t,_.PASS_SUCCESS);case _.SEEN_STATE_DISALLOWED:return this._setPassFetchingStatus(e,t,_.PASS_MIXED_SUCCESS);case _.FETCHING:return this._setPassFetchingStatus(e,t,_.PRESENCE_SUCCESS);case null:return p.reportStack("Debugging T123456: pass fetching status is null",{severity:p.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this._passFetchingStatusMap[this._fileKey(e,t)]}})}},s.prototype._new_payload=function(e){var t,n,o,i,r;switch(t=e.action.data,e.action.type){case d.FETCH_PASS_REQUEST:return this._setPassFetchingStatus(t.nsId,t.sjid,_.FETCHING);case d.FETCH_PASS_ERROR:return this._setPassFetchingStatus(t.nsId,t.sjid,_.ERROR);case d.FETCH_PASS_CONCLUDED:return n=t.nsId,i=t.sjid,this._setPassFetchingStatus(n,i,_.CONCLUDED),this._updateSeenStateInfoWithEmptyData(n,i);case d.PASS_PERMISSION_REQUEST:
return this._setPassPermissionRequest(t.fileId,t.nsId,t.sjid);case d.RECEIVE_PRESENCE_DELTA:return this._assurePresenceSuccessRegistered(t.nsId,t.sjid),this._receivePresenceDelta(t.userId,t.nsId,t.sjid,t.onlineUniqueUsers,t.offlineUniqueUsers);case d.RECEIVE_PRESENCE_SNAPSHOT:return this._assurePresenceSuccessRegistered(t.nsId,t.sjid),this._receivePresenceSnapshot(t.userId,t.nsId,t.sjid,t.onlineUniqueUsers);case d.RESET_PASS_INFO:return this._resetPassInfo(t.nsId,t.sjid);case d.SET_PASS_PERMISSIONS:return this._setPassPermissions(t.fileId,t.passPermissionObject);case d.DISCONTINUE_SEEN_STATE_INFO:return o={cursor_state:"",has_next:!1},this._updateSeenStateCursor(t.nsId,t.sjid,o);case d.UPDATE_SEEN_STATE_INFO:return this._assureSeenStateSuccessRegistered(t.nsId,t.sjid),this._updateSeenStateInfo(t.nsId,t.sjid,t.seenStateInfo),this._updateSeenStateCursor(t.nsId,t.sjid,t.seenStateCursor);case d.UPDATE_SEEN_STATE_INFO_CONTINUE:return this._assureSeenStateSuccessRegistered(t.nsId,t.sjid),this._updateSeenStateInfo(t.nsId,t.sjid,t.seenStateInfo,!0),this._updateSeenStateCursor(t.nsId,t.sjid,t.seenStateCursor);case d.UPDATE_SEEN_STATE_UNAVAILABLE:return r=t.userId,n=t.nsId,i=t.sjid,this._onFetchSeenStateDisabled(n,i),this._updateSeenStateInfoWithEmptyData(n,i),this._updateUserIdsWithoutSeenStateInfo(r,n,i,[])}},s})(i))})}.call(this),define("modules/clean/react/pass/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n,o,i,r,s){this.key=e,this.displayName=t,this.isActive=n,this.isViewer=o,this.incrementOverflowBasis=i,this.whenLastSeen=r,this.photoUrl=s}return e})();t.UserInfo=n,t.PASS_PERMISSION_PENDING_STATUS="pending";var o=(function(){function e(e,t){this.isLoaded=e,this.data=t}return e.create=function(t){return new e(!0,t)},e.createNotLoaded=function(){return new e(!1,null)},e})();t.FacepileInfo=o}),define("modules/clean/react/pass/utils",["require","exports","external/underscore"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){function t(e){return e.startsWith("dbwsid:")||e.startsWith("dbafvid:")}function o(e){return t(e.seen_state_user.user_id)}function i(e){return n.filter(e,t)}function r(e){return n.reject(e,t)}e.isAnonymousSeenState=o,e.getAnonymousUserIds=i,e.filterAnonymousUserIds=r})(t.AnonymousViewerUtils||(t.AnonymousViewerUtils={}))}),define("modules/clean/react/previews/archive/actions",["require","exports","modules/clean/react/previews/archive/constants","modules/clean/flux/dispatcher","modules/clean/previews/util"],function(e,t,n,o,i){"use strict";function r(e){var t=i.generateDucId(64);o.dispatch({type:n.ArchivePreviewAction.InitializePreview,data:{duc_id:t,fileId:e}})}function s(e){o.dispatch({type:n.ArchivePreviewAction.UpdateFolderPath,data:{entries:e}})}function a(){o.dispatch({type:n.ArchivePreviewAction.Unload})}Object.defineProperty(t,"__esModule",{value:!0}),t.initializePreview=r,t.updateFolderPath=s,t.unloadPreview=a}),define("modules/clean/react/previews/archive/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivePreviewAction={InitializePreview:"InitializePreview",Unload:"Unload",UpdateFolderPath:"UpdateFolderPath"}}),define("modules/clean/react/previews/archive/file_row",["require","exports","external/react","external/spectrum/media_table","modules/clean/display_format","modules/clean/filepath","modules/clean/react/file_icon_view"],function(e,t,n,o,i,r,s){"use strict";function a(e){var t=e.entry,a=e.topOffset,l=n.createElement(s.FileIconView,{icon:r.file_icon(t.name,{size:r.ICON_SIZES.LARGE})});return n.createElement(o.CulledMediaRow,{topOffset:a,doubleLine:!0},function(){return[n.createElement(o.MediaCell,{key:"filecell",title:t.name,icon:l}),n.createElement(o.MediaCell,{key:"filesize",title:i.format_bytes(t.size)})]})}Object.defineProperty(t,"__esModule",{value:!0}),t.FileRow=a}),define("modules/clean/react/previews/archive/folder_row",["require","exports","external/react","external/spectrum/media_table","modules/clean/filepath","modules/clean/react/file_icon_view"],function(e,t,n,o,i,r){"use strict";function s(e){var t=e.entry,s=e.topOffset,a=e.onClick,l=n.createElement(r.FileIconView,{icon:i.folder_icon()});return a?n.createElement(o.CulledMediaRow,{topOffset:s,onClick:a,doubleLine:!0},function(e){var i=e.isHovered;return[n.createElement(o.MediaCell,{key:"foldercell",title:t.name,icon:l,highlight:i})]}):n.createElement(o.CulledMediaRow,{topOffset:s,doubleLine:!0},function(){return[n.createElement(o.MediaCell,{key:"foldercell",title:t.name,icon:l})]})}Object.defineProperty(t,"__esModule",{value:!0}),t.FolderRow=s}),define("modules/clean/react/previews/archive/preview_archive",["require","exports","tslib","external/react","external/spectrum/media_table_skeleton","external/spectrum/table","modules/clean/loggers/file_preview_logger","modules/clean/previews/actions","modules/clean/previews/util","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/breadcrumb/trail","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/previews/archive/file_row","modules/clean/react/previews/archive/folder_row","modules/clean/react/previews/archive/actions","modules/clean/react/previews/archive/store","modules/clean/react/previews/archive/types","modules/clean/web_timing_logger","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=(function(e){function t(t){var n=e.call(this,t)||this;return n.onUpdateFromStore=function(){n.setState(f.archivePreviewStore.getState())},n.onClickNavigateFolder=function(e,t){e.preventDefault(),m.updateFolderPath(n.state.entries.concat([t]))},n.renderEntryRow=function(e,t,i){if(e.isDir){var r=void 0;return r=n.props.navigationEnabled?function(t){return n.onClickNavigateFolder(t,e)}:void 0,o.createElement(_.FolderRow,{entry:e,topOffset:i,onClick:r})}return o.createElement(h.FileRow,{entry:e,topOffset:i})},n.navigateUp=function(e,t,o){e.preventDefault();var i=n.state.entries.slice(0,o+1);m.updateFolderPath(i)},n.state={duc_id:void 0,entries:[],isLoaded:!1},n}return n.__extends(t,e),t.prototype.fetchArchiveContents=function(){var e=this;this.logFilePreviewEvent(d.EventTypes.FILE_PREVIEW_SHOW_CONTENTS_ATTEMPTED),this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED);var t=new XMLHttpRequest;t.open("GET",this.getArchivePreviewUrl()),t.withCredentials=!0,t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&(200===t.status?e.onFetchSuccess(t.response):e.onFetchFailure())},t.send()},t.prototype.onFetchSuccess=function(e){this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED);var t=this.parseServerResponse(e);m.updateFolderPath([t]),this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED)},t.prototype.parseServerResponse=function(e){var t=JSON.parse(e);if(!t.children){var n=new v.ArchiveEntry("/",0,!0);return this.convertToTree(t,n),n}return t},t.prototype.convertToTree=function(e,t){for(var n=0,o=e[t.name];n<o.length;n++){var i=o[n],r=new v.ArchiveEntry(i.filename,i.bytes,i.is_dir);t.children.push(r),r.isDir&&this.convertToTree(e,r),r.name=i.filename.split("/").pop()}},t.prototype.onFetchFailure=function(){this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),m.unloadPreview(),this.props.onError&&this.props.onError()},t.prototype.getArchivePreviewUrl=function(){var e=E.parse(this.props.file.preview_url.toString());e.updateQuery({duc_id:this.state.duc_id});var t=e.toString();return"//"===t.slice(0,2)&&(t="https:"+t),t},t.prototype.componentDidMount=function(){this.unsubscribe=f.archivePreviewStore.addListener(this.onUpdateFromStore),this.setUpLogger(),this.logFilePreviewTimeline(d.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.markWebTiming(),setTimeout(a.broadcastRenderSucceeded,0),m.initializePreview(this.props.file.file_id)},t.prototype.componentDidUpdate=function(e,t){this.state.duc_id!==t.duc_id&&this.fetchArchiveContents()},t.prototype.componentWillUnmount=function(){m.unloadPreview(),this.unsubscribe(),this.teardownLogger()},t.prototype.setUpLogger=function(){this.logger&&this.teardownLogger(),this.logger=new s.FilePreviewArchiveLogger,this.logger.listenTo(c.filePreviewEventEmitter)},t.prototype.teardownLogger=function(){this.logger.unlistenTo(c.filePreviewEventEmitter),delete this.logger},t.prototype.logFilePreviewTimeline=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.logFilePreviewEvent=function(e){c.filePreviewEventEmitter.emit(e,this.props.filePreviewSession,{preview_type:this.props.file.preview_type})},t.prototype.markWebTiming=function(){g.mark_time_to_view(),g.mark_time_to_interactive()},t.prototype.render=function(){var e,t,n=this;if(this.state.isLoaded){if(this.props.navigationEnabled){var s=this.state.entries.map(function(e){if("/"===e.name){var t=y._("%(file)s").format({file:l.get_filename(n.props.file)});return 1===n.state.entries.length&&(t=y._("Viewing the contents of %(file)s").format({file:t})),{label:t,href:"#"}}return{label:e.name,href:"#"}});e=o.createElement("div",{className:"preview-archive__breadcrumbs clearfix"},o.createElement(u.BreadcrumbTrail,{crumbs:s,onChange:this.navigateUp,overflowDropdownPosition:u.BreadcrumbOverflowPositions.BOTTOM_ALIGN_LEFT}))}var a=this.state.entries[this.state.entries.length-1].children;t=o.createElement("div",{className:"preview-archive__table"},o.createElement(r.Table,null,o.createElement(r.FixedTableHead,null,o.createElement(r.TableHeadCell,null,y._("Name")),o.createElement(r.TableHeadCell,null,y._("Size"))),o.createElement(r.CulledTableBody,{items:a,listItemHeight:72,renderRow:this.renderEntryRow})))}else t=o.createElement(i.MediaTableSkeleton,{numRows:10});return o.createElement("div",{className:"preview-archive"},o.createElement("div",{className:"preview-archive__content"},e,t))},t})(o.Component),b=p(S,["/static/css/preview_archive-vflUMeaLl.css"]);t.PreviewArchive=b}),define("modules/clean/react/previews/archive/store",["require","exports","tslib","modules/clean/flux/flux_store","modules/clean/react/previews/archive/constants","modules/clean/flux/dispatcher"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(t){var n=e.call(this,t)||this;return n.previewStates={},n.previewStates={},n}return n.__extends(t,e),t.prototype.getState=function(){return this.previewStates[this.currentFileId]},t.prototype.handleInitializePreview=function(e){this.currentFileId=e.fileId;var t=e.fileId in this.previewStates?this.previewStates[e.fileId].duc_id:e.duc_id,n={duc_id:t,entries:[],isLoaded:!1};this.previewStates[e.fileId]=n,this.__emitChange()},t.prototype.handleUpdateFolderPath=function(e){if(this.previewStates[this.currentFileId].entries=e.entries.slice(),this.previewStates[this.currentFileId].isLoaded===!1){var t=e.entries.slice()[0],n=t.children[0];1===t.children.length&&n.isDir===!0&&0!==n.children.length&&(this.previewStates[this.currentFileId].entries=[t,n])}this.previewStates[this.currentFileId].isLoaded=!0,this.__emitChange()},t.prototype.handleUnload=function(){this.previewStates[this.currentFileId].entries=[],this.previewStates[this.currentFileId].isLoaded=!1,this.currentFileId=void 0,this.__emitChange()},t.prototype.__onDispatch=function(e){switch(e.action.type){case i.ArchivePreviewAction.InitializePreview:this.handleInitializePreview(e.action.data);break;case i.ArchivePreviewAction.Unload:this.handleUnload();break;case i.ArchivePreviewAction.UpdateFolderPath:this.handleUpdateFolderPath(e.action.data)}},t})(o);t.archivePreviewStore=new s(r)}),define("modules/clean/react/previews/archive/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t,n){this.name=e,this.size=t,this.isDir=n,this.children=[]}return e})();t.ArchiveEntry=n}),define("modules/clean/react/previews/audio/preview_audio",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/previews/actions","modules/clean/react/css","modules/clean/react/file_viewer/constants","modules/clean/react/previews/audio/preview_audio_details","modules/clean/react/previews/audio/preview_audio_play_button","modules/clean/react/previews/audio/preview_audio_visuals","modules/clean/react/previews/audio/preview_audio_volume","modules/clean/react/previews/audio/utils","modules/core/browser","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={time:0,duration:0,bufferedLength:0,isPlaying:!1,isReady:!1,isMuted:!1,volumeLevel:1,rawWaveformHeights:[],waveformWidth:0,isContainerSet:!1},t.setAudioRef=function(e){t.audio=e},t.setAudioWrapperRef=function(e){t.audioWrapper=e},t.setReady=s.once(function(){t.props.filePreviewSession&&t.props.filePreviewSession.markPrimaryEvent(),f.mark_time_to_view(),f.mark_time_to_interactive(),t.setState({isReady:!0}),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(a.broadcastRenderSucceeded,0),setTimeout(t.setContainer,500)}),t.setContainer=function(){t.setState({isContainerSet:!0})},t.updateProgress=function(){var e=t.getBufferProgress();t.setState({bufferedLength:e})},t.updateTime=function(){t.setState({time:t.getAudioNode().currentTime})},t.updateTimeTo=function(e){t.getAudioNode().currentTime=e,t.setState({time:e})},t.updateDuration=function(){var e=t.getBufferProgress();t.setState({duration:t.getAudioNode().duration,bufferedLength:e})},t.playOrPause=function(){t.state.isPlaying?t.pauseFile():t.playFile()},t.pauseFile=function(){t.getAudioNode().pause(),t.setState({isPlaying:!1})},t.toggleMute=function(){var e=t.state.isMuted?t.state.volumeLevel||.1:0;t.getAudioNode().volume=e;var n={isMuted:!t.state.isMuted};0===t.state.volumeLevel&&(n.volumeLevel=e),t.setState(n)},t.changeVolumeTo=function(e){t.getAudioNode().volume=e,t.setState({volumeLevel:e,isMuted:!e})},t.throwError=function(){y.error(g._("An audio error occurred")),v.reportException({err:new Error("Audio file failed to play"),tags:["audioPreviews"],severity:v.SEVERITY.NONCRITICAL}),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),t.props.onError()},t.updateWaveformState=function(e){t.isRendered&&t.setState({rawWaveformHeights:e})},t.checkIfRendered=function(){return t.isRendered},t.parseWaveFormBuffer=function(e){return t.setWaveformWidth(),_.PreviewAudioWaveformHelpers.buildFromBuffer(e,1e3,100,t.checkIfRendered,t.updateWaveformState)},t.generateWaveform=function(){var e=Math.floor((t.state.waveformWidth-1)/3);return _.PreviewAudioWaveformHelpers.returnWaveform(t.state.rawWaveformHeights,e,.85)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.isRendered=!0,this.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED);var e=this.getAudioNode();e.addEventListener("timeupdate",this.updateTime),e.addEventListener("durationchange",this.updateDuration),e.addEventListener("ended",this.pauseFile),e.addEventListener("canplay",this.setReady),e.addEventListener("progress",this.updateProgress),e.addEventListener("error",this.throwError),this.setWaveformWidth(),window.addEventListener("resize",this.getDebouncedWaveformWidthFunction()),this.props.bytes<7e7&&this.sendWaveFormRequest()},t.prototype.componentWillUnmount=function(){this.isRendered=!1;var e=this.getAudioNode();e.removeEventListener("timeupdate",this.updateTime),e.removeEventListener("durationchange",this.updateDuration),e.removeEventListener("ended",this.pauseFile),e.removeEventListener("canplay",this.setReady),e.removeEventListener("progress",this.updateProgress),e.removeEventListener("error",this.throwError),window.removeEventListener("resize",this.getDebouncedWaveformWidthFunction()),null!=this.audioContext&&null!=this.audioContext.close&&this.audioContext.close()},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.getAudioNode=function(){return r.findDOMNode(this.audio)},t.prototype.getDebouncedWaveformWidthFunction=function(){return this.debouncedWaveformWidthFunction||(this.debouncedWaveformWidthFunction=s.debounce(this.setWaveformWidth,100)),this.debouncedWaveformWidthFunction},t.prototype.setWaveformWidth=function(){this.isRendered&&this.setState({waveformWidth:r.findDOMNode(this.audioWrapper).offsetWidth})},t.prototype.getSrcUrl=function(){var e=E.parse(this.props.src);e.updateQuery({duc_id:"dropbox_duc_id"});var t=e.toString();return"//"===t.slice(0,2)&&(t="https:"+t),t},t.prototype.getBufferProgress=function(){var e=this.getAudioNode();return e.duration&&e.buffered&&e.buffered.length?e.buffered.end(e.buffered.length-1):0},t.prototype.playFile=function(){this.getAudioNode().play(),this.setState({isPlaying:!0})},t.prototype.sendWaveFormRequest=function(){var e=this;if(this.setAudioContext(),null==this.audioContext)this.logFailedWaveformGeneration();else{if(m.is_mobile_or_tablet())return void this.setReady();var t=new XMLHttpRequest;t.open("GET",this.getSrcUrl()),t.responseType="arraybuffer",t.withCredentials=!0,t.onreadystatechange=function(){4===t.readyState&&e.isRendered&&(200===t.status?e.audioContext.decodeAudioData(t.response,e.parseWaveFormBuffer,e.logFailedWaveformGeneration):e.logFailedWaveformGeneration())},t.send()}},t.prototype.logFailedWaveformGeneration=function(){v.reportException({err:new Error("Audio could not be decoded"),tags:["audioPreviews"],severity:v.SEVERITY.NONCRITICAL})},t.prototype.setAudioContext=function(){var e=window.AudioContext||window.webkitAudioContext;e&&(this.audioContext=new e)},t.prototype.renderAudioTag=function(){return i.createElement("audio",{src:this.getSrcUrl(),preload:"auto",ref:this.setAudioRef})},t.prototype.renderRadio=function(){var e=0!==this.state.rawWaveformHeights.length,t=o({"preview-audio__radio":!0,"preview-audio__radio--hidden":!this.state.isReady||e});return i.createElement("div",{className:t},_.PreviewAudioHelpers.getRadioImage())},t.prototype.renderLoading=function(){return i.createElement("div",{className:"preview-audio__load-wheel"},_.PreviewAudioHelpers.getLoaderWheel())},t.prototype.renderWaveForm=function(){return i.createElement(d.PreviewAudioVisuals,{generateWaveform:this.generateWaveform,time:this.state.time,duration:this.state.duration,bufferedLength:this.state.bufferedLength,updateTime:this.updateTimeTo,barWidth:2,barSpacing:1,waveformWidth:this.state.waveformWidth,isWaveformReady:0!==this.state.rawWaveformHeights.length,isPlayerReady:this.state.isReady,isContainerSet:this.state.isContainerSet,key:1})},t.prototype.renderToolbar=function(){return i.createElement("div",{className:"toolbar",key:2},this.renderPlayButton(),this.renderDetails(),this.renderVolume())},t.prototype.renderPlayButton=function(){return i.createElement(p.PreviewAudioPlayButton,{isPlaying:this.state.isPlaying,onChange:this.playOrPause})},t.prototype.renderDetails=function(){return i.createElement(u.PreviewAudioDetails,{time:this.state.time,duration:this.state.duration})},t.prototype.renderVolume=function(){return m.iOS?null:i.createElement(h.PreviewAudioVolume,{isMuted:this.state.isMuted,volumeLevel:this.state.volumeLevel,onVolumeChange:this.changeVolumeTo,onMuteToggle:this.toggleMute})},t.prototype.render=function(){var e=o({"preview-audio__container":!0,"preview-audio__container--loading":!this.state.isReady});return i.createElement("div",{className:"flex-preview-container"},i.createElement("div",{className:"preview-audio preview-content preview-content--center"},i.createElement("div",{className:"preview-audio__wrapper",ref:this.setAudioWrapperRef},i.createElement("div",{className:"preview-audio__aspect-container"},i.createElement("div",{className:e},this.renderAudioTag(),this.renderRadio(),this.state.isReady?[this.renderWaveForm(),this.renderToolbar()]:this.renderLoading())))))},t})(i.Component);t.PreviewAudioWithoutCss=S,t.PreviewAudio=l(S,["/static/css/preview_audio-vflhAiKm2.css"])}),define("modules/clean/react/previews/audio/preview_audio_details",["require","exports","tslib","external/react","modules/clean/datetime","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.formatString=function(e){return r._("%(time)s").format({time:i.formatAudioTime(e)})},t.prototype.getDisplayString=function(){return o.createElement("span",{className:"toolbar-details__time"},this.formatString(this.props.time)+" / "+this.formatString(this.props.duration))},t.prototype.render=function(){return o.createElement("div",{className:"toolbar-details vertical-align"},o.createElement("div",{className:"toolbar-details__string vertical-align__child"},this.getDisplayString()))},t})(o.Component);t.PreviewAudioDetails=s}),define("modules/clean/react/previews/audio/preview_audio_play_button",["require","exports","tslib","external/react","modules/clean/react/previews/audio/utils"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getIconString=function(){return this.props.isPlaying?"pause":"play"},t.prototype.renderButtonImage=function(){return i.PreviewAudioHelpers.getSprite(this.getIconString())},t.prototype.render=function(){return o.createElement("button",{className:"toolbar-controller vertical-align",onClick:this.props.onChange,title:this.getIconString()},o.createElement("div",{className:"toolbar-controller__button vertical-align__child"},this.renderButtonImage()))},t})(o.Component);t.PreviewAudioPlayButton=r}),define("modules/clean/react/previews/audio/preview_audio_visuals",["require","exports","tslib","external/classnames","external/react","external/react-dom"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrubPercentage:0,isMouseDown:!1},t.setWaveformRef=function(e){t.waveform=e},t.scrubTime=function(e){var n=t.getSeekPercentageFromEvent(e);t.updateWaveformScrubToPercentage(n),t.state.isMouseDown&&t.updateTime(e)},t.resetScrub=function(){t.updateWaveformScrubToPercentage(0),t.setMouseUp()},t.updateTime=function(e){var n=t.getSeekPercentageFromEvent(e),o=n*t.props.duration;t.props.updateTime(o)},t.setMouseDown=function(){t.setState({isMouseDown:!0})},t.setMouseUp=function(){t.setState({isMouseDown:!1})},t}return n.__extends(t,e),t.prototype.getSeekPercentageFromEvent=function(e){var t=r.findDOMNode(this.waveform).getBoundingClientRect();return(e.pageX-t.left)/t.width},t.prototype.getProgress=function(){return this.props.time/(this.props.duration||1)},t.prototype.getBuffered=function(){return this.state.scrubPercentage>0?this.state.scrubPercentage:this.props.isContainerSet?this.props.bufferedLength/(this.props.duration||1):0},t.prototype.getWidthObject=function(e){return{width:e+"%"}},t.prototype.updateWaveformScrubToPercentage=function(e){this.setState({scrubPercentage:e})},t.prototype.getScrubObject=function(e){return{onClick:this.updateTime,onMouseMove:this.scrubTime,onMouseLeave:this.resetScrub,onMouseDown:this.setMouseDown,onMouseUp:this.setMouseUp,className:e}},t.prototype.getWavebarClasses=function(e){return o({wavebar__single:!0,"wavebar__single--scrubbed":e})},t.prototype.renderWaveBar=function(e,t){var n,o=1-e,r={top:100*o+"%",height:100*e+"%"},s=this.props.waveformWidth,a=(t+1)*(this.props.barWidth+this.props.barSpacing)-this.props.barWidth;if(this.state.scrubPercentage>0){var l=this.state.scrubPercentage*s;n=this.getWavebarClasses(a<l)}else{var c=this.getProgress()*s;n=this.getWavebarClasses(a<c)}return[i.createElement("div",{className:"wavebar__single wavebar__space",key:1}),i.createElement("div",{className:n,style:r,key:2})]},t.prototype.renderWaveBars=function(){var e,t=this,r=o({wavebar__container:!0,"wavebar__container--ready":this.props.isWaveformReady});return e=this.props.isWaveformReady?this.getScrubObject(r):{className:r},i.createElement("div",n.__assign({},e),this.props.generateWaveform().map(function(e,n){return t.renderWaveBar(e,n)}))},t.prototype.renderWaveForm=function(){var e;return e=this.props.isWaveformReady?this.getWidthObject(100*this.state.scrubPercentage):this.getWidthObject(0),i.createElement("div",{className:"waveform"},i.createElement("div",{className:"waveform__scrub",style:e}),this.renderWaveBars())},t.prototype.renderProgressBar=function(){var e=100*this.getProgress(),t=100*this.getBuffered(),r=o({"audio-progress-bar__done":!0,"audio-progress-bar__showing":!!e});return i.createElement("div",n.__assign({},this.getScrubObject("audio-progress-bar")),i.createElement("div",{className:"audio-progress-bar__buffered",style:this.getWidthObject(t)}),i.createElement("div",{className:r,style:this.getWidthObject(e)}))},t.prototype.render=function(){return i.createElement("div",{className:"visuals",ref:this.setWaveformRef},this.renderWaveForm(),this.renderProgressBar())},t})(i.Component);t.PreviewAudioVisuals=s}),define("modules/clean/react/previews/audio/preview_audio_volume",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/previews/audio/utils"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isMouseDown:!1},t.setVolumeBarRef=function(e){t.volumeBar=e},t.setMouseDown=function(){t.setState({isMouseDown:!0})},t.setMouseUp=function(){t.setState({isMouseDown:!1})},t.safeChangeVolume=function(e){if(t.state.isMouseDown)return t.changeVolume(e)},t.changeVolume=function(e){var n=t.getVolumePercentageFromEvent(e);t.props.onVolumeChange(n)},t}return n.__extends(t,e),t.prototype.getVolumePercentageFromEvent=function(e){var t=i.findDOMNode(this.volumeBar).getBoundingClientRect();return(e.pageX-t.left)/t.width},t.prototype.getIconString=function(){return this.props.isMuted?"volumeMuted":"volume"},t.prototype.renderVolumeImage=function(){var e=r.PreviewAudioHelpers.getSprite(this.getIconString());return o.createElement("div",{className:"toolbar-volume__button vertical-align__child"},o.createElement("button",{onClick:this.props.onMuteToggle},e))},t.prototype.renderVolumeBar=function(){var e=this.props.isMuted?0:100*this.props.volumeLevel,t={width:e+"%"};return o.createElement("div",{className:"volume-bar vertical-align__child",onMouseUp:this.setMouseUp,onMouseDown:this.setMouseDown,onMouseLeave:this.setMouseUp,onMouseMove:this.safeChangeVolume,onClick:this.changeVolume},o.createElement("div",{className:"volume-bar__container",ref:this.setVolumeBarRef},o.createElement("div",{className:"volume-bar__selected",style:t})))},t.prototype.render=function(){return o.createElement("div",{className:"toolbar-volume vertical-align"},this.renderVolumeImage(),this.renderVolumeBar())},t})(o.Component);t.PreviewAudioVolume=s}),define("modules/clean/react/previews/audio/utils",["require","exports","external/react","modules/clean/average_counter","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i,r,s,a){"use strict";function l(e){var t=a._("%(state)s").format({state:e});return n.createElement(r,{group:"web",name:e,alt:t})}function c(){return n.createElement(i,{src:s.static_url("/static/images/icons/spinner-blue-overlay-vflLgNAM7.gif"),srcHiRes:s.static_url("/static/images/icons/spinner-blue-overlay@2x-vflpi64gx.gif")})}function u(){return n.createElement(i,{src:s.static_url("/static/images/icons/waveformEmpty-vflZHW9X-.png"),srcHiRes:s.static_url("/static/images/icons/waveformEmpty@2x-vflZvenXO.png")})}function p(e,t,n,i,r){function s(e){return function(){if(e>=t)return void r(l);var c=[],u=Math.ceil(e*a.length/t),p=Math.ceil((e+1)*a.length/t),d=p-u;if(d>n)for(var h=0;h<n;h++){var _=Math.floor(Math.random()*d)+u;c.push(Math.abs(a[_]))}else for(var h=u;h<p;h++){var m=Math.floor(Math.abs(a[h]));c.push(m)}var f=new o.AverageCounter;f.addArray(c),l[e]=f.getAverage(),i()&&setTimeout(s(e+1),0)}}var a=e.getChannelData(0),l=new Array(t);setTimeout(s(0),0)}function d(e,t,n){void 0===n&&(n=1);var i=[];if(0===e.length||t<=0)return i;for(var r=[],s=0;s<t;s++)r.push(new o.AverageCounter);for(var a=0,l=0,s=0;s<e.length;s++){var c=e[s],u=Math.floor(s*t/e.length),p=r[u];p.add(c),i[u]=p.getAverage(),u!==l&&(a=Math.max(a,i[l]),l=u)}return a=Math.max(a,i[t-1]),i.map(function(e){return e*n/a})}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewAudioHelpers={getLoaderWheel:c,getRadioImage:u,getSprite:l},t.PreviewAudioWaveformHelpers={buildFromBuffer:p,returnWaveform:d}}),define("modules/clean/react/previews/constants",["require","exports"],function(e,t){"use strict";function n(e){return a[e]}function o(e){return l[e]}function i(e){return u[e]}Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorTypes={LOAD_ERROR:"LOAD_ERROR",SUPPORT_ERROR:"SUPPORT_ERROR",EXTENSION_ERROR:"EXTENSION_ERROR",NEED_FLASH_ERROR:"NEED_FLASH_ERROR",FILE_SIZE_ERROR:"FILE_SIZE_ERROR",PASSWORD_PROTECTED_ERROR:"PASSWORD_PROTECTED_ERROR",PENDING_UPLOAD_ERROR:"PENDING_UPLOAD_ERROR",EMPTY_FILE_ERROR:"EMPTY_FILE_ERROR"};var r;(function(e){e[e.BROWSE=0]="BROWSE",e[e.SHARED_LINK_FILE=1]="SHARED_LINK_FILE",e[e.SHARED_LINK_FOLDER=2]="SHARED_LINK_FOLDER",e[e.SHARED_LINK_COLLECTION=3]="SHARED_LINK_COLLECTION",e[e.VERSION_HISTORY=4]="VERSION_HISTORY",e[e.FILE_VIEWER=5]="FILE_VIEWER",e[e.DESKTOP=6]="DESKTOP",e[e.EMBEDDED_SHARED_LINK_FILE=7]="EMBEDDED_SHARED_LINK_FILE"})(r=t.PreviewSourceContext||(t.PreviewSourceContext={}));var s;(function(e){e[e.VISIT=0]="VISIT",e[e.CLICK=1]="CLICK"})(s=t.PreviewSourceAction||(t.PreviewSourceAction={}));var a=[];a[r.BROWSE]="browse",a[r.SHARED_LINK_FILE]="sl_file",a[r.SHARED_LINK_FOLDER]="sl_folder",a[r.SHARED_LINK_COLLECTION]="sl_collection",a[r.VERSION_HISTORY]="version_history",a[r.FILE_VIEWER]="file_viewer",a[r.DESKTOP]="desktop",a[r.EMBEDDED_SHARED_LINK_FILE]="embedded_sl_file",t.getPreviewSourceContextKey=n;var l=[];l[s.VISIT]="visit",l[s.CLICK]="click",t.getPreviewSourceActionKey=o;var c;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NEW_FILE=1]="NEW_FILE",e[e.BEFORE_UNLOAD=2]="BEFORE_UNLOAD",e[e.UNMOUNT=3]="UNMOUNT"})(c=t.PreviewSessionEndReasons||(t.PreviewSessionEndReasons={})),t.RivieraPreviewResponseTypes={UNKNOWN:0,OK:1,CONVERSION_FAILURE:2,TEMPORARY_FAILURE:3,INTERNAL_FAILURE:4,UNSUPPORTED_FORMAT:5,TIMEOUT:6,TOO_BIG:7,INVALID_METADATA:8,SOURCE_CORRUPT:9,TIME_BUDGET_EXCEEDED:10,NOT_FOUND:11,PASSWORD_PROTECTED:12};var u=[];u[c.UNKNOWN]="unknown",u[c.NEW_FILE]="new_file",u[c.BEFORE_UNLOAD]="before_unload",u[c.UNMOUNT]="unmount",t.getSessionEndReasonLoggingKey=i}),define("modules/clean/react/previews/frame_messenger_host",["require","exports","tslib","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){var t=["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-doc.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","dl-doc.dropboxusercontent.com"],n=t.map(function(e){return"https://"+e});return n.push("null"),e.call(this,n)||this}return n.__extends(t,e),t})(o.FrameMessengerHost);t.PreviewFrameMessengerHost=i}),
define("modules/clean/react/previews/image_helpers",["require","exports","modules/clean/photos/thumbnail_url_util"],function(e,t,n){"use strict";function o(e){return s.map(function(t){var o=t[0],i=t[1];return n.thumbnailUrlForSize(e,o,i,3)+" "+o+"w"}).join(", ")}function i(e){return n.thumbnailUrlForSize(e,800,600,3)}function r(e){return new Promise(function(n,r){var s=Date.now(),a=new Image;a.onload=function(){n({started:s,completed:Date.now()})},a.onerror=function(){r({started:s,failed:Date.now()})},a.srcset=o(e),a.sizes=t.IMG_SIZES_ATTR,a.src=i(e)})}Object.defineProperty(t,"__esModule",{value:!0});var s=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]];t.IMG_SIZES_ATTR="90vw",t.getSrcSet=o,t.getFallbackSrc=i,t.preloadImage=r}),define("modules/clean/react/previews/pdf_thumbnail_image",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.onLoad=function(e){if(t.props.firstPageWidth){var n=e.target;t.setState({naturalWidth:n.naturalWidth})}if(t.props.onLoad)return t.props.onLoad()},t}return n.__extends(t,e),t.prototype.render=function(){var e={};return this.state.naturalWidth&&(e.width="calc((100% - 32px) * "+this.state.naturalWidth/this.props.firstPageWidth+")"),o.createElement("div",{className:"thumbnail__image-border",style:e},o.createElement("img",{alt:"",src:this.props.src,className:this.props.className,onLoad:this.onLoad,onError:this.props.onError,ref:this.props.refCallback}))},t})(o.PureComponent);t.PdfThumbnailImage=i}),define("modules/clean/react/previews/pdf_viewer/annotation_creation_layer",["require","exports","tslib","external/underscore","external/react","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/transform","modules/clean/annotations/annotation_controller"],function(e,t,n,o,i,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={draftAnnotationVersion:0},t.onResize=o.debounce(function(){t.setState({draftAnnotationVersion:t.state.draftAnnotationVersion+1})},1e3,!0),t.onAnnotationHiddenCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-hidden")},t.onAnnotationPlacedCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-placed",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationStartDragCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-start-drag",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationEndDragCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-end-drag",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationScrollCallback=function(e){e&&t.props.frameMessenger.postMessageToParent("scroll",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationScaleChangeCallback=function(e){t.props.frameMessenger.postMessageToParent("scale-change",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationEnterCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-enter",{annotation:t.finalizeAnnotation(e)})},t.onAnnotationLeaveCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-leave",{annotation:t.finalizeAnnotation(e)})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){r.eventEmitter.on("resize",this.onResize)},t.prototype.componentWillUnmount=function(){r.eventEmitter.off("resize",this.onResize)},t.prototype.finalizeAnnotation=function(e){return e.pdf_coordinates=s.transformViewportCoordinates(this.props.pageNumber,this.props.parentOffset.left,this.props.parentOffset.top,this.props.width,this.props.height,this.props.scaleFactor,e.viewportCoordinates),e.pdf_page={rotate:0,view:{}},e},t.prototype.render=function(){return i.createElement("div",{className:"db-annotation-creation-layer"},i.createElement(a,{parentContainerOffset:this.props.parentOffset,controllerEventHandlers:this.props.delegate,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationHighlightEnabled:this.props.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:this.props.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.props.isAnnotationCreationEnabled,draftAnnotationVersion:this.state.draftAnnotationVersion}))},t})(i.Component);l.defaultProps={scaleFactor:1},t.AnnotationCreationLayer=l}),define("modules/clean/react/previews/pdf_viewer/annotation_view_layer",["require","exports","tslib","jquery","external/react","external/react-dom","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_region_ui","modules/clean/react/previews/pdf_viewer/transform","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/css"],function(e,t,n,o,i,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderedAnnotations={},t.onAnnotationClickCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-click",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onAnnotationEnterCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-enter",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onAnnotationLeaveCallback=function(e){t.props.frameMessenger.postMessageToParent("annotation-ui-leave",{annotation:e.annotation,commentActivity:e.commentActivity})},t.onHighlightAnnotation=function(e){if(t.renderedAnnotations[e.activity_key]){var n=!1,i=t.renderedAnnotations[e.activity_key],r=o(".page-container"),s=o(i.firstChild);n=!1,t.isElementVisible(s,r)||(n=!0,r.animate({scrollTop:r.scrollTop()+s.offset().top-300+"px"},300)),i.classList.remove("start-highlight-animation"),i.classList.remove("start-highlight-animation--delay"),requestAnimationFrame(function(){i.classList.add("start-highlight-animation"),n&&i.classList.add("start-highlight-animation--delay")})}},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){u.eventEmitter.on("highlight-annotation",this.onHighlightAnnotation)},t.prototype.componentWillUnmount=function(){u.eventEmitter.off("highlight-annotation",this.onHighlightAnnotation)},t.prototype.isElementVisible=function(e,t){var n=e.offset().top;return 0<n&&n<t.height()},t.prototype.render=function(){var e=this,t=null;return this.props.annotations&&(t=this.props.annotations.map(function(t,o){var u=s.Annotation.createAnnotationFromDict(t.annotation);u.viewportCoordinates=c.transformPdfCoordinates(0,e.props.height,t.annotation.pdf_coordinates);var p={key:t.commentActivity.activity_key,annotation:u,scaleFactor:e.props.scaleFactor,commentActivity:t.commentActivity,options:t.options,onAnnotationClickCallback:e.onAnnotationClickCallback,onAnnotationEnterCallback:e.onAnnotationEnterCallback,onAnnotationLeaveCallback:e.onAnnotationLeaveCallback,ref:function(n){return e.renderedAnnotations[t.commentActivity.activity_key]=r.findDOMNode(n)}};return u.type===s.AnnotationTypes.HIGHLIGHT?i.createElement(a,n.__assign({},p)):u.type===s.AnnotationTypes.REGION?i.createElement(l,n.__assign({},p)):null})),i.createElement("div",{className:"db-annotation-layer db-annotation-view-layer"},t)},t})(i.PureComponent);d.defaultProps={scaleFactor:1};var h=["/static/css/comments_annotations-vflT6HX_-.css"],_=p(d,h);t.AnnotationViewLayer=_}),define("modules/clean/react/previews/pdf_viewer/app",["require","exports","tslib","external/react","modules/core/uri","modules/clean/react/previews/pdf_viewer/connection_pool","modules/clean/react/previews/pdf_viewer/font","modules/clean/react/previews/pdf_viewer/timing","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/previews/pdf_viewer/viewer","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/printable","modules/clean/react/previews/pdf_viewer/utils","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var o=e.call(this,t)||this;if(o.state={accounts:{},attributions:[],isAnnotationHighlightEnabled:!0},o.inProgressPages={},o.downloadSucceedLogged=!1,o.renderSucceededLogged=!1,o.onScrollToAnnotation=function(e){var t=function(n,o){o===e.page-1&&(u.eventEmitter.off("page-set-to",t),u.eventEmitter.emit("highlight-annotation",e.commentActivity))};u.eventEmitter.on("page-set-to",t),u.eventEmitter.emit("set-current-page",e.page-1)},o.onPrint=function(){o.state.metadata&&p.print(o.state.metadata)},o.onScrollToPage=function(e){return n.__awaiter(o,void 0,void 0,function(){var t,o,i;return n.__generator(this,function(r){switch(r.label){case 0:t=50*Math.floor(e/50),t+50-e<15&&(t+=50),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.fetchDataForPage(t)];case 2:return o=r.sent(),o&&this.setState({text:this.addPdfgenText(o.text,n.__assign({},this.state.text)),links:o.text&&(o.text.links||void 0)}),[3,4];case 3:return i=r.sent(),u.eventEmitter.emit("error",h._("Failed to load PDF")),[3,4];case 4:return[2]}})})},o.onFileFeedbackUIReady=function(){o.props.frameMessenger.postMessageToParent("page-rendered")},o.onUpdateAnnotations=function(e){var t=e.annotations.reduce(function(e,t,n,o){var i=t.annotation.pdf_coordinates[0].page,r=i-1;return e[r]=e[r]||[],e[r].push(t),e},[]);o.setState({annotations:t})},o.onRemoveAllAnnotations=function(){o.setState({annotations:[]})},o.onEnableAnnotationCreation=function(){o.setState({isAnnotationCreationEnabled:!0})},o.onDisableAnnotationCreation=function(){o.setState({isAnnotationCreationEnabled:!1})},o.onEnableRegionCreation=function(){o.setState({isAnnotationRegionEnabled:!0})},o.onDisableRegionCreation=function(){o.setState({isAnnotationRegionEnabled:!1})},o.onSetAttributions=function(e){var t=e.attributions.reduce(function(e,t){var n=t.page;return e[n]=e[n]||[],e[n].push(t),e},[]),n=e.accounts.reduce(function(e,t){return e[t.accountId]=t,e},{});o.setState({attributions:t,accounts:n})},o.onPageRenderComplete=function(e,t,n){o.props.filePreviewSession&&(o.props.filePreviewSession.logSSREvent("any_page_rendered"),e<5&&(o.props.filePreviewSession.ssrTiming["page_"+e+"_render"]=t.duration())),!o.renderSucceededLogged&&o.props.timelineCallbacks.onFirstRenderSucceeded&&(o.renderSucceededLogged=!0,o.props.timelineCallbacks.onFirstRenderSucceeded(),o.props.frameMessenger.postMessageToParent("page-rendered"))},o.onPageImageLoad=function(e,t,n){o.props.filePreviewSession&&(o.props.filePreviewSession.logSSREvent("any_page_image_loaded"),e<5&&(o.props.filePreviewSession.ssrTiming["page_"+e+"_image_load"]=t.duration())),!o.downloadSucceedLogged&&o.props.timelineCallbacks.onDownloadSucceeded&&(o.downloadSucceedLogged=!0,o.props.timelineCallbacks.onDownloadSucceeded())},t.previewThumbnailUrl){var r=i.parse(t.previewThumbnailUrl);r.updateQuery({size_mode:"5"}),o.placeholderImageUrl=r.toString()}else o.placeholderImageUrl=l.imageUrl(0,0);return o}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.connectionPool=new r.ConnectionPool({maxConnections:3}),this.props.timelineCallbacks.onDownloadAttempted&&this.props.timelineCallbacks.onDownloadAttempted(),this.requestMetadata()},t.prototype.addPdfgenText=function(e,t){if(void 0===t&&(t={}),!e||!e.pages)return t;var n=e.fonts?e.fonts.map(s.renderFont):[];for(var o in e.pages)e.pages.hasOwnProperty(o)&&(t[o]=(e.pages[o]||[]).map(function(e){return{d:e.d,t:e.t,r:e.r,h:e.h,font:n[e.f]?n[e.f]:void 0}}));return t},t.prototype.requestMetadata=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t;return n.__generator(this,function(n){switch(n.label){case 0:return e=a.makeTimer().time(),[4,this.fetchDataForPage(0)];case 1:return t=n.sent(),t?(this.props.filePreviewSession&&(this.props.filePreviewSession.markSecondaryEvent(),this.props.filePreviewSession.logSSREvent("metadata_succeeded"),this.props.filePreviewSession.ssrTiming.metadata=e.timeEnd().duration()),t.metadata&&this.onMetadataLoad(t.metadata),this.setState({metadata:t.metadata,text:this.addPdfgenText(t.text),links:t.text&&(t.text.links||void 0)}),this.props.onLoad&&this.props.onLoad()):this.props.onError&&this.props.onError(),[2]}})})},t.prototype.componentDidMount=function(){u.eventEmitter.on("print",this.onPrint),u.eventEmitter.on("scrolled-to-page",this.onScrollToPage),u.eventEmitter.on("file-feedback-ui-ready",this.onFileFeedbackUIReady),u.eventEmitter.on("scroll-to-annotation",this.onScrollToAnnotation),u.eventEmitter.on("update-annotations",this.onUpdateAnnotations),u.eventEmitter.on("remove-all-annotations",this.onRemoveAllAnnotations),u.eventEmitter.on("enable-annotation-creation",this.onEnableAnnotationCreation),u.eventEmitter.on("disable-annotation-creation",this.onDisableAnnotationCreation),u.eventEmitter.on("enable-region-creation",this.onEnableRegionCreation),u.eventEmitter.on("disable-region-creation",this.onDisableRegionCreation),u.eventEmitter.on("set-attributions",this.onSetAttributions)},t.prototype.componentWillUnmount=function(){u.eventEmitter.off("print",this.onPrint),u.eventEmitter.off("scrolled-to-page",this.onScrollToPage),u.eventEmitter.off("file-feedback-ui-ready",this.onFileFeedbackUIReady),u.eventEmitter.off("scroll-to-annotation",this.onScrollToAnnotation),u.eventEmitter.off("update-annotations",this.onUpdateAnnotations),u.eventEmitter.off("remove-all-annotations",this.onRemoveAllAnnotations),u.eventEmitter.off("enable-annotation-creation",this.onEnableAnnotationCreation),u.eventEmitter.off("disable-annotation-creation",this.onDisableAnnotationCreation),u.eventEmitter.off("enable-region-creation",this.onEnableRegionCreation),u.eventEmitter.off("disable-region-creation",this.onDisableRegionCreation),u.eventEmitter.off("set-attributions",this.onSetAttributions),this.connectionPool.shutdown()},t.prototype.fetchDataForPage=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,o,i,r,s=this;return n.__generator(this,function(n){switch(n.label){case 0:if(e%50!==0)throw new Error("invalid page lower bound");if(this.state.metadata&&this.state.metadata.page_count<=e)return[2,void 0];if(t=e+50,this.state.text&&this.state.text[e])return[3,4];o=l.textUrl(0===e,e,t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.connectionPool.request({url:o,dataType:"json"},function(t){s.inProgressPages[e]?t():s.inProgressPages[e]=!0})];case 2:return i=n.sent(),delete this.inProgressPages[e],[2,i];case 3:return r=n.sent(),delete this.inProgressPages[e],[3,4];case 4:return[2,void 0]}})})},t.prototype.onMetadataLoad=function(e){var t={page:1,pages:e.page_count},n=d.docTypeFromExtension(this.props.fileExtension);this.props.frameMessenger.postMessageToParent("pagerendered",{current_page:t.page,pages_count:t.pages,doc_type:n,attributes:t})},t.prototype.render=function(){return o.createElement(c.Viewer,{fileExtension:this.props.fileExtension,placeholderImageUrl:this.placeholderImageUrl,metadata:this.state.metadata,text:this.state.text,links:this.state.links,annotations:this.state.annotations,attributions:this.state.attributions,accounts:this.state.accounts,frameMessenger:this.props.frameMessenger,onPageRenderComplete:this.onPageRenderComplete,onPageImageLoad:this.onPageImageLoad,onPlaceholderImageLoad:this.props.timelineCallbacks.onPlaceholderImageLoad,isAnnotationCreationEnabled:!!this.state.isAnnotationCreationEnabled,isAnnotationRegionEnabled:!!this.state.isAnnotationRegionEnabled,isAnnotationHighlightEnabled:!!this.state.isAnnotationHighlightEnabled,isFullscreen:this.props.isFullscreen,isToolbarVisible:this.props.isToolbarVisible,onExitFullscreen:this.props.onExitFullscreen})},t})(o.PureComponent);t.App=_}),define("modules/clean/react/previews/pdf_viewer/connection_pool",["require","exports","tslib","modules/clean/ajax"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(){function e(e){this.inflightConnections=0,this.waitingConnections=[],this.maxConnections=e.maxConnections}return e.prototype.request=function(e,t){var n=this;return new Promise(function(o,i){n.waitingConnections.push({request:e,onBeforeExecute:t,resolve:o,reject:i}),n.maybeSendRequest()})},e.prototype.shutdown=function(){this.waitingConnections=[]},e.prototype.maybeSendRequest=function(){var e=this;if(0!==this.waitingConnections.length)for(var t=function(){var t=i.waitingConnections.pop();if(!t)return{value:void 0};if(t.onBeforeExecute){var r=!1,s=function(){return r=!0};if(t.onBeforeExecute(s),r)return"continue"}i.inflightConnections++,o.WebRequest(n.__assign({},t.request,{success:function(e){return t.resolve(e)},error:function(e,n,o){return t.reject(o)},complete:function(){e.inflightConnections--,e.maybeSendRequest()}}))},i=this;this.inflightConnections<this.maxConnections;){var r=t();if("object"==typeof r)return r.value}},e})();t.ConnectionPool=i}),define("modules/clean/react/previews/pdf_viewer/error_snackbar",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";function i(e){return o.createElement("svg",{width:"32px",height:"32px",viewBox:"0 0 32 32",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},o.createElement("defs",null),o.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},o.createElement("g",null,o.createElement("ellipse",{fill:"#F22322",cx:"16",cy:"16",rx:"8",ry:"8"}),o.createElement("rect",{fill:"#FFFFFF",x:"13",y:"15.7",width:"6",height:"1.6"}))))}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),t.props.onClick()},t}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"pdf-snackbar"+(this.props.isToolbarVisible?" pdf-snackbar__toolbar-visible":"")},o.createElement("div",{className:"c-snackbar-fail o-snackbar-large"},o.createElement("div",{className:"c-snackbar-container o-snackbar-large o-snackbar-icon"},o.createElement("div",{className:"c-snackbar-icon"},o.createElement(i,null)),o.createElement("p",null,this.props.text),o.createElement("a",{href:"#",className:"c-snackbar-actions",onClick:this.onClick},this.props.buttonText))))},t})(o.Component);t.ErrorSnackbar=r}),define("modules/clean/react/previews/pdf_viewer/event_emitter",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventEmitter=new n}),define("modules/clean/react/previews/pdf_viewer/font",["require","exports"],function(e,t){"use strict";function n(e){var t=e.n.lastIndexOf(",");return{fontFamily:'"'+(t>-1?e.n.substr(0,t):e.n)+'", '+(1&e.f?"monospace":"serif"),isBold:(e.f&1<<18)>0,isItalic:(64&e.f)>0}}Object.defineProperty(t,"__esModule",{value:!0});t.renderFont=n}),define("modules/clean/react/previews/pdf_viewer/frame_messenger_shims",["require","exports","tslib","external/eventemitter3","modules/clean/frame_messenger/frame_messenger_client","modules/clean/frame_messenger/frame_messenger_host"],function(e,t,n,o,i,r){"use strict";function s(){return{parentEmitter:new o,childEmitter:new o}}Object.defineProperty(t,"__esModule",{value:!0});t.makeChannel=s;var a=(function(e){function t(t){var n=e.call(this,[])||this;return n.eventListener=function(e){n.validActions.indexOf(e.action)>-1&&n.handler(e)},n.channel=t,n}return n.__extends(t,e),t.prototype.configureChildMessaging=function(e,t,n){this.handler=t,this.validActions=n},t.prototype.startListening=function(){this.channel.childEmitter.on("message",this.eventListener)},t.prototype.stopListening=function(){this.channel.childEmitter.off("message",this.eventListener)},t.prototype.postMessageToChildren=function(e,t){void 0===t&&(t={}),this.channel.parentEmitter.emit("message",{action:e,parameters:t})},t})(r.FrameMessengerHost);t.FrameMessengerHostShim=a;var l=(function(e){function t(t){var n=e.call(this,[])||this;return n.eventListener=function(e){n.validActions.indexOf(e.action)>-1&&n.handler(e)},n.channel=t,n}return n.__extends(t,e),t.prototype.configureParentMessaging=function(e,t,n){void 0===n&&(n=null),this.validActions=t,this.handler=e},t.prototype.postMessageToParent=function(e,t){void 0===t&&(t={}),this.channel.childEmitter.emit("message",{action:e,parameters:t})},t.prototype.startListening=function(){this.channel.parentEmitter.on("message",this.eventListener)},t.prototype.stopListening=function(){this.channel.parentEmitter.off("message",this.eventListener)},t})(i.FrameMessengerClient);t.FrameMessengerClientShim=l}),define("modules/clean/react/previews/pdf_viewer/links_layer",["require","exports","tslib","external/react","modules/clean/referrer_cleansing_redirect","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";function s(e){return!!e.ur}Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.links.map(function(e,t){var n=e.a,a={position:"absolute",bottom:e.r[1],left:e.r[0],width:e.r[2],height:e.r[3]};return s(n)?o.createElement("a",{key:t,style:a,href:i.get_redirect_uri(n.ur).toString(),target:"_blank",rel:"noreferrer noopener","aria-label":r._("External Link")}):o.createElement("a",{key:t,style:a,href:"#pageContainer"+(n.pn+1),"aria-label":r._("Internal Link")})});return o.createElement("div",{className:"links-layer-inner"},e)},t})(o.PureComponent),l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"links-layer",style:{position:"absolute",top:0,left:0,width:this.props.width,height:this.props.height,transform:"scale("+this.props.clientScaleFactor+")",transformOrigin:"top left"}},o.createElement(a,{links:this.props.links}))},t})(o.PureComponent);t.LinksLayer=l}),define("modules/clean/react/previews/pdf_viewer/loading_indicator",["require","exports","external/react","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i){"use strict";function r(e){return n.createElement("div",{className:"loading-indicator-ssr"},n.createElement("img",{alt:i._("Loading"),src:o.static_url("/static/images/icons/fileviewer-loading-maestro@2x-vfl5LQSzg.gif"),width:"32",height:"32"}))}Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingIndicator=r}),define("modules/clean/react/previews/pdf_viewer/page",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/gutter_attributions/container","modules/clean/react/previews/pdf_viewer/annotation_creation_layer","modules/clean/react/previews/pdf_viewer/links_layer","modules/clean/react/previews/pdf_viewer/annotation_view_layer","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/previews/pdf_viewer/text_box","modules/clean/react/previews/pdf_viewer/timing","modules/clean/react/previews/pdf_viewer/zoom"],function(e,t,n,o,i,r,s,a,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onTextboxRender=function(){t.numTextboxes--,0===t.numTextboxes&&t.props.onRender()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){0===this.props.textboxes.length&&this.props.onRender()},t.prototype.render=function(){var e=this,t=this.props.textboxes;this.numTextboxes=t.length;var n=t.map(function(t,n){var i=t.t,r=t.r,s=t.d,a=r[0],l=r[1],c=r[2],p=r[3];return o.createElement(u.TextBox,{key:n,text:i,x:a,y:l,width:c,height:p,rotation:s,font:t.font,fontSize:t.h,onRender:e.onTextboxRender})});return o.createElement("div",{className:"text-layer-inner"},n)},t})(o.PureComponent),_=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e={position:"absolute",top:0,left:0,width:this.props.width,height:this.props.height,transform:"scale("+this.props.clientScaleFactor+")",transformOrigin:"top left"};return o.createElement("div",{className:"textLayer",style:e},o.createElement(h,{textboxes:this.props.textboxes,onRender:this.props.onRender}))},t})(o.PureComponent);t.TextLayer=_;var m=(function(){function e(){this.imageLoad=new p.TimingStat,this.pageRender=new p.TimingStat}return e})(),f=(function(e){function t(t){var n=e.call(this,t)||this;return n.timingStats=new m,n.imageLoaded=!1,n.textRendered=!1,n.hasError=!1,n.imageElRef=function(e){return n.imageEl=e},n.onMouseDown=function(e){n.updateOffset(),n.annotationCreationDelegate.onMouseDownCallback(e)},n.onMouseMove=function(e){e.persist(),n.annotationCreationDelegate.onMouseMoveCallback(e)},n.onMouseUp=function(e){n.annotationCreationDelegate.onMouseUpCallback(e)},n.onImageLoaded=function(){n.imageLoaded||(n.imageLoaded=!0,n.timingStats.imageLoad.timeEnd(),n.props.onImageLoad&&n.props.onImageLoad(n.props.pageIndex,n.timingStats.imageLoad),n.onTimingEventCompleted())},n.onTextRendered=function(){n.textRendered||(n.textRendered=!0,n.onTimingEventCompleted())},n.shouldMarkTimingEventCompleted=function(){return n.imageLoaded&&(n.props.loadImageOnly||n.textRendered)},n.onTimingEventCompleted=function(){n.shouldMarkTimingEventCompleted()&&(n.timingStats.pageRender.timeEnd(),!n.props.isVirtual&&n.props.onRenderComplete&&n.props.onRenderComplete(n.props.pageIndex,n.timingStats.pageRender))},n.onError=function(){n.hasError=!0,n.props.onImageError&&n.props.onImageError(n.props.pageIndex)},n.state={},n.annotationCreationDelegate={onMouseDownCallback:function(e){},onMouseMoveCallback:function(e){},onMouseUpCallback:function(e){}},n}return n.__extends(t,e),t.prototype.updateOffset=function(){var e=i.findDOMNode(this),t=e.getBoundingClientRect();this.setState({offset:{top:t.top,right:t.right,bottom:t.bottom,left:t.left}})},t.prototype.startTiming=function(){this.timingStats=new m,this.timingStats.imageLoad.time(),this.timingStats.pageRender.time()},t.prototype.componentWillMount=function(){this.startTiming()},t.prototype.componentDidMount=function(){this.updateOffset(),this.imageEl&&this.imageEl.complete&&!this.hasError&&this.onImageLoaded()},t.prototype.componentWillUpdate=function(e,t){this.props.pageIndex!==e.pageIndex&&(this.imageLoaded=!1,this.textRendered=!1,this.hasError=!1,this.startTiming())},t.prototype.render=function(){var e=null,t=null,n=null,i=null,u=null,p=null,h=null,m="";if(!this.props.isVirtual){h=this.props.pageIndex+1,m="pageContainer"+h;var f="pageImage"+h,v=d.calculatedFetchedScaleFactor(this.props.clientScaleFactor,this.props);n=o.createElement("div",{className:"page-image-wrapper"},o.createElement("img",{ref:this.imageElRef,alt:"",key:f,width:"100%","aria-hidden":"true",src:c.imageUrl(this.props.pageIndex,100*v),onLoad:this.onImageLoaded,onError:this.onError})),this.props.loadImageOnly||(e=o.createElement(_,{width:this.props.originalWidth,height:this.props.originalHeight,textboxes:this.props.textboxes||[],clientScaleFactor:this.props.clientScaleFactor,onRender:this.onTextRendered}),t=o.createElement(a.LinksLayer,{width:this.props.originalWidth,height:this.props.originalHeight,links:this.props.links||[],clientScaleFactor:this.props.clientScaleFactor})),i=o.createElement(l.AnnotationViewLayer,{annotations:this.props.annotations||[],page:h,width:this.props.originalWidth,height:this.props.originalHeight,scaleFactor:this.props.clientScaleFactor,frameMessenger:this.props.frameMessenger});var g=!!this.props.isAnnotationCreationEnabled;g&&(u=o.createElement(s.AnnotationCreationLayer,{pageNumber:h,width:this.props.originalWidth,height:this.props.originalHeight,scaleFactor:this.props.clientScaleFactor,parentOffset:this.state.offset,delegate:this.annotationCreationDelegate,frameMessenger:this.props.frameMessenger,isAnnotationCreationEnabled:g,isAnnotationHighlightEnabled:!!this.props.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:!!this.props.isAnnotationRegionEnabled})),this.props.attributions&&(p=o.createElement(r.GutterAttributionsContainer,{attributions:this.props.attributions,accounts:this.props.accounts}))}var y=o.createElement("div",{className:"c-loader"}),E={width:this.props.scaledWidth,height:this.props.scaledHeight};return o.createElement("div",{id:m,className:"page","data-page-number":h,style:E,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp},y,n,e,t,p,i,u)},t})(o.PureComponent);t.Page=f}),define("modules/clean/react/previews/pdf_viewer/pdf_viewer",["require","exports","tslib","external/keymaster","external/react","external/underscore","external/classnames","modules/core/browser","modules/core/browser","modules/clean/react/previews/pdf_viewer/page","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/utils"],function(e,t,n,o,i,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(t){var n=e.call(this,t)||this;return n.pageContainerRef=function(e){return n.pageContainerDOM=e},n.updateTextLayerPageIndex=function(){n.setState({textLayerPage:n.state.currentPage})},n.debouncedUpdateTextLayerPageIndex=r.debounce(n.updateTextLayerPageIndex,200),n.onScrollTopChange=function(e){if(void 0===e&&(e=function(e){}),n.props.metadata&&n.props.clientScaleFactor){for(var t=n.pageContainerDOM.scrollTop+n.pageContainerDOM.clientHeight/2,o=0,i=n.props.clientScaleFactor,r=0,s=n.props.metadata.dimensions;r<s.length;r++){var a=s[r],l=(a[0],a[1]),c=a[2],u=(l*i+18)*c;if(!(t>u)){o+=Math.floor((t+1)/(l*i+18));break}t-=u,o+=c}o!==n.state.currentPage?n.onPageNumberUpdated(o,function(){return e(o)}):e(o)}},n.throttledOnScrollTopChange=r.throttle(n.onScrollTopChange,100),n.debouncedOnScrollTopChange=r.debounce(n.onScrollTopChange,200),n.maxScrollSpeed=100,n.onScroll=function(){var e=n.checkScrollSpeed();if(Math.abs(e)>n.maxScrollSpeed)return void n.debouncedOnScrollTopChange();n.throttledOnScrollTopChange(),n.debouncedUpdateTextLayerPageIndex()},n.lastPos=null,n.checkScrollSpeed=function(){var e=0,t=n.pageContainerDOM.scrollTop;return null!==n.lastPos&&(e=t-n.lastPos),n.lastPos=t,e},n.pageDown=function(){n.setPage(n.state.currentPage+1)},n.pageUp=function(){n.setPage(n.state.currentPage-1)},n.onSetCurrentPage=function(e){n.setPage(e,function(t){u.eventEmitter.emit("page-set-to",t,e)})},n.onPageRenderComplete=function(e,t){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,e===n.state.currentPage)},n.onPageImageLoad=function(e,t){n.props.onPageImageLoad&&n.props.onPageImageLoad(e,t,e===n.state.currentPage)},n.state={currentPage:0,textLayerPage:0,fetchedImageScaleFactor:0},n.isMobileOrTablet=a.is_mobile_or_tablet(),n.backwardBatchSize=n.isMobileOrTablet?1:3,n.forwardBatchSize=n.isMobileOrTablet?2:4,n}return n.__extends(t,e),t.prototype.onPageNumberUpdated=function(e,t){void 0===t&&(t=function(){}),this.props.frameMessenger.postMessageToParent("page-change",{current_page:e+1,pages_count:this.props.metadata.page_count,doc_type:"default"}),this.setState({currentPage:e},t),u.eventEmitter.emit("scrolled-to-page",e)},t.prototype.setPage=function(e,t){if(void 0===t&&(t=function(e){}),!(e<0||e>=this.props.metadata.page_count)&&this.props.clientScaleFactor){for(var n=0,o=this.props.clientScaleFactor,i=0,r=this.props.metadata.dimensions;i<r.length;i++){var s=r[i],a=(s[0],s[1]),l=s[2];if(!(e>=l)){n+=(18+a*o)*e;break}n+=(18+a*o)*l,e-=l}this.pageContainerDOM.scrollTop=n,this.onScrollTopChange(t),this.updateTextLayerPageIndex()}},t.prototype.getStartPage=function(e){
return Math.max(0,e-this.backwardBatchSize)},t.prototype.getEndPage=function(e){return Math.min(this.props.metadata.page_count,e+this.forwardBatchSize)},t.prototype.componentDidMount=function(){u.eventEmitter.on("page-down",this.pageDown),u.eventEmitter.on("page-up",this.pageUp),u.eventEmitter.on("set-current-page",this.onSetCurrentPage),this.addKeyListeners()},t.prototype.componentWillReceiveProps=function(e){e.clientScaleFactor!==this.props.clientScaleFactor&&p.resetAnnotationState(this.props.frameMessenger,this.pageContainerDOM)},t.prototype.componentDidUpdate=function(e,t){if(this.pageContainerDOM&&this.props.clientScaleFactor&&e.clientScaleFactor&&this.props.clientScaleFactor!==e.clientScaleFactor){var n=this.pageContainerDOM.scrollTop,o=18*(this.state.currentPage+1);n>o&&(this.pageContainerDOM.scrollTop=(n-o)*(this.props.clientScaleFactor/e.clientScaleFactor)+o),this.maxScrollSpeed*=e.clientScaleFactor/this.props.clientScaleFactor}},t.prototype.componentWillUnmount=function(){u.eventEmitter.off("page-down",this.pageDown),u.eventEmitter.off("page-up",this.pageUp),u.eventEmitter.off("set-current-page",this.onSetCurrentPage)},t.prototype.addKeyListeners=function(){var e=this;o("alt+down, pagedown","fileviewer",function(){e.pageDown()}),o("alt+up, pageup","fileviewer",function(){e.pageUp()})},t.prototype.render=function(){if(!this.props.clientScaleFactor)return null;for(var e=this.props,t=e.clientScaleFactor,n=e.metadata,o=this.props.annotations||[],r=this.props.attributions||[],a=this.getStartPage(this.state.currentPage),u=this.getEndPage(this.state.currentPage),d=this.getStartPage(this.state.textLayerPage),h=this.getEndPage(this.state.textLayerPage),_=p.expandDimensions(n.dimensions),m=[],f=a;f<u;f++){var v=_[f],g=v[0],y=v[1],E=g*t,S=y*t,b=f>=d&&f<h?this.props.text[f]:[],w=f>=d&&f<h?(this.props.links||{})[f]||[]:[];m.push(i.createElement(c.Page,{key:f,originalWidth:g,originalHeight:y,scaledWidth:E,scaledHeight:S,isVirtual:!1,pageIndex:f,clientScaleFactor:t,loadImageOnly:this.isMobileOrTablet,textboxes:b,links:w,accounts:this.props.accounts,annotations:o[f],attributions:r[f],frameMessenger:this.props.frameMessenger,isAnnotationCreationEnabled:this.props.isAnnotationCreationEnabled,isAnnotationHighlightEnabled:this.props.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:this.props.isAnnotationRegionEnabled,onRenderComplete:this.onPageRenderComplete,onImageLoad:this.onPageImageLoad,onImageError:this.props.onImageError}))}var C=a>0?p.getTotalSize(_.slice(0,a),t,18)[1]+18:0,T=p.getTotalSize(_,t,18)[1],A={height:T},I={top:C};return i.createElement("div",{className:s({"page-container":!0,"ios-enable-inertial-scroll":l.iOS}),onScroll:this.onScroll,ref:this.pageContainerRef},i.createElement("div",{style:A},i.createElement("div",{className:"page-container-inner",style:I},m)))},t})(i.PureComponent);t.PdfViewer=d}),define("modules/clean/react/previews/pdf_viewer/ppt_viewer",["require","exports","tslib","jquery","external/keymaster","external/react","external/underscore","modules/core/browser","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/page","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom","external/jquery.mousewheel"],function(e,t,n,o,i,r,s,a,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.slideContainerRef=function(e){return n.slideContainerDOM=e},n.onSetCurrentPage=function(e){n.setPage(e,function(){l.eventEmitter.emit("page-set-to",e,e)})},n.pageDown=function(){p.resetAnnotationState(n.props.frameMessenger,n.slideContainerDOM),n.setPage(n.state.currentPageIndex+1)},n.pageUp=function(){p.resetAnnotationState(n.props.frameMessenger,n.slideContainerDOM),n.setPage(n.state.currentPageIndex-1)},n.debouncedPageDown=s.debounce(n.pageDown,40,!0),n.debouncedPageUp=s.debounce(n.pageUp,40,!0),n.onPageRenderComplete=function(e,t){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,e===n.state.currentPageIndex)},n.onPageImageLoad=function(e,t){n.props.onPageImageLoad&&n.props.onPageImageLoad(e,t,e===n.state.currentPageIndex)},n.state={currentPageIndex:0},n}return n.__extends(t,e),t.fileSupported=function(e){return p.docTypeFromExtension(e)===t.DOC_TYPE},t.deviceSupported=function(){return!a.is_mobile_or_tablet()},t.prototype.componentDidMount=function(){l.eventEmitter.on("page-down",this.pageDown),l.eventEmitter.on("page-up",this.pageUp),l.eventEmitter.on("set-current-page",this.onSetCurrentPage),this.addListeners(),this.prefetchImageAroundPage(this.state.currentPageIndex)},t.prototype.componentWillUnmount=function(){l.eventEmitter.off("page-down",this.pageDown),l.eventEmitter.off("page-up",this.pageUp),l.eventEmitter.off("set-current-page",this.onSetCurrentPage)},t.prototype.addListeners=function(){var e=this;i("right, down, pagedown","fileviewer",function(){e.pageDown()}),i("left, up, pageup","fileviewer",function(){e.pageUp()}),o(this.slideContainerDOM).on("mousewheel",function(t){t.deltaY<0?e.debouncedPageDown():t.deltaY>0&&e.debouncedPageUp()})},t.prototype.prefetchImageAroundPage=function(e){for(var t=e+1;t<Math.min(e+5+1,this.props.metadata.page_count);t++){var n=this.pageDimension(t);p.prefetchImage(u.imageUrl(t,100*d.calculatedFetchedScaleFactor(this.props.clientScaleFactor||0,{originalWidth:n[0],originalHeight:n[1]})))}},t.prototype.setPage=function(e,n){void 0===n&&(n=function(){}),e<0||e>=this.props.metadata.page_count||(this.setState({currentPageIndex:e},n),this.props.frameMessenger.postMessageToParent("page-change",{current_page:e+1,pages_count:this.props.metadata.page_count,doc_type:t.DOC_TYPE}),l.eventEmitter.emit("scrolled-to-page",e),this.prefetchImageAroundPage(e))},t.prototype.pageDimension=function(e){return p.expandDimensions(this.props.metadata.dimensions)[e]},t.prototype.render=function(){if(!this.props.clientScaleFactor)return null;var e=this.pageDimension(this.state.currentPageIndex),t=e[0],n=e[1],o=this.state.currentPageIndex,i=this.props.annotations||[],s=this.props.attributions||[];return r.createElement("div",{className:"slide-container",ref:this.slideContainerRef},r.createElement(c.Page,{key:this.state.currentPageIndex,isVirtual:!1,pageIndex:o,textboxes:this.props.text[o],links:(this.props.links||{})[o]||[],originalWidth:t,originalHeight:n,clientScaleFactor:this.props.clientScaleFactor,scaledWidth:t*this.props.clientScaleFactor,scaledHeight:n*this.props.clientScaleFactor,onRenderComplete:this.onPageRenderComplete,onImageLoad:this.onPageImageLoad,frameMessenger:this.props.frameMessenger,loadImageOnly:!1,accounts:this.props.accounts,attributions:s[o],annotations:i[o],isAnnotationCreationEnabled:this.props.isAnnotationCreationEnabled,isAnnotationHighlightEnabled:this.props.isAnnotationHighlightEnabled,isAnnotationRegionEnabled:this.props.isAnnotationRegionEnabled,onImageError:this.props.onImageError}))},t})(r.PureComponent);h.DOC_TYPE="spp",t.PowerPointViewer=h}),define("modules/clean/react/previews/pdf_viewer/printable",["require","exports","tslib","external/react","external/react-dom","external/underscore","modules/clean/react/previews/pdf_viewer/progress_bar","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/previews/pdf_viewer/utils","modules/core/exception"],function(e,t,n,o,i,r,s,a,l,c){"use strict";function u(e){var t=window.open("about:blank"),n=r.max(e.dimensions,function(e){return e[2]}),s=n[0]/72,a=n[1]/72;window.setTimeout(function(){var n=t.document.createElement("style");n.innerHTML="\n      @page { margin: 0; size: "+s+"in "+a+"in; }\n      img { width: 100%; }\n      .print-progress { height: 8px; background-color: #0070E0; float: left; }\n    ",t.document.head.appendChild(n);var r=t.document.createElement("div");t.document.body.appendChild(r);var l=function(){t.print()};i.render(o.createElement(p,{metadata:e,document:t.document,onLoad:l}),r)},50)}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.imagesLoaded={},t.state={numImagesLoaded:0},t.onImageResolve=function(e){return function(){t.imagesLoaded[e]||(t.imagesLoaded[e]=!0,t.setState(function(e,t){return{numImagesLoaded:e.numImagesLoaded+1}}))}},t}return n.__extends(t,e),t.prototype.printIfReady=function(){if(c.assert(this.state.numImagesLoaded<=this.props.metadata.page_count),this.state.numImagesLoaded===this.props.metadata.page_count&&this.props.onLoad)return void this.props.onLoad()},t.prototype.componentDidMount=function(){for(var e=0,t=this.props.document.getElementsByTagName("img"),n=0;n<t.length;n++)t[n].complete&&e++;this.setState({numImagesLoaded:e})},t.prototype.componentDidUpdate=function(e,t){this.printIfReady()},t.prototype.render=function(){var e=this,t={pageBreakInside:"avoid",pageBreakAfter:"always"};return o.createElement("div",null,o.createElement(s.ProgressBar,{totalImages:this.props.metadata.page_count,numImagesLoaded:this.state.numImagesLoaded}),l.mapPages(this.props.metadata.dimensions,function(n,i,r){return o.createElement("img",{key:n,src:a.imageUrl(n),style:t,onLoad:e.onImageResolve(n),onError:e.onImageResolve(n),alt:""+(n+1)})}))},t})(o.Component);t.Printable=p,t.print=u}),define("modules/clean/react/previews/pdf_viewer/progress_bar",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.calculatePercentComplete=function(){return this.props.numImagesLoaded/this.props.totalImages*100},t.prototype.render=function(){var e={width:this.calculatePercentComplete()+"%"};return o.createElement("div",{className:"print-progress",style:e})},t})(o.PureComponent);t.ProgressBar=i}),define("modules/clean/react/previews/pdf_viewer/text/bidi",["require","exports"],function(e,t){"use strict";function n(e){return 0!==(1&e)}function o(e){return 0===(1&e)}function i(e,t,n){for(var o=t,i=e.length;o<i;++o)if(e[o]!==n)return o;return o}function r(e,t,n,o){for(var i=t;i<n;++i)e[i]=o}function s(e,t,n){for(var o=t,i=n-1;o<i;++o,--i){var r=e[o];e[o]=e[i],e[i]=r}}function a(e,t,n){return{str:e,dir:n?"ttb":t?"ltr":"rtl"}}function l(e,t,l){var h=!0,_=e.length;if(0===_||l)return a(e,h,l);p.length=_,d.length=_;var m,f,v=0;for(m=0;m<_;++m){p[m]=e.charAt(m);var g=e.charCodeAt(m),y="L";g<=255?y=c[g]:1424<=g&&g<=1524?y="R":1536<=g&&g<=1791?y=u[255&g]:1792<=g&&g<=2220&&(y="AL"),"R"!==y&&"AL"!==y&&"AN"!==y||v++,d[m]=y}if(0===v)return h=!0,a(e,h);t===-1&&(v/_<.3?(h=!0,t=0):(h=!1,t=1));var E=[];for(m=0;m<_;++m)E[m]=t;var S=n(t)?"R":"L",b=S,w=b,C=b;for(m=0;m<_;++m)"NSM"===d[m]?d[m]=C:C=d[m];C=b;var T;for(m=0;m<_;++m)T=d[m],"EN"===T?d[m]="AL"===C?"AN":"EN":"R"!==T&&"L"!==T&&"AL"!==T||(C=T);for(m=0;m<_;++m)T=d[m],"AL"===T&&(d[m]="R");for(m=1;m<_-1;++m)"ES"===d[m]&&"EN"===d[m-1]&&"EN"===d[m+1]&&(d[m]="EN"),"CS"!==d[m]||"EN"!==d[m-1]&&"AN"!==d[m-1]||d[m+1]!==d[m-1]||(d[m]=d[m-1]);for(m=0;m<_;++m)if("EN"===d[m]){var A;for(A=m-1;A>=0&&"ET"===d[A];--A)d[A]="EN";for(A=m+1;A<_&&"ET"===d[A];++A)d[A]="EN"}for(m=0;m<_;++m)T=d[m],"WS"!==T&&"ES"!==T&&"ET"!==T&&"CS"!==T||(d[m]="ON");for(C=b,m=0;m<_;++m)T=d[m],"EN"===T?d[m]="L"===C?"L":"EN":"R"!==T&&"L"!==T||(C=T);for(m=0;m<_;++m)if("ON"===d[m]){var I=i(d,m+1,"ON"),P=b;m>0&&(P=d[m-1]);var R=w;I+1<_&&(R=d[I+1]),"L"!==P&&(P="R"),"L"!==R&&(R="R"),P===R&&r(d,m,I,P),m=I-1}for(m=0;m<_;++m)"ON"===d[m]&&(d[m]=S);for(m=0;m<_;++m)T=d[m],o(E[m])?"R"===T?E[m]+=1:"AN"!==T&&"EN"!==T||(E[m]+=2):"L"!==T&&"AN"!==T&&"EN"!==T||(E[m]+=1);var O,N=-1,L=99;for(m=0,f=E.length;m<f;++m)O=E[m],N<O&&(N=O),L>O&&n(O)&&(L=O);for(O=N;O>=L;--O){var M=-1;for(m=0,f=E.length;m<f;++m)E[m]<O?M>=0&&(s(p,M,m),M=-1):M<0&&(M=m);M>=0&&s(p,M,E.length)}for(m=0,f=p.length;m<f;++m){var k=p[m];"<"!==k&&">"!==k||(p[m]="")}return a(p.join(""),h)}Object.defineProperty(t,"__esModule",{value:!0});var c=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","ON","ON","ET","ET","ET","ON","ON","ON","ON","ON","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","ON","ET","ET","ET","ET","ON","ON","ON","ON","L","ON","ON","BN","ON","ON","ET","ET","EN","EN","ON","L","ON","ON","ON","EN","L","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L"],u=["AN","AN","AN","AN","AN","AN","ON","ON","AL","ET","ET","AL","CS","AL","ON","ON","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","ON","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","ON","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL"],p=[],d=[];t.bidi=l}),define("modules/clean/react/previews/pdf_viewer/text/unicode",["require","exports"],function(e,t){"use strict";function n(e){var t;return function(){return e&&(t=Object.create(null),e(t),e=null),t}}function o(e){var t=r[13];return e>=t.begin&&e<t.end||(t=r[11],e>=t.begin&&e<t.end)}function i(e){var t=e.length;if(t<=1||!o(e.charCodeAt(0)))return e;for(var n="",i=t-1;i>=0;i--)n+=e[i];return n}Object.defineProperty(t,"__esModule",{value:!0});var r=(n(function(e){e[63721]=169,e[63193]=169,e[63720]=174,e[63194]=174,e[63722]=8482,e[63195]=8482,e[63729]=9127,e[63730]=9128,e[63731]=9129,e[63740]=9131,e[63741]=9132,e[63742]=9133,e[63726]=9121,e[63727]=9122,e[63728]=9123,e[63737]=9124,e[63738]=9125,e[63739]=9126,e[63723]=9115,e[63724]=9116,e[63725]=9117,e[63734]=9118,e[63735]=9119,e[63736]=9120}),[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}]);t.getNormalizedUnicodes=n(function(e){e["¨"]=" ̈",e["¯"]=" ̄",e["´"]=" ́",e["µ"]="μ",e["¸"]=" ̧",e["Ĳ"]="IJ",e["ĳ"]="ij",e["Ŀ"]="L·",e["ŀ"]="l·",e["ŉ"]="ʼn",e["ſ"]="s",e["Ǆ"]="DŽ",e["ǅ"]="Dž",e["ǆ"]="dž",e["Ǉ"]="LJ",e["ǈ"]="Lj",e["ǉ"]="lj",e["Ǌ"]="NJ",e["ǋ"]="Nj",e["ǌ"]="nj",e["Ǳ"]="DZ",e["ǲ"]="Dz",e["ǳ"]="dz",e["˘"]=" ̆",e["˙"]=" ̇",e["˚"]=" ̊",e["˛"]=" ̨",e["˜"]=" ̃",e["˝"]=" ̋",e["ͺ"]=" ͅ",e["΄"]=" ́",e["ϐ"]="β",e["ϑ"]="θ",e["ϒ"]="Υ",e["ϕ"]="φ",e["ϖ"]="π",e["ϰ"]="κ",e["ϱ"]="ρ",e["ϲ"]="ς",e["ϴ"]="Θ",e["ϵ"]="ε",e["Ϲ"]="Σ",e["և"]="եւ",e["ٵ"]="اٴ",e["ٶ"]="وٴ",e["ٷ"]="ۇٴ",e["ٸ"]="يٴ",e["ำ"]="ํา",e["ຳ"]="ໍາ",e["ໜ"]="ຫນ",e["ໝ"]="ຫມ",e["ཷ"]="ྲཱྀ",e["ཹ"]="ླཱྀ",e["ẚ"]="aʾ",e["᾽"]=" ̓",e["᾿"]=" ̓",e["῀"]=" ͂",e["῾"]=" ̔",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e[" "]=" ",e["‗"]=" ̳",e["․"]=".",e["‥"]="..",e["…"]="...",e["″"]="′′",e["‴"]="′′′",e["‶"]="‵‵",e["‷"]="‵‵‵",e["‼"]="!!",e["‾"]=" ̅",e["⁇"]="??",e["⁈"]="?!",e["⁉"]="!?",e["⁗"]="′′′′",e[" "]=" ",e["₨"]="Rs",e["℀"]="a/c",e["℁"]="a/s",e["℃"]="°C",e["℅"]="c/o",e["℆"]="c/u",e["ℇ"]="Ɛ",e["℉"]="°F",e["№"]="No",e["℡"]="TEL",e["ℵ"]="א",e["ℶ"]="ב",e["ℷ"]="ג",e["ℸ"]="ד",e["℻"]="FAX",e["Ⅰ"]="I",e["Ⅱ"]="II",e["Ⅲ"]="III",e["Ⅳ"]="IV",e["Ⅴ"]="V",e["Ⅵ"]="VI",e["Ⅶ"]="VII",e["Ⅷ"]="VIII",e["Ⅸ"]="IX",e["Ⅹ"]="X",e["Ⅺ"]="XI",e["Ⅻ"]="XII",e["Ⅼ"]="L",e["Ⅽ"]="C",e["Ⅾ"]="D",e["Ⅿ"]="M",e["ⅰ"]="i",e["ⅱ"]="ii",e["ⅲ"]="iii",e["ⅳ"]="iv",e["ⅴ"]="v",e["ⅵ"]="vi",e["ⅶ"]="vii",e["ⅷ"]="viii",e["ⅸ"]="ix",e["ⅹ"]="x",e["ⅺ"]="xi",e["ⅻ"]="xii",e["ⅼ"]="l",e["ⅽ"]="c",e["ⅾ"]="d",e["ⅿ"]="m",e["∬"]="∫∫",e["∭"]="∫∫∫",e["∯"]="∮∮",e["∰"]="∮∮∮",e["⑴"]="(1)",e["⑵"]="(2)",e["⑶"]="(3)",e["⑷"]="(4)",e["⑸"]="(5)",e["⑹"]="(6)",e["⑺"]="(7)",e["⑻"]="(8)",e["⑼"]="(9)",e["⑽"]="(10)",e["⑾"]="(11)",e["⑿"]="(12)",e["⒀"]="(13)",e["⒁"]="(14)",e["⒂"]="(15)",e["⒃"]="(16)",e["⒄"]="(17)",e["⒅"]="(18)",e["⒆"]="(19)",e["⒇"]="(20)",e["⒈"]="1.",e["⒉"]="2.",e["⒊"]="3.",e["⒋"]="4.",e["⒌"]="5.",e["⒍"]="6.",e["⒎"]="7.",e["⒏"]="8.",e["⒐"]="9.",e["⒑"]="10.",e["⒒"]="11.",e["⒓"]="12.",e["⒔"]="13.",e["⒕"]="14.",e["⒖"]="15.",e["⒗"]="16.",e["⒘"]="17.",e["⒙"]="18.",e["⒚"]="19.",e["⒛"]="20.",e["⒜"]="(a)",e["⒝"]="(b)",e["⒞"]="(c)",e["⒟"]="(d)",e["⒠"]="(e)",e["⒡"]="(f)",e["⒢"]="(g)",e["⒣"]="(h)",e["⒤"]="(i)",e["⒥"]="(j)",e["⒦"]="(k)",e["⒧"]="(l)",e["⒨"]="(m)",e["⒩"]="(n)",e["⒪"]="(o)",e["⒫"]="(p)",e["⒬"]="(q)",e["⒭"]="(r)",e["⒮"]="(s)",e["⒯"]="(t)",e["⒰"]="(u)",e["⒱"]="(v)",e["⒲"]="(w)",e["⒳"]="(x)",e["⒴"]="(y)",e["⒵"]="(z)",e["⨌"]="∫∫∫∫",e["⩴"]="::=";e["⩵"]="==",e["⩶"]="===",e["⺟"]="母",e["⻳"]="龟",e["⼀"]="一",e["⼁"]="丨",e["⼂"]="丶",e["⼃"]="丿",e["⼄"]="乙",e["⼅"]="亅",e["⼆"]="二",e["⼇"]="亠",e["⼈"]="人",e["⼉"]="儿",e["⼊"]="入",e["⼋"]="八",e["⼌"]="冂",e["⼍"]="冖",e["⼎"]="冫",e["⼏"]="几",e["⼐"]="凵",e["⼑"]="刀",e["⼒"]="力",e["⼓"]="勹",e["⼔"]="匕",e["⼕"]="匚",e["⼖"]="匸",e["⼗"]="十",e["⼘"]="卜",e["⼙"]="卩",e["⼚"]="厂",e["⼛"]="厶",e["⼜"]="又",e["⼝"]="口",e["⼞"]="囗",e["⼟"]="土",e["⼠"]="士",e["⼡"]="夂",e["⼢"]="夊",e["⼣"]="夕",e["⼤"]="大",e["⼥"]="女",e["⼦"]="子",e["⼧"]="宀",e["⼨"]="寸",e["⼩"]="小",e["⼪"]="尢",e["⼫"]="尸",e["⼬"]="屮",e["⼭"]="山",e["⼮"]="巛",e["⼯"]="工",e["⼰"]="己",e["⼱"]="巾",e["⼲"]="干",e["⼳"]="幺",e["⼴"]="广",e["⼵"]="廴",e["⼶"]="廾",e["⼷"]="弋",e["⼸"]="弓",e["⼹"]="彐",e["⼺"]="彡",e["⼻"]="彳",e["⼼"]="心",e["⼽"]="戈",e["⼾"]="戶",e["⼿"]="手",e["⽀"]="支",e["⽁"]="攴",e["⽂"]="文",e["⽃"]="斗",e["⽄"]="斤",e["⽅"]="方",e["⽆"]="无",e["⽇"]="日",e["⽈"]="曰",e["⽉"]="月",e["⽊"]="木",e["⽋"]="欠",e["⽌"]="止",e["⽍"]="歹",e["⽎"]="殳",e["⽏"]="毋",e["⽐"]="比",e["⽑"]="毛",e["⽒"]="氏",e["⽓"]="气",e["⽔"]="水",e["⽕"]="火",e["⽖"]="爪",e["⽗"]="父",e["⽘"]="爻",e["⽙"]="爿",e["⽚"]="片",e["⽛"]="牙",e["⽜"]="牛",e["⽝"]="犬",e["⽞"]="玄",e["⽟"]="玉",e["⽠"]="瓜",e["⽡"]="瓦",e["⽢"]="甘",e["⽣"]="生",e["⽤"]="用",e["⽥"]="田",e["⽦"]="疋",e["⽧"]="疒",e["⽨"]="癶",e["⽩"]="白",e["⽪"]="皮",e["⽫"]="皿",e["⽬"]="目",e["⽭"]="矛",e["⽮"]="矢",e["⽯"]="石",e["⽰"]="示",e["⽱"]="禸",e["⽲"]="禾",e["⽳"]="穴",e["⽴"]="立",e["⽵"]="竹",e["⽶"]="米",e["⽷"]="糸",e["⽸"]="缶",e["⽹"]="网",e["⽺"]="羊",e["⽻"]="羽",e["⽼"]="老",e["⽽"]="而",e["⽾"]="耒",e["⽿"]="耳",e["⾀"]="聿",e["⾁"]="肉",e["⾂"]="臣",e["⾃"]="自",e["⾄"]="至",e["⾅"]="臼",e["⾆"]="舌",e["⾇"]="舛",e["⾈"]="舟",e["⾉"]="艮",e["⾊"]="色",e["⾋"]="艸",e["⾌"]="虍",e["⾍"]="虫",e["⾎"]="血",e["⾏"]="行",e["⾐"]="衣",e["⾑"]="襾",e["⾒"]="見",e["⾓"]="角",e["⾔"]="言",e["⾕"]="谷",e["⾖"]="豆",e["⾗"]="豕",e["⾘"]="豸",e["⾙"]="貝",e["⾚"]="赤",e["⾛"]="走",e["⾜"]="足",e["⾝"]="身",e["⾞"]="車",e["⾟"]="辛",e["⾠"]="辰",e["⾡"]="辵",e["⾢"]="邑",e["⾣"]="酉",e["⾤"]="釆",e["⾥"]="里",e["⾦"]="金",e["⾧"]="長",e["⾨"]="門",e["⾩"]="阜",e["⾪"]="隶",e["⾫"]="隹",e["⾬"]="雨",e["⾭"]="靑",e["⾮"]="非",e["⾯"]="面",e["⾰"]="革",e["⾱"]="韋",e["⾲"]="韭",e["⾳"]="音",e["⾴"]="頁",e["⾵"]="風",e["⾶"]="飛",e["⾷"]="食",e["⾸"]="首",e["⾹"]="香",e["⾺"]="馬",e["⾻"]="骨",e["⾼"]="高",e["⾽"]="髟",e["⾾"]="鬥",e["⾿"]="鬯",e["⿀"]="鬲",e["⿁"]="鬼",e["⿂"]="魚",e["⿃"]="鳥";e["⿄"]="鹵",e["⿅"]="鹿",e["⿆"]="麥",e["⿇"]="麻",e["⿈"]="黃",e["⿉"]="黍",e["⿊"]="黑",e["⿋"]="黹",e["⿌"]="黽",e["⿍"]="鼎",e["⿎"]="鼓",e["⿏"]="鼠",e["⿐"]="鼻",e["⿑"]="齊",e["⿒"]="齒",e["⿓"]="龍",e["⿔"]="龜",e["⿕"]="龠",e["〶"]="〒",e["〸"]="十",e["〹"]="卄",e["〺"]="卅",e["゛"]=" ゙",e["゜"]=" ゚",e["ㄱ"]="ᄀ",e["ㄲ"]="ᄁ",e["ㄳ"]="ᆪ",e["ㄴ"]="ᄂ",e["ㄵ"]="ᆬ",e["ㄶ"]="ᆭ",e["ㄷ"]="ᄃ",e["ㄸ"]="ᄄ",e["ㄹ"]="ᄅ",e["ㄺ"]="ᆰ",e["ㄻ"]="ᆱ",e["ㄼ"]="ᆲ",e["ㄽ"]="ᆳ",e["ㄾ"]="ᆴ",e["ㄿ"]="ᆵ",e["ㅀ"]="ᄚ",e["ㅁ"]="ᄆ",e["ㅂ"]="ᄇ",e["ㅃ"]="ᄈ",e["ㅄ"]="ᄡ",e["ㅅ"]="ᄉ",e["ㅆ"]="ᄊ",e["ㅇ"]="ᄋ",e["ㅈ"]="ᄌ",e["ㅉ"]="ᄍ",e["ㅊ"]="ᄎ",e["ㅋ"]="ᄏ",e["ㅌ"]="ᄐ",e["ㅍ"]="ᄑ",e["ㅎ"]="ᄒ",e["ㅏ"]="ᅡ",e["ㅐ"]="ᅢ",e["ㅑ"]="ᅣ",e["ㅒ"]="ᅤ",e["ㅓ"]="ᅥ",e["ㅔ"]="ᅦ",e["ㅕ"]="ᅧ",e["ㅖ"]="ᅨ",e["ㅗ"]="ᅩ",e["ㅘ"]="ᅪ",e["ㅙ"]="ᅫ",e["ㅚ"]="ᅬ",e["ㅛ"]="ᅭ",e["ㅜ"]="ᅮ",e["ㅝ"]="ᅯ",e["ㅞ"]="ᅰ",e["ㅟ"]="ᅱ",e["ㅠ"]="ᅲ",e["ㅡ"]="ᅳ",e["ㅢ"]="ᅴ",e["ㅣ"]="ᅵ",e["ㅤ"]="ᅠ",e["ㅥ"]="ᄔ",e["ㅦ"]="ᄕ",e["ㅧ"]="ᇇ",e["ㅨ"]="ᇈ",e["ㅩ"]="ᇌ",e["ㅪ"]="ᇎ",e["ㅫ"]="ᇓ",e["ㅬ"]="ᇗ",e["ㅭ"]="ᇙ",e["ㅮ"]="ᄜ",e["ㅯ"]="ᇝ",e["ㅰ"]="ᇟ",e["ㅱ"]="ᄝ",e["ㅲ"]="ᄞ",e["ㅳ"]="ᄠ",e["ㅴ"]="ᄢ",e["ㅵ"]="ᄣ",e["ㅶ"]="ᄧ",e["ㅷ"]="ᄩ",e["ㅸ"]="ᄫ",e["ㅹ"]="ᄬ",e["ㅺ"]="ᄭ",e["ㅻ"]="ᄮ",e["ㅼ"]="ᄯ",e["ㅽ"]="ᄲ",e["ㅾ"]="ᄶ",e["ㅿ"]="ᅀ",e["ㆀ"]="ᅇ",e["ㆁ"]="ᅌ",e["ㆂ"]="ᇱ",e["ㆃ"]="ᇲ",e["ㆄ"]="ᅗ",e["ㆅ"]="ᅘ",e["ㆆ"]="ᅙ",e["ㆇ"]="ᆄ",e["ㆈ"]="ᆅ",e["ㆉ"]="ᆈ",e["ㆊ"]="ᆑ",e["ㆋ"]="ᆒ",e["ㆌ"]="ᆔ",e["ㆍ"]="ᆞ",e["ㆎ"]="ᆡ",e["㈀"]="(ᄀ)",e["㈁"]="(ᄂ)",e["㈂"]="(ᄃ)",e["㈃"]="(ᄅ)",e["㈄"]="(ᄆ)",e["㈅"]="(ᄇ)",e["㈆"]="(ᄉ)",e["㈇"]="(ᄋ)",e["㈈"]="(ᄌ)",e["㈉"]="(ᄎ)",e["㈊"]="(ᄏ)",e["㈋"]="(ᄐ)",e["㈌"]="(ᄑ)",e["㈍"]="(ᄒ)",e["㈎"]="(가)",e["㈏"]="(나)",e["㈐"]="(다)",e["㈑"]="(라)",e["㈒"]="(마)",e["㈓"]="(바)",e["㈔"]="(사)",e["㈕"]="(아)",e["㈖"]="(자)",e["㈗"]="(차)",e["㈘"]="(카)",e["㈙"]="(타)",e["㈚"]="(파)",e["㈛"]="(하)",e["㈜"]="(주)",e["㈝"]="(오전)",e["㈞"]="(오후)",e["㈠"]="(一)",e["㈡"]="(二)",e["㈢"]="(三)",e["㈣"]="(四)",e["㈤"]="(五)",e["㈥"]="(六)",e["㈦"]="(七)",e["㈧"]="(八)",e["㈨"]="(九)",e["㈩"]="(十)",e["㈪"]="(月)",e["㈫"]="(火)",e["㈬"]="(水)",e["㈭"]="(木)",e["㈮"]="(金)",e["㈯"]="(土)",e["㈰"]="(日)",e["㈱"]="(株)",e["㈲"]="(有)",e["㈳"]="(社)",e["㈴"]="(名)",e["㈵"]="(特)",e["㈶"]="(財)",e["㈷"]="(祝)",e["㈸"]="(労)",e["㈹"]="(代)",e["㈺"]="(呼)",e["㈻"]="(学)",e["㈼"]="(監)",e["㈽"]="(企)",e["㈾"]="(資)",e["㈿"]="(協)",e["㉀"]="(祭)",e["㉁"]="(休)",e["㉂"]="(自)",e["㉃"]="(至)",e["㋀"]="1月",e["㋁"]="2月",e["㋂"]="3月",e["㋃"]="4月",e["㋄"]="5月",e["㋅"]="6月",e["㋆"]="7月",e["㋇"]="8月",e["㋈"]="9月",e["㋉"]="10月",e["㋊"]="11月",e["㋋"]="12月",e["㍘"]="0点",e["㍙"]="1点",e["㍚"]="2点";e["㍛"]="3点",e["㍜"]="4点",e["㍝"]="5点",e["㍞"]="6点",e["㍟"]="7点",e["㍠"]="8点",e["㍡"]="9点",e["㍢"]="10点",e["㍣"]="11点",e["㍤"]="12点",e["㍥"]="13点",e["㍦"]="14点",e["㍧"]="15点",e["㍨"]="16点",e["㍩"]="17点",e["㍪"]="18点",e["㍫"]="19点",e["㍬"]="20点",e["㍭"]="21点",e["㍮"]="22点",e["㍯"]="23点",e["㍰"]="24点",e["㏠"]="1日",e["㏡"]="2日",e["㏢"]="3日",e["㏣"]="4日",e["㏤"]="5日",e["㏥"]="6日",e["㏦"]="7日",e["㏧"]="8日",e["㏨"]="9日",e["㏩"]="10日",e["㏪"]="11日",e["㏫"]="12日",e["㏬"]="13日",e["㏭"]="14日",e["㏮"]="15日",e["㏯"]="16日",e["㏰"]="17日",e["㏱"]="18日",e["㏲"]="19日",e["㏳"]="20日",e["㏴"]="21日",e["㏵"]="22日",e["㏶"]="23日",e["㏷"]="24日",e["㏸"]="25日",e["㏹"]="26日",e["㏺"]="27日",e["㏻"]="28日",e["㏼"]="29日",e["㏽"]="30日",e["㏾"]="31日",e["ﬀ"]="ff",e["ﬁ"]="fi",e["ﬂ"]="fl",e["ﬃ"]="ffi",e["ﬄ"]="ffl",e["ﬅ"]="ſt",e["ﬆ"]="st",e["ﬓ"]="մն",e["ﬔ"]="մե",e["ﬕ"]="մի",e["ﬖ"]="վն",e["ﬗ"]="մխ",e["ﭏ"]="אל",e["ﭐ"]="ٱ",e["ﭑ"]="ٱ",e["ﭒ"]="ٻ",e["ﭓ"]="ٻ",e["ﭔ"]="ٻ",e["ﭕ"]="ٻ",e["ﭖ"]="پ",e["ﭗ"]="پ",e["ﭘ"]="پ",e["ﭙ"]="پ",e["ﭚ"]="ڀ",e["ﭛ"]="ڀ",e["ﭜ"]="ڀ",e["ﭝ"]="ڀ",e["ﭞ"]="ٺ",e["ﭟ"]="ٺ",e["ﭠ"]="ٺ",e["ﭡ"]="ٺ",e["ﭢ"]="ٿ",e["ﭣ"]="ٿ",e["ﭤ"]="ٿ",e["ﭥ"]="ٿ",e["ﭦ"]="ٹ",e["ﭧ"]="ٹ",e["ﭨ"]="ٹ",e["ﭩ"]="ٹ",e["ﭪ"]="ڤ",e["ﭫ"]="ڤ",e["ﭬ"]="ڤ",e["ﭭ"]="ڤ",e["ﭮ"]="ڦ",e["ﭯ"]="ڦ",e["ﭰ"]="ڦ",e["ﭱ"]="ڦ",e["ﭲ"]="ڄ",e["ﭳ"]="ڄ",e["ﭴ"]="ڄ",e["ﭵ"]="ڄ",e["ﭶ"]="ڃ",e["ﭷ"]="ڃ",e["ﭸ"]="ڃ",e["ﭹ"]="ڃ",e["ﭺ"]="چ",e["ﭻ"]="چ",e["ﭼ"]="چ",e["ﭽ"]="چ",e["ﭾ"]="ڇ",e["ﭿ"]="ڇ",e["ﮀ"]="ڇ",e["ﮁ"]="ڇ",e["ﮂ"]="ڍ",e["ﮃ"]="ڍ",e["ﮄ"]="ڌ",e["ﮅ"]="ڌ",e["ﮆ"]="ڎ",e["ﮇ"]="ڎ",e["ﮈ"]="ڈ",e["ﮉ"]="ڈ",e["ﮊ"]="ژ",e["ﮋ"]="ژ",e["ﮌ"]="ڑ",e["ﮍ"]="ڑ",e["ﮎ"]="ک",e["ﮏ"]="ک",e["ﮐ"]="ک",e["ﮑ"]="ک",e["ﮒ"]="گ",e["ﮓ"]="گ",e["ﮔ"]="گ",e["ﮕ"]="گ",e["ﮖ"]="ڳ",e["ﮗ"]="ڳ",e["ﮘ"]="ڳ",e["ﮙ"]="ڳ",e["ﮚ"]="ڱ",e["ﮛ"]="ڱ",e["ﮜ"]="ڱ",e["ﮝ"]="ڱ",e["ﮞ"]="ں",e["ﮟ"]="ں",e["ﮠ"]="ڻ",e["ﮡ"]="ڻ",e["ﮢ"]="ڻ",e["ﮣ"]="ڻ",e["ﮤ"]="ۀ",e["ﮥ"]="ۀ",e["ﮦ"]="ہ",e["ﮧ"]="ہ",e["ﮨ"]="ہ",e["ﮩ"]="ہ",e["ﮪ"]="ھ",e["ﮫ"]="ھ",e["ﮬ"]="ھ",e["ﮭ"]="ھ",e["ﮮ"]="ے",e["ﮯ"]="ے",e["ﮰ"]="ۓ",e["ﮱ"]="ۓ",e["ﯓ"]="ڭ",e["ﯔ"]="ڭ",e["ﯕ"]="ڭ",e["ﯖ"]="ڭ",e["ﯗ"]="ۇ",e["ﯘ"]="ۇ",e["ﯙ"]="ۆ",e["ﯚ"]="ۆ",e["ﯛ"]="ۈ",e["ﯜ"]="ۈ",e["ﯝ"]="ٷ",e["ﯞ"]="ۋ",e["ﯟ"]="ۋ",e["ﯠ"]="ۅ",e["ﯡ"]="ۅ",e["ﯢ"]="ۉ",e["ﯣ"]="ۉ",e["ﯤ"]="ې",e["ﯥ"]="ې",e["ﯦ"]="ې",e["ﯧ"]="ې",e["ﯨ"]="ى",e["ﯩ"]="ى",e["ﯪ"]="ئا",e["ﯫ"]="ئا",e["ﯬ"]="ئە",e["ﯭ"]="ئە",e["ﯮ"]="ئو",e["ﯯ"]="ئو",e["ﯰ"]="ئۇ",e["ﯱ"]="ئۇ",e["ﯲ"]="ئۆ",e["ﯳ"]="ئۆ",e["ﯴ"]="ئۈ",e["ﯵ"]="ئۈ",e["ﯶ"]="ئې";e["ﯷ"]="ئې",e["ﯸ"]="ئې",e["ﯹ"]="ئى",e["ﯺ"]="ئى",e["ﯻ"]="ئى",e["ﯼ"]="ی",e["ﯽ"]="ی",e["ﯾ"]="ی",e["ﯿ"]="ی",e["ﰀ"]="ئج",e["ﰁ"]="ئح",e["ﰂ"]="ئم",e["ﰃ"]="ئى",e["ﰄ"]="ئي",e["ﰅ"]="بج",e["ﰆ"]="بح",e["ﰇ"]="بخ",e["ﰈ"]="بم",e["ﰉ"]="بى",e["ﰊ"]="بي",e["ﰋ"]="تج",e["ﰌ"]="تح",e["ﰍ"]="تخ",e["ﰎ"]="تم",e["ﰏ"]="تى",e["ﰐ"]="تي",e["ﰑ"]="ثج",e["ﰒ"]="ثم",e["ﰓ"]="ثى",e["ﰔ"]="ثي",e["ﰕ"]="جح",e["ﰖ"]="جم",e["ﰗ"]="حج",e["ﰘ"]="حم",e["ﰙ"]="خج",e["ﰚ"]="خح",e["ﰛ"]="خم",e["ﰜ"]="سج",e["ﰝ"]="سح",e["ﰞ"]="سخ",e["ﰟ"]="سم",e["ﰠ"]="صح",e["ﰡ"]="صم",e["ﰢ"]="ضج",e["ﰣ"]="ضح",e["ﰤ"]="ضخ",e["ﰥ"]="ضم",e["ﰦ"]="طح",e["ﰧ"]="طم",e["ﰨ"]="ظم",e["ﰩ"]="عج",e["ﰪ"]="عم",e["ﰫ"]="غج",e["ﰬ"]="غم",e["ﰭ"]="فج",e["ﰮ"]="فح",e["ﰯ"]="فخ",e["ﰰ"]="فم",e["ﰱ"]="فى",e["ﰲ"]="في",e["ﰳ"]="قح",e["ﰴ"]="قم",e["ﰵ"]="قى",e["ﰶ"]="قي",e["ﰷ"]="كا",e["ﰸ"]="كج",e["ﰹ"]="كح",e["ﰺ"]="كخ",e["ﰻ"]="كل",e["ﰼ"]="كم",e["ﰽ"]="كى",e["ﰾ"]="كي",e["ﰿ"]="لج",e["ﱀ"]="لح",e["ﱁ"]="لخ",e["ﱂ"]="لم",e["ﱃ"]="لى",e["ﱄ"]="لي",e["ﱅ"]="مج",e["ﱆ"]="مح",e["ﱇ"]="مخ",e["ﱈ"]="مم",e["ﱉ"]="مى",e["ﱊ"]="مي",e["ﱋ"]="نج",e["ﱌ"]="نح",e["ﱍ"]="نخ",e["ﱎ"]="نم",e["ﱏ"]="نى",e["ﱐ"]="ني",e["ﱑ"]="هج",e["ﱒ"]="هم",e["ﱓ"]="هى",e["ﱔ"]="هي",e["ﱕ"]="يج",e["ﱖ"]="يح",e["ﱗ"]="يخ",e["ﱘ"]="يم",e["ﱙ"]="يى",e["ﱚ"]="يي",e["ﱛ"]="ذٰ",e["ﱜ"]="رٰ",e["ﱝ"]="ىٰ",e["ﱞ"]=" ٌّ",e["ﱟ"]=" ٍّ",e["ﱠ"]=" َّ",e["ﱡ"]=" ُّ",e["ﱢ"]=" ِّ",e["ﱣ"]=" ّٰ",e["ﱤ"]="ئر",e["ﱥ"]="ئز",e["ﱦ"]="ئم",e["ﱧ"]="ئن",e["ﱨ"]="ئى",e["ﱩ"]="ئي",e["ﱪ"]="بر",e["ﱫ"]="بز",e["ﱬ"]="بم",e["ﱭ"]="بن",e["ﱮ"]="بى",e["ﱯ"]="بي",e["ﱰ"]="تر",e["ﱱ"]="تز",e["ﱲ"]="تم",e["ﱳ"]="تن",e["ﱴ"]="تى",e["ﱵ"]="تي",e["ﱶ"]="ثر",e["ﱷ"]="ثز",e["ﱸ"]="ثم",e["ﱹ"]="ثن",e["ﱺ"]="ثى",e["ﱻ"]="ثي",e["ﱼ"]="فى",e["ﱽ"]="في",e["ﱾ"]="قى",e["ﱿ"]="قي",e["ﲀ"]="كا",e["ﲁ"]="كل",e["ﲂ"]="كم",e["ﲃ"]="كى",e["ﲄ"]="كي",e["ﲅ"]="لم",e["ﲆ"]="لى",e["ﲇ"]="لي",e["ﲈ"]="ما",e["ﲉ"]="مم",e["ﲊ"]="نر",e["ﲋ"]="نز",e["ﲌ"]="نم",e["ﲍ"]="نن",e["ﲎ"]="نى",e["ﲏ"]="ني",e["ﲐ"]="ىٰ",e["ﲑ"]="ير",e["ﲒ"]="يز",e["ﲓ"]="يم",e["ﲔ"]="ين",e["ﲕ"]="يى",e["ﲖ"]="يي",e["ﲗ"]="ئج",e["ﲘ"]="ئح",e["ﲙ"]="ئخ",e["ﲚ"]="ئم",e["ﲛ"]="ئه",e["ﲜ"]="بج",e["ﲝ"]="بح",e["ﲞ"]="بخ",e["ﲟ"]="بم",e["ﲠ"]="به",e["ﲡ"]="تج",e["ﲢ"]="تح",e["ﲣ"]="تخ",e["ﲤ"]="تم",e["ﲥ"]="ته",e["ﲦ"]="ثم",e["ﲧ"]="جح",e["ﲨ"]="جم",e["ﲩ"]="حج",e["ﲪ"]="حم",e["ﲫ"]="خج",e["ﲬ"]="خم",e["ﲭ"]="سج",e["ﲮ"]="سح",e["ﲯ"]="سخ",e["ﲰ"]="سم",e["ﲱ"]="صح",e["ﲲ"]="صخ",e["ﲳ"]="صم",e["ﲴ"]="ضج",e["ﲵ"]="ضح",e["ﲶ"]="ضخ",e["ﲷ"]="ضم",e["ﲸ"]="طح",e["ﲹ"]="ظم",e["ﲺ"]="عج",e["ﲻ"]="عم",e["ﲼ"]="غج",e["ﲽ"]="غم",e["ﲾ"]="فج";e["ﲿ"]="فح",e["ﳀ"]="فخ",e["ﳁ"]="فم",e["ﳂ"]="قح",e["ﳃ"]="قم",e["ﳄ"]="كج",e["ﳅ"]="كح",e["ﳆ"]="كخ",e["ﳇ"]="كل",e["ﳈ"]="كم",e["ﳉ"]="لج",e["ﳊ"]="لح",e["ﳋ"]="لخ",e["ﳌ"]="لم",e["ﳍ"]="له",e["ﳎ"]="مج",e["ﳏ"]="مح",e["ﳐ"]="مخ",e["ﳑ"]="مم",e["ﳒ"]="نج",e["ﳓ"]="نح",e["ﳔ"]="نخ",e["ﳕ"]="نم",e["ﳖ"]="نه",e["ﳗ"]="هج",e["ﳘ"]="هم",e["ﳙ"]="هٰ",e["ﳚ"]="يج",e["ﳛ"]="يح",e["ﳜ"]="يخ",e["ﳝ"]="يم",e["ﳞ"]="يه",e["ﳟ"]="ئم",e["ﳠ"]="ئه",e["ﳡ"]="بم",e["ﳢ"]="به",e["ﳣ"]="تم",e["ﳤ"]="ته",e["ﳥ"]="ثم",e["ﳦ"]="ثه",e["ﳧ"]="سم",e["ﳨ"]="سه",e["ﳩ"]="شم",e["ﳪ"]="شه",e["ﳫ"]="كل",e["ﳬ"]="كم",e["ﳭ"]="لم",e["ﳮ"]="نم",e["ﳯ"]="نه",e["ﳰ"]="يم",e["ﳱ"]="يه",e["ﳲ"]="ـَّ",e["ﳳ"]="ـُّ",e["ﳴ"]="ـِّ",e["ﳵ"]="طى",e["ﳶ"]="طي",e["ﳷ"]="عى",e["ﳸ"]="عي",e["ﳹ"]="غى",e["ﳺ"]="غي",e["ﳻ"]="سى",e["ﳼ"]="سي",e["ﳽ"]="شى",e["ﳾ"]="شي",e["ﳿ"]="حى",e["ﴀ"]="حي",e["ﴁ"]="جى",e["ﴂ"]="جي",e["ﴃ"]="خى",e["ﴄ"]="خي",e["ﴅ"]="صى",e["ﴆ"]="صي",e["ﴇ"]="ضى",e["ﴈ"]="ضي",e["ﴉ"]="شج",e["ﴊ"]="شح",e["ﴋ"]="شخ",e["ﴌ"]="شم",e["ﴍ"]="شر",e["ﴎ"]="سر",e["ﴏ"]="صر",e["ﴐ"]="ضر",e["ﴑ"]="طى",e["ﴒ"]="طي",e["ﴓ"]="عى",e["ﴔ"]="عي",e["ﴕ"]="غى",e["ﴖ"]="غي",e["ﴗ"]="سى",e["ﴘ"]="سي",e["ﴙ"]="شى",e["ﴚ"]="شي",e["ﴛ"]="حى",e["ﴜ"]="حي",e["ﴝ"]="جى",e["ﴞ"]="جي",e["ﴟ"]="خى",e["ﴠ"]="خي",e["ﴡ"]="صى",e["ﴢ"]="صي",e["ﴣ"]="ضى",e["ﴤ"]="ضي",e["ﴥ"]="شج",e["ﴦ"]="شح",e["ﴧ"]="شخ",e["ﴨ"]="شم",e["ﴩ"]="شر",e["ﴪ"]="سر",e["ﴫ"]="صر",e["ﴬ"]="ضر",e["ﴭ"]="شج",e["ﴮ"]="شح",e["ﴯ"]="شخ",e["ﴰ"]="شم",e["ﴱ"]="سه",e["ﴲ"]="شه",e["ﴳ"]="طم",e["ﴴ"]="سج",e["ﴵ"]="سح",e["ﴶ"]="سخ",e["ﴷ"]="شج",e["ﴸ"]="شح",e["ﴹ"]="شخ",e["ﴺ"]="طم",e["ﴻ"]="ظم",e["ﴼ"]="اً",e["ﴽ"]="اً",e["ﵐ"]="تجم",e["ﵑ"]="تحج",e["ﵒ"]="تحج",e["ﵓ"]="تحم",e["ﵔ"]="تخم",e["ﵕ"]="تمج",e["ﵖ"]="تمح",e["ﵗ"]="تمخ",e["ﵘ"]="جمح",e["ﵙ"]="جمح",e["ﵚ"]="حمي",e["ﵛ"]="حمى",e["ﵜ"]="سحج",e["ﵝ"]="سجح",e["ﵞ"]="سجى",e["ﵟ"]="سمح",e["ﵠ"]="سمح",e["ﵡ"]="سمج",e["ﵢ"]="سمم",e["ﵣ"]="سمم",e["ﵤ"]="صحح",e["ﵥ"]="صحح",e["ﵦ"]="صمم",e["ﵧ"]="شحم",e["ﵨ"]="شحم",e["ﵩ"]="شجي",e["ﵪ"]="شمخ",e["ﵫ"]="شمخ",e["ﵬ"]="شمم",e["ﵭ"]="شمم",e["ﵮ"]="ضحى",e["ﵯ"]="ضخم",e["ﵰ"]="ضخم",e["ﵱ"]="طمح",e["ﵲ"]="طمح",e["ﵳ"]="طمم",e["ﵴ"]="طمي",e["ﵵ"]="عجم",e["ﵶ"]="عمم",e["ﵷ"]="عمم",e["ﵸ"]="عمى",
e["ﵹ"]="غمم",e["ﵺ"]="غمي",e["ﵻ"]="غمى",e["ﵼ"]="فخم",e["ﵽ"]="فخم",e["ﵾ"]="قمح",e["ﵿ"]="قمم",e["ﶀ"]="لحم",e["ﶁ"]="لحي",e["ﶂ"]="لحى",e["ﶃ"]="لجج",e["ﶄ"]="لجج",e["ﶅ"]="لخم",e["ﶆ"]="لخم",e["ﶇ"]="لمح",e["ﶈ"]="لمح",e["ﶉ"]="محج",e["ﶊ"]="محم",e["ﶋ"]="محي",e["ﶌ"]="مجح",e["ﶍ"]="مجم",e["ﶎ"]="مخج",e["ﶏ"]="مخم",e["ﶒ"]="مجخ",e["ﶓ"]="همج",e["ﶔ"]="همم",e["ﶕ"]="نحم",e["ﶖ"]="نحى",e["ﶗ"]="نجم",e["ﶘ"]="نجم",e["ﶙ"]="نجى",e["ﶚ"]="نمي";e["ﶛ"]="نمى",e["ﶜ"]="يمم",e["ﶝ"]="يمم",e["ﶞ"]="بخي",e["ﶟ"]="تجي",e["ﶠ"]="تجى",e["ﶡ"]="تخي",e["ﶢ"]="تخى",e["ﶣ"]="تمي",e["ﶤ"]="تمى",e["ﶥ"]="جمي",e["ﶦ"]="جحى",e["ﶧ"]="جمى",e["ﶨ"]="سخى",e["ﶩ"]="صحي",e["ﶪ"]="شحي",e["ﶫ"]="ضحي",e["ﶬ"]="لجي",e["ﶭ"]="لمي",e["ﶮ"]="يحي",e["ﶯ"]="يجي",e["ﶰ"]="يمي",e["ﶱ"]="ممي",e["ﶲ"]="قمي",e["ﶳ"]="نحي",e["ﶴ"]="قمح",e["ﶵ"]="لحم",e["ﶶ"]="عمي",e["ﶷ"]="كمي",e["ﶸ"]="نجح",e["ﶹ"]="مخي",e["ﶺ"]="لجم",e["ﶻ"]="كمم",e["ﶼ"]="لجم",e["ﶽ"]="نجح",e["ﶾ"]="جحي",e["ﶿ"]="حجي",e["ﷀ"]="مجي",e["ﷁ"]="فمي",e["ﷂ"]="بحي",e["ﷃ"]="كمم",e["ﷄ"]="عجم",e["ﷅ"]="صمم",e["ﷆ"]="سخي",e["ﷇ"]="نجي",e["﹉"]="‾",e["﹊"]="‾",e["﹋"]="‾",e["﹌"]="‾",e["﹍"]="_",e["﹎"]="_",e["﹏"]="_",e["ﺀ"]="ء",e["ﺁ"]="آ",e["ﺂ"]="آ",e["ﺃ"]="أ",e["ﺄ"]="أ",e["ﺅ"]="ؤ",e["ﺆ"]="ؤ",e["ﺇ"]="إ",e["ﺈ"]="إ",e["ﺉ"]="ئ",e["ﺊ"]="ئ",e["ﺋ"]="ئ",e["ﺌ"]="ئ",e["ﺍ"]="ا",e["ﺎ"]="ا",e["ﺏ"]="ب",e["ﺐ"]="ب",e["ﺑ"]="ب",e["ﺒ"]="ب",e["ﺓ"]="ة",e["ﺔ"]="ة",e["ﺕ"]="ت",e["ﺖ"]="ت",e["ﺗ"]="ت",e["ﺘ"]="ت",e["ﺙ"]="ث",e["ﺚ"]="ث",e["ﺛ"]="ث",e["ﺜ"]="ث",e["ﺝ"]="ج",e["ﺞ"]="ج",e["ﺟ"]="ج",e["ﺠ"]="ج",e["ﺡ"]="ح",e["ﺢ"]="ح",e["ﺣ"]="ح",e["ﺤ"]="ح",e["ﺥ"]="خ",e["ﺦ"]="خ",e["ﺧ"]="خ",e["ﺨ"]="خ",e["ﺩ"]="د",e["ﺪ"]="د",e["ﺫ"]="ذ",e["ﺬ"]="ذ",e["ﺭ"]="ر",e["ﺮ"]="ر",e["ﺯ"]="ز",e["ﺰ"]="ز",e["ﺱ"]="س",e["ﺲ"]="س",e["ﺳ"]="س",e["ﺴ"]="س",e["ﺵ"]="ش",e["ﺶ"]="ش",e["ﺷ"]="ش",e["ﺸ"]="ش",e["ﺹ"]="ص",e["ﺺ"]="ص",e["ﺻ"]="ص",e["ﺼ"]="ص",e["ﺽ"]="ض",e["ﺾ"]="ض",e["ﺿ"]="ض",e["ﻀ"]="ض",e["ﻁ"]="ط",e["ﻂ"]="ط",e["ﻃ"]="ط",e["ﻄ"]="ط",e["ﻅ"]="ظ",e["ﻆ"]="ظ",e["ﻇ"]="ظ",e["ﻈ"]="ظ",e["ﻉ"]="ع",e["ﻊ"]="ع",e["ﻋ"]="ع",e["ﻌ"]="ع",e["ﻍ"]="غ",e["ﻎ"]="غ",e["ﻏ"]="غ",e["ﻐ"]="غ",e["ﻑ"]="ف",e["ﻒ"]="ف",e["ﻓ"]="ف",e["ﻔ"]="ف",e["ﻕ"]="ق",e["ﻖ"]="ق",e["ﻗ"]="ق",e["ﻘ"]="ق",e["ﻙ"]="ك",e["ﻚ"]="ك",e["ﻛ"]="ك",e["ﻜ"]="ك",e["ﻝ"]="ل",e["ﻞ"]="ل",e["ﻟ"]="ل",e["ﻠ"]="ل",e["ﻡ"]="م",e["ﻢ"]="م",e["ﻣ"]="م",e["ﻤ"]="م",e["ﻥ"]="ن",e["ﻦ"]="ن",e["ﻧ"]="ن",e["ﻨ"]="ن",e["ﻩ"]="ه",e["ﻪ"]="ه",e["ﻫ"]="ه",e["ﻬ"]="ه",e["ﻭ"]="و",e["ﻮ"]="و",e["ﻯ"]="ى",e["ﻰ"]="ى",e["ﻱ"]="ي",e["ﻲ"]="ي",e["ﻳ"]="ي",e["ﻴ"]="ي",e["ﻵ"]="لآ",e["ﻶ"]="لآ",e["ﻷ"]="لأ",e["ﻸ"]="لأ",e["ﻹ"]="لإ",e["ﻺ"]="لإ",e["ﻻ"]="لا",e["ﻼ"]="لا"}),t.reverseIfRtl=i}),define("modules/clean/react/previews/pdf_viewer/text_box",["require","exports","tslib","external/react","modules/clean/react/previews/pdf_viewer/text/bidi","modules/clean/react/previews/pdf_viewer/text/unicode","modules/clean/referrer_cleansing_redirect"],function(e,t,n,o,i,r,s){"use strict";function a(e,t){t.length>0&&e.push(t)}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.createAnchor=function(e){var t=s.get_redirect_uri("http"===e.substr(0,4)?e:"http://"+e).toString();return o.createElement("a",{href:t,target:"_blank",rel:"noreferrer noopener"},e)},t.prototype.render=function(){var e=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;if("string"==typeof this.props.children){for(var t=this.props.children,n=[],i=void 0,r=0;i=e.exec(t);){var s=i[0];a(n,t.slice(r,e.lastIndex-s.length)),n.push(this.createAnchor(s)),r=e.lastIndex}return a(n,t.slice(r)),o.createElement.apply(o,["span",{}].concat(n))}return null},t})(o.PureComponent);t.LinkedText=l;var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={xScale:1,yScale:1},t.ref=function(e){t.textElement=e},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(this.textElement){var e=this.props,t=e.text,n=e.width,o=e.height,i=e.fontSize;this.setState(this.scaleText(t,n,o,i),this.props.onRender)}},t.prototype.measureText=function(e,t){return e!==this.cachedText&&(this.cachedText=e,this.cachedTextWidth=t.clientWidth,this.cachedTextHeight=t.clientHeight),{textWidth:this.cachedTextWidth,textHeight:this.cachedTextHeight}},t.prototype.scaleText=function(e,t,n,o){var i=!0;if(e.length<=1)i=!1;else if(2===e.length){var r=e.charCodeAt(0),s=e.charCodeAt(1);r>=55296&&r<=56319&&s>=56320&&s<=57343&&(i=!1)}if(i){var a=this.measureText(e,this.textElement),l=a.textWidth,c=a.textHeight;return{xScale:t/l,yScale:o?1:n/c}}return{xScale:1,yScale:1}},t.prototype.componentWillReceiveProps=function(e){var t=e.text,n=e.width,o=e.height,i=e.fontSize;this.setState(this.scaleText(t,n,o,i))},t.prototype.render=function(){var e=this.props,t=e.text,n=e.x,s=e.y,a=e.rotation,c={left:n,bottom:s,transform:"rotate("+-a+"rad) scale("+this.state.xScale+", "+this.state.yScale+")"};this.props.font&&(c.fontFamily=this.props.font.fontFamily,this.props.font.isBold&&(c.fontWeight="bold"),this.props.font.isItalic&&(c.fontStyle="italic")),this.props.fontSize&&(c.fontSize=this.props.fontSize+"px");for(var u=r.getNormalizedUnicodes(),p="",d=0;d<t.length;d++){var h=t.charAt(d);void 0!==u[h]&&(h=u[h]),h=r.reverseIfRtl(h),p+=h}var _=i.bidi(p,-1,!1),m=_.str,f=_.dir;return o.createElement("p",{className:"textbox",style:c,ref:this.ref,dir:f},o.createElement(l,null,m))},t})(o.PureComponent);t.TextBox=c}),define("modules/clean/react/previews/pdf_viewer/timing",["require","exports"],function(e,t){"use strict";function n(){return i?window.performance.now():Date.now()}function o(){return new r}Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.OVERALL=0]="OVERALL",e[e.REQUEST=1]="REQUEST",e[e.RENDER=2]="RENDER"})(t.TimingEventType||(t.TimingEventType={}));var i=!(!window.performance||!window.performance.now),r=(function(){function e(){}return e.prototype.time=function(){return this.start=n(),this},e.prototype.timeEnd=function(){return void 0===this.end&&(this.end=n()),this},e.prototype.duration=function(){return this.end-this.start},e})();t.TimingStat=r,t.makeTimer=o}),define("modules/clean/react/previews/pdf_viewer/transform",["require","exports"],function(e,t){"use strict";function n(e,t,n){return n.map(function(e){return e.coordinates.map(function(e){return{x:e.x,y:t-e.y}})})}function o(e,t,n,o,i,r,s){return s.map(function(s){return{coordinates:s.map(function(e){return{x:(e.x-t)/r,y:i-(e.y-n)/r}}),page:e,page_size:{width:o,height:i}}})}Object.defineProperty(t,"__esModule",{value:!0}),t.transformPdfCoordinates=n,t.transformViewportCoordinates=o}),define("modules/clean/react/previews/pdf_viewer/urls",["require","exports","modules/core/uri"],function(e,t,n){"use strict";function o(e,t){return n.parse(e).updateQuery(t).toString()}function i(e){u=e}function r(e){p=e}function s(e){c=e}function a(e,t){void 0===t&&(t=0);var n=o(u,{page:e.toString(),scale_percent:t.toString()});return c&&(n=o(n,{canned_file_name:"spdf/audi.pdf."+e+".png"})),n}function l(e,t,n){var i=p;return e&&(i=o(i,{metadata:"1"})),void 0!==t&&(i=o(i,{text:"1",page_start:""+t,page_end:""+n})),c&&(i=o(i,{canned_file_name:"spdf/audi.pdf.json"})),i}Object.defineProperty(t,"__esModule",{value:!0});var c=!1,u="",p="";t.updateQueryParam=o,t.setImageUrlTemplate=i,t.setTextUrlTemplate=r,t.setUseCannedFile=s,t.imageUrl=a,t.textUrl=l}),define("modules/clean/react/previews/pdf_viewer/utils",["require","exports","modules/clean/react/previews/pdf_viewer/event_emitter"],function(e,t,n){"use strict";function o(e){return c.indexOf(e)!==-1?"spp":"default"}function i(e){if(u===e)return p;for(var t=[],n=0,o=e;n<o.length;n++)for(var i=o[n],r=i[0],s=i[1],a=i[2],l=0;l<a;l++)t.push([r,s]);return u=e,p=t,t}function r(e,t,n){return e.map(function(e){return[e[0]*t,e[1]*t]}).reduce(function(e,t){var o=e[0],i=e[1],r=t[0],s=t[1];return[Math.max(o,r),i+n+s]},[0,0])}function s(e,t){for(var n=i(e),o=[],r=0;r<n.length;r++){var s=n[r],a=s[0],l=s[1];o.push(t(r,a,l))}return o}function a(e){(new Image).src=e}function l(e,t){if(e.postMessageToParent("annotation-hidden"),n.eventEmitter.emit("resize"),t){var o=document,i=window.getSelection?window.getSelection():o.selection;if(i){var r=i.anchorNode,s=i.focusNode;t.contains(r)&&t.contains(s)&&(window.getSelection?window.getSelection().removeAllRanges():o.selection&&o.selection.empty())}}}Object.defineProperty(t,"__esModule",{value:!0});var c=["ppt","pptx"];t.docTypeFromExtension=o;var u,p;t.expandDimensions=i,t.getTotalSize=r,t.mapPages=s,t.prefetchImage=a,t.resetAnnotationState=l}),define("modules/clean/react/previews/pdf_viewer/viewer",["require","exports","tslib","external/classnames","external/react","modules/clean/react/previews/pdf_viewer/error_snackbar","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/loading_indicator","modules/clean/react/previews/pdf_viewer/pdf_viewer","modules/clean/react/previews/pdf_viewer/ppt_viewer","modules/clean/react/previews/pdf_viewer/utils","modules/clean/react/previews/pdf_viewer/zoom","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.viewerRef=function(e){return n.viewer=e},n.iframeRef=function(e){e&&e.contentWindow&&(e.contentWindow.addEventListener("load",n.onResize),e.contentWindow.addEventListener("resize",n.onResize))},n.onResize=function(){void 0===n.resizeRequestID&&(n.resizeRequestID=window.requestAnimationFrame(n.onResizeNextFrame))},n.onResizeNextFrame=function(){n.props.metadata&&n.viewer&&(u.resetAnnotationState(n.props.frameMessenger,n.viewer),n.fitToContainer(n.props.metadata.dimensions,n.viewer,n.state.fittingMode),n.resizeRequestID=void 0)},n.zoomIn=function(){var e=Math.min(1.1*n.state.clientScaleFactor,10);n.setState({clientScaleFactor:e}),n.setFittingMode(p.FittingMode.NONE)},n.zoomOut=function(){var e=Math.max(n.state.clientScaleFactor/1.1,.1);n.setState({clientScaleFactor:e}),n.setFittingMode(p.FittingMode.NONE)},n.onFirstPageError=function(){n.setState({firstPageFailed:!0})},n.onError=function(e){n.setState({error:e})},n.onImageError=function(){n.setState({error:d._("Some pages failed to load")})},n.onDismissError=function(){n.setState({error:void 0})},n.onPageRenderComplete=function(e,t,o){n.props.onPageRenderComplete&&n.props.onPageRenderComplete(e,t,o),n.setState({pageRendered:!0})},n.state={fittingMode:p.defaultFittingMode(t.fileExtension)},n}return n.__extends(t,e),t.prototype.setFittingMode=function(e){this.setState({fittingMode:e})},t.prototype.fitToContainer=function(e,t,n){if(n!==p.FittingMode.NONE){var o=this.viewer.clientHeight,i=this.viewer.clientWidth;this.setState({clientScaleFactor:p.computeClientScaleFactor(this.state.fittingMode,e,o-32,i-32)})}},t.prototype.componentDidMount=function(){s.eventEmitter.on("zoom-in",this.zoomIn),s.eventEmitter.on("zoom-out",this.zoomOut),s.eventEmitter.on("error",this.onError),this.props.metadata&&this.viewer&&this.fitToContainer(this.props.metadata.dimensions,this.viewer,this.state.fittingMode)},t.prototype.componentWillUnmount=function(){s.eventEmitter.off("zoom-in",this.zoomIn),s.eventEmitter.off("zoom-out",this.zoomOut),s.eventEmitter.off("error",this.onError)},t.prototype.componentWillReceiveProps=function(e){!this.state.clientScaleFactor&&e.metadata&&this.viewer&&this.fitToContainer(e.metadata.dimensions,this.viewer,this.state.fittingMode)},t.prototype.renderViewer=function(){if(this.props.metadata&&this.props.text){var e={metadata:this.props.metadata,text:this.props.text,links:this.props.links||{},frameMessenger:this.props.frameMessenger,onPageRenderComplete:this.onPageRenderComplete,onPageImageLoad:this.props.onPageImageLoad,accounts:this.props.accounts,attributions:this.props.attributions,annotations:this.props.annotations,isAnnotationCreationEnabled:!!this.props.isAnnotationCreationEnabled,isAnnotationRegionEnabled:!!this.props.isAnnotationRegionEnabled,isAnnotationHighlightEnabled:!!this.props.isAnnotationHighlightEnabled,clientScaleFactor:this.state.clientScaleFactor,onImageError:this.onImageError};return c.PowerPointViewer.fileSupported(this.props.fileExtension)&&c.PowerPointViewer.deviceSupported()?i.createElement(c.PowerPointViewer,n.__assign({},e)):i.createElement(l.PdfViewer,n.__assign({},e))}return null},t.prototype.renderErrorSnackbar=function(){return this.state.error?i.createElement(r.ErrorSnackbar,{text:this.state.error,buttonText:d._("Close"),onClick:this.onDismissError,isToolbarVisible:!!this.props.isToolbarVisible}):null},t.prototype.renderCloseFullscreenButton=function(){return this.props.isFullscreen?i.createElement("div",{className:"close-x"},i.createElement("button",{onClick:this.props.onExitFullscreen,className:"close-x-button","aria-label":d._("Close")},"✕")):null},t.prototype.renderPlaceholder=function(){return this.state.pageRendered||!this.props.placeholderImageUrl||this.state.firstPageFailed?null:i.createElement("div",{className:"placeholder-image-wrapper"},i.createElement("div",{className:"placeholder-image-wrapper__border"},i.createElement("img",{className:"placeholder-image",alt:d._("Loading"),src:this.props.placeholderImageUrl,onError:this.onFirstPageError,onLoad:this.props.onPlaceholderImageLoad})))},t.prototype.render=function(){var e=this.renderViewer(),t=this.renderCloseFullscreenButton(),n=this.renderErrorSnackbar(),r={"preview-ssr-viewer":!0,"region-creation":this.props.isAnnotationRegionEnabled,"fit-page":this.state.fittingMode===p.FittingMode.FIT_PAGE,"fit-to-width":this.state.fittingMode===p.FittingMode.FIT_TO_WIDTH,"single-page-scroll":p.defaultScrollMode(this.props.fileExtension)===p.ScrollMode.SINGLE_PAGE,"continuous-scroll":p.defaultScrollMode(this.props.fileExtension)===p.ScrollMode.CONTINUOUS},s=null,l=this.renderPlaceholder(),c=null;return e?s=i.createElement("iframe",{"aria-hidden":"true",ref:this.iframeRef,style:{position:"absolute",left:0,bottom:0,top:0,width:"100%",zIndex:-1e3,opacity:0}}):c=i.createElement(a.LoadingIndicator,null),i.createElement("div",{className:o(r)},c,l,s,t,i.createElement("div",{className:"viewer-container",style:{visibility:l?"hidden":"visible"},ref:this.viewerRef},e),n)},t})(i.PureComponent);t.Viewer=h}),define("modules/clean/react/previews/pdf_viewer/zoom",["require","exports","modules/clean/react/previews/pdf_viewer/utils"],function(e,t,n){"use strict";function o(e){switch(n.docTypeFromExtension(e)){case"spp":return l.FIT_PAGE;case"default":return l.FIT_TO_WIDTH}return l.NONE}function i(e){return"spp"===n.docTypeFromExtension(e)?p.SINGLE_PAGE:p.CONTINUOUS}function r(e,t,n,o){var i=1;if(e===l.FIT_PAGE){for(var r=0,s=0,a=0,c=t;a<c.length;a++){var p=c[a],d=p[0],h=p[1];s=Math.max(d,s),r=Math.max(h,r)}i=Math.min(n/r,o/s)}else e===l.FIT_TO_WIDTH&&(i=o/t[0][0]);return Math.min(i,u)}function s(e,t){var n=Math.max(e,t);return n<=2048?1:2048/n}function a(e,t){if(t){var n=t.originalHeight;if(s(t.originalWidth,n)>=e)return 0}for(var o=0,i=c;o<i.length;o++){var r=i[o];if(r>=e)return r}return u}Object.defineProperty(t,"__esModule",{value:!0});var l,c=[1,2,4],u=Math.max.apply(Math,c);(function(e){e[e.NONE=0]="NONE",e[e.FIT_TO_WIDTH=1]="FIT_TO_WIDTH",e[e.FIT_PAGE=2]="FIT_PAGE"})(l=t.FittingMode||(t.FittingMode={}));var p;(function(e){e[e.CONTINUOUS=0]="CONTINUOUS",e[e.SINGLE_PAGE=1]="SINGLE_PAGE"})(p=t.ScrollMode||(t.ScrollMode={})),t.defaultFittingMode=o,t.defaultScrollMode=i,t.computeClientScaleFactor=r,t.calculatedFetchedScaleFactor=a}),define("modules/clean/react/previews/preview_error",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/display_format","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/previews/util","modules/clean/react/css","modules/clean/react_format","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button","modules/clean/react/open_in_app/button","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/react/share_download/button","modules/clean/static_urls","modules/clean/web_timing_logger","modules/constants/file_viewer"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var b=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){if(E.set_tti_exclusion_flow("failed previews not included"),E.mark_time_to_view(),E.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===v.ErrorTypes.PENDING_UPLOAD_ERROR&&this.props.shareToken){new c.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()}},Object.defineProperty(t.prototype,"isSharedFile",{get:function(){return this.props.sharedLinkInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!0,configurable:!0}),t.prototype.renderActionable=function(){return this.props.areActionablesEnabled||null==this.props.areActionablesEnabled?this.isSharedFile?this.allowOpenInApp?i.createElement(m.OpenInAppButton,{urls:this.props.file.open_in_app_data}):i.createElement(g.ShareDownloadButton,{downloadOnly:!!this.props.isMobileUserAgent,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,fileOrFolder:this.props.file,justifyRight:!1,location:h.FileViewerPane.PREVIEW_CONTENT}):i.createElement(_.OpenButton,{file:this.props.file,user:this.props.user,justifyRight:!1,location:h.FileViewerPane.PREVIEW_CONTENT,isMaestroDesign:S.MAESTRO_ENABLED}):i.createElement("div",null)},t.prototype.renderFileInfo=function(){var e=u.get_filename(this.props.file);return this.props.errorType===v.ErrorTypes.PENDING_UPLOAD_ERROR||this.props.file.is_dir?i.createElement("div",{className:"preview-error__info"},l.em_snippet(e,this.props.maxFilenameEmLength)):i.createElement("div",{className:"preview-error__info"},l.em_snippet(e,this.props.maxFilenameEmLength),i.createElement("span",{className:"bottom-dot"}," · "),a.format_bytes(this.props.file.bytes))},t.prototype.renderErrorInfo=function(e,t){return i.createElement("div",null,i.createElement("div",{className:"u-mar-bottom-s"},e),i.createElement("div",{className:"preview-error__message u-mar-xs"},t))},t.prototype.getBadFiletypeErrorImage=function(){return i.createElement(f,{src:y.static_url("/static/images/previews/error/filetypeNA_1x-vflfrlFzF.png"),srcHiRes:y.static_url("/static/images/previews/error/filetypeNA_2x-vflXCCBSQ.png")})},t.prototype.getTooBigErrorImage=function(){return i.createElement(f,{src:y.static_url("/static/images/previews/error/large_1x-vflkPYeXF.png"),srcHiRes:y.static_url("/static/images/previews/error/large_2x-vflueyc5P.png")})},t.prototype.getPasswordProtectedErrorImage=function(){return i.createElement(f,{src:y.static_url("/static/images/previews/error/password_1x-vflYknWoW.png"),srcHiRes:y.static_url("/static/images/previews/error/password_2x-vflJBbjf_.png")})},t.prototype.getNoPreviewErrorImage=function(){return i.createElement(f,{src:y.static_url("/static/images/previews/error/previewNA_1x-vflTFvhxk.png"),srcHiRes:y.static_url("/static/images/previews/error/previewNA_2x-vflMDSiZI.png")})},t.prototype.getPendingUploadErrorImage=function(){return i.createElement(f,{className:"icon",src:y.static_url("/static/images/previews/error/FileUploading_1x-vflSMveQj.png"),srcHiRes:y.static_url("/static/images/previews/error/FileUploading_2x-vflG2sw4y.png")})},t.prototype.getPendingUploadSyncImage=function(){return i.createElement(f,{className:"sync-image",src:y.static_url("/static/images/previews/error/fileUploading_justbadge_1x-vflmyKG2f.png"),srcHiRes:y.static_url("/static/images/previews/error/fileUploading_justbadge_2x-vfl3T4urj.png")})},t.prototype.renderAnnotationsToolbar=function(){if(this.props.shouldDisplayAnnotationsToolbar)return i.createElement("div",{className:"preview-toolbar-container"},i.createElement(s,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext}))},t.prototype.getDisplayErrorType=function(){var e=this.props.errorType;return e===v.ErrorTypes.EXTENSION_ERROR&&u.extensionSupported(this.props.file)?v.ErrorTypes.LOAD_ERROR:e},t.prototype.renderError=function(){if(this.props.message)return this.renderErrorInfo(this.getNoPreviewErrorImage(),this.props.message);switch(this.getDisplayErrorType()){case v.ErrorTypes.PENDING_UPLOAD_ERROR:var e=r._("File is uploading...");return i.createElement("div",{ref:"errorInfo"},i.createElement("div",{className:"u-mar-bottom-s"},this.getPendingUploadErrorImage(),this.getPendingUploadSyncImage()),i.createElement("div",{className:"preview-error__message u-mar-xs"},e));case v.ErrorTypes.EMPTY_FILE_ERROR:return this.renderErrorInfo(this.getNoPreviewErrorImage(),r._("Empty files can’t be previewed"));case v.ErrorTypes.EXTENSION_ERROR:var t=u.get_extension(this.props.file);if(t){var n=i.createElement("span",null,d.reactFormat(r._("<span>.%(extension)s</span> files can’t be previewed",{comment:"Like '.exe files can’t be previewed'"}),{span:i.createElement("span",{className:"preview-error__message--bold"}),extension:t}));return this.renderErrorInfo(this.getBadFiletypeErrorImage(),n)}var n=r._("Extensionless files can’t be previewed");return this.renderErrorInfo(this.getBadFiletypeErrorImage(),n);case v.ErrorTypes.FILE_SIZE_ERROR:return this.renderErrorInfo(this.getTooBigErrorImage(),r._("This file is too big to preview"));case v.ErrorTypes.PASSWORD_PROTECTED_ERROR:return this.renderErrorInfo(this.getPasswordProtectedErrorImage(),r._("This file is password-protected"));case v.ErrorTypes.NEED_FLASH_ERROR:return this.renderErrorInfo(this.getNoPreviewErrorImage(),d.reactFormat(r._("Install <a>Adobe Flash Player</a> to preview this video."),{a:i.createElement("a",{href:"https://get.adobe.com/flashplayer/"})}));case v.ErrorTypes.LOAD_ERROR:default:return this.renderErrorInfo(this.getNoPreviewErrorImage(),r._("This file can’t be previewed"))}},t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==v.ErrorTypes.LOAD_ERROR&&this.props.errorType!==v.ErrorTypes.PENDING_UPLOAD_ERROR&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(h.EventTypes.FILE_PREVIEW_SUPPORT_DENIED,{errorType:this.props.errorType})},t.prototype.render=function(){var e=o({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar});return i.createElement("div",{className:e},i.createElement("div",{className:"preview-error__wrapper"},i.createElement("div",{className:"preview-error__content"},this.renderError(),this.renderFileInfo(),this.renderActionable()),this.renderAnnotationsToolbar()))},t})(i.Component);t.PreviewErrorWithoutCss=b,t.PreviewError=p(b,["/static/css/preview_error-vflJPSHc1.css"])}),define("modules/clean/react/previews/preview_html",["require","exports","tslib","external/react","external/react-dom","jquery","modules/clean/previews/actions","modules/clean/react/previews/constants","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/frame_messenger_host","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=["failed","viewer-ready"],y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getIframeProps=function(){var e={title:t.props.filename,name:"preview-content",type:"text/html",src:t.getIframeSrc(),sandbox:"",className:"previewhtml",ref:t.setRefIframe};return t.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},t.handleTrustedMessageFromChild=function(e){switch(e.action){case"failed":t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_RENDER_FAILED);var n=a.RivieraPreviewResponseTypes.UNKNOWN;e.parameters&&(n=e.parameters.rivieraStatusCode),t.props.onError&&t.props.onError(l.mapRivieraStatusToErrorType(n));break;case"viewer-ready":t.markWebTiming(),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(s.broadcastRenderSucceeded,0),t.props.isFullscreen?t.frameMessenger.postMessageToChildren("enter-fullscreen"):t.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),t.shouldIncreaseTabHeightForExcel()&&t.frameMessenger.postMessageToChildren("increase-tab-height")}},t.handleIframeLoad=function(){t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.props.usesFrameMessenger||(t.markWebTiming(),t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED))},t.handleIframeError=function(){t.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED)},t.setRefPreviewToolbarContainer=function(e){t.previewToolbarContainer=e},t.setRefIframe=function(e){t.iframe=e},t}return n.__extends(t,e),t.prototype.getIframeSrc=function(){var e=v.parse(this.props.src);return"excel"===this.props.previewType&&(m.FORCE_TEST_EXCEL_HTML?e.updateQuery({canned_file_name:c.CannedTestFilenames.EXCEL_HTML}):"password_protected"===m.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===m.DOCPREVIEW_FORCE_RIVIERA_EXCEPTION&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},t.prototype.shouldIncreaseTabHeightForExcel=function(){return"excel"===this.props.previewType&&f.is_mobile_or_tablet()},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),_.mark_time_to_view(),_.mark_time_to_interactive()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(c.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.props.usesFrameMessenger&&(this.frameMessenger=new p.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,g),this.frameMessenger.startListening(),u.FullscreenHelpers.setupFullscreen(this.props.isFullscreen),this.previewToolbarContainer&&r(document).on("keydown",this.previewToolbarContainer.onKeydown));var e=i.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},t.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&(this.frameMessenger.stopListening(),this.previewToolbarContainer&&r(document).off("keydown",this.previewToolbarContainer.onKeydown),this.props.isFullscreen&&u.FullscreenHelpers.teardownExitFullscreenListeners())},t.prototype.renderToolbarContainer=function(){var e={fileExtension:this.props.fileExtension,fileHref:this.props.src,filePreviewType:this.props.previewType,isHidden:this.props.sizeClass===h.SizeClass.Small,sharePermissions:this.props.sharePermissions,shouldDisplayRegionCreationButton:!1,sizeClass:this.props.sizeClass};return o.createElement(d.PreviewToolbarContainer,{elevateToolbar:this.shouldIncreaseTabHeightForExcel(),ref:this.setRefPreviewToolbarContainer,previewToolbarProps:e,isFullscreen:this.props.isFullscreen,commentsActionCreators:this.props.commentsActionCreators,shouldUseImageToolbar:!1})},t.prototype.render=function(){var e=this.getIframeProps(),t={};return f.iOS&&(t=l.iOSIframeScrollStyles()),o.createElement("div",{className:"preview-content",style:t},o.createElement("iframe",n.__assign({},e)),this.renderToolbarContainer())},t})(o.Component);y.defaultProps={usesFrameMessenger:!0},t.PreviewHTML=y}),define("modules/clean/react/previews/preview_image_with_annotations",["require","exports","tslib","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/analytics","modules/clean/image_preview_util","modules/clean/image_annotations","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/css","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/constants","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/previews/responsive_image","modules/clean/web_timing_logger","modules/constants/file_viewer"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={width:"",height:"",zoomPercent:0,minimumZoomPercent:0,margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1},t.onImageLoad=function(){t.props.filePreviewSession&&(t.props.filePreviewSession.markPrimaryEvent(),t.props.filePreviewSession.markSecondaryEvent()),y.mark_time_to_view(),y.mark_time_to_interactive(),t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),t.setState({shouldLoadFullSizeImage:!!t.props.supportsAnnotations}),setTimeout(p.broadcastRenderSucceeded,0),t.props.supportsAnnotations&&t.imageAnnotations.onImageLoad(t.onResizeImage),null!=t.props.onLoad&&t.props.onLoad()},t.onImageClick=function(){t.shouldDisableZoom()||t.openFullscreen()},t.openFullscreen=function(){null!=t.props.isFullscreen?h.openFullscreen():f.PreviewImageZoom.open(t.props["preview-url"],t.props["file-extension"],t.props.onContextMenu,t.props.fileName)},t.onImageError=function(){t.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),null!=t.props.onError&&t.props.onError()},t.onFullSizeLoad=function(){var e=t.calculateZoomPercent(t.getImageDOMNode().height);t.setState({zoomPercent:e,minimumZoomPercent:e})},t.onResizeImage=function(){if(""===t.state.width&&""===t.state.height){var e=t.calculateZoomPercent(t.getImageDOMNode().height);t.setState({zoomPercent:e,minimumZoomPercent:e})}},t.onZoom=function(e,n,o){if(void 0===o&&(o=void 0),e+"px"!==t.state.width){if(void 0===o&&(o=t.calculateZoomPercent(n)),o<t.state.minimumZoomPercent)return void t.onZoomFit();if(o>16){if(null!=r.findDOMNode(t.previewImageFullSize)){var i=16*r.findDOMNode(t.previewImageFullSize).naturalWidth,s=16*r.findDOMNode(t.previewImageFullSize).naturalHeight;t.onZoom(i,s,16)}}else{var a=t.getImageDOMNode().width,c=e/a,u=l.getPreviewImageWrapper(),p=u.scrollLeft(),d=u.scrollTop(),h=u.width(),_=u.height(),m=h*(c-1)/2+p*c,f=_*(c-1)/2+d*c,v=n>=_?"0":"auto",g=e>=h?"0":"auto",y=v+" "+g;t.setState({shouldDisplayFullSizeImage:null!=t.previewImageFullSize,width:e+"px",height:n+"px",margin:y,zoomPercent:o,zoomFit:!1},function(){u.scrollLeft(m),u.scrollTop(f),t.imageAnnotations.onResize(!1)})}}},t.onZoomIn=function(){t.zoomWithMultiplier(1.25)},t.onZoomOut=function(){t.zoomWithMultiplier(.8)},t.onZoomOriginalOrFit=function(){1===t.state.zoomPercent?t.onZoomFit():t.onZoomOriginal()},t.onZoomOriginal=function(){if(null!=r.findDOMNode(t.previewImageFullSize)){var e=r.findDOMNode(t.previewImageFullSize).naturalWidth,n=r.findDOMNode(t.previewImageFullSize).naturalHeight;t.onZoom(e,n)}},t.onZoomFit=function(){""!==t.state.width&&t.setState({width:"",height:"",margin:"auto",zoomFit:!0},function(){t.imageAnnotations.onResize(!1);var e=t.calculateZoomPercent(t.getImageDOMNode().height);t.setState({zoomPercent:e,minimumZoomPercent:e})})},t.setPreviewImageRef=function(e){t.previewImage=e},t.setPreviewImageFullSizeRef=function(e){t.previewImageFullSize=e},t}return n.__extends(t,e),
t.prototype.componentWillUnmount=function(){null==this.props.isFullscreen&&f.PreviewImageZoom.close(),null!=this.imageAnnotations&&this.imageAnnotations.reset()},t.prototype.componentWillMount=function(){this.imageAnnotations=new c},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.logOpen();var e=this.getImageDOMNode();if(null!=e&&e.complete){var t=this.props.nsId+"_"+this.props.sjId,n=window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[t];E.DETECT_SSR_IMAGE_ERROR&&n?this.onImageError():this.onImageLoad()}},t.prototype.componentWillReceiveProps=function(e){if(e["preview-url"]!==this.props["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED,t),this.logFilePreviewEvent(_.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,t),this.logOpen(),this.props.supportsAnnotations&&(this.imageAnnotations.removeAnnotations(),this.setState({width:"",height:"",margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1}))}},t.prototype.logFilePreviewEvent=function(e,t){void 0===t&&(t=this.props.filePreviewSession),null!=t&&t.recordEvent(e)},t.prototype.logOpen=function(){a.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},t.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.supportsAnnotations||t===m.SizeClass.Small},t.prototype.getImageDOMNode=function(){return this.state.shouldDisplayFullSizeImage?r.findDOMNode(this.previewImageFullSize):r.findDOMNode(this.previewImage)},t.prototype.zoomWithMultiplier=function(e){if(1!==e){var t=this.getImageDOMNode().width,n=this.getImageDOMNode().height,o=this.calculateZoomPercent(n),i=.05*Math.round(o*e/.05);if(Math.abs(i-o)<.05&&(e>1?i+=.05:i-=.05),!(i<0)){var r=i/o,s=Math.round(t*r),a=Math.round(n*r);this.onZoom(s,a,i)}}},t.prototype.calculateZoomPercent=function(e){if(null==this.previewImageFullSize)return 0;var t=r.findDOMNode(this.previewImageFullSize).naturalHeight;return e&&t?e/t:0},t.prototype.renderToolbarContainer=function(){return this.props.supportsAnnotations?i.createElement(v.PreviewToolbarContainer,{previewToolbarProps:{index:this.props.index,count:this.props.count,zoomPercent:this.state.zoomPercent,minimumZoomPercent:this.state.minimumZoomPercent,maximumZoomPercent:16,onPrevious:this.props.onPrevious,onNext:this.props.onNext,onFullscreen:this.openFullscreen,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,onZoomOriginalOrFit:this.onZoomOriginalOrFit},isFullscreen:this.props.isFullscreen,shouldUseImageToolbar:!0,commentsActionCreators:this.props.commentsActionCreators}):null},t.prototype.renderFullSizeImage=function(e){if(this.state.shouldLoadFullSizeImage){var t={"absolute-center":!0};t[""+l.PREVIEW_IMAGE]=this.state.shouldDisplayFullSizeImage,t=o(t);var n=s.extend({},e);return this.state.shouldDisplayFullSizeImage||(n=s.extend(n,{visibility:"hidden"})),i.createElement("img",{alt:this.props.fileName,ref:this.setPreviewImageFullSizeRef,src:u.fullSizeUrl(this.props["preview-url"]),className:t,style:n,onLoad:this.onFullSizeLoad,onClick:this.onImageClick})}},t.prototype.renderSmallImage=function(e){if(!this.state.shouldDisplayFullSizeImage)return i.createElement(g.ResponsiveImage,{ref:this.setPreviewImageRef,thumbnailUrlTmpl:this.props["preview-url"],className:l.PREVIEW_IMAGE+" absolute-center",style:e,onLoad:this.onImageLoad,onError:this.onImageError,onClick:this.onImageClick,onContextMenu:this.props.onContextMenu,fileName:this.props.fileName})},t.prototype.render=function(){var e={};this.state.width&&this.state.height&&this.props.supportsAnnotations&&(e={maxWidth:this.state.width,maxHeight:this.state.height,width:this.state.width,height:this.state.height,margin:this.state.margin});var t={"flex-preview-container":!0,"image-visible":!0,"annotations-visible":!0,"zoom-disabled":this.shouldDisableZoom(),"has-annotations-toolbar":this.props.supportsAnnotations,"zoom-fit":this.state.zoomFit};return t[""+l.PREVIEW_IMAGE_CONTAINER]=!0,t=o(t),i.createElement("div",{className:t},i.createElement("div",{className:l.PREVIEW_IMAGE_WRAPPER+" preview-content"},this.renderFullSizeImage(e),this.renderSmallImage(e)),this.renderToolbarContainer())},t})(i.Component);t.PreviewImageWithAnnotationsWithoutCss=S,t.PreviewImageWithAnnotations=d(S,["/static/css/preview_image_with_annotations-vflex8M7t.css"])}),define("modules/clean/react/previews/preview_image_zoom",["require","exports","tslib","external/jquery.fs.zoomer","external/react","external/react-dom","jquery","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/image","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/responsive_image","modules/clean/static_urls","modules/core/browser","modules/core/i18n","external/jquery.mousewheel"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={loadedFullResolutionImageUrl:null,zoomOutDisabled:!0,zoomInDisabled:!1,dragDisabled:!0,isMounted:!0},t.onFullResolutionImageLoaded=function(){t.state.isMounted&&(t.logFilePreviewEvent(p.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.logFilePreviewEvent(p.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),t.setState({loadedFullResolutionImageUrl:t.fullResolutionImage.src},t.bindZoomer),setTimeout(l.broadcastRenderSucceeded,0))},t.onFullResolutionImageError=function(){t.logFilePreviewEvent(p.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED)},t.onZoomCallback=function(e){t.setState({zoomOutDisabled:e.atMinZoom,zoomInDisabled:e.atMaxZoom,dragDisabled:e.atMinZoom})},t.zoomToFit=function(){s(r.findDOMNode(t.zoomContainerRef.refs.zoomControlZoomOut)).trigger("zoomout")},t.unmount=function(){if(t.props.isFlippable)u.closeFullscreen();else{var e=r.findDOMNode(t).parentNode;r.unmountComponentAtNode(e),s(e).remove()}},t.onImageDoubleClick=function(e){if(!s(e.target).hasClass("zoomer"))if(t.getZoomPercent()<100){var n=e.target.getBoundingClientRect();t.zoom100(e.pageX-n.left,e.pageY-n.top)}else t.zoomToFit()},t.setZoomContainerRef=function(e){t.zoomContainerRef=e},t}return n.__extends(t,e),t.open=function(e,n,o,a){void 0===o&&(o=void 0);var l=s("<div />",{id:"preview-image-zoomzoom-wrapper"});s(document.body).append(l);var c=i.createElement(t,{thumbnailUrlTmpl:e,fileExtension:n,isFlippable:!1,onContextMenu:o,fileName:a});return r.render(c,l.get(0))},t.close=function(){var e=document.getElementById("preview-image-zoomzoom-wrapper");e&&r.unmountComponentAtNode(e)},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(p.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(p.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.delayedSetupImage(this.props.thumbnailUrlTmpl)},t.prototype.componentWillReceiveProps=function(e){e.thumbnailUrlTmpl!==this.props.thumbnailUrlTmpl&&(this.logFilePreviewEvent(p.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.logFilePreviewEvent(p.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.setState({loadedFullResolutionImageUrl:null}),this.destroyZoomer(),this.delayedSetupImage(e.thumbnailUrlTmpl))},t.prototype.componentWillUnmount=function(){this.destroyZoomer(),s(window).off("resize.zommer"),this.setState({isMounted:!1})},t.prototype.delayedSetupImage=function(e){var n=this;setTimeout(function(){n.state.isMounted&&n.props.thumbnailUrlTmpl===e&&n.setupImage(e)},t.SETUP_IMAGE_WAIT_TIME)},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.setupImage=function(e){var t=this;this.fullResolutionImage=document.createElement("img"),this.fullResolutionImage.onload=function(){t.props.thumbnailUrlTmpl===e&&t.onFullResolutionImageLoaded()},this.fullResolutionImage.onerror=this.onFullResolutionImageError,this.fullResolutionImage.src=a.fullSizeUrl(e)},t.prototype.bindZoomer=function(){var e=this;if(null!=this.state.loadedFullResolutionImageUrl){var t=s(".preview-zoom").width(),n=this.getPreviewZoomerElement();o(n,{controls:{zoomIn:s(r.findDOMNode(this.zoomContainerRef.refs.zoomControlZoomIn)),zoomOut:s(r.findDOMNode(this.zoomContainerRef.refs.zoomControlZoomOut)),zoomLabel:s(r.findDOMNode(this.zoomContainerRef.refs.zoomLabel)),zoomLabelContainer:s(r.findDOMNode(this.zoomContainerRef.refs.zoomLabelContainer))},customClass:"preview-zoomer-style",retina:!1,onZoomCallback:this.onZoomCallback,startWidth:t,onContextMenu:this.props.onContextMenu}),null==this.fitToZoom&&(this.fitToZoom=this.getZoomPercent()),s(window).off("resize.zoomer").on("resize.zoomer",function(){o(n,"resize"),e.fitToZoom=e.getZoomPercent()}),n.off("mousewheel.zoom").on("mousewheel.zoom",function(t,n){t.preventDefault(),e.zoomScroll(n*t.deltaFactor)})}},t.prototype.destroyZoomer=function(){o(this.getPreviewZoomerElement(),"destroy")},t.prototype.getPreviewZoomerElement=function(){return s(".preview-zoomer")},t.prototype.getZoomPercent=function(){return parseFloat(s(r.findDOMNode(this.zoomContainerRef.refs.zoomLabel)).text())},t.prototype.zoom100=function(e,t){o(this.getPreviewZoomerElement(),"zoom100",e,t)},t.prototype.zoomScroll=function(e){o(this.getPreviewZoomerElement(),"zoomScroll",e)},t.prototype.renderFullResolution=function(){return null!=this.state.loadedFullResolutionImageUrl?i.createElement("img",{alt:this.props.fileName,className:"preview-zoom",src:this.state.loadedFullResolutionImageUrl,style:{maxHeight:s(".preview-zoom").height(),maxWidth:s(".preview-zoom").width()},onContextMenu:this.props.onContextMenu}):i.createElement(h.ResponsiveImage,{thumbnailUrlTmpl:this.props.thumbnailUrlTmpl,className:"preview-zoom",onContextMenu:this.props.onContextMenu,fileName:this.props.fileName})},t.prototype.renderImage=function(){return i.createElement("div",{ref:"previewZoomer",className:"preview-zoomer",style:{textAlign:"center"},onDoubleClick:null!=this.state.loadedFullResolutionImageUrl?this.onImageDoubleClick:void 0},this.renderFullResolution())},t.prototype.renderLoading=function(){return i.createElement("div",{className:"preview-zoomer-loading"},i.createElement(c,{alt:f._("Loading..."),src:_.static_url("/static/images/icons/white-on-dark-spinner-vflInam4o.gif"),srcHiRes:_.static_url("/static/images/icons/white-on-dark-spinner@2x-vfltkzAUn.gif")}))},t.prototype.renderPreview=function(){return null!=m.mozilla&&null==this.state.loadedFullResolutionImageUrl?this.renderLoading():this.renderImage()},t.prototype.render=function(){var e="preview-zoom";return null!=this.state.loadedFullResolutionImageUrl?e="zoomer-image":null!=m.mozilla&&(e="preview-zoomer-loading"),i.createElement(d.PreviewZoomContainer,{isFlippable:this.props.isFlippable||!1,renderZoomControls:null!=this.state.loadedFullResolutionImageUrl,onClose:this.unmount,containerClass:e,zoomOutCallback:this.zoomToFit,zoomInDisabled:this.state.zoomInDisabled,zoomOutDisabled:this.state.zoomOutDisabled,dragDisabled:this.state.dragDisabled,ref:this.setZoomContainerRef},this.renderPreview())},t})(i.Component);v.SETUP_IMAGE_WAIT_TIME=100,t.PreviewImageZoom=v}),define("modules/clean/react/previews/preview_linkfile",["require","exports","tslib","external/classnames","external/react","modules/clean/analytics","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/actions","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/clean/static_urls","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={description:null,hadError:!1,link:null,isMounted:!1},t.requestLinkfileData=function(e){t.logEvent("requestlinkdata",!0),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED);var n={url:e,dataType:"json",success:t.handleLinkDataSuccess,error:t.handleLinkDataError,xhrFields:{withCredentials:!1}};t.props.data.authenticated?(n.xhrFields={withCredentials:!0},s.SilentBackgroundRequest(n)):s.Request(n)},t.handleLinkDataSuccess=function(e){if(null==e.uri)return void t.handleLinkDataError();t.logEvent("displaylinkdata",!0,e.uri),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),t.markWebTiming(),t.setState({description:e.uri,hadError:!1,link:e.uri}),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(c.broadcastRenderSucceeded,0)},t.handleLinkDataError=function(){t.logEvent("displaylinkerror",!1),t.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),t.markWebTiming(),t.state.isMounted&&t.setState({description:_._("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},t.handleClickOpenLinkButton=function(e){if(null!=t.state.link){t.logEvent("navlink",!0,t.state.link);var n=p.get_redirect_uri(t.state.link);window.open(n.toString(),"_blank")}},t}return n.__extends(t,e),t.prototype.logEvent=function(e,t,n,o){void 0===o&&(o={});var i=null;null!=n&&(i=m.parse(n).getAuthority()),r.LinkfileActivityLogger.log(e,l.file_extension(this.props.filename),i,t,this.props.source,o)},t.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markWebTiming=function(){d.mark_time_to_view(),d.mark_time_to_interactive()},t.prototype.isFileDataFetched=function(){return null==this.state.description},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(u.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.state.isMounted=!0,this.requestLinkfileData(this.props.data.url)},t.prototype.componentWillUnmount=function(){this.state.isMounted=!1,this.logEvent("destroy",!0,this.state.link)},t.prototype.render=function(){var e={"preview-linkfile-content":!0,"loading-content":this.isFileDataFetched()},n={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},r="-",s="";null!=this.props.filename&&(r=l.filename_without_extension(this.props.filename),s=l.file_extension(this.props.filename),""!==s&&(s="."+s));var c=t.MAX_DISPLAYED_FILENAME_CHARS-s.length,u=a.em_snippet(r,c),p="-";null!=this.state.description&&(p=this.state.description);var d={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},m=h.static_url("/static/images/icons128/page_white_linkfile-vfloEntlU.png");return i.createElement("div",{className:"flex-preview-container"},i.createElement("div",{className:"preview-content preview-content--center"},i.createElement("div",{className:"preview-linkfile-box"},i.createElement("div",{className:o(e)},i.createElement("div",{className:"preview-linkfile-icon"},i.createElement("img",{src:m,alt:""})),i.createElement("div",{className:"preview-linkfile-title"},i.createElement("span",{className:"preview-linkfile-filebase"},u),i.createElement("span",{className:"preview-linkfile-fileext"},s)),i.createElement("div",{className:"preview-linkfile-info"},i.createElement("div",{className:o(d)},p),i.createElement("button",{className:o(n),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},_._("Open in new tab")))))))},t})(i.Component);f.SPINNER_FADE_DELAY_MSEC=150,f.MAX_DISPLAYED_FILENAME_CHARS=21,t.PreviewLinkfile=f}),define("modules/clean/react/previews/preview_pdf",["require","exports","tslib","external/react","jquery","external/underscore","modules/constants/file_viewer","modules/core/browser","modules/core/uri","modules/core/i18n","modules/clean/ajax","modules/clean/previews/pdf_loader","modules/clean/previews/actions","modules/clean/react/previews/preview_toolbar_container","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/pdf_thumbnail_image","modules/clean/web_timing_logger"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_INFINITE_SCROLL_ACTIVE_ZONE=1;var y=(function(e){function y(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={keydownRegistered:!1,numThumbnails:t.areThumbnailsEnabled()?1:0,thumbnailPage:-1,pagesRendered:[],maxThumbnails:1/0,lastPageLoaded:0},t.showMorePageIfNeeded=function(){if(null!=t.thumbnailRef&&t.isInfiniteScrollEnabled()){var e=t.thumbnailRef;e.scrollHeight-e.scrollTop<=e.clientHeight*(1+y.getInfiniteScrollActiveZone())&&t.state.numThumbnails<t.state.maxThumbnails&&t.state.numThumbnails<=t.state.lastPageLoaded+1&&t.setState({numThumbnails:t.state.numThumbnails+1})}},t.onThumbnailScroll=r.throttle(t.showMorePageIfNeeded,500),t.exitFullscreenCallback=function(){f.FullscreenHelpers.setBrowserFullscreen(!1),d.exitFullscreen()},t.onDownloadAttempted=function(){t.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED)},t.onDownloadFailed=function(e){t.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED);var n;null!=e&&(n=e.rivieraStatus),null!=t.props.onError&&t.props.onError(_.mapRivieraStatusToErrorType(n))},t.onDownloadSucceeded=function(e){null!=t.props.filePreviewSession&&(t.props.filePreviewSession.previewSize=e.size,t.props.filePreviewSession.pageCount=e.pageCount),t.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},t.onRenderFailed=function(){t.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_RENDER_FAILED),null!=t.props.onError&&t.props.onError(),g.mark_time_to_view(),g.mark_time_to_interactive()},t.onFirstRenderSucceeded=function(e){t.props.filePreviewSession&&(t.props.filePreviewSession.markPrimaryEvent(),t.props.filePreviewSession.markSecondaryEvent(),e&&(t.props.filePreviewSession.firstPageRendered=e.pageRendered)),g.mark_time_to_view(),g.mark_time_to_interactive(),t.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(d.broadcastRenderSucceeded,0),t.pdfLoader.repositionFile(t.getThumbnailScrollPosition())},t.onPageRendered=function(e){var n=e.page,o=e.pagesRendered,i=Date.now();null==t.props.filePreviewSession||t.props.filePreviewSession.pagesRendered[n]||(t.props.filePreviewSession.pagesRendered[n]=i),o&&t.setState({pagesRendered:o}),t.hideThumbnailsIfPageRendered()},t.onZoom=function(e){null!=t.props.filePreviewSession&&(t.props.filePreviewSession.zoomScales=r.union(t.props.filePreviewSession.zoomScales,[e.zoomScale]))},t.onPasswordNeeded=function(){t.hideThumbnails(),g.mark_time_to_view(),g.mark_time_to_interactive(),t.logPasswordNeeded(),t.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},t.onPageRepositioned=function(e){var n=e.page;t.setState({thumbnailPage:n}),t.hideThumbnailsIfPageRendered()},t.hideThumbnails=function(){t.setState({numThumbnails:0})},t.onFirstThumbnailLoad=function(){t.props.filePreviewSession&&(t.props.filePreviewSession.markPrimaryEvent(),t.props.filePreviewSession.markSecondaryEvent()),g.mark_time_to_view(),g.mark_time_to_interactive();var e=t.firstPageThumbnailDOM;e&&t.setFirstPageWidth(e.naturalWidth)},t.onSubsequentThumbnailLoad=function(e){t.setState({lastPageLoaded:Math.max(e,t.state.lastPageLoaded+1)}),window.requestAnimationFrame&&window.requestAnimationFrame(t.showMorePageIfNeeded)},t.setThumbnailDOM=function(e){t.firstPageThumbnailDOM=e},t.setThumbnailRef=function(e){return t.thumbnailRef=e},t.setToolbarContainerRef=function(e){return t.toolbarContainerRef=e},t}return n.__extends(y,e),y.prototype.areThumbnailsEnabled=function(){var e=s.SHARED_LINK_PDF_PERF;return this.props.previewUrl&&e&&e.indexOf("THUMBNAIL")>-1&&!this.shouldMakeSilentThumbnailRequest()},y.prototype.shouldMakeSilentThumbnailRequest=function(){var e=s.SHARED_LINK_PDF_PERF;return e&&e.indexOf("LOGONLY")!==-1},y.prototype.getInitialNumThumbnails=function(){if(!this.areThumbnailsEnabled())return 0;var e=s.SHARED_LINK_PDF_PERF,t=_.extractLastNumberFromVariant(e);return null!=t?t:1},y.prototype.isInfiniteScrollEnabled=function(){var e=s.SHARED_LINK_PDF_PERF;return e&&e.indexOf("SCROLL")>-1},y.getInfiniteScrollActiveZone=function(){var e=s.SHARED_LINK_PDF_PERF,n=e.match(/SCROLL(\d*(\.\d*)?)/);if(n&&n[1]){var o=parseFloat(n[1]);if(o>0)return o}return t.DEFAULT_INFINITE_SCROLL_ACTIVE_ZONE},y.prototype.componentDidMount=function(){this.setState({numThumbnails:this.getInitialNumThumbnails()}),this.setUpPdfLoader(),this.logFilePreviewEvent(m.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.loadPdf(),f.FullscreenHelpers.setupFullscreen(!!this.props.isFullscreen);var e=this.toolbarContainerRef.onKeydown;!this.state.keydownRegistered&&e&&(i(document).on("keydown",e),this.setState({keydownRegistered:!0})),this.areThumbnailsEnabled()&&(this.checkIfFirstThumbnailLoaded(),this.showMorePageIfNeeded()),this.shouldMakeSilentThumbnailRequest()&&this.logThumbnailData()},y.prototype.componentDidUpdate=function(){this.state.keydownRegistered||(i(document).on("keydown",this.toolbarContainerRef.onKeydown),this.setState({keydownRegistered:!0})),this.loadPdf()},y.prototype.componentWillUnmount=function(){null!=this.pdfLoader&&this.pdfLoader.stopListening(),this.props.isFullscreen&&f.FullscreenHelpers.teardownExitFullscreenListeners(),i(document).off("keydown",this.toolbarContainerRef.onKeydown)},y.prototype.setUpPdfLoader=function(){this.pdfLoader=new p.PdfLoader,this.pdfLoader.setIsFullscreen(this.props.isFullscreen),this.pdfLoader.setExitFullscreenCallback(this.exitFullscreenCallback),this.pdfLoader.setOnDownloadAttempted(this.onDownloadAttempted),this.pdfLoader.setOnDownloadFailed(this.onDownloadFailed),this.pdfLoader.setOnDownloadSucceeded(this.onDownloadSucceeded),this.pdfLoader.setOnRenderFailed(this.onRenderFailed),this.pdfLoader.setOnFirstRenderSucceeded(this.onFirstRenderSucceeded),this.pdfLoader.setOnPageRendered(this.onPageRendered),this.pdfLoader.setOnPageRepositioned(this.onPageRepositioned),this.pdfLoader.setOnPasswordNeeded(this.onPasswordNeeded),this.pdfLoader.setOnZoom(this.onZoom),this.pdfLoader.startListening()},y.prototype.logFilePreviewEvent=function(e){null!=this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},y.prototype.logPasswordNeeded=function(){null!=this.props.filePreviewSession&&(this.props.filePreviewSession.passwordNeeded=!0)},y.prototype.logThumbnailData=function(){var e=this;this.props.thumbnailUrl&&window.performance&&u.SilentBackgroundRequest({url:this.props.thumbnailUrl}).then(function(t,n,o){var i=window.performance.getEntriesByName(e.props.thumbnailUrl);if(null!=e.props.filePreviewSession&&i.length){var r=i[0],s=Number(o.getResponseHeader("x-server-response-time")),a=o.getResponseHeader("x-dropbox-request-id"),l={req_id:a,con_start_ts:r.connectStart,con_end_ts:r.connectEnd,dom_look_start:r.domainLookupStart,dom_look_end:r.domainLookupEnd,fetch_start_ts:r.fetchStart,req_start_ts:r.requestStart,req_end_ts:r.requestEnd,res_start_ts:r.responseStart,res_finish_ts:r.responseEnd,server_time:s,total_duration:r.duration};e.props.filePreviewSession.previewThumbnailInfo=l}})},y.prototype.onThumbnailError=function(e){this.setState({numThumbnails:Math.min(e,this.state.numThumbnails),maxThumbnails:Math.min(e,this.state.maxThumbnails)})},y.prototype.hideThumbnailsIfPageRendered=function(){this.state.pagesRendered.indexOf(this.state.thumbnailPage)!==-1&&this.hideThumbnails()},y.prototype.setFirstPageWidth=function(e){this.setState({firstPageWidth:e})},y.prototype.checkIfFirstThumbnailLoaded=function(){var e=this.firstPageThumbnailDOM;e&&e.complete&&(e.naturalWidth>0?this.onFirstThumbnailLoad():this.hideThumbnails())},y.prototype.generatePreviewUrl=function(){return _.get_progressive_url(this.getNormalizedExtension(),this.props.src)},y.prototype.getIframeUrl=function(){var e=_.get_pdf_js_url(this.getNormalizedExtension());return e=_.update_url_with_user_id(e,this.props.userId),e=_.update_url_for_annotation(e),e.toString()},y.prototype.getPreviewUrl=function(){return this.props.previewUrl?this.props.previewUrl:this.generatePreviewUrl()},y.prototype.getNormalizedExtension=function(){return _.normalize_extension(this.props.fileExtension)},y.prototype.getThumbnailScrollPosition=function(){return null!=this.thumbnailRef&&"none"!==this.thumbnailRef.style.display?this.thumbnailRef.scrollTop:null},y.prototype.loadPdf=function(){if(null!=this.pdfLoader){var e=!a.is_mobile_or_tablet()&&"ppt"===this.getNormalizedExtension();this.pdfLoader.openFile(this.getPreviewUrl(),{presentationMode:e})}},y.prototype.renderPreview=function(){return o.createElement("iframe",{key:"RenderPreviewIFrame",name:"preview-content",type:"application/pdf",className:"pdfjs",id:"pdf-embed-iframe",src:this.getIframeUrl()})},y.prototype.renderLoadingIndicator=function(){if(this.state.numThumbnails>0&&this.props.thumbnailUrl)return o.createElement("div",{className:"loading-indicator",key:"LoadingIndicator"},o.createElement("div",{className:"loading-indicator__content"},c._("Loading...")))},y.prototype.renderThumbnails=function(){if(this.state.numThumbnails>0&&this.props.thumbnailUrl){for(var e=[],t=l.parse(this.props.thumbnailUrl),n=0;n<this.state.numThumbnails;++n){var i=void 0;if(n>0){if(!this.state.firstPageWidth)continue;t.updateQuery({page:""+n,size_mode:"5"});var r=t.toString();i=o.createElement(v.PdfThumbnailImage,{firstPageWidth:this.state.firstPageWidth,src:r,className:"thumbnail__image",onLoad:this.onSubsequentThumbnailLoad.bind(this,n),onError:this.onThumbnailError.bind(this,n)})}else{t.updateQuery({size_mode:"5"});var r=t.toString();i=o.createElement(v.PdfThumbnailImage,{refCallback:this.setThumbnailDOM,src:r,className:"thumbnail__image",onLoad:this.onFirstThumbnailLoad,onError:this.hideThumbnails})}e.push(o.createElement("div",{className:"thumbnail__image-wrapper",key:n},i))}return o.createElement("div",{className:"thumbnail",onScroll:this.onThumbnailScroll,ref:this.setThumbnailRef},e)}},y.prototype.renderToolbarContainer=function(){var e={afterFileViewerExit:this.props.onCloseViewer,fileExtension:this.props.fileExtension,fileHref:this.props.fileHref,fileBlockServerUrl:this.props.src,filePreviewType:this.props.previewType,isSharedLink:this.props.isSharedLink,sharePermissions:this.props.sharePermissions,shouldDisplayRegionCreationButton:!1,sizeClass:this.props.sizeClass};return o.createElement(h.PreviewToolbarContainer,{key:"PreviewToolbarContainer",ref:this.setToolbarContainerRef,previewToolbarProps:e,isFullscreen:this.props.isFullscreen,commentsActionCreators:this.props.commentsActionCreators,shouldUseImageToolbar:!1})},y.prototype.render=function(){return o.createElement("div",{className:"preview-content preview-pdf"},this.renderThumbnails(),this.renderLoadingIndicator(),this.renderToolbarContainer(),this.renderPreview())},y})(o.Component);t.PreviewPDF=y}),define("modules/clean/react/previews/preview_pdf_ssr",["require","exports","tslib","external/react","external/underscore","modules/constants/file_viewer","modules/clean/previews/actions","modules/clean/previews/actions","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/previews/pdf_viewer/frame_messenger_shims","modules/clean/react/previews/pdf_viewer/event_emitter","modules/clean/react/previews/pdf_viewer/urls","modules/clean/react/previews/pdf_viewer/app","modules/clean/react/file_viewer/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/file_viewer_interface_controller","modules/clean/react/file_viewer/full_screen_helpers"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(t){var n=e.call(this,t)||this;return n.onDownloadAttempted=function(){n.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED)},n.onDownloadSucceeded=function(){n.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},n.onDownloadFailed=function(){n.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),n.props.onError&&n.props.onError()},n.onFirstRenderSucceeded=function(){n.markPrimaryEvent(),n.props.filePreviewSession&&n.props.filePreviewSession.markSecondaryEvent(),n.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),s.broadcastRenderSucceeded()},n.onPlaceholderImageLoad=function(){n.markPrimaryEvent(),n.props.filePreviewSession&&n.props.filePreviewSession.logSSREvent("placeholder_loaded")},n.sendIdleMouse=i.debounce(function(){n.frameMessengerClient.postMessageToParent("idle-mouse")},1500),n.onMouseMove=i.throttle(function(){n.frameMessengerClient.postMessageToParent("active-mouse"),n.sendIdleMouse()},16),n.onToolbarShow=function(){n.setState({isToolbarVisible:!0})},n.onToolbarHide=function(){n.setState({isToolbarVisible:!1})},n.onLoad=function(){n.frameMessengerClient.postMessageToParent("viewer-ready")},n.onExitFullscreen=function(){f.FullscreenHelpers.setBrowserFullscreen(!1),a.exitFullscreen()},p.setImageUrlTemplate(t.imageUrl),p.setTextUrlTemplate(t.textUrl),p.setUseCannedFile(r.DOCPREVIEW_DEBUG_FORCE_TEST_PDF),n.state={isToolbarVisible:!1},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){var e=this;this.props.filePreviewSession&&(this.props.filePreviewSession.isSSR=!0),this.logFilePreviewEvent(h.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),this.frameMessengerChannel=c.makeChannel(),this.frameMessengerHost=new c.FrameMessengerHostShim(this.frameMessengerChannel),this.frameMessengerClient=new c.FrameMessengerClientShim(this.frameMessengerChannel),this.frameMessengerClient.configureParentMessaging(function(e){return u.eventEmitter.emit(e.action,e.parameters)},["open-file","page-up","page-down","file-feedback-ui-ready","update-annotations","enable-annotation-creation","disable-annotation-creation","enable-region-creation","disable-region-creation","set-attributions","zoom-in","zoom-out","print","remove-all-annotations","scroll-to-annotation"]),this.frameMessengerClient.startListening(),m.FileViewerInterfaceController.setFrameMessengerFactory(function(){return new c.FrameMessengerHostShim(e.frameMessengerChannel)})},t.prototype.componentDidMount=function(){f.FullscreenHelpers.setupFullscreen(!!this.props.isFullscreen)},t.prototype.componentWillUnmount=function(){m.FileViewerInterfaceController.setFrameMessengerFactory(void 0),this.props.isFullscreen&&f.FullscreenHelpers.teardownExitFullscreenListeners()},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.markPrimaryEvent=function(){_.mark_time_to_view(),_.mark_time_to_interactive(),this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent()},t.prototype.renderToolbar=function(){var e={afterFileViewerExit:this.props.onCloseViewer,fileExtension:this.props.fileExtension,fileHref:this.props.fileHref,fileBlockServerUrl:this.props.src,filePreviewType:this.props.previewType,isSharedLink:this.props.isSharedLink,sharePermissions:this.props.sharePermissions,shouldDisplayRegionCreationButton:!1,frameMessenger:this.frameMessengerHost,onToolbarShow:this.onToolbarShow,onToolbarHide:this.onToolbarHide,sizeClass:this.props.sizeClass};return o.createElement(l.PreviewToolbarContainer,{commentsActionCreators:this.props.commentsActionCreators,isFullscreen:this.props.isFullscreen,previewToolbarProps:e,shouldUseImageToolbar:!1})},t.prototype.renderPreviewContent=function(){return o.createElement(d.App,{fileExtension:this.props.fileExtension,filePreviewSession:this.props.filePreviewSession,frameMessenger:this.frameMessengerClient,onLoad:this.onLoad,onError:this.onDownloadFailed,timelineCallbacks:{onDownloadAttempted:this.onDownloadAttempted,onDownloadSucceeded:this.onDownloadSucceeded,onFirstRenderSucceeded:this.onFirstRenderSucceeded,onPlaceholderImageLoad:this.onPlaceholderImageLoad},isFullscreen:this.props.isFullscreen,onExitFullscreen:this.onExitFullscreen,isToolbarVisible:this.state.isToolbarVisible,
previewThumbnailUrl:this.props.previewThumbnailUrl})},t.prototype.render=function(){return o.createElement("div",{className:"preview-content preview-pdf preview-pdf-ssr",onMouseMove:this.onMouseMove,onTouchStart:this.onMouseMove,onTouchMove:this.onMouseMove},this.renderPreviewContent(),this.renderToolbar())},t})(o.PureComponent);t.PreviewPdfSSR=v}),define("modules/clean/react/previews/preview_toolbar",["require","exports","tslib","external/keymaster","external/react","jquery","modules/clean/analytics","modules/clean/keycode","modules/clean/previews/actions","modules/clean/react/file_viewer/actions","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/size_class/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/sprite","modules/core/dom","modules/core/exception","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g){"use strict";function y(e){var t=e.className+" toolbar-button-entry",n=e.disabled;return i.createElement("div",{className:t,onMouseUp:e.onClick},i.createElement("div",{className:"toolbar-tooltip"},i.createElement("div",{className:"toolbar-tooltip-container"},i.createElement("div",{className:"toolbar-tooltip-pointer-border"})),i.createElement("div",{className:"toolbar-tooltip-container"},i.createElement("div",{className:"toolbar-tooltip-body"},e.tooltip)),i.createElement("div",{className:"toolbar-tooltip-container"},i.createElement("div",{className:"toolbar-tooltip-pointer"}))),i.createElement("button",{alt:e.tooltip},i.createElement(m,{group:e.spriteGroup,name:e.spriteName,className:n?"disabled":"",alt:e.tooltip})))}function E(e){var n=e.currentPage,o=e.docType,r=e.pagesCount,s=e.sizeClass;if(!n||!r)return null;var a="";a=s===h.SizeClass.Small?g._("%(current_page)s of %(pages_count)s"):o===t.PreviewToolbarDocType_SPP?g._("Slide %(current_page)s of %(pages_count)s"):g._("Page %(current_page)s of %(pages_count)s");var l=a.format({current_page:n,pages_count:r});return i.createElement("div",{className:b.PAGE_INDICATOR},l)}Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarDocType_DEFAULT="default",t.PreviewToolbarDocType_SPP="spp",t.PreviewToolbarDocType_SPREADSHEET="spreadsheet",t.PreviewToolbarDocType_HTML="html";var S={};S[a.KeyCode.ESC]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.SPACE]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.PAGE_UP]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.PAGE_DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.LEFT]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.UP]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.RIGHT]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},S[70]={altKey:!1,ctrlKey:!0,metaKey:!0},S[80]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.PLUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},S[a.KeyCode.MINUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0};var b={PAGE_INDICATOR:"page-indicator",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",FULLSCREEN:"fullscreen",PRINT:"print",ENABLE_REGION_CREATION:"enable-region-creation"},w={default:["page-indicator","zoom-in","zoom-out","page-up","page-down","fullscreen","print","enable-region-creation"],spp:["page-indicator","page-up","page-down","fullscreen","print","enable-region-creation"],spreadsheet:["zoom-in","zoom-out","fullscreen","print"],html:["fullscreen","print"]},C={default:["page-indicator"],spp:["page-indicator"],spreadsheet:[],html:[]},T={ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",ENTER_FULLSCREEN:"enter-fullscreen",EXIT_VIEWER_FULLSCREEN:"exit-viewer-fullscreen",PRINT:"print",CLEAR_MOUSE_TRACKING:"clear-mouse-tracking",SCROLL_DOWN:"scroll-down",SCROLL_UP:"scroll-up",SCROLL_LEFT:"scroll-left",SCROLL_RIGHT:"scroll-right",SCREEN_DOWN:"screen-down",SCREEN_UP:"screen-up",ENABLE_REGION_CREATION:"enable-region-creation"};t.PreviewToolbarButton=y;var A=(function(e){function m(){var n=null!==e&&e.apply(this,arguments)||this;return n.previewOpen=!1,n.state={pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledButtons:{},docType:t.PreviewToolbarDocType_DEFAULT},n.onMouseEnterToolbar=function(){n.frameMessenger.postMessageToChildren(T.CLEAR_MOUSE_TRACKING),n.setState({hovering:!0}),n.clearIdleTimeout()},n.onMouseLeaveToolbar=function(){n.setState({hovering:!1})},n.onKeydown=function(e){var i=!1;if(n.frameMessenger.childIsValidated()&&"dbmodal"!==o.getScope()&&!f.focus_in_input()&&!f.is_input(e.target)){if(null!=e.target){var s=r("#file-comments");if(1!==s.length&&(s=r("#photo-comments")),1===s.length&&(e.target===s[0]||r.contains(s[0],e.currentTarget)))return}var l={input_method:"keydown",file_ext:n.props.fileExtension,extra:JSON.stringify({keycode:e.keyCode})},c={context:p.UserActionContextNames.KEYBOARD},u=e.keyCode;return n.state.docType!==t.PreviewToolbarDocType_SPP&&[a.KeyCode.EQUALS,a.KeyCode.PLUS_EQUALS_FF,a.KeyCode.PLUS_CHROME,a.KeyCode.PLUS_EQUALS_FF_GERMAN].indexOf(u)>-1?(n.zoomIn(c),i=!0):n.state.docType!==t.PreviewToolbarDocType_SPP&&[a.KeyCode.MINUS_FF_MAC,a.KeyCode.MINUS_FF,a.KeyCode.MINUS_CHROME].indexOf(u)>-1?(n.zoomOut(c),i=!0):u===a.KeyCode.LEFT?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageUp(l):n.scrollLeft(l),i=!0):u===a.KeyCode.RIGHT?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageDown(l):n.scrollRight(l),i=!0):u===a.KeyCode.PAGE_UP?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageUp(l):n.screenUp(l),i=!0):[a.KeyCode.SPACE,a.KeyCode.PAGE_DOWN].indexOf(u)>-1?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageDown(l):n.screenDown(l),i=!0):u===a.KeyCode.UP?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageUp(l):n.scrollUp(l),i=!0):u===a.KeyCode.DOWN?(n.state.docType===t.PreviewToolbarDocType_SPP?n.pageDown(l):n.scrollDown(l),i=!0):70!==u||e.ctrlKey||e.metaKey?70===u&&(e.ctrlKey||e.metaKey)?n.searchInline(c):80===u?(n.printDocument(c),i=!0):u===a.KeyCode.ESC&&(n.isViewerFullscreen()?n.exitFullscreen(c):n.props.afterFileViewerExit&&!n.isAnnotationBubbleShown()&&n.exitPreview(l),i=!0):(n.isViewerFullscreen()?n.exitFullscreen(c):n.enterFullscreen(c),i=!0),i&&null!=e.preventDefault&&e.preventDefault(),!i}},n.onBrowserFullscreenChange=function(){var e={context:p.UserActionContextNames.BROWSER};n.isViewerFullscreen&&!n.isBrowserFullscreen()&&n.setFullscreen(!1,e)},n.pageUp=function(e){n.logAndPostMessage(T.PAGE_UP,"page-up",e)},n.pageDown=function(e){n.logAndPostMessage(T.PAGE_DOWN,"page-down",e)},n.screenUp=function(e){n.logAndPostMessage(T.SCREEN_UP,"screen-up",e)},n.screenDown=function(e){n.logAndPostMessage(T.SCREEN_DOWN,"screen-down",e)},n.scrollUp=function(e){n.logAndPostMessage(T.SCROLL_UP,"scroll-up",e)},n.scrollDown=function(e){n.logAndPostMessage(T.SCROLL_DOWN,"scroll-down",e)},n.scrollRight=function(e){n.logAndPostMessage(T.SCROLL_RIGHT,"scroll-right",e)},n.scrollLeft=function(e){n.logAndPostMessage(T.SCROLL_LEFT,"scroll-left",e)},n}return n.__extends(m,e),m.prototype.reset=function(){this.clearAllTimeouts(),this.setState({pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledButtons:{},docType:t.PreviewToolbarDocType_DEFAULT})},m.prototype.setFullscreen=function(e,t){if(this.logUserAction(e?p.UserActionNames.TOGGLE_FULLSCREEN_ON:p.UserActionNames.TOGGLE_FULLSCREEN_OFF,t.context),e?l.enterFullscreen():l.exitFullscreen()){this.clearFullscreeningTimeout(),e?this.fadeOut():(this.fadeIn(),this.startIdleTimeout()),this.setState({fullscreening:!0}),this.startFullscreeningTimeout(),d.FullscreenHelpers.setBrowserFullscreen(e);var n=e?T.ENTER_FULLSCREEN:T.EXIT_VIEWER_FULLSCREEN;this.frameMessenger.postMessageToChildren(n)}},m.prototype.isViewerFullscreen=function(){return l.isFullscreen()},m.prototype.isBrowserFullscreen=function(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement},m.prototype.postKeysHandledByParent=function(){this.frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:S})},m.prototype.handleMessageFromChild=function(e){var t=this,n={input_method:"child-message",file_ext:this.props.fileExtension},o={context:p.UserActionContextNames.UNKNOWN},i=e.parameters;switch(e.action){case"page-change":case"pagerendered":var r=this.isToolbarReadyToShow(),a=this.sanitizePageNumber(i.current_page||i.attributes.page),l=this.sanitizePageNumber(i.pages_count||i.attributes.pages);if(a<=0||l<=0)break;null!=i.doc_type&&this.setState({docType:i.doc_type});var c={pageUp:a<=1,pageDown:a>=l,print:!this.canPrint()};this.setState({currentPage:a,pagesCount:l,disabledButtons:c},function(){!r&&t.isToolbarReadyToShow()&&(t.fadeIn(),t.startIdleTimeout())});break;case"idle-mouse":this.state.hovering||this.fadeOut(),s.PreviewActivityLogger.log("idle-mouse",n);break;case"active-mouse":this.fadeIn();break;case"exit-parent-fullscreen":this.setFullscreen(!1,o);break;case"keydown":null!=i&&this.onKeydown(i);break;case"get-keydown-keys-handled-by-parent":this.postKeysHandledByParent()}},m.prototype.onPreviewOpen=function(){return!!this.previewOpen||(r(document).on("keydown",this.onKeydown),r(document).on("fullscreenchange",this.onBrowserFullscreenChange),r(document).on("webkitfullscreenchange",this.onBrowserFullscreenChange),r(document).on("msfullscreenchange",this.onBrowserFullscreenChange),r(document).on("mozfullscreenchange",this.onBrowserFullscreenChange),this.previewOpen=!0,!0)},m.prototype.onPreviewClose=function(){return!this.previewOpen||(r(document).off("keydown",this.onKeydown),r(document).off("fullscreenchange",this.onBrowserFullscreenChange),r(document).off("webkitfullscreenchange",this.onBrowserFullscreenChange),r(document).off("msfullscreenchange",this.onBrowserFullscreenChange),r(document).off("mozfullscreenchange",this.onBrowserFullscreenChange),this.reset(),this.frameMessenger.resetOriginsForPosting(),this.previewOpen=!1,!0)},m.prototype.componentDidMount=function(){this.props.frameMessenger?this.frameMessenger=this.props.frameMessenger:this.frameMessenger=new _.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging(u.getIframeQuery(),this.handleMessageFromChild.bind(this),["page-change","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent","pagerendered"]),this.frameMessenger.startListening(),this.postKeysHandledByParent()},m.prototype.componentWillUnmount=function(){this.clearAllTimeouts(),this.frameMessenger.stopListening()},m.prototype.canPrint=function(){return!(this.props.sharePermissions&&this.props.sharePermissions.canPrintRoles&&0===this.props.sharePermissions.canPrintRoles.length)},m.prototype.showButton=function(e){return this.props.sizeClass===h.SizeClass.Small?C[this.state.docType].includes(e):w[this.state.docType].includes(e)},m.prototype.render=function(){var e,o=this,r="preview-toolbar-overlay-container ";this.state.visible&&!this.props.isHidden||(r+="hide "),this.state.fadingOut&&(r+="fadeout ");var s={className:r},a=this.state.docType===t.PreviewToolbarDocType_SPP?g._("Previous slide"):g._("Page up"),l=this.state.docType===t.PreviewToolbarDocType_SPP?g._("Next slide"):g._("Page down"),c=this.state.docType===t.PreviewToolbarDocType_SPP?"left":"up",u=this.state.docType===t.PreviewToolbarDocType_SPP?"right":"down";e=this.canPrint()?g._("Print"):g._("Printing is turned off for this file.");var d={input_method:"click",file_ext:this.props.fileExtension},h={context:p.UserActionContextNames.TOOLBAR},_=function(e){return function(){e(),o.frameMessenger.postMessageToChildren(T.CLEAR_MOUSE_TRACKING)}};return i.createElement("div",n.__assign({},s),i.createElement("div",{className:"preview-toolbar-overlay",onMouseEnter:this.onMouseEnterToolbar,onMouseLeave:this.onMouseLeaveToolbar},i.createElement("div",{className:"preview-toolbar-content"},this.showButton("page-indicator")?i.createElement(E,{currentPage:this.state.currentPage,docType:this.state.docType,pagesCount:this.state.pagesCount,sizeClass:this.props.sizeClass}):null,this.showButton("zoom-out")?i.createElement(y,{className:b.ZOOM_OUT,spriteGroup:"web",spriteName:"zoomout",tooltip:g._("Zoom out"),onClick:_(function(){return o.zoomOut(h)})}):null,this.showButton("zoom-in")?i.createElement(y,{className:b.ZOOM_IN,spriteGroup:"web",spriteName:"zoom",tooltip:g._("Zoom in"),onClick:_(function(){return o.zoomIn(h)})}):null,this.showButton("page-up")?i.createElement(y,{disabled:this.state.disabledButtons.pageUp,className:b.PAGE_UP,spriteGroup:"web",spriteName:c,tooltip:a,onClick:_(function(){return o.pageUp(d)})}):null,this.showButton("page-down")?i.createElement(y,{disabled:this.state.disabledButtons.pageDown,className:b.PAGE_DOWN,spriteGroup:"web",spriteName:u,tooltip:l,onClick:_(function(){return o.pageDown(d)})}):null,this.showButton("fullscreen")?i.createElement(y,{className:b.FULLSCREEN,spriteGroup:"web",spriteName:"fullscreen",tooltip:g._("Fullscreen"),onClick:_(function(){return o.toggleFullscreen(h)})}):null,this.showButton("print")?i.createElement(y,{disabled:this.state.disabledButtons.print,className:b.PRINT,spriteGroup:"web",spriteName:"print",tooltip:e,onClick:_(function(){return o.printDocument(h)})}):null,this.showButton("enable-region-creation")&&this.props.shouldDisplayRegionCreationButton?i.createElement(y,{className:b.ENABLE_REGION_CREATION,spriteGroup:"web",spriteName:"ic_comment_area_large",tooltip:g._("Comment on specific areas"),onClick:_(function(){return o.onRegionCreationClick()})}):null)))},m.prototype.sanitizePageNumber=function(e){if(null==e)return 0;var t=parseInt(e,10);return isNaN(t)?0:t},m.prototype.fadeOut=function(){this.state.fadingOut||this.clearFadeTimeout(),this.setState({fadingOut:!0,tooltipClass:void 0}),this.props.onToolbarHide&&this.props.onToolbarHide(),this.startFadeTimeout()},m.prototype.fadeIn=function(){this.clearIdleTimeout(),this.isViewerFullscreen()||this.isToolbarReadyToShow()&&(this.clearFadeTimeout(),this.setState({visible:!0,fadingOut:!1}),this.props.onToolbarShow&&this.props.onToolbarShow())},m.prototype.isAnnotationBubbleShown=function(){return r(".annotation-bubble-container .bubble-dropdown").length>0},m.prototype.startFadeTimeout=function(){var e=this;this.fadeTimeout=setTimeout(function(){e.fadeTimeout=void 0,e.setState({visible:!1,fadingOut:!1})},400)},m.prototype.clearFadeTimeout=function(){this.fadeTimeout&&(clearTimeout(this.fadeTimeout),this.fadeTimeout=void 0)},m.prototype.startFullscreeningTimeout=function(){var e=this,t=function(){e.fullscreeningTimeout=void 0,e.setState({fullscreening:!1})};this.fullscreeningTimeout=setTimeout(t,1e3)},m.prototype.clearFullscreeningTimeout=function(){null!=this.fullscreeningTimeout&&(clearTimeout(this.fullscreeningTimeout),this.fullscreeningTimeout=void 0)},m.prototype.onIdleTimeout=function(){this.clearIdleTimeout(),this.fadeOut()},m.prototype.startIdleTimeout=function(){this.clearIdleTimeout(),this.idleTimeout=setTimeout(this.onIdleTimeout.bind(this),1500)},m.prototype.clearIdleTimeout=function(){null!=this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=void 0)},m.prototype.clearAllTimeouts=function(){this.clearFadeTimeout(),this.clearFullscreeningTimeout(),this.clearIdleTimeout()},m.prototype.isToolbarReadyToShow=function(){return!!this.state.currentPage&&!!this.state.pagesCount},m.prototype.logData=function(e,t){return"string"==typeof t.input_method?s.PreviewActivityLogger.log(e,t):v.assert(!1,"logData not correctly formed"),"string"==typeof t.input_method},m.prototype.logUserAction=function(e,t){c.logUserAction(e,t)},m.prototype.logAndPostMessage=function(e,t,n){this.logData(t,n)&&this.frameMessenger.postMessageToChildren(e)},m.prototype.zoomIn=function(e){this.frameMessenger.postMessageToChildren(T.ZOOM_IN),this.logUserAction(p.UserActionNames.ZOOM_IN,e.context)},m.prototype.zoomOut=function(e){this.frameMessenger.postMessageToChildren(T.ZOOM_OUT),this.logUserAction(p.UserActionNames.ZOOM_OUT,e.context)},m.prototype.toggleFullscreen=function(e){this.isViewerFullscreen()?this.exitFullscreen(e):this.enterFullscreen(e)},m.prototype.enterFullscreen=function(e){this.setFullscreen(!0,e)},m.prototype.exitFullscreen=function(e){this.setFullscreen(!1,e)},m.prototype.exitPreview=function(e){if(this.logData("exit-preview",e))return"function"==typeof this.props.afterFileViewerExit?this.props.afterFileViewerExit():void 0},m.prototype.printDocument=function(e){var t;t=this.props.isSharedLink?l.nativePdfPrintFromSharedLink(this.props.fileHref,this.props.fileBlockServerUrl):l.nativePdfPrint({href:this.props.fileBlockServerUrl,preview_type:this.props.filePreviewType}),t||this.frameMessenger.postMessageToChildren(T.PRINT),this.logUserAction(p.UserActionNames.PRINT,e.context)},m.prototype.searchInline=function(e){this.logUserAction(p.UserActionNames.INLINE_SEARCH,e.context)},m.prototype.onRegionCreationClick=function(){this.props.onRegionCreationClick&&this.props.onRegionCreationClick()},m})(i.Component);t.PreviewToolbar=A,t.PageIndicator=E}),define("modules/clean/react/previews/preview_toolbar_container",["require","exports","tslib","external/classnames","external/react","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/comments/constants","modules/clean/comments/logging","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/react/previews/preview_toolbar","modules/clean/react/previews/preview_toolbar_region_creation","modules/clean/previews/preview_toolbar_store","modules/constants/comments_panel"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getComponentState=function(){return{canAnnotate:c.canAnnotate(t.props.isFullscreen),regionCreationEnabled:l.state.regionCreationEnabled,hideToolbar:d.PreviewToolbarStore.state.hideToolbar}},t.state=t.getComponentState(),t.onStateChange=function(){return t.setState(t.getComponentState())},t.logRegionCreationClick=function(e){a.logEvent(e,s.FileActivityLogClientOriginType.ANNOTATION_MODE_BUTTON_IN_TOOLBAR)},t.onRegionCreationClick=function(){t.logRegionCreationClick(s.FileActivityLogEventType.CLIENT_ANNOTATION_MODE_ENABLED),t.props.commentsActionCreators.setRegionCreationEnabled(!0)},t.onRegionCreationDoneClick=function(){t.logRegionCreationClick(s.FileActivityLogEventType.CLIENT_ANNOTATION_MODE_DISABLED),t.props.commentsActionCreators.setRegionCreationEnabled(!1)},t.onKeydown=function(e){t.refs.previewToolbar&&t.refs.previewToolbar.onKeydown(e)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.unsubscribeCommentsStore=l.listen(this.onStateChange),this.unsubscribePreviewToolbarStore=d.PreviewToolbarStore.listen(this.onStateChange)},t.prototype.componentWillUnmount=function(){this.unsubscribeCommentsStore(),this.unsubscribePreviewToolbarStore(),this.state.regionCreationEnabled&&this.props.commentsActionCreators.setRegionCreationEnabled(!1)},t.prototype.render=function(){var e=this.state.regionCreationEnabled&&this.state.canAnnotate,t=h.ALLOW_VIEW_ANNOTATE_MODES&&this.state.canAnnotate,s=null;if(this.props.shouldUseImageToolbar)e||(s=i.createElement(r,n.__assign({},this.props.previewToolbarProps,{ref:"previewToolbar",onRegionCreationClick:this.onRegionCreationClick,canEnableRegionCreation:t})));else{var a=!!this.props.previewToolbarProps.isHidden||e||this.state.hideToolbar;s=i.createElement(u.PreviewToolbar,n.__assign({},this.props.previewToolbarProps,{ref:"previewToolbar",onRegionCreationClick:this.onRegionCreationClick,isHidden:a,shouldDisplayRegionCreationButton:t}))}var l=null;e&&(l=i.createElement(p,{ref:"previewToolbarRegionCreation",onRegionCreationDoneClick:this.onRegionCreationDoneClick}));var c=o({"preview-toolbar-container":!0,"preview-toolbar-container--elevated":!!this.props.elevateToolbar});return i.createElement("div",{className:c},s,l)},t})(i.Component);t.PreviewToolbarContainer=_}),function(){define("modules/clean/react/previews/preview_toolbar_region_creation",["external/react","modules/core/dom","modules/core/i18n"],function(e,t,n){var o,i;return i=e.DOM,o=n._,e.createClass({displayName:"PreviewToolbarRegionCreation",propTypes:{onRegionCreationDoneClick:e.PropTypes.func.isRequired},_renderDoneButton:function(){return i.div({className:"done-button",onMouseUp:this.props.onRegionCreationDoneClick},o("Done"))},_renderHint:function(){return i.div({className:"region-creation-hint"},o("Click and drag to comment on areas"))},render:function(){return i.div({className:"preview-toolbar-overlay-container"},i.div({className:"preview-toolbar-overlay"},i.div({className:"region-creation-toolbar-content"},this._renderHint(),this._renderDoneButton())))}})})}.call(this),define("modules/clean/react/previews/preview_video",["require","exports","tslib","external/classnames","external/react","external/react-dom","jquery","modules/core/browser","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/image_size","modules/clean/loggers/file_preview_logger","modules/clean/previews/actions","modules/clean/previews/util","modules/clean/react/css","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/previews/constants","modules/clean/react/previews/preview_zoom_container","modules/clean/web_timing_logger","modules/core/uri","modules/clean/keycode"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=(function(t){function h(e){var n=t.call(this,e)||this;return n.lastPlaybackRate=1,n.player=null,n.setRefPreviewVideoPlayer=function(e){n.previewVideoPlayer=e},n.onEmbed=function(){n.logFilePreviewTimelineEvent(m.EventTypes.FILE_PREVIEW_SUPPORT_CONFIRMED),n.logFilePreviewTimelineEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),n.resolveEmbedCompleted()},n.onCanPlay=function(){n.markRenderSucceeded()},n.onReady=function(){n.props.shouldFocusOnReady&&setTimeout(n.setFocus,0),n.logFilePreviewTimelineEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),E.mark_time_to_view()},n.onPlay=function(){n.markRenderSucceeded(),s(".vjs-poster").hide(),s(".vjs-big-play-button").hide()},n.onEnd=function(){s(".vjs-poster").show(),s(".vjs-big-play-button").show(),s(".vjs-loading-spinner").hide()},n.onWaiting=function(){null!=n.props.filePreviewSession&&n.props.filePreviewSession.recordEvent(m.EventTypes.FILE_PREVIEW_VIDEO_STALLED,{playback_rate:n.player.playbackRate()})},n.onUserInactive=function(){var e=n.player.playbackRate();e!==n.lastPlaybackRate&&(n.lastPlaybackRate=e,n.logUserAction("playback_rate_changed",{playback_rate:e}))},n.onError=function(e){if(n.rejectEmbedCompleted(e),"needflash"===e)return n.logFilePreviewTimelineEvent(m.EventTypes.FILE_PREVIEW_SUPPORT_DENIED),void("function"==typeof n.props.onError&&n.props.onError(g.ErrorTypes.NEED_FLASH_ERROR));n.shutdown(),n.logFilePreviewTimelineEvent(m.EventTypes.FILE_PREVIEW_DOWNLOAD_FAILED),E.mark_time_to_view(),E.mark_time_to_interactive(),n.props.onError&&n.props.onError(g.ErrorTypes.LOAD_ERROR)},n.handleKeyPress=function(e){return e.keyCode===b.KeyCode.SPACE&&(n.togglePlayback(),e.preventDefault(),!0)},n.embedCompleted=new Promise(function(e,t){n.resolveEmbedCompleted=e,n.rejectEmbedCompleted=t}),n}return n.__extends(h,t),h.prototype.setUpLogger=function(){this.logger&&this.teardownLogger(),this.logger=new u.FilePreviewUserActionLogger,this.logger.listenTo(f.filePreviewEventEmitter)},h.prototype.teardownLogger=function(){this.logger.unlistenTo(f.filePreviewEventEmitter),delete this.logger},h.prototype.logFilePreviewTimelineEvent=function(e){null!==this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},h.prototype.logUserAction=function(e,t){f.filePreviewEventEmitter.emit(m.EventTypes.FILE_PREVIEW_USER_ACTION,this.props.filePreviewSession,e,m.UserActionContextNames.VIDEO_PLAYER,t)},h.prototype.getSizedImageUrl=function(){return S.parse(this.props.thumbnailUrlTmpl).updateQuery({size:c.imageBestFitSize(s(window).width(),s(window).height()),size_mode:"2"}).toString()},h.prototype.shutdown=function(){if(s(".vjs-big-play-button").blur(),null!=this.player){try{this.player.trigger("shutdown"),"Hls"===this.player.techName&&null!=this.player.tech.sourceBuffer&&this.player.tech.sourceBuffer.abort(),this.player.dispose()}catch(e){}this.player=null}},h.prototype.markRenderSucceeded=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),E.mark_time_to_interactive(),this.logFilePreviewTimelineEvent(m.EventTypes.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(p.broadcastRenderSucceeded,0)},h.prototype.setFocus=function(){s(".vjs-poster").show(),s(".vjs-big-play-button").show(),s(".vjs-big-play-button").focus()},h.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},h.prototype.embedVideoLoader=function(){var t=this,n=s(r.findDOMNode(this.previewVideoPlayer)),o=d.video_type(this.props.videoContainer);e(["modules/clean/video_loader"],function(e){t.player=e.embed(n,{src:t.props.previewUrl,type:o,useFlash:o===d.FLV_CONTAINER,controls:!0,playbackRates:t.getPlaybackRates(),preload:"auto",poster:t.getSizedImageUrl(),metadata_link:t.props.videoMetadataUrl,metadata:null,onEmbed:t.onEmbed,onCanPlay:t.onCanPlay,onEnd:t.onEnd,onError:t.onError,onReady:t.onReady,onPlay:t.onPlay,onWaiting:t.onWaiting,onUserInactive:t.onUserInactive})})},h.prototype.componentDidMount=function(){this.embedVideoLoader(),this.setUpLogger()},h.prototype.componentWillUpdate=function(e){e.previewUrl!==this.props.previewUrl&&this.shutdown()},h.prototype.componentDidUpdate=function(e){e.previewUrl!==this.props.previewUrl&&this.embedVideoLoader()},h.prototype.componentWillUnmount=function(){this.shutdown(),this.teardownLogger()},h.prototype.shouldComponentUpdate=function(e,t){return v.compareStateAndProps(e,t)},h.prototype.renderAnnotationsToolbar=function(){if(this.props.shouldDisplayAnnotationsToolbar&&this.props.count>1)return i.createElement("div",{className:"preview-toolbar-container"},i.createElement(l,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,onKeyPress:this.handleKeyPress}))},h.prototype.renderPlayer=function(){return i.createElement("div",{ref:this.setRefPreviewVideoPlayer,className:"video-player"})},h.prototype.togglePlayback=function(){null!=this.player&&(this.player.paused()?this.player.play():this.player.pause())},h.prototype.render=function(){return this.props.isFullscreen?i.createElement(y.PreviewZoomContainer,{isFlippable:!0,renderZoomControls:!1,onClose:_.closeFullscreen,containerClass:"video-player"},this.renderPlayer()):i.createElement("div",{className:o({"flex-preview-container":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar,"touch-device":a.is_mobile_or_tablet()}),ref:"previewVideoContainer"},i.createElement("div",{className:"preview-content preview-video"},i.createElement("div",{className:"preview-video__wrapper"},i.createElement("div",{className:"preview-video__aspect-container"},i.createElement("div",{className:"preview-video__container"},this.renderPlayer())))),this.renderAnnotationsToolbar())},h})(i.Component);t.PreviewVideoWithoutCss=w,t.PreviewVideo=h(w,["/static/css/preview_video-vfl8h2Vm-.css","/static/css/video-js-5-custom-vflfPE3K9.css"])});define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","external/keymaster","external/classnames","external/react","external/underscore","jquery","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/store","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m="",f="previewzoomcontainer",v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={controlsHidden:!1},t.flipNext=function(e){void 0===e&&(e=c.UserActionContextNames.LIGHTBOX_TOOLBAR),l.flipNext(),l.logUserAction(c.UserActionNames.FLIP_NEXT,e)},t.flipPrevious=function(e){void 0===e&&(e=c.UserActionContextNames.LIGHTBOX_TOOLBAR),l.flipPrevious(),l.logUserAction(c.UserActionNames.FLIP_PREV,e)},t.onClick=function(e){var n="."+t.props.containerClass+", .preview-toolbar-overlay, .preview-zoomer-close";a(e.target).is(n)||0!==a(e.target).parents(n).length||(e.preventDefault(),t.onCloseFactory({},c.UserActionContextNames.LIGHTBOX_FRAME))},t.onMouseMove=function(e){0===a(e.target).parents(".preview-toolbar-overlay").length?t.startControlsTimer():clearTimeout(t.controlsHideTimer)},t.onCloseFactory=function(e,n){void 0===e&&(e={}),void 0===n&&(n=c.UserActionContextNames.LIGHTBOX_CLOSE_BUTTON),l.logUserAction(c.UserActionNames.TOGGLE_FULLSCREEN_OFF,n),t.props.onClose()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.flipNext=s.throttle(this.flipNext,100),this.flipPrevious=s.throttle(this.flipPrevious,100),o("esc",f,function(){e.onCloseFactory({},c.UserActionContextNames.KEYBOARD)}),null!=this.props.zoomOutCallback&&o("space",f,this.props.zoomOutCallback),this.props.isFlippable&&(o("left",f,function(){e.startControlsTimer(),e.flipPrevious(c.UserActionContextNames.KEYBOARD)}),o("right",f,function(){e.startControlsTimer(),e.flipNext(c.UserActionContextNames.KEYBOARD)})),m=o.getScope(),o.setScope(f),this.startControlsTimer()},t.prototype.componentWillUpdate=function(){o.setScope(f)},t.prototype.componentWillUnmount=function(){o.clearScope(f),o.setScope(m),clearTimeout(this.controlsHideTimer)},t.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(){e.hideControls()},3e3)},t.prototype.showControls=function(){this.setState({controlsHidden:!1})},t.prototype.hideControls=function(){this.setState({controlsHidden:!0})},t.prototype.renderFlippableControls=function(){return this.props.isFlippable?r.createElement(u.FlippableControls,{index:""+(p.FileViewerStore.instance.getCurrentIndex()+1),numFlippableFiles:p.FileViewerStore.instance.getFiles().length,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},t.prototype.renderControls=function(){var e=this.props.renderZoomControls,t=i({"preview-toolbar-container":!0,hidden:this.state.controlsHidden});return r.createElement("div",{className:t,ref:"previewZoomerToolbarContainer"},r.createElement("div",{className:"preview-toolbar-overlay-container"},r.createElement("div",{className:"preview-toolbar-overlay"},r.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),e?r.createElement("div",{className:i({"toolbar-button-entry":!0,"zoom-out":!0,disabled:this.props.zoomOutDisabled}),ref:"zoomControlZoomOut"},r.createElement(d,{alt:_._("Zoom out"),group:"web",name:"zoomout"})):null,e?r.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer"},r.createElement(h,{content:_._("View actual size"),position:h.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},r.createElement("span",{className:"zoom-label",ref:"zoomLabel"}))):null,e?r.createElement("div",{className:i({"toolbar-button-entry":!0,"zoom-in":!0,disabled:this.props.zoomInDisabled}),ref:"zoomControlZoomIn"},r.createElement(d,{alt:_._("Zoom in"),group:"web",name:"zoom"})):null))))},t.prototype.renderClose=function(){var e=i({"preview-zoomer-close":!0,
hidden:this.state.controlsHidden});return r.createElement("span",null,r.createElement("button",{"aria-label":_._("Close"),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"}),r.createElement(d,{alt:_._("Close"),group:"web",name:"lightbox_close"}))},t.prototype.render=function(){var e=i({"preview-zoomer-container":!0,"zoomer-drag-disabled":this.props.dragDisabled});return r.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},t})(r.Component);v.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},t.PreviewZoomContainer=v}),define("modules/clean/react/previews/quality_popup/constants",["require","exports"],function(e,t){"use strict";function n(e){return i[e]}Object.defineProperty(t,"__esModule",{value:!0});var o;(function(e){e[e.POPUP=0]="POPUP",e[e.FEEDBACK_MODAL=1]="FEEDBACK_MODAL"})(o=t.QualityPopupStage||(t.QualityPopupStage={}));var i=[];i[o.POPUP]="popup",i[o.FEEDBACK_MODAL]="feedback_modal",t.getPopupStageLoggerKey=n,t.BooleanAnswers={YES:"Y",NO:"N"}}),define("modules/clean/react/previews/quality_popup/feedback_modal",["require","exports","tslib","external/react","modules/clean/em_string","modules/clean/filepath","modules/clean/react_format","modules/core/i18n","modules/clean/react/modal","modules/clean/react/sprite"],function(e,t,n,o,i,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isFileSelected:t.props.allowFileDonation,feedback:""},t.onDone=function(){t.props.onDone(t.state.isFileSelected,t.state.feedback),l.Modal.close()},t.onDismiss=function(){t.props.onDismiss(),l.Modal.close()},t.checkboxChange=function(e){t.setState({isFileSelected:e.target.checked})},t}return n.__extends(t,e),t.showInstance=function(e){l.Modal.showInstance(e)},t.prototype.renderFileDonation=function(){if(!this.props.allowFileDonation)return null;var e=i.em_snippet(r.filename(this.props.filename),32),t=r.file_icon(this.props.filename);return o.createElement("label",{className:"file_selection"},o.createElement("div",{className:"file_check"},o.createElement("input",{type:"checkbox",checked:this.state.isFileSelected,"aria-checked":this.state.isFileSelected,onClick:this.checkboxChange,id:"file_selection_checkbox"})),o.createElement("div",{className:"file_image"},o.createElement(c,{group:"web",name:t+"_32",alt:""})),o.createElement("div",{className:"file_desc"},o.createElement("div",{className:"file_desc_container"},o.createElement("div",{className:"main"},s.reactFormat(a._("Include <b>%(filename)s</b>"),{filename:e,b:o.createElement("b",null)})),o.createElement("div",{className:"disclaimer"},a._("The Dropbox team will review your document. It will only be used to help improve previews.")))))},t.prototype.render=function(){var e=this;return o.createElement(l.Modal,{title:a._("Tell us what’s wrong"),acceptButtonText:a._("Send feedback"),dismissButtonText:a._("Cancel"),autoClose:!1,showX:!0,onAccept:this.onDone,onDismiss:this.onDismiss},o.createElement("div",{className:"send_feedback_modal_content"},o.createElement("textarea",{className:"feedback",name:"feedback",id:"feedback",maxLength:255,readOnly:!1,placeholder:a._("My document doesn’t look right because..."),value:this.state.feedback,onChange:function(t){return e.setState({feedback:t.target.value})}}),this.renderFileDonation()))},t})(o.Component);t.PreviewFeedbackModal=u}),define("modules/clean/react/previews/quality_popup/preview_quality_popup",["require","exports","tslib","external/react","modules/clean/filepath","modules/clean/loggers/file_preview_logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/models","modules/clean/react/previews/quality_popup/constants","modules/clean/react/previews/quality_popup/questions","modules/clean/react/previews/quality_popup/feedback_modal","modules/clean/previews/util","modules/clean/react/sprite","modules/clean/react/file_viewer/file_preview_event_emitter","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.handleDismissPopup=function(){t.recordDismissed(c.QualityPopupStage.POPUP),t.hidePopup()},t.handleAnswerYes=function(){t.recordAnswer(t.state.question,c.BooleanAnswers.YES),t.feedbackReceived()},t.handleAnswerNo=function(){t.recordAnswer(t.state.question,c.BooleanAnswers.NO),u.shouldShowFeedbackModal(t.state.question)?t.showFeedbackModal():t.feedbackReceived()},t.handleModalDone=function(e,n){var o={};o[u.Questions.FEEDBACK]=n||"",o[u.Questions.DONATE]=e?c.BooleanAnswers.YES:c.BooleanAnswers.NO;var i={};e&&(i._file_nsid=t.props.file.ns_id,i._file_sjid=t.props.file.sjid),t.recordMultipleAnswers(o,i),t.feedbackReceived()},t.handleModalDismiss=function(){t.recordDismissed(c.QualityPopupStage.FEEDBACK_MODAL)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.file,t=i.file_extension(i.filename(e.fq_path));this.popupLogger=new r.FilePreviewQualityPopupLogger,this.popupLogger.listenTo(_.filePreviewEventEmitter),this.handlePreviewOpen(t)},t.prototype.componentWillUnmount=function(){this.popupLogger.unlistenTo(_.filePreviewEventEmitter)},t.prototype.recordQuestions=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=l.FilePreviewSession.currentSession;_.filePreviewEventEmitter.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ASKED,n,e)},t.prototype.recordAnswer=function(e,t){var n={};n[e]=t,this.recordMultipleAnswers(n)},t.prototype.recordMultipleAnswers=function(e,t){void 0===t&&(t={});var n=l.FilePreviewSession.currentSession;_.filePreviewEventEmitter.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_ANSWERED,n,e,t)},t.prototype.recordDismissed=function(e){var t=l.FilePreviewSession.currentSession;_.filePreviewEventEmitter.emit(a.EventTypes.FILE_PREVIEW_QUALITY_POPUP_DISMISSED,t,e)},t.prototype.showFeedbackModal=function(){var e=o.createElement(p.PreviewFeedbackModal,{filename:i.filename(this.props.file.fq_path),allowFileDonation:this.props.allowFileDonation,onDone:this.handleModalDone,onDismiss:this.handleModalDismiss});this.recordQuestions(u.Questions.FEEDBACK,u.Questions.DONATE),p.PreviewFeedbackModal.showInstance(e)},t.prototype.feedbackReceived=function(){f.success(m._("Thanks! Your feedback will help improve Dropbox."),3),this.hidePopup()},t.prototype.hidePopup=function(){this.setState({question:void 0}),s.closePreviewQualityPopup()},t.prototype.randomNum=function(e,t){return void 0===t&&(t=0),Math.random()*(e-t)+t},t.prototype.handlePreviewOpen=function(e){if(!(this.randomNum(100)>this.props.showProbability)){var t=u.getQuestionToAsk(e);null!==t&&(this.setState({question:t}),this.recordQuestions(t))}},t.prototype.render=function(){return void 0===this.state.question?null:o.createElement("div",{id:"preview-quality-popup",className:"preview-quality-bar fadeout"},o.createElement("div",{className:"container"},o.createElement("div",{className:"title"},u.getQuestionWording(this.state.question,d.get_extension(this.props.file)),o.createElement("div",{className:"resolution"},o.createElement("button",{className:"button-as-link looks-good-link",onClick:this.handleAnswerYes},m._("Yes")),o.createElement("span",{className:""},m._("•")),o.createElement("button",{className:"button-as-link something-wrong-link",onClick:this.handleAnswerNo},m._("No")))),o.createElement("div",{className:"hide_button"},o.createElement("button",{className:"button-as-link dismiss-link",onClick:this.handleDismissPopup},o.createElement(h,{group:"web",name:"x",alt:m._("Close")})))),o.createElement("hr",{className:"separator"}))},t})(o.Component);t.PreviewQualityPopup=v}),define("modules/clean/react/previews/quality_popup/questions",["require","exports","modules/core/i18n","modules/constants/file_viewer"],function(e,t,n,o){"use strict";function i(e,t){var n=_[e];return"ALL_EXTENSIONS"===n||n.indexOf(t)>-1}function r(e){var t=o.PREVIEW_QUALITY_POPUP_QUESTION;if(!h.hasOwnProperty(t))return null;var n=h[t];return i(n,e)?n:null}function s(e){return!!m[e]}function a(e,t){return f[e][t]||f[e].ALL_EXTENSIONS}function l(e){return C[e]}Object.defineProperty(t,"__esModule",{value:!0});var c;(function(e){e[e.LOOK_GOOD=0]="LOOK_GOOD",e[e.LOAD_QUICKLY=1]="LOAD_QUICKLY",e[e.FEEDBACK=2]="FEEDBACK",e[e.DONATE=3]="DONATE"})(c=t.Questions||(t.Questions={}));var u=["3gp","3gpp","3gpp2","asf","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpg","mpeg","mts","oggtheora","ogv","rm","ts","vob","webm","wmv"],p=["jpg","jpeg","png","tiff","tif","gif","bmp","webp","wbmp"],d=["flac","oga","m4a","mp3","wma","aac","wav"],h={};h.LOOK_GOOD=c.LOOK_GOOD,h.LOAD_QUICKLY=c.LOAD_QUICKLY;var _={};_[c.LOOK_GOOD]="ALL_EXTENSIONS",_[c.LOAD_QUICKLY]="ALL_EXTENSIONS";var m=[];m[c.LOOK_GOOD]=!0;var f=[];f[c.LOOK_GOOD]={};for(var v=0,g=d;v<g.length;v++){var y=g[v];f[c.LOOK_GOOD][y]=n._("Does this audio preview sound okay?")}for(var E=0,S=u;E<S.length;E++){var y=S[E];f[c.LOOK_GOOD][y]=n._("Does this video preview look okay?")}for(var b=0,w=p;b<w.length;b++){var y=w[b];f[c.LOOK_GOOD][y]=n._("Does this image preview look okay?")}f[c.LOOK_GOOD].ALL_EXTENSIONS=n._("Does this file preview look okay?"),f[c.LOAD_QUICKLY]={},f[c.LOAD_QUICKLY].ALL_EXTENSIONS=n._("Did this preview load quickly?");var C=[];C[c.LOOK_GOOD]="look_good",C[c.LOAD_QUICKLY]="load_quickly",C[c.FEEDBACK]="feedback",C[c.DONATE]="donate",t.isQuestionAllowed=i,t.getQuestionToAsk=r,t.shouldShowFeedbackModal=s,t.getQuestionWording=a,t.getQuestionLoggerKey=l}),define("modules/clean/react/previews/responsive_image",["require","exports","tslib","external/react","modules/clean/react/previews/image_helpers"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e;return e=this.props.onContextMenu?this.props.className+" disabled-context-menu":this.props.className,o.createElement("img",{alt:this.props.fileName,srcSet:i.getSrcSet(this.props.thumbnailUrlTmpl),sizes:i.IMG_SIZES_ATTR,src:i.getFallbackSrc(this.props.thumbnailUrlTmpl),className:e,style:this.props.style,onLoad:this.props.onLoad,onError:this.props.onError,onClick:this.props.onClick,onContextMenu:this.props.onContextMenu,ref:this.props.refCallback})},t})(o.Component);t.ResponsiveImage=r}),function(){define("modules/clean/react/select",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/hidden","modules/clean/react/sprite","modules/clean/react/util","modules/core/dom"],function(e,t,n,o,i,r,s,a,l,c,u){var p,d,h,_,m,f,v,g;return d=r.KeyCode,p=a.HiddenSelect,_=t.DOM,h=t.createElement,m=function(e,t){var n,o,i,r;return r=e.scrollTop(),i=r+e.height(),o=t.position().top+r,n=o+t.height(),o<r?e.scrollTop(o):n>i?e.scrollTop(n-e.height()):void 0},g=t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.number]),v=t.createClass({displayName:"selectOption",propTypes:{id:t.PropTypes.string,className:t.PropTypes.string,disabled:t.PropTypes.bool,title:t.PropTypes.string,value:g,error:t.PropTypes.shape({message_text:t.PropTypes.string,message_html:t.PropTypes.string})},getInitialState:function(){return{id:o.uniqueId("option")}},componentWillReceiveProps:function(e){if(null!=e.id)return this.setState({id:e.id})},render:function(){var t,n,o;return t={"list-item":!0,"select-option":!0,"select-option-disabled":this.props.disabled},null!=this.props.className&&(t[this.props.className]=!0),o=this.props.value,n=i.extend(!0,{},this.props),delete n.value,_.div(i.extend({"data-value":o},n,{id:this.state.id,role:"option",className:e(t),"aria-disabled":this.props.disabled}),this.props.children)}}),f=t.createClass({displayName:"selectInput",mixins:[s],mouseInput:!0,propTypes:{name:t.PropTypes.string,onChange:t.PropTypes.func,defaultValue:g,style:t.PropTypes.object,value:g,variant:t.PropTypes.string,className:t.PropTypes.string,ariaLabelId:t.PropTypes.string,ariaDescriptionId:t.PropTypes.string,valueLink:t.PropTypes.object,isDisabled:t.PropTypes.bool,headerElement:t.PropTypes.element},getDefaultProps:function(){return{errorWrapperClassName:"select-input-error-wrapper",ariaLabelId:"",ariaDescriptionId:"",style:null,headerElement:null}},getInitialState:function(){return{open:!1,focused:null,keyboarsSelectPrefix:"",selectOptionId:o.uniqueId("selected-option"),listboxId:o.uniqueId("listbox"),value:this.props.defaultValue}},_getFilteredChildren:function(){return o.isArray(this.props.children)?o.filter(this.props.children,function(e){return e}):this.props.children},render:function(){var n,o,i,r,s,a,c;return o={"select-input":!0,"select-input-dropdown-shown":this.state.open,"select-input-disabled":this.props.isDisabled},this.props.variant&&(o[this.props.variant]=!0),this.props.className&&(o[this.props.className]=!0),r={"list-menu":!0,"select-input-dropdown":!0,"select-input-disable-error":this.props["disable-errors"]},i=this.renderErrorIfEnabled(),n=this.props.ariaDescriptionId,((null!=(s=this.props.error)?s.message_text:void 0)||null!=(null!=(a=this.props.error)?a.message_html:void 0))&&(n=i.props.id),c=this.selectedOption(),_.div({className:e(o),style:this.props.style,ref:"wrapperDiv"},i,_.button({className:"select-input-button","aria-expanded":this.state.open,"aria-describedby":n,"aria-controls":this.state.listboxId,"aria-labelledby":this.props.ariaLabelId+" "+c.props.id,ref:"selectButton",tabIndex:0,onClick:this.handleClickOnInputButton},_.div({className:"select-input-input filter-item__filter-input",ref:"label"},c,_.div({className:"select-input-dropdown-arrow"},h(l,{group:"web",name:"arrow-down-gray",alt:""})))),h(p,{name:this.props.name,defaultValue:this.props.defaultValue,value:this.getValue(),options:(function(e){return function(){var n;return n=[],t.Children.forEach(e._getFilteredChildren(),function(e){return n.push(e.props.value)}),n}})(this)()}),_.div({className:"hidden-option-container"},_.div({id:this.state.listboxId,className:e(r),role:"listbox",onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,tabIndex:-1,ref:"dropdown"},this.menuChildren())))},handleMouseMove:function(e){var t,n;if(!this.props.isDisabled)return e.pageX===t&&e.pageY===n||(this.mouseInput=!0),t=e.pageX,n=e.pageY},_commonPrefixLen:function(e,t){var n;for(e=e.trim().toLowerCase(),t=t.trim().toLowerCase(),n=0;n<e.length&&n<t.length&&e.charAt(n)===t.charAt(n);)n++;return n},_keyboardSelect:function(e){var t,n,i,r,s;return s=o.sortedIndex(this.sortedOptions,{text:e.toLowerCase()},"text"),i=this.sortedOptions[Math.max(s-1,0)],t=this.sortedOptions[Math.min(s,this.sortedOptions.length-1)],r=this._commonPrefixLen(e,i.text),n=this._commonPrefixLen(e,t.text),r>=n?this.setState({keyboarsSelectPrefix:e,focused:i.value}):this.setState({keyboarsSelectPrefix:e,focused:t.value})},handleKeydown:function(e){var t,n,i;if(!this.props.isDisabled){switch(this.mouseInput=!1,e.keyCode){case d.TAB:return this.setState({open:!1,focused:null}),!0;case d.ENTER:case d.SPACE:this.state.open&&this.state.focused?(this.setValue(this.state.focused),this.setState({open:!1})):this.toggle();break;case d.ESC:this.state.open&&(i=this.getValue(),this.setValue(i),this.setState({open:!1}));break;case d.UP:this.state.open?this.setState({focused:this.prev(this.state.focused)}):this.setState({open:!0});break;case d.DOWN:this.state.open?this.setState({focused:this.next(this.state.focused)}):this.setState({open:!0});break;default:if(!this.state.open)return!0;o.contains(o.values(d),e.keyCode)||(t=String.fromCharCode(e.which),n=this.state.keyboarsSelectPrefix+t,this._keyboardSelect(n),this._keyboardSelect_timeout&&clearTimeout(this._keyboardSelect_timeout),this._keyboardSelect_timeout=setTimeout((function(e){return function(){return e.setState({keyboarsSelectPrefix:""}),e._keyboardSelect_timeout=null}})(this),500))}return!1}},prev:function(e){var n,o;return n=null,o=null,t.Children.forEach(this._getFilteredChildren(),(function(t){return function(t){if(o||t.props.disabled||(o=t),t.props.value===e&&(n=o),!t.props.disabled)return o=t}})(this)),null!=n?n.props.value:void 0},next:function(e){var n,o,i;return n=null,o=null,t.Children.forEach(this._getFilteredChildren(),(function(t){return function(t){if(!t.props.disabled)return(null!=o?o.props.value:void 0)===e&&(n=t),o=t}})(this)),null!=(i=n||o)?i.props.value:void 0},menuChildren:function(){var n;return n=this.getValue(),t.Children.map(this._getFilteredChildren(),(function(o){return function(i){return t.cloneElement(i,{onMouseEnter:function(){if(u.scroll_lock_document(),o.mouseInput)return o.setState({focused:i.props.value})},onMouseOut:function(){return u.scroll_unlock_document()},onClick:function(){if(!i.props.disabled)return o.setState({open:!1}),o.setValue(i.props.value)},className:e({"focused-option":null!=o.state.focused&&o.state.focused===i.props.value,"selected-option":n===i.props.value},i.props.className)})}})(this))},componentWillMount:function(){var e;return e=t.Children.map(this._getFilteredChildren(),function(e){return{value:e.props.value,text:c.getText(e).trim().toLowerCase()}}),this.sortedOptions=o.sortBy(e,"text")},componentDidMount:function(){return this.globalMenuCloser=(function(e){return function(t){var o;if(e.state.open&&(o=i(t.target).closest(".select-input"),!o.length||o[0]!==n.findDOMNode(e.refs.wrapperDiv)))return e.setState({open:!1,focused:null})}})(this),i(document).on("click",this.globalMenuCloser)},componentWillUnmount:function(){return i(document).off("click",this.globalMenuCloser)},componentDidUpdate:function(e,t){var o,r,s,a,l;if(r=i(n.findDOMNode(this.refs.dropdown)),s=i(n.findDOMNode(this.refs.selectButton)),this.state.open&&(o=r.find("[data-value='"+this.state.focused+"']"),r.attr("aria-activedescendant",o.attr("id"))),this.state.open&&this.state.focused&&null==this.props.headerElement&&(o=r.find("[data-value='"+this.state.focused+"']"),r.attr("aria-activedescendant",o.attr("id")),m(r,o)),l=t.open&&!this.state.open,a=!t.open&&this.state.open,a&&r.focus(),l)return s.focus()},selectedOption:function(){var e;return e=null,null!=this.props.headerElement?this.props.headerElement:(t.Children.forEach(this._getFilteredChildren(),(function(t){return function(n){if(e||(e=n),(null!=n?n.props.value:void 0)===t.getValue())return e=n}})(this)),e?t.cloneElement(e,{id:this.state.selectOptionId}):null)},handleClickOnInputButton:function(e){return e.preventDefault(),this.toggle()},toggle:function(){if(!this.props.isDisabled)return this.state.open?this.setState({open:!1,focused:null}):this.setState({open:!0,focused:this.getValue()})},getValue:function(){var e,t,n,o;return null!=(e=null!=(t=null!=(n=this.props.value)?n:null!=(o=this.props.valueLink)?o.value:void 0)?t:this.state.value)?e:this.props.defaultValue},setValue:function(e){var t,n;if(n=this.getValue(),this.props.valueLink?this.props.valueLink.requestChange(e):this.setState({value:e}),n!==e||null!=this.props.headerElement)return"function"==typeof(t=this.props).onChange?t.onChange(n,e):void 0}}),{input:f,option:v}})}.call(this),define("modules/clean/react/share_download/actions",["require","exports","external/react","modules/clean/ajax","modules/clean/downloads","modules/clean/multiaccount_login","modules/clean/react/copy_to_dropbox/modal","modules/clean/react/modal","modules/clean/sharing/signup_modal_proxy","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_){"use strict";return new((function(){function e(){}return e.prototype.direct=function(e){var t=function(){var t=function(){var t=_.parse(e.url).updateQuery({dl:"1"}).toString();i.get({url:t,__do_not_use_expected_domain:"dl.dropboxusercontent.com"})};if(!e.downloadTestUrl)return void t();var n=function(){h.error(d._("Failed to download zip file."))},r=function(e){"OK"===e?t():0===e.indexOf("err:")?h.error(d._("The zip file is too large.")):n()};o.SilentBackgroundRequest({url:e.downloadTestUrl,success:r,error:n})};return l.signupForDirectDownload().then(t)},e.prototype.toDropbox=function(e,t,o,i){var d,h;if("anonymous"===o)d=l.signup(),h=u.reload;else{var _=i?i.id:-1;p.assert(_!==-1,"role isn't anonymous => user cannot be null or undefined!"),d=new Promise(function(e){c.get_viewer().is_user_signed_in(i)?e(_):r.show_modal({role:o,on_success:function(){e(_)}})})}d.then(function(i){var r=n.createElement(s,{shareToken:e,fileOrFolder:t,userId:i,role:o,onDismiss:h});a.Modal.showInstance(r)})},e})())}),define("modules/clean/react/share_download/button",["require","exports","tslib","external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/react/share_download/models","modules/clean/react/share_download/util","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={isDisabled:!0},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setState({isDisabled:this.props.isDisabled})},t.prototype.render=function(){var e=["button-secondary","c-btn","c-btn--secondary","download-button","control__button"];this.props.className&&e.push(this.props.className);var t=o(e);return i.createElement("button",{id:"download-menu-button",className:t,disabled:this.state.isDisabled,onClick:this.props.onClick},this.props.children)},t})(i.Component);d.defaultProps={isDisabled:!1};var h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=function(t){t.preventDefault(),e.props.onClick&&e.props.onClick(e.props.option),e.props.option.handler(),s.logUserAction(e.props.option.userActionName,l.getSplitButtonUserActionContext(a.SplitButtonActionLocation.MAIN,e.props.location))};return i.createElement(d,{isDisabled:this.props.isDisabled,onClick:t},this.props.targetText)},t})(i.Component);t.DownloadSimpleButton=h;var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.onClickProxy=function(e,t){return function(o){n.props.onClick&&n.props.onClick(),e.handler&&e.handler(),s.logUserAction(e.userActionName,l.getSplitButtonUserActionContext(t,n.props.location))}},n.state={isDisabled:!0},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setState({isDisabled:this.props.isDisabled})},t.prototype.renderDropdownButton=function(){var e=o({"button-secondary":!0,"c-btn":!0,"c-btn--secondary":!0,"download-button":!0,control__button:!0,disabled:this.state.isDisabled});return i.createElement("button",{className:e},this.props.targetText)},t.prototype.renderMenu=function(e){var t=this,n=this.props.options.map(function(e){return i.createElement(r.BubbleMenuItem,{onClick:t.onClickProxy(e,a.SplitButtonActionLocation.SPLIT),disabled:e.isDisabled},e.text)}),o=this.props.justifyRight?r.BubbleMenu.POSITIONS.BOTTOM_ALIGN_RIGHT:r.BubbleMenu.POSITIONS.BOTTOM;return i.createElement(r.BubbleMenu,{targetButton:e,position:o,verticalDisplacement:4,className:"react-file-viewer-dropdown",items:n})},t.prototype.render=function(){return this.props.isDisabled?i.createElement(d,{isDisabled:!0},this.props.targetText):this.renderMenu(this.renderDropdownButton())},t})(i.Component);_.defaultProps={justifyRight:!0};var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.isDownloadAllowed=function(){return this.props.sharePermissions.canDownloadRoles.length>0},t.prototype.getTargetText=function(e){return this.isDownloadAllowed()?e>1?p._("Download ▾"):p._("Download"):p._("Add to Dropbox")},t.prototype.getTooltipLabel=function(){return this.props.fileOrFolder&&null===this.props.fileOrFolder.ns_id?p._("Download is unavailable while file is uploading."):p._("The owner turned off the option to download.")},t.prototype.render=function(){var e=u.getDownloadOptions(this.props.sharePermissions,this.props.sharedLinkInfo,this.props.shareToken,this.props.fileOrFolder);if(this.props.downloadOnly){var t=new c.ShareDownloadActionOption({isDisabled:!0}),n=!0;return this.isDownloadAllowed()&&(t=c.ShareDownloadActionOption.buildDirectOption(this.props.sharedLinkInfo),n=!1),i.createElement(h,{isDisabled:n,targetText:p._("Download"),option:t,onClick:this.props.onClick,location:this.props.location})}return 0===e.length?i.createElement(_,{targetText:p._("Download"),isDisabled:!0,options:[new c.ShareDownloadActionOption({isDisabled:!0})],justifyRight:this.props.justifyRight,onClick:this.props.onClick,location:this.props.location,title:this.getTooltipLabel()}):1===e.length?i.createElement(h,{isDisabled:!1,targetText:this.getTargetText(e.length),option:e[0],onClick:this.props.onClick,location:this.props.location}):i.createElement(_,{targetText:this.getTargetText(e.length),options:e,justifyRight:this.props.justifyRight,onClick:this.props.onClick,location:this.props.location,isDisabled:!1})},t})(i.Component);t.ShareDownloadButton=m}),define("modules/clean/react/share_download/models",["require","exports","tslib","external/immutable","modules/clean/react/file_viewer/constants","modules/clean/react/share_download/actions","modules/core/i18n"],function(e,t,n,o,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={text:void 0,handler:void 0,spriteName:void 0,isDisabled:void 0,userActionName:void 0},l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.buildDirectOption=function(e){return new t({text:s._("Direct download"),handler:function(){r.direct(e)},spriteName:"download_arrow",userActionName:i.UserActionNames.DOWNLOAD})},t.buildToDropboxOption=function(e,n,o,a,l,c){void 0===c&&(c=!1);var u=s._("Save to my Dropbox"),p="dropbox",d=i.UserActionNames.SAVE_TO_DROPBOX;if(o.is_paired)switch(l){case"personal":u=s._("Save to personal Dropbox"),p="s_house",d=i.UserActionNames.SAVE_TO_DROPBOX_PERSONAL;break;case"work":u=s._("Save to %(team_name)s Dropbox").format({team_name:o.team_name}),p="s_briefcase",d=i.UserActionNames.SAVE_TO_DROPBOX_WORK}return new t({text:u,handler:function(){r.toDropbox(e,n,l,a)},spriteName:p,isDisabled:c,userActionName:d})},t})(o.Record(a));t.ShareDownloadActionOption=l}),define("modules/clean/react/share_download/util",["require","exports","modules/clean/react/share_download/models","modules/clean/viewer"],function(e,t,n,o){"use strict";function i(e,t,i,r){var s=e.canDownloadRoles,a=e.canCopyToDropboxRoles,l=n.ShareDownloadActionOption.buildDirectOption,c=n.ShareDownloadActionOption.buildToDropboxOption,u=[];if(r&&null===r.ns_id)return u;if(s.length>0&&u.push(l(t)),a.length>0){var p=o.get_viewer(),d=p.get_users(!0),h=function(e,t){var n=a.indexOf(t)===-1;u.push(c(i,r,p,e,t,n))};d.forEach(function(e){h(e,e.role)}),a.indexOf("anonymous")>-1&&h(void 0,"anonymous")}return u}Object.defineProperty(t,"__esModule",{value:!0}),t.getDownloadOptions=i}),define("modules/clean/react/size_class/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"})(t.SizeClass||(t.SizeClass={})),t.MEDIA_SIZE_CLASS_MEDIUM="screen and (min-width: 736px) and (max-width: 1023px)",t.MEDIA_SIZE_CLASS_LARGE="screen and (min-width: 1024px)"}),define("modules/clean/react/size_class/size_class",["require","exports","tslib","external/react","external/classnames","external/hoist-non-react-statics","external/spectrum/match","modules/clean/react/size_class/constants","modules/clean/react/size_class/utils","modules/clean/react/size_class/utils"],function(e,t,n,o,i,r,s,a,l,c){"use strict";function u(e,t){return void 0===t&&(t={}),r((function(r){function u(){var t=null!==r&&r.apply(this,arguments)||this;return t.displayName="WithSizeClass("+c.getDisplayName(e),t.state={},t.getHandleMatch=function(e,n){return function(){t.setState((o={},o[e]=n,o));var o}},t.onMatchMedium=t.getHandleMatch("matchSizeClassMedium",!0),t.onUnmatchMedium=t.getHandleMatch("matchSizeClassMedium",!1),t.onMatchLarge=t.getHandleMatch("matchSizeClassLarge",!0),t.onUnmatchLarge=t.getHandleMatch("matchSizeClassLarge",!1),t}return n.__extends(u,r),u.prototype.render=function(){var r=t.isResponsiveEnabled,c=t.responsiveClassName,u=void 0===c?"":c;return o.createElement("div",{className:i((p={},p[u]=!r||r(),p))},o.createElement(s.Match,{media:a.MEDIA_SIZE_CLASS_MEDIUM,onMatch:this.onMatchMedium,onUnmatch:this.onUnmatchMedium}),o.createElement(s.Match,{media:a.MEDIA_SIZE_CLASS_LARGE,onMatch:this.onMatchLarge,onUnmatch:this.onUnmatchLarge}),o.createElement(e,n.__assign({},this.props,{sizeClass:l.getSizeClass(this.state.matchSizeClassMedium,this.state.matchSizeClassLarge,r)})));var p},u})(o.Component),e)}Object.defineProperty(t,"__esModule",{value:!0}),t.withSizeClass=u}),define("modules/clean/react/size_class/utils",["require","exports","modules/clean/react/size_class/constants"],function(e,t,n){"use strict";function o(e,t,o){return o&&!o()?n.SizeClass.Large:t?n.SizeClass.Large:e?n.SizeClass.Medium:n.SizeClass.Small}function i(e){return e.displayName||e.name||"Component"}Object.defineProperty(t,"__esModule",{value:!0}),t.getSizeClass=o,t.getDisplayName=i}),function(){define("modules/clean/react/slider",["external/classnames","external/react","modules/clean/css"],function(e,t,n){var o,i,r,s,a,l;return l=n.require_css,a=t.DOM,o=t.createClass({displayName:"IndicatorGroup",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string,currentSlideIndex:t.PropTypes.number.isRequired,slideCount:t.PropTypes.number.isRequired,onIndicatorClick:t.PropTypes.func},render:function(){var t;return a.ul({className:e("c-slider__indicator-group",this.props.className)},function(){t=[];for(var e=0,n=this.props.slideCount;0<=n?e<n:e>n;0<=n?e++:e--)t.push(e);return t}.apply(this).map((function(t){return function(n){return a.li({key:"indicator-"+n,className:e({"c-slider__indicator":!0,"is-active":n===t.props.currentSlideIndex}),onClick:function(){var e;return"function"==typeof(e=t.props).onIndicatorClick?e.onIndicatorClick(n):void 0}})}})(this)))}}),i=t.createClass({displayName:"NavButtonGroup",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string},render:function(){return a.div({className:e("c-slider__nav-button-group",this.props.className)},this.props.children)}}),s=t.createClass({displayName:"Slides",mixins:[t.addons.PureRenderMixin],propTypes:{currentSlideIndex:t.PropTypes.number.isRequired,width:t.PropTypes.number.isRequired,height:t.PropTypes.number},getSlideCount:function(){return t.Children.count(this.props.children)},render:function(){var n;return a.div({className:"c-slider__window",style:{width:this.props.width+"px",height:null!=(n=this.props.height)?n:"auto"}},a.div({className:"c-slider__slides"},t.Children.map(this.props.children,(function(t){return function(n,o){return a.div({className:e({"c-slider__slide":"c-slider__slide","is-active":t.props.currentSlideIndex===o}),style:{width:t.props.width+"px",transform:"translateX("+100*-t.props.currentSlideIndex+"%)"}},n)}})(this))))}}),r=t.createClass({displayName:"Slider",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string},componentWillMount:function(){return l("/static/css/legacy_packages/components-vflfWNhxV.css")},render:function(){return a.div({className:e("c-slider",this.props.className)},this.props.children)}}),{NavButtonGroup:i,Slider:r,IndicatorGroup:o,Slides:s}})}.call(this),
define("modules/clean/react/title_bar/base",["require","exports","tslib","external/react","modules/clean/react/title_bar/title_bar_title"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.closeTitle,n=e.controls,r=e.customLogoUrl,s=e.file,a=e.sizeClass,l=e.title;return o.createElement("div",{className:"react-title-bar"},o.createElement(i.TitleBarTitle,{canClose:!!this.props.canClose,closeTitle:t,customLogoUrl:r,file:s,sizeClass:a,onClose:this.props.onClose},l),o.createElement("div",{className:"react-title-bar__action-wrap"},n))},t})(o.Component);r.defaultProps={canClose:!1},t.TitleBarBase=r}),define("modules/clean/react/title_bar/controls_container",["require","exports","tslib","external/react"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("div",{className:"react-title-bar__controls u-mar-right-xs"},this.props.children)},t})(o.Component);t.TitleBarControlsContainer=i}),define("modules/clean/react/title_bar/title_bar_close_button",["require","exports","tslib","external/classnames","external/react","modules/clean/filepath","modules/clean/static_urls","modules/clean/react/size_class/constants","modules/clean/react/file_viewer/utils","modules/clean/react/image","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n","modules/core/browser"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_){"use strict";function m(e){var t=e.customLogoUrl,n=e.file,a=!0;if(n&&l.isBrowseFile(n)&&n.fq_path&&(a="/"===r.parent_dir(n.fq_path)),a)return i.createElement(u.DropboxLogo,{className:"react-title-bar__close--logo"});if(t)return i.createElement("img",{alt:h._("Logo"),src:t});var c=o("sprite","sprite_web","s_web_folder_32");return i.createElement(p,{group:"web",name:s.static_url("/static/images/icons/icon_spacer-vflN3BYt2.gif"),className:c,alt:"Dropbox"})}Object.defineProperty(t,"__esModule",{value:!0}),t.CloseButtonLogo=m;var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClose=function(e){e.stopPropagation(),null!=t.props.onClose&&t.props.onClose()},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.closeTitle,n=e.customLogoUrl,o=e.file,r=e.onClose,l=e.sizeClass,u=l===a.SizeClass.Large,p=i.createElement("button",{"aria-label":t,className:"react-title-bar__close",onClick:r},i.createElement(c,{alt:h._("Back"),src:s.static_url("/static/images/file_viewer/arrow_left-vflSMJAmE.png"),srcHiRes:s.static_url("/static/images/file_viewer/arrow_left@2x-vflTImUmm.png"),width:32}),u?null:i.createElement(m,{customLogoUrl:n,file:o}));return _.is_mobile_or_tablet()?p:i.createElement(d,{className:"title-bar-back-tooltip",content:t,isTargetPositionFixed:!0,position:d.POSITIONS.RIGHT},p)},t})(i.Component);t.CloseButton=f}),define("modules/clean/react/title_bar/title_bar_logo",["require","exports","tslib","external/react","modules/clean/react/image","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.logLogoClick=function(){var e=t.props.customLogoUrl?s.UserActionNames.CLICK_CUSTOM_LOGO:s.UserActionNames.CLICK_DROPBOX_LOGO;return r.logUserAction(e,s.UserActionContextNames.TITLE_BAR_MAIN)},t}return n.__extends(t,e),t.prototype.render=function(){return o.createElement("a",{href:"//www.dropbox.com?src=shmodel",className:"title-bar-icon u-mar-horizontal-xxs",onClick:this.logLogoClick},this.props.customLogoUrl?o.createElement("img",{alt:l._("Logo"),className:"title-bar-icon__img",src:this.props.customLogoUrl}):o.createElement(i,{alt:"Dropbox",src:a.static_url("/static/images/header/header_logo_shmodel-vflsZ7QsE.png"),srcHiRes:a.static_url("/static/images/header/header_logo_shmodel@2x-vflvJX68X.png"),className:"title-bar-icon__img"}))},t})(o.Component);t.Logo=c}),define("modules/clean/react/title_bar/title_bar_title",["require","exports","external/react","modules/clean/react/title_bar/title_bar_logo","modules/clean/react/title_bar/title_bar_close_button"],function(e,t,n,o,i){"use strict";function r(e){var t=e.canClose,r=e.children,s=e.closeTitle,a=e.customLogoUrl,l=e.file,c=e.onClose,u=e.sizeClass;return n.createElement("div",{className:"react-title-bar__title-wrap"},t?n.createElement(i.CloseButton,{customLogoUrl:a,closeTitle:s,file:l,onClose:c,sizeClass:u}):n.createElement(o.Logo,{customLogoUrl:a}),r)}Object.defineProperty(t,"__esModule",{value:!0}),t.TitleBarTitle=r}),function(){define("modules/clean/revisions/file_revisions_iterator",["jquery","modules/clean/ajax","modules/clean/react/browse/models"],function(e,t,n){var o,i,r,s;return o=n.File,r=50,i=(function(){function e(e){this.file=e.file,this.action_description=e.action_description,this.is_primary_revision=e.is_primary_revision,this.author=e.author,this.device_name=e.device_name,this.when_mses=e.when_mses}return e})(),s=function(e){return new i({file:o.fromServerObject(e.preview_info),action_description:e.action_description,is_primary_revision:e.is_primary_revision,author:e.author,device_name:e.device_name,when_mses:e.ts})},(function(){function n(e,t,n){this.fqPath=e,this.userId=t,null==n&&(n={}),this.cursor=n.initialCursor||null,this.deserializer=n.deserializer||s}return n.prototype.next=function(n){var o,i;return null==n&&(n=r),i=new e.Deferred,o={path:this.fqPath,limit:n},this.cursor&&(o.cursor=this.cursor),t.WebRequest({url:"/file_revisions",type:"GET",subject_user:this.userId,data:o,success:(function(e){return function(t){var n,r;return o=JSON.parse(t),e.cursor=o.cursor,r=function(){var e,t,i,r;for(i=o.revisions,r=[],e=0,t=i.length;e<t;e++)n=i[e],r.push(this.deserializer(n));return r}.call(e),i.resolve({revisions:r,hasMore:o.more})}})(this),error:function(e){return i.reject({errorText:e.error_text})}}),i.promise()},n})()})}.call(this),define("modules/clean/sharing/action_types",["require","exports","modules/clean/flux/action_type"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShareModalActionTypes=n.withActionNamespace("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",CLEAR_SHARING_PREFS:"clear-sharing-prefs",FETCH_SHARING_PREFS_REQUEST:"sharing-prefs-request",FETCH_SHARING_PREFS_SUCCESS:"sharing-prefs-success",FETCH_SHARING_PREFS_FAILURE:"sharing-prefs-failure",SET_COMMENT_CHECKBOX_PREF_REQUEST:"set-comment-checkbox-pref-request",SET_COMMENT_CHECKBOX_PREF_SUCCESS:"set-comment-checkbox-pref-success",SET_COMMENT_CHECKBOX_PREF_FAILURE:"set-comment-checkbox-pref-failure",SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST:"set-comment-checkbox-pref-help-request",SET_COMMENT_CHECKBOX_HELP_PREF_SUCCESS:"set-comment-checkbox-pref-help-success",SET_COMMENT_CHECKBOX_HELP_PREF_FAILURE:"set-comment-checkbox-pref-help-failure",CLEAR_SHARING_PAYWALL_INFO:"clear-sharing-paywall-info",FETCH_SHARING_PAYWALL_INFO_REQUEST:"fetch-sharing-paywall-info-request",FETCH_SHARING_PAYWALL_INFO_SUCCESS:"fetch-sharing-paywall-info-success",PAYWALL_GRANDFATHER_MODAL_DISMISS:"paywall-grandfather-modal-dismiss",PAYWALL_GRANDFATHER_MODAL_LEARN_MORE:"paywall-grandfather-modal-learn-more",CLEAR_UNSHARE_FROM_PAYWALL:"clear-unshare-from-paywall",UNSHARE_FROM_PAYWALL:"unshare-from-paywall",FETCH_UPSELL_EXPERIMENT_VARIANT:"fetch-upsell-experiment-variant",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",FETCH_USER_ACCOUNTS_CONTINUED_REQUEST:"fetch-user-accounts-continued-request",FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:"fetch-user-accounts-continued-success",CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:"clear-file-membership-last-seen-info",FETCH_FILE_MEMBER_COUNT_REQUEST:"fetch-file-member-count-request",FETCH_FILE_MEMBER_COUNT_SUCCESS:"fetch-file-member-count-success",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",DISPLAY_CONTENT_NAME_INFO:"display-content-name-info",SEND_SHARE_REQUEST:"send-share-request",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",MEMBER_ACTION_PENDING:"member-action-pending",MEMBER_ACTION_COMPLETE:"member-action-complete",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_KEEP_ACCESS:"remove-member-keep-access",TRANSFER_OWNER_SUCCESS:"transfer-owner-success",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_MEMBER_COUNTS_REQUEST:"fetch-member-counts-request",FETCH_MEMBER_COUNTS_SUCCESS:"fetch-member-counts-success",HANDLE_CONTENT_NAME_CHANGE:"handle-content-name-change",HANDLE_CONTENT_NAME_FOCUS_CHANGE:"handle-content-name-focus-change",UPDATE_BANNER:"update-banner",VALIDATE_CONTENT_NAME_SUCCESS:"validate-content-name-success",VALIDATE_CONTENT_NAME_ERROR:"validate-content-name-error",CHANGE_LINK_AUDIENCE_REQUEST:"change-link-audience-request",CHANGE_LINK_AUDIENCE_SUCCESS:"change-link-audience-success",CHANGE_LINK_AUDIENCE_FAILURE:"change-link-audience-failure",UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:"unblock-member-list-on-pass-load",UPDATE_SHARING_SETTINGS_SUCCESS:"update-sharing-settings-success"}),t.SharingActionTypes=n.withActionNamespace("sharing-actions",{CLEAR_EVERYTHING:"clear-everything",FETCH_METADATA_BATCH_ATTEMPT:"fetch-metadata-batch-attempt",FETCH_METADATA_BATCH_SUCCESS:"fetch-metadata-batch-success",FETCH_METADATA_BATCH_FAIL:"fetch-metadata-batch-fail"})}),define("modules/clean/sharing/actions/sharing_actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/browse/store","modules/clean/sharing/action_types","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/share_page/action_types","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/stores/sharing_info_util","modules/core/exception"],function(e,t,n,o,i,r,s,a,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=o.browseStore;t.SharingActions={loadFileMetadataBatch:function(e,t){return new r.FileShareApiClient({userId:e.id}).getMetadataBatchAlpha({contentIds:t,actions:Object.keys(s.ALPHA_FILE_METADATA_PERMISSIONS)}).then(function(t){return n.dispatch({type:i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:e,data:t})})},loadFolderLinkMetadataBatch:function(e,t){var o=p.context().isNonUserRelativeContext;return Promise.resolve({}).then(function(){return t.forEach(function(t){return n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,user:e,contentIds:[t]})})}),new r.FolderShareApiClient({userId:e.id,isNonUserRelativeContext:o}).validateFolderPathBatch({paths:t}).then(function(t){t.forEach(function(t){var o=t.metadata,r=t.path;o&&o.link_metadata?n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,data:{linkMetadata:o.link_metadata},user:e,contentIds:c.getContentIdsForMetadata(o).concat([r])}):n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE,user:e,contentIds:[r]})})})},loadFileMetadata:function(e){var t=e.user,o=e.contentId,c=e.sourceUrl,u=e.client,p=l.sharingInfoStore.getSharingInfo(t.id,o);if(p&&p.fetchingMetadataPromise())return p.fetchingMetadataPromise();u=u||new r.FileShareApiClient({userId:t.id});var d=u.getMetadataAlpha({contentId:o,actions:Object.keys(s.ALPHA_FILE_METADATA_PERMISSIONS),sourceURL:c}).then(function(e){n.dispatch({type:i.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:t,data:[e]}),n.dispatch({type:a.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:t})});return n.dispatch({type:i.ShareModalActionTypes.FETCH_METADATA_REQUEST,contentIds:[o],data:{promise:d},user:t}),d},listMembers:function(e){var t=e.user,o=e.contentId,s=e.isFolder,a=e.limit,c=e.url,d=e.members,h=e.client;u.assert(!a||a<=100,"listMembers not implemented for limit > 100");var _=a||9999999,m=l.sharingInfoStore.getSharingInfo(t.id,o);if(m){var f=m.fetchingMembersRequest();if(f&&_<=f.limitNonNull)return f.promise;if(m.hasDisplayableMembers()&&_<m.members().getMemberCount())return Promise.resolve({})}var v=Math.random().toString(),g=!s,y=p.context().isNonUserRelativeContext;h||(h=s?new r.FolderShareApiClient({userId:t.id,isNonUserRelativeContext:y}):new r.FileShareApiClient({userId:t.id,isNonUserRelativeContext:y}));var E,S=function(e){return e?(n.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_REQUEST,contentIds:[o],user:t}),h.listMembersContinue({cursor:e,url:c,isAlpha:g}).then(function(e){n.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS,contentIds:[o],data:{members:e,requestId:v},user:t}),S(e.cursor)})):Promise.resolve({})};return E=d?Promise.resolve(d):h.listMembers({contentId:o,url:c,limit:a,isAlpha:g}),E=E.then(function(e){n.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS,contentIds:[o],data:{members:e,requestId:v},user:t}),a||S(e.cursor)}),n.dispatch({type:i.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST,contentIds:[o],data:{limitNonNull:_,requestId:v,promise:E},user:t}),E},fetchFileMemberCount:function(e){var t=e.user,o=e.contentId,s=e.limit,a=e.url,l=e.client,c=e.countGroupsAsMembers,u=void 0!==c&&c;l=l||new r.FileShareApiClient({userId:t.id});var p=l.getMemberCounts({contentId:o,limit:s,url:a,countGroupsAsMembers:u});return n.dispatch({type:i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_REQUEST,contentIds:[o],user:t}),p.then(function(e){n.dispatch({type:i.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS,contentIds:[o],data:e,user:t})})},fetchLinkMetadata:function(e){var t=e.user,o=e.contentId,a=e.client;s.TRUELINK.TRUELINK_UI[t.id]||(a=a||new r.ShareApiClient({userId:t.id}),n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST,contentIds:[o],data:{},user:t}),a.sharedLinkInfo({fileIdOrPath:o}).then(function(e){n.dispatch({type:i.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,contentIds:[o],data:{linkMetadata:e},user:t})}))}}}),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/api/client",["external/immutable","external/underscore","modules/clean/api_v2/root_aware_client","modules/clean/api_v2/error","modules/clean/contacts/types","modules/clean/sharing/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/core/exception","modules/core/user_i18n","modules/clean/viewer"],function(t,o,i,r,s,a,l,c,u,p,d){var h,_,m,f,v,g,y,E,S,b,w,C,T,A,I,P,assert,R,O,N,L,M,k,F,x,D,U,B,H,V,W,q,z,j;return A=i.UserActionsRootAwareClient,_=r.AppError,R=r.catchApiError,h=a.ACCESS_LEVEL,y=a.MEMBER_ACTION,a.TRUELINK,m=l.FilePolicy,v=l.FolderPolicy,E=l.MemberPermission,C=l.SharingMembership,T=l.TeamSharingPolicies,I=c.accessLevelConstToApi,P=c.accountInfoApiToRecord,O=c.combinedPolicyDiffToApi,N=c.fileMetadataApiToRecord,L=c.folderMetadataApiToRecord,M=c.fullAccountApiToRecord,k=c.hasFolderMetadataRecordInMetadata,F=c.linkMetadataApiToRecord,x=c.listFilesResultApiToRecord,D=c.listFoldersResultApiToRecord,U=c.makeMemberSelector,B=c.memberAccessLevelApiToRecord,H=c.memberCountsApiToRecord,V=c.membershipApiToRecord,W=c.parseFolderPolicy,z=c.sharedContentLinkMetadataToRecord,j=c.sharingPrefsApiToRecord,assert=u.assert,w=(function(t){function n(e){this.message=e,this.name="ShareError",this.stack=(new Error).stack}return e(n,t),n})(Error),b=(function(){function e(e){var t,n,o;this.userId=e.userId,this.client=null!=(n=e.client)?n:null,t=null!=(o=e.isNonUserRelativeContext)&&o,null==this.client&&(this.client=new A),t&&null==this.teamMemberId&&(this.teamMemberId=d.get_viewer().work_user.team_member_id)}return e.prototype._getHeaders=function(e){return null==e&&(e=null),null!=this.teamMemberId&&(null===e&&(e={}),e["Dropbox-API-Select-Admin"]=this.teamMemberId),e},e.prototype._rpc=function(e,t,n,o,i){return null==n&&(n=null),null==o&&(o=!1),null==i&&(i=null),i=this._getHeaders(i),this.client.rpc(e,t,n,o,i)},e.prototype.addMembers=function(e){var t,n;throw e.contentId,e.members,e.accessLevel,null!=(t=e.customMessage)?t:null,null!=(n=e.quiet)&&n,new TypeError("Not implemented")},e.prototype.removeMember=function(e){throw e.contentId,e.memberId,new TypeError("Not implemented")},e.prototype.getMetadata=function(e){var t;throw e.contentId,null!=(t=e.actions)?t:[],new TypeError("Not implemented")},e.prototype.getMetadataInternal=function(e){var t;throw e.contentId,null!=(t=e.actions)?t:[],new TypeError("Not implemented")},e.prototype.getMetadataAlpha=function(e){var t;throw e.contentId,null!=(t=e.actions)?t:[],new TypeError("Not implemented")},e.prototype.listMembers=function(e){throw e.contentId,e.isAlpha,new TypeError("Not implemented")},e.prototype.listMembersContinue=function(e){throw e.cursor,e.isAlpha,new TypeError("Not implemented")},e.prototype.getMemberCounts=function(e){throw e.contentId,new TypeError("Not implemented")},e.prototype.getParentFolderAccess=function(e){throw e.contentId,e.memberId,e.accessLevel,new TypeError("Not implemented")},e.prototype.updateMember=function(e){throw e.contentId,e.memberId,e.accessLevel,new TypeError("Not implemented")},e.prototype.dismissInviteNotification=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/dismiss_invite_notification",{content_id:t})},e.prototype.getSharingPrefs=function(){return this._rpc(this.userId,"users/get_sharing_prefs",null,!1).then(j)},e.prototype.setSharingPrefs=function(e){return this._rpc(this.userId,"users/set_sharing_prefs",e)},e.prototype.getSharingPaywallInfo=function(){return this._rpc(this.userId,"users/get_sharing_paywall_info")},e.prototype.claimMembership=function(e){var t;return t=e.contentUrl,this._rpc(this.userId,"sharing/claim_membership",{content_url:t})},e.prototype.checkJobStatus=function(e){var t;return t=e.jobId,this._rpc(this.userId,"sharing/check_job_status",{async_job_id:t})},e.prototype.getAccountBatch=function(e){var t;return t=e.accountIds,t.length>0?this._rpc(this.userId,"users/get_account_batch",{account_ids:t}).then(function(e){return e.map(P)}):Promise.resolve([])},e.prototype._getAccountBatchCache={},e.prototype.getAccountBatchCached=function(e){var t,n,i,r,s,a;return t=e.accountIds,r=this._getAccountBatchCache,s=o.partition(t,function(e){return e in r}),i=s[0],a=s[1],n=o.values(o.pick(r,i)),this.getAccountBatch({accountIds:a}).then(function(e){var t;return t=o.object(e.map(function(e){return[e.account_id,e]})),o.extendOwn(r,t),e.concat(n)})},e.prototype.resetGetAccountBatchCache=function(){return this._getAccountBatchCache={}},e.prototype.getCurrentAccount=function(e){return this._rpc(this.userId,"users/get_current_account").then(function(e){return M(e)})},e.prototype._getCurrentAccountCache=null,e.prototype.getCurrentAccountCached=function(e){return null==this._getCurrentAccountCache&&(this._getCurrentAccountCache=this.getCurrentAccount()),this._getCurrentAccountCache},e.prototype.resetGetCurrentAccountCache=function(){return this._getCurrentAccountCache={}},e.prototype.requestAccess=function(e){var t,n;return t=e.contentUrl,n=e.customMessage,this._rpc(this.userId,"sharing/request_access",{content_url:t,custom_message:n})},e.prototype.sharedLinkInfo=function(e){var t,n;return t=e.fileIdOrPath,assert(null!=t,"an fqPath or fileId must be present to retrieve shared link info"),n=this._rpc(this.userId,"sharing/alpha/list_shared_links",{path:t,direct_only:!0}),n.then(function(e){return 0===e.links.length?null:F(e.links[0])})},e.prototype.createSharedLink=function(e){var t;return t=e.fileIdOrPath,this._rpc(this.userId,"sharing/alpha/create_shared_link_with_settings",{path:t}).then(F)},e.prototype.modifySharedLinkSettings=function(e){var t,n,o;return o=e.url,n=e.settings,t=e.remove_expiration,this._rpc(this.userId,"sharing/alpha/modify_shared_link_settings",{url:o,settings:n,remove_expiration:t}).then(F)},e.prototype.revokeSharedLink=function(e){var t;return t=e.url,this._rpc(this.userId,"sharing/revoke_shared_link",{url:t})},e.prototype.getLinkMetadata=function(e){var t;return t=e.url,this._rpc(this.userId,"sharing/alpha/get_link_metadata",{url:t}).then(z)},e.prototype.setLinkSettings=function(e){var t,n;return t=e.linkSettings,n=e.url,this._rpc(this.userId,"sharing/alpha/set_link_settings",{link_settings:t,url:n}).then(z)},e.prototype._addAccountsToMembership=function(e){return this._addAccountsToMembershipBatch(t.Map([[1,e]])).then(function(e){return e.get(1)})},e.prototype._addAccountsToMembershipBatch=function(e){var n;return n=e.valueSeq().flatMap(function(e){return e.users.valueSeq()}).map(function(e){return e.memberId()}).toSet().toArray(),n.length>0?this.getAccountBatchCached({accountIds:n}).then(function(n){var o;return o=t.Map(n.map(function(e){return[e.account_id,e]})),e.map(function(e,t){return e.set("users",e.users.map((function(e){return function(e){var t;return t=o.get(e.account_id),null!=t?e.set("account",t):e}})(this)))})}):Promise.resolve(e)},e})(),S=(function(t){function o(){this.validateFqPath=n(this.validateFqPath,this),this.getMetadataAlpha=n(this.getMetadataAlpha,this),this.getMetadataInternal=n(this.getMetadataInternal,this),this.getMetadata=n(this.getMetadata,this),o.__super__.constructor.apply(this,arguments),this._promises={}}return e(o,t),o.prototype.addMembers=function(e){var t,n;return e.contentId,e.members,e.accessLevel,null!=(t=e.customMessage)?t:null,null!=(n=e.quiet)&&n,this.createPromise("addMembers")},o.prototype.getMetadata=function(e){var t;return e.contentId,null!=(t=e.actions)?t:[],this.createPromise("getMetadata")},o.prototype.getMetadataInternal=function(e){var t;return e.contentId,null!=(t=e.actions)?t:[],this.createPromise("getMetadataInternal")},o.prototype.getMetadataAlpha=function(e){var t;return e.contentId,null!=(t=e.actions)?t:[],this.createPromise("getMetadataAlpha")},o.prototype.dismissInviteNotification=function(e){var t;return e.contentId,null!=(t=e.cursor)?t:null,this.createPromise("dismissInviteNotification")},o.prototype.getSharingPrefs=function(){return this.createPromise("getSharingPrefs")},o.prototype.getSharingPaywallInfo=function(){return this.createPromise("getSharingPaywallInfo")},o.prototype.getOwnedSharedFolders=function(){return this.createPromise("getOwnedSharedFolders")},o.prototype.listMembers=function(e){return e.contentId,e.isAlpha,this.createPromise("listMembers")},o.prototype.listMembersContinue=function(e){return e.cursor,e.isAlpha,this.createPromise("listMembersContinue")},o.prototype.getMemberCounts=function(e){return e.contentId,this.createPromise("getMemberCounts")},o.prototype.getParentFolderAccess=function(e){return e.contentId,e.memberId,e.accessLevel,this.createPromise("getParentFolderAccess")},o.prototype.removeMember=function(e){return e.contentId,e.memberId,this.createPromise("removeMember")},o.prototype.setLinkSettings=function(e){return e.linkSettings,e.url,this.createPromise("setLinkSettings")},o.prototype.share=function(e){var t,n,o,i;return e.fqPath,null!=(t=e.memberPolicy)?t:null,null!=(n=e.aclUpdatePolicy)?n:null,null!=(o=e.sharedLinkPolicy)?o:null,null!=(i=e.forceAsync)&&i,this.createPromise("share")},o.prototype.shareInternal=function(e){var t,n,o;return e.fqPath,null!=(t=e.folderPolicy)?t:null,null!=(n=e.forceAsync)&&n,null!=(o=e.confidential)&&o,this.createPromise("shareInternal")},o.prototype.requestAccess=function(e){return e.contentUrl,e.customMessage,this.createPromise("requestAccess")},o.prototype.sharedLinkInfo=function(e){return e.fileIdOrPath,this.createPromise("sharedLinkInfo")},o.prototype.transferContent=function(e){return e.contentId,e.memberId,this.createPromise("transferContent")},o.prototype.createSharedLink=function(e){return e.fileIdOrPath,this.createPromise("createSharedLink")},o.prototype.updateMember=function(){return this.createPromise("updateMember")},o.prototype.updatePolicyAlpha=function(){return this.createPromise("updatePolicyAlpha")},o.prototype.validateFqPath=function(e){var t;return e.fqPath,null!=(t=e.actions)?t:[],this.createPromise("validateFqPath")},o.prototype.getCurrentAccountCached=function(e){return this.createPromise("getCurrentAccountCached")},o.prototype.modifySharedLinkSettings=function(e){return e.url,e.settings,e.remove_expiration,this.createPromise("modifySharedLinkSettings")},o.prototype.revokeSharedLink=function(e){return e.url,this.createPromise("revokeSharedLink")},o.prototype.relinquishMembership=function(e){var t;return e.contentId,null!=(t=e.leaveACopy)&&t,this.createPromise("relinquishMembership")},o.prototype.setConfidentiality=function(e){return e.contentId,e.confidential,this.createPromise("setConfidentiality")},o.prototype.createPromise=function(e){var t;return t=this._promises[e],t&&t.calledBeforeCreatePromise?(this._promises[e]=null,t.promise):(t={},t.promise=new Promise(function(e,n){return t.resolve=e,t.reject=n}),this._promises[e]=t,t.promise)},o.prototype.getPromise=function(e){var t;return null!=(t=this._promises[e])?t.promise:void 0},o.prototype.resolvePromise=function(e,t,n){var o;return null==n&&(n=!1),this._promises[e]||this.createPromise(e),o=this._promises[e],o.calledBeforeCreatePromise=n,o.resolve.apply(null,t),o.promise},o.prototype.rejectPromise=function(e,t){var n;return this._promises[e]||this.createPromise(e),n=this._promises[e],n.reject.apply(null,t),n.promise},o})(b),f=(function(o){function i(){return this.getMetadataBatchAlpha=n(this.getMetadataBatchAlpha,this),this.getMetadataAlpha=n(this.getMetadataAlpha,this),this.getMetadata=n(this.getMetadata,this),i.__super__.constructor.apply(this,arguments)}return e(i,o),i.prototype.addMembers=function(e){var t,n,o,i,r,s,a,l,c,u,p;return i=e.contentId,s=e.members,r=null!=(l=e.customMessage)?l:null,a=null!=(c=e.quiet)&&c,t=null!=(u=e.accessLevel)?u:h.READER,n=null!=(p=e.addMessageAsComment)&&p,o=I(t),0===(null!=r?r.length:void 0)&&(r=null),this._rpc(this.userId,"sharing/add_file_member",{file:i,members:s,custom_message:r,quiet:a,access_level:o,add_message_as_comment:n})},i.prototype.removeMember=function(e){var t,n;return t=e.contentId,n=e.memberId,this._rpc(this.userId,"sharing/remove_file_member_2",{file:t,member:U(n)},!1).then((function(e){return function(t){return B(e.userId,t)}})(this))},i.prototype.getMetadata=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this._rpc(this.userId,"sharing/get_file_metadata",{file:n,actions:t},!1).then(N)},i.prototype.getMetadataAlpha=function(e){var t,n,o,i;return n=e.contentId,t=null!=(o=e.actions)?o:[],i=e.sourceURL,this._rpc(this.userId,"sharing/alpha/get_file_metadata",{file:n,actions:t,url:i},!1).then(N)},i.prototype.getMetadataBatchAlpha=function(e){var t,n,o;return n=e.contentIds,t=null!=(o=e.actions)?o:[],this._rpc(this.userId,"sharing/alpha/get_file_metadata/batch",{files:n,actions:t},!1).then(function(e){return e.map(function(e){return N(e.result)})})},i.prototype.listMembers=function(e){var t,n,o,i,r,s,a;return t=e.contentId,a=null!=(i=e.url)?i:null,o=null!=(r=e.limit)?r:100,n=null!=(s=e.isAlpha)&&s,this._rpc(this.userId,n?"sharing/alpha/list_file_members":"sharing/list_file_members",{file:t,actions:y.ALL,include_inherited:!0,limit:o,url:n?a:void 0},!1).then(V).then(this._addAccountsToMembership.bind(this))},i.prototype.listMembersContinue=function(e){var t,n,o,i,r;return t=e.cursor,r=null!=(o=e.url)?o:null,n=null!=(i=e.isAlpha)&&i,this._rpc(this.userId,n?"sharing/alpha/list_file_members/continue":"sharing/list_file_members/continue",{cursor:t,url:n?r:void 0}).then(function(e){return V(e,null)}).then(this._addAccountsToMembership.bind(this))},i.prototype.listMembersBatch=function(e){var n,o,i;return n=e.contentIds,o=null!=(i=e.limit)?i:10,this._rpc(this.userId,"sharing/list_file_members/batch",{files:n,limit:o}).then(function(e){var n,o,i,r;for(r={},o=0,i=e.length;o<i;o++)n=e[o],"result"===n.result[".tag"]&&(r[n.file]=V(n.result.members,n.result.member_count));return t.Map(r)}).then(this._addAccountsToMembershipBatch.bind(this))},i.prototype.getMemberCounts=function(e){var t,n,o,i,r,s;return t=e.contentId,o=e.limit,n=null!=(i=e.countGroupsAsMembers)&&i,s=null!=(r=e.url)?r:null,this._rpc(this.userId,"sharing/get_file_member_counts",{file:t,limit:o,count_groups_as_members:n,url:s})},i.prototype.getParentFolderAccess=function(e){throw e.contentId,e.memberId,e.accessLevel,new w("Parent folder access points not implemented for files")},i.prototype.relinquishMembership=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/relinquish_file_membership",{file:String(t)})},i.prototype.listReceivedFiles=function(e){var t,n,o,i;return n=null!=(o=e.limit)?o:100,t=null!=(i=e.actions)?i:[],this._rpc(this.userId,"sharing/list_received_files",{limit:n,actions:t}).then(x)},i.prototype.listReceivedFilesContinue=function(e){var t;return t=e.cursor,this._rpc(this.userId,"sharing/list_received_files/continue",{cursor:t}).then(x)},i.prototype.updateMember=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this._rpc(this.userId,"sharing/update_file_member",{file:String(n),member:U(o),access_level:I(t)}).then((function(e){return function(t){return B(e.userId,t)}})(this))},i.prototype.updatePolicy=function(e){var t,n,o,i;return o=e.contentId,i=e.newPolicy,t=e.actions,n=O(i),n.actions=t,n.file=o,this._rpc(this.userId,"sharing/alpha/update_file_policy",n).then(function(e){return null!=e.metadata&&(e=e.metadata),N(e)})},i.prototype.unshare=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/unshare_file",{file:String(t)})},i})(b),g=(function(t){function o(){
return this.updatePolicyAlpha=n(this.updatePolicyAlpha,this),this.updatePolicy=n(this.updatePolicy,this),this.validateFqPath=n(this.validateFqPath,this),this.getMetadata=n(this.getMetadata,this),o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.share=function(e){var t,n,o,i,r;return i=e.fqPath,o=e.folderPolicy,n=null!=(r=e.confidential)&&r,t=O(o),t.path=i,t.confidentiality=n?"confidential":"not_confidential",this._rpc(this.userId,"sharing/alpha/share_folder",t,!1).then((function(e){return function(t){return("complete"===t[".tag"]?Promise.resolve(t):q(e.checkShareJobStatus.bind(e,{jobId:t.async_job_id}))).then(L)}})(this))},o.prototype.checkShareJobStatus=function(e){var t;return t=e.jobId,this._rpc(this.userId,"sharing/check_share_internal_job_status",{async_job_id:t})},o.prototype.checkRemoveMemberJobStatus=function(e){var t;return t=e.jobId,this._rpc(this.userId,"sharing/check_remove_member_job_status",{async_job_id:t})},o.prototype.addMembers=function(e){var t,n,o,i,r,s,a,l,c,u;return i=e.contentId,a=e.members,t=e.accessLevel,r=null!=(c=e.customMessage)?c:null,l=null!=(u=e.quiet)&&u,o=I(t),0===(null!=r?r.length:void 0)&&(r=null),n={shared_folder_id:String(i),members:(function(){var e,t,n;for(n=[],e=0,t=a.length;e<t;e++)s=a[e],n.push({member:s,access_level:o});return n})(),custom_message:r,quiet:l},this._rpc(this.userId,"sharing/add_folder_member",n,!1)},o.prototype.fetchNsId=function(e){return this._rpc(this.userId,"files/get_metadata",{path:e}).then(function(e){var t;return null!=(t=e.sharing_info)?t.shared_folder_id:void 0})},o.prototype.getMetadata=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this._rpc(this.userId,"sharing/alpha/get_folder_metadata",{shared_folder_id:String(n),actions:t},!1).then(L)},o.prototype._metadataAndInheritMembers=function(e){var t;return t=e.members_cursor,t?this.listMembersContinue({cursor:t}).then(function(t){return{metadata:e,inheritedMembers:t}}):{metadata:e,inheritedMembers:new C}},o.prototype.validateFqPath=function(e){var t,n,o,i,r,s,a,l,c,u;return n=e.fqPath,t=null!=(i=e.actions)?i:[],o=null!=(r=e.listMembersArg)?r:{},u=null!=(s=e.shouldParseMetadataFromError)&&s,c=null!=(a=e.shareAsConfidential)&&a,l=this._rpc(this.userId,"sharing/validate_folder_path",{path:n,actions:t,list_members_arg:o,confidentiality:c?"confidential":"not_confidential"},!1),this.validatePathContinue(l,u)},o.prototype.validatePathContinue=function(e,t){return e.catch(R(function(e){var n,o;if("already_shared"===(null!=(n=e.error)&&null!=(o=n.bad_path)?o[".tag"]:void 0))return e.error.bad_path;if(t&&e instanceof _&&e.error&&"no_permission"===e.error[".tag"]&&k(e.error))return e.error;throw e})).then(L).then(this._metadataAndInheritMembers.bind(this))},o.prototype.validateFolderPathBatch=function(e){var t;return t=e.paths,this._rpc(this.userId,"sharing/validate_folder_path/batch",{paths:t}).then(function(e){return e.entries.map(function(e){var t,n,o,i,r,s;return s=e.result,t=null,"metadata"===s[".tag"]?t=s:"no_permission"===(null!=(o=s.path_error)?o[".tag"]:void 0)?t=s.path_error:"already_shared"===(null!=(i=s.path_error)&&null!=(r=i.bad_path)?r[".tag"]:void 0)&&(t=s.path_error.bad_path),n=null,t&&t.link_metadata&&(n=L(t)),{path:e.path,metadata:n}})})},o.prototype.updatePolicy=function(e){var t,n,o;return n=e.contentId,o=e.newPolicy,t=o,t.shared_folder_id=String(n),this._rpc(this.userId,"sharing/update_folder_policy",t,!1).then(L)},o.prototype.updatePolicyAlpha=function(e){var t,n,o;return n=e.contentId,o=e.newPolicy,t=O(o),t.shared_folder_id=String(n),this._rpc(this.userId,"sharing/alpha/update_folder_policy",t,!1).then(L)},o.prototype.unshare=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.leaveACopy)&&o,this._rpc(this.userId,"sharing/unshare_folder",{shared_folder_id:String(t),leave_a_copy:n}).then((function(e){return function(t){return"complete"===t[".tag"]?Promise.resolve(t):q(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}})(this))},o.prototype.getOwnedSharedFolders=function(){return this._rpc(this.userId,"users/list_owned_shared_folders").then(function(e){return Promise.resolve(e)})},o.prototype.unshareFolderBatch=function(e){var t,n,o;return n=e.nsIds,t=null!=(o=e.leaveACopy)&&o,this._rpc(this.userId,"sharing/unshare_folder/batch",{shared_folder_ids:n,leave_a_copy:t}).then(function(e){return"async_job_id"===e[".tag"]?Promise.resolve(e):Promise.reject(e)})},o.prototype.listMembers=function(e){var t,n,o,i;return t=e.contentId,n=null!=(o=e.limit)?o:100,null!=(i=e.isAlpha)&&i,this._rpc(this.userId,"sharing/list_folder_members",{shared_folder_id:String(t),actions:y.ALL,limit:n},!1).then(V).then(this._addAccountsToMembership.bind(this))},o.prototype.listMembersContinue=function(e){var t,n;return t=e.cursor,null!=(n=e.isAlpha)&&n,this._rpc(this.userId,"sharing/list_folder_members/continue",{cursor:t},!1).then(function(e){return V(e,null)}).then(this._addAccountsToMembership.bind(this))},o.prototype.listMountableFolders=function(e){var t,n,o,i,r;return o=null!=e?e:{},n=null!=(i=o.limit)?i:100,t=null!=(r=o.actions)?r:[],this._rpc(this.userId,"sharing/list_mountable_folders",{limit:n,actions:t}).then(D)},o.prototype.listMountableFoldersContinue=function(e){var t;return t=e.cursor,this._rpc(this.userId,"sharing/list_mountable_folders/continue",{cursor:t}).then(D)},o.prototype.listMountableFoldersAlpha=function(e){var t,n,o,i,r;return o=null!=e?e:{},n=null!=(i=o.limit)?i:100,t=null!=(r=o.actions)?r:[],this._rpc(this.userId,"sharing/alpha/list_mountable_folders",{limit:n,actions:t}).then(D)},o.prototype.listMountableFoldersContinueAlpha=function(e){var t;return t=e.cursor,this._rpc(this.userId,"sharing/alpha/list_mountable_folders/continue",{cursor:t}).then(D)},o.prototype.getMemberCounts=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/get_folder_member_counts",{shared_folder_id:String(t)},!1).then(H)},o.prototype.getParentFolderAccess=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this._rpc(this.userId,"sharing/get_parent_folder_access",{shared_folder_id:String(n),member:U(o),access_level:null!=t?I(t):void 0},!1).then(B.bind(null,this.userId))},o.prototype.relinquishMembership=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.leaveACopy)&&o,this._rpc(this.userId,"sharing/relinquish_folder_membership",{shared_folder_id:String(t),leave_a_copy:n}).then((function(e){return function(t){return"complete"===t[".tag"]?Promise.resolve():q(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}})(this))},o.prototype.removeMember=function(e){var t,n,o,i;return t=e.contentId,o=e.memberId,n=null!=(i=e.leaveACopy)&&i,this._rpc(this.userId,"sharing/remove_folder_member",{shared_folder_id:String(t),member:U(o),leave_a_copy:n},!1).then((function(e){return function(t){return"complete"===t[".tag"]?Promise.resolve():q(e.checkRemoveMemberJobStatus.bind(e,{jobId:t.async_job_id}))}})(this)).then((function(e){return function(t){return B(e.userId,t)}})(this))},o.prototype.transferContent=function(e){var t,n;return t=e.contentId,n=e.memberId,this._rpc(this.userId,"sharing/transfer_folder",{shared_folder_id:String(t),to_dropbox_id:n})},o.prototype.updateMember=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this._rpc(this.userId,"sharing/update_folder_member",{shared_folder_id:String(n),member:U(o),access_level:I(t)},!1).then((function(e){return function(t){return B(e.userId,t)}})(this))},o.prototype.mount=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/mount_folder",{shared_folder_id:String(t)}).then(L)},o.prototype.unmount=function(e){var t;return t=e.contentId,this._rpc(this.userId,"sharing/unmount_folder",{shared_folder_id:String(t)})},o.prototype.setConfidentiality=function(e){var t,n;return n=e.contentId,t=e.confidential,this._rpc(this.userId,"sharing/set_confidentiality",{shared_folder_id:String(n),confidentiality:t?"confidential":"not_confidential"}).then((function(e){return function(t){return"complete"===t[".tag"]?Promise.resolve(t):q(e.checkShareJobStatus.bind(e,{jobId:t.async_job_id}))}})(this)).then(L)},o})(b),q=function(e,t){var n,o,i,r,s,a,l;return r=null!=t?t:{},i=null!=(s=r.interval)?s:1e3,l=null!=(a=r.timeout)?a:null,o=null!=l?Date.now()+l:null,n=function(t,r){return null!=o&&Date.now()>o?r():e().then(function(e){switch(e[".tag"]){case"failed":return r(e);case"complete":return t(e);case"in_progress":return window.setTimeout(n,i,t,r)}}).catch(R(function(e){return r(e)}))},new Promise(n)},{FilePolicy:m,FileShareApiClient:f,FolderPolicy:v,FolderShareApiClient:g,MemberPermission:E,MockShareApiClient:S,parseFolderPolicy:W,ShareError:w,ShareApiClient:b,TeamSharingPolicies:T}})}.call(this),define("modules/clean/sharing/api/types/metadata",["require","exports","tslib","external/immutable","modules/clean/api_v2/types"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemberPolicy={team:new i.UnionScalar("team"),anyone:new i.UnionScalar("anyone")},t.AclUpdatePolicy={owner:new i.UnionScalar("owner"),editors:new i.UnionScalar("editors")},t.SharedLinkPolicy={anyone:new i.UnionScalar("anyone"),members:new i.UnionScalar("members")},t.SharedFolderMemberMemberPolicy={team:new i.UnionScalar("team"),anyone:new i.UnionScalar("anyone")},t.SharedFolderJoinPolicy={from_team_only:new i.UnionScalar("from_team_only"),from_anyone:new i.UnionScalar("from_anyone")},t.SharedLinkCreatePolicy={default_public:new i.UnionScalar("default_public"),default_team_only:new i.UnionScalar("default_team_only"),team_only:new i.UnionScalar("team_only")},t.RequestedVisibilityPolicy={policy_name:"requested_visibility",password:"password",public:"public",team_only:"team_only"},t.ResolvedVisibilityPolicy={policy_name:"resolved_visibility",only_you:"only_you",password:"password",public:"public",shared_folder_only:"shared_folder_only",team_and_password:"team_and_password",team_only:"team_only"},t.VisibilityDisallowedReason={delete_and_recreate:"delete_and_recreate",restricted_by_shared_folder:"restricted_by_shared_folder",restricted_by_team:"restricted_by_team",user_account_type:"user_account_type",user_not_on_team:"user_not_on_team",permission_denied:"permission_denied"},t.LinkExpiryPolicy={policy_name:"expires"},t.ViewerInfoPolicy={policy_name:"viewer_info_policy",enabled:"enabled",disabled:"disabled"},t.DownloadPolicy={policy_name:"download_policy",allow:"allow",disallow:"disallow"},t.LinkAudience={public:"public",team:"team",members:"members",default_on:"default_on"},t.GroupManagementType={user_managed:new i.UnionScalar("user_managed"),company_managed:new i.UnionScalar("company_managed"),system_managed:new i.UnionScalar("system_managed")};var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({id:null,name:null},"Team"));t.Team=r;var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({display_name:null,member_id:null,team_info:null},"TeamMemberInfo"));t.TeamMemberInfo=s;var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({id:null,name:null,sharing_policies:null},"FullTeam"));t.FullTeam=a;var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({shared_folder_member_policy:null,shared_folder_join_policy:null,shared_link_create_policy:null},"TeamSharingPolicies"));t.TeamSharingPolicies=l;var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,is_teammate:!1,profile_photo_url:null,surname:null,team_member_id:null},"BasicAccount"));t.BasicAccount=c;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,profile_photo_url:null,surname:null,team:null,team_member_id:null},"FullAccount"));t.FullAccount=u;var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({allow:!1,reason:null},"PermissionSetting"));t.PermissionSetting=p;var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.contentId=function(){return this.shared_folder_id||this.path_lower},t.prototype.isSharedFolder=function(){return Boolean(this.shared_folder_id)},t.prototype.isNewSharedFolder=function(){return!this.shared_folder_id},t})(o.Record({access_type:null,is_confidential:!1,is_inside_team_folder:!1,is_team_folder:!1,link_metadata:null,members_cursor:null,name:null,owner_team:null,parent_shared_folder_id:null,path_lower:null,permissions:null,policy:null,preview_url:null,shared_folder_id:null,time_invited:null},"SharedFolderMetadata"));t.SharedFolderMetadata=d;var h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({acl_update_policy:null,download_policy:null,member_policy:null,viewer_info_policy:null,resolved_member_policy:null,shared_link_policy:null},"FolderPolicy"));t.FolderPolicy=h;var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({acl_update_policy:null,download_policy:null,member_policy:null,viewer_info_policy:null,shared_link_policy:null,audience:null,access_level:null,expiry:null,password:null},"CombinedPolicy"));t.CombinedPolicy=_;var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({change_options:null,disable_viewer_info:null,edit_contents:null,enable_viewer_info:null,invite_editor:null,invite_viewer:null,invite_viewer_no_comment:null,leave_a_copy:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,update_confidentiality:null,unmount:null,unshare:null},"FolderPermissions"));t.FolderPermissions=m;var f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({entries:o.Map(),cursor:null},"ListFoldersResult"));t.ListFoldersResult=f;var v=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.contentId=function(){return this.id},t.prototype.isSharedFolder=function(){return!1},t.prototype.isNewSharedFolder=function(){return!1},t})(o.Record({access_type:null,id:null,file_policy:null,link_metadata:null,name:null,owner_team:null,policy:null,parent_shared_folder_id:null,path_display:null,path_lower:null,permissions:null,preview_url:null,time_invited:null},"SharedFileMetadata"));t.SharedFileMetadata=v;var g=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({change_options:null,disable_viewer_info:null,edit_contents:null,enable_viewer_info:null,invite_viewer:null,invite_viewer_no_comment:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,unshare:null,view_members:null},"FilePermissions"));t.FilePermissions=g;var y=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({download_policy:null,viewer_info_policy:null},"FilePolicy"));t.FilePolicy=y;var E=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({entries:o.Map(),cursor:null},"ListFilesResult"));t.ListFilesResult=E;var S=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getMemberCount=function(){return this.memberCount||this.invitees.count()+this.groups.count()+this.users.count()},t})(o.Record({cursor:null,invitees:o.Map(),groups:o.Map(),users:o.Map(),memberCount:null},"SharingMembership"));t.SharingMembership=S,t.makeMemberKey=function(e,t){return e+":"+t};var b=(function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(o,e),o.prototype.memberId=function(){return this.account_id},o.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},o.prototype.displayName=function(){return this.account?this.account.display_name:void 0},o.prototype.type=function(){return"users"},o})(o.Record({access_type:null,account:null,account_id:null,initials:null,is_inherited:!1,permissions:null,same_team:null,team_member_id:null,time_last_seen:null},"UserMembershipInfo"));t.UserMembershipInfo=b;var w=(function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(o,e),o.prototype.memberId=function(){return this.contact_type+":"+this.contact},o.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},o.prototype.displayName=function(){return this.contact},o.prototype.type=function(){return"invitees"},o})(o.Record({access_type:null,contact:null,contact_type:null,initials:!1,is_inherited:null,permissions:null,same_team:null},"InviteeMembershipInfo"));t.InviteeMembershipInfo=w;var C=(function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(o,e),o.prototype.memberId=function(){return this.group_id},o.prototype.memberKey=function(){return t.makeMemberKey(this.is_inherited,this.memberId())},o.prototype.displayName=function(){return this.group_name},o.prototype.type=function(){return"groups"},o})(o.Record({access_type:null,group_external_id:null,group_id:null,group_management_type:null,group_name:null,group_type:null,initials:null,is_inherited:!1,is_member:!1,is_owner:!1,member_count:null,permissions:null,same_team:!0},"GroupMembershipInfo"));t.GroupMembershipInfo=C;var T=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({leave_a_copy:null,make_editor:null,make_owner:null,make_viewer:null,make_viewer_no_comment:null,remove:null},"MemberPermissions"));t.MemberPermissions=T;var A=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({total_unique_users:null,users_outside_team:null,exceeds_count:!1},"MemberCounts"));t.MemberCounts=A;var I=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({access_level:null,warning:null,parentFolders:null},"MemberAccessLevelResult"));t.MemberAccessLevelResult=I;var P=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({name:null,shared_folder_id:null,path:null,permissions:null},"ParentFolderInfo"));t.ParentFolderInfo=P;var R=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.isFolder=function(){return"folder"===this.file_type},t.prototype.teamInfo=function(){return this.content_owner_team_info?this.content_owner_team_info:this.team_member_info?this.team_member_info.team_info:void 0},t})(o.Record({url:null,client_modified:null,content_owner_team_info:null,expires:null,file_type:null,id:null,link_permissions:null,name:null,path_lower:null,rev:null,server_modified:null,size:null,team_member_info:null,preview_type:null},"LinkMetadata"));t.LinkMetadata=R;var O=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({requested_visibility:null,link_password:null,expires:null,allow_download:null},"LinkPolicy"));t.LinkPolicy=O;var N=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({allow_comments:null,can_revoke:null,allow_download:null,can_allow_download:null,can_disallow_download:null,can_set_expiry:null,can_remove_expiry:null,requested_visibility:null,resolved_visibility:null,restricting_shared_folder_path:null,revoke_failure_reason:null,team_restricts_comments:null,visibility_policies:null},"LinkPermissions"));t.LinkPermissions=N;var L=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({policy:null,resolved_policy:null,allowed:null,disallowed_reason:null},"LinkVisibilityPolicy"));t.LinkVisibilityPolicy=L;var M=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({add_message_as_comment_checked:null,add_message_as_comment_help_shown:null,access_reader_no_comment_content_links:null,access_reader_no_comment_shared_folders:null},"SharingPrefs"));t.SharingPrefs=M;var k=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({change_audience:null,remove_expiry:null,remove_password:null,set_expiry:null,set_password:null},"SharedContentLinkPermissions"));t.SharedContentLinkPermissions=k;var F=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({shared_folder_id:null,name:null,audience:null},"AudienceRestrictingSharedFolder"));t.AudienceRestrictingSharedFolder=F;var x=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({audience_options:null,current_audience:null,expiry:null,link_permissions:null,password_protected:null,url:null,audience_restricting_shared_folder:null,access_level:null},"SharedContentLinkMetadata"));t.SharedContentLinkMetadata=x;var D=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t})(o.Record({audience:null,remove_expiry:null,set_expiry:null,remove_password:null,set_password:null,access_level:null},"SharedContentLinkSettings"));t.SharedContentLinkSettings=D}),define("modules/clean/sharing/api/util/types",["require","exports","tslib","modules/clean/contacts/types","external/immutable","external/underscore","modules/clean/api_v2/types","modules/clean/sharing/constants","modules/clean/sharing/link_info","modules/clean/sharing/api/types/metadata"],function(e,t,n,o,i,r,s,a,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.accessLevelConstToApi=function(e){switch(e){case a.ACCESS_LEVEL.OWNER:return new s.UnionScalar("owner");case a.ACCESS_LEVEL.WRITER:return new s.UnionScalar("editor");case a.ACCESS_LEVEL.READER:return new s.UnionScalar("viewer");case a.ACCESS_LEVEL.READER_NO_COMMENT:return new s.UnionScalar("viewer_no_comment");default:throw new Error("unknown access level")}},t.accessLevelApiToConst=function(e){switch(e.type||e){case"owner":return a.ACCESS_LEVEL.OWNER;case"editor":return a.ACCESS_LEVEL.WRITER;case"viewer":return a.ACCESS_LEVEL.READER;case"viewer_no_comment":return a.ACCESS_LEVEL.READER_NO_COMMENT}},t.groupManagementTypeApiToConst=function(e){if(!e)return null;switch(e[".tag"]){case"user_managed":return c.GroupManagementType.user_managed;case"company_managed":return c.GroupManagementType.company_managed;case"system_managed":return c.GroupManagementType.system_managed;default:return}},t.hasFolderMetadataRecordInMetadata=function(e){return null!=e.path_lower&&null!=e.access_type&&null!=e.policy},t.folderPolicyApiToRecord=function(e){return null==e?new c.FolderPolicy:new c.FolderPolicy({acl_update_policy:e.acl_update_policy&&e.acl_update_policy[".tag"],download_policy:e.download_policy&&e.download_policy[".tag"],member_policy:e.member_policy&&e.member_policy[".tag"],resolved_member_policy:e.resolved_member_policy&&e.resolved_member_policy[".tag"],shared_link_policy:e.shared_link_policy&&e.shared_link_policy[".tag"],viewer_info_policy:e.viewer_info_policy&&e.viewer_info_policy[".tag"]})};var u=function(e){for(var t={},n=0,o=e;n<o.length;n++){var i=o[n];t[i.action[".tag"]]=new c.PermissionSetting({allow:i.allow,reason:i.reason?i.reason[".tag"]:void 0})}return t};t.sharedContentLinkPermissionsApiToRecord=function(e){var t=u(e);return new c.SharedContentLinkPermissions(t)},t.audienceRestrictingSharedFolderToRecord=function(e){return new c.AudienceRestrictingSharedFolder({shared_folder_id:e.shared_folder_id,name:e.name,audience:e.audience[".tag"]})},t.sharedContentLinkMetadataToRecord=function(e){return new c.SharedContentLinkMetadata({audience_options:i.List(e.audience_options.map(function(e){return e[".tag"]})),current_audience:e.current_audience[".tag"],expiry:e.expiry&&new Date(e.expiry)>new Date?new Date(e.expiry):void 0,link_permissions:t.sharedContentLinkPermissionsApiToRecord(e.link_permissions),password_protected:e.password_protected,url:e.url,audience_restricting_shared_folder:e.audience_restricting_shared_folder&&t.audienceRestrictingSharedFolderToRecord(e.audience_restricting_shared_folder),access_level:e.access_level&&e.access_level[".tag"]})},t.parseFolderPolicy=t.folderPolicyApiToRecord,t.folderPermissionsApiToRecord=function(e){var t=u(e);return new c.FolderPermissions(t)},t.folderMetadataApiToRecord=function(e){return new c.SharedFolderMetadata({access_type:t.accessLevelApiToConst(s.Union.parse(e.access_type)),is_inside_team_folder:e.is_inside_team_folder,is_team_folder:e.is_team_folder,link_metadata:null!=e.link_metadata?t.sharedContentLinkMetadataToRecord(e.link_metadata):void 0,members_cursor:e.members_cursor,name:e.name,owner_team:null!=e.owner_team?new c.Team(e.owner_team):void 0,parent_shared_folder_id:e.parent_shared_folder_id,path_lower:e.path_lower,permissions:null!=e.permissions?t.folderPermissionsApiToRecord(e.permissions):void 0,policy:t.parseFolderPolicy(e.policy),preview_url:e.preview_url,shared_folder_id:e.shared_folder_id,time_invited:null!=e.time_invited?new Date(e.time_invited):void 0,is_confidential:null!=e.is_confidential?e.is_confidential:void 0})},t.listFoldersResultApiToRecord=function(e){return new c.ListFoldersResult({entries:i.Map(e.entries.map(t.folderMetadataApiToRecord).map(function(e){return[e.shared_folder_id,e]})),cursor:e.cursor})},t.filePermissionsApiToRecord=function(e){var t={};if(e)for(var n=0,o=e;n<o.length;n++){var i=o[n];t[i.action[".tag"]]=new c.PermissionSetting({allow:i.allow,reason:i.reason&&i.reason[".tag"]})}return new c.FilePermissions(t)},t.getFilePolicy=function(e){var t={};return t[c.ViewerInfoPolicy.policy_name]=e&&e.viewer_info_policy&&e.viewer_info_policy[".tag"],t[c.DownloadPolicy.policy_name]=e&&e.download_policy&&e.download_policy[".tag"]||c.DownloadPolicy.allow,new c.FilePolicy(t)},t.fileMetadataApiToRecord=function(e){return new c.SharedFileMetadata({access_type:null!=e.access_type?t.accessLevelApiToConst(s.Union.parse(e.access_type)):a.ACCESS_LEVEL.READER,id:e.id,file_policy:t.getFilePolicy(e.policy),link_metadata:e.link_metadata&&t.sharedContentLinkMetadataToRecord(e.link_metadata),name:e.name,owner_team:e.owner_team&&new c.Team(e.owner_team),policy:null!=e.policy?t.parseFolderPolicy(e.policy):new c.FolderPolicy,parent_shared_folder_id:e.parent_shared_folder_id,path_display:e.path_display,path_lower:e.path_lower,permissions:t.filePermissionsApiToRecord(e.permissions),preview_url:e.preview_url,time_invited:e.time_invited&&new Date(e.time_invited)})},t.listFilesResultApiToRecord=function(e){return new c.ListFilesResult({entries:i.Map(e.entries.map(function(e){return[e.id,t.fileMetadataApiToRecord(e)]})),cursor:e.cursor})},t.memberPermissionsApiToRecord=function(e){var t={};if(null!=e)for(var n=0,o=e;n<o.length;n++){var i=o[n];t[i.action[".tag"]]=new c.PermissionSetting({allow:i.allow,reason:i.reason&&i.reason[".tag"]})}return new c.MemberPermissions(t)},t.inviteeMembershipApiToRecord=function(e){var n=e.invitee[".tag"];return new c.InviteeMembershipInfo({access_type:t.accessLevelApiToConst(s.Union.parse(e.access_type)),contact:e.invitee[n],contact_type:n,initials:e.initials,is_inherited:e.is_inherited,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:Boolean(e.user&&e.user.same_team)})},t.groupMembershipApiToRecord=function(e){return new c.GroupMembershipInfo({access_type:t.accessLevelApiToConst(s.Union.parse(e.access_type)),group_external_id:e.group.group_external_id,group_id:e.group.group_id,group_management_type:t.groupManagementTypeApiToConst(e.group.group_management_type),group_name:e.group.group_name,group_type:e.group.group_type[".tag"],initials:e.initials,is_inherited:e.is_inherited,is_member:e.group.is_member,is_owner:e.group.is_owner,member_count:e.group.member_count,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:e.group.same_team})},t.userMembershipApiToRecord=function(e){return new c.UserMembershipInfo({access_type:t.accessLevelApiToConst(s.Union.parse(e.access_type)),account_id:e.user.account_id,initials:e.initials,is_inherited:e.is_inherited,permissions:t.memberPermissionsApiToRecord(e.permissions),same_team:e.user.same_team,team_member_id:e.user.team_member_id,time_last_seen:e.time_last_seen&&new Date(e.time_last_seen)})},t.membershipApiToRecord=function(e,n){return void 0===n&&(n=null),new c.SharingMembership({cursor:e.cursor,invitees:i.Map(e.invitees.map(function(e){var n=t.inviteeMembershipApiToRecord(e);return[n.memberKey(),n]})),groups:i.Map(e.groups.map(function(e){var n=t.groupMembershipApiToRecord(e);return[n.memberKey(),n]})),users:i.Map(e.users.map(function(e){var n=t.userMembershipApiToRecord(e);return[n.memberKey(),n]})),memberCount:n})},t.memberCountsApiToRecord=function(e){return new c.MemberCounts(e)},t.parentFolderInfoApiToRecord=function(e){return new c.ParentFolderInfo({name:e.folder_name,shared_folder_id:e.shared_folder_id,path:e.path,permissions:t.memberPermissionsApiToRecord(e.permissions)})},t.memberAccessLevelApiToRecord=function(e,n){if(null==n)return new c.MemberAccessLevelResult;var o;return null!=n.access_details&&(o=n.access_details.map(function(e){return t.parentFolderInfoApiToRecord(e)})),new c.MemberAccessLevelResult({access_level:n.access_level&&t.accessLevelApiToConst(s.Union.parse(n.access_level)),warning:n.warning,parentFolders:o})},t.teamMemberInfoApiToRecord=function(e){return null==e?null:new c.TeamMemberInfo({display_name:e.display_name,member_id:e.member_id,team_info:e.team_info&&new c.Team(e.team_info)})},t.visibilityPolicyApiToRecord=function(e){return new c.LinkVisibilityPolicy({policy:e.policy&&e.policy[".tag"],resolved_policy:e.resolved_policy&&e.resolved_policy[".tag"],allowed:e.allowed,disallowed_reason:e.disallowed_reason&&e.disallowed_reason[".tag"]})},t.linkPermissionsApiToRecord=function(e){return null==e?new c.LinkPermissions:new c.LinkPermissions({allow_download:e.allow_download,allow_comments:e.allow_comments,can_allow_download:e.can_allow_download,can_disallow_download:e.can_disallow_download,can_revoke:e.can_revoke,can_set_expiry:e.can_set_expiry,can_remove_expiry:e.can_remove_expiry,requested_visibility:e.requested_visibility&&e.requested_visibility[".tag"],resolved_visibility:e.resolved_visibility&&e.resolved_visibility[".tag"],restricting_shared_folder_path:e.restricting_shared_folder_path,revoke_failure_reason:e.revoke_failure_reason&&e.revoke_failure_reason[".tag"],team_restricts_comments:e.team_restricts_comments,visibility_policies:e.visibility_policies&&e.visibility_policies.map(t.visibilityPolicyApiToRecord)})},t.linkMetadataApiToRecord=function(e){return new c.LinkMetadata({url:e.url,client_modified:e.client_modified&&new Date(e.client_modified),content_owner_team_info:e.content_owner_team_info&&new c.Team(e.content_owner_team_info),expires:e.expires&&new Date(e.expires),file_type:e[".tag"],id:e.id,link_permissions:t.linkPermissionsApiToRecord(e.link_permissions),name:e.name,path_lower:e.path_lower,rev:e.rev,server_modified:e.server_modified&&new Date(e.server_modified),size:e.size,team_member_info:t.teamMemberInfoApiToRecord(e.team_member_info),preview_type:e.preview_type})},t.accountInfoApiToRecord=function(e){return new c.BasicAccount({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,is_teammate:e.is_teammate,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id})},
t.teamSharingPoliciesApiToRecord=function(e){return e&&new c.TeamSharingPolicies({shared_folder_member_policy:e.shared_folder_member_policy&&e.shared_folder_member_policy[".tag"],shared_folder_join_policy:e.shared_folder_join_policy&&e.shared_folder_join_policy[".tag"],shared_link_create_policy:e.shared_link_create_policy&&e.shared_link_create_policy[".tag"]})},t.fullAccountApiToRecord=function(e){var n=e.team&&new c.FullTeam({id:e.team.id,name:e.team.name,sharing_policies:t.teamSharingPoliciesApiToRecord(e.team.sharing_policies)});return new c.FullAccount({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id,team:n})},t.sharingPrefsApiToRecord=function(e){return new c.SharingPrefs({add_message_as_comment_checked:e.add_message_as_comment_checked,add_message_as_comment_help_shown:e.add_message_as_comment_help_shown,access_reader_no_comment_content_links:e.access_reader_no_comment_content_links,access_reader_no_comment_shared_folders:e.access_reader_no_comment_shared_folders})},t.makeMemberSelector=function(e){return e.startsWith("email:")?new s.UnionScalar("email",e.substr(6)):new s.UnionScalar("dropbox_id",e)},t.parseSharedLinkMetadata=function(e){if(null==e)return null;var t=s.Union.parse(e.link_permissions.resolved_visibility).type,o=null!=e.team_member_info?{teamId:e.team_member_info.team_info.id,teamName:e.team_member_info.team_info.name}:{teamId:null,teamName:null},i={isFolder:"folder"===e[".tag"],url:e.url,name:e.name,expires:e.expires&&new Date(e.expires),visibility:t,isPackage:e.is_package};return i=n.__assign({},i,o),new l.LinkInfo(i)},t.contactsToMembers=function(e){return e.map(function(e){if(e.type===o.NEW_STYLE_GROUP)return new s.UnionScalar("dropbox_id",e.getContactID());if(e.type!==o.INVALID_ID)return new s.UnionScalar("email",e.getContactID());throw new Error("Unknown contact type")})},t.getCombinedPolicy=function(e,t){return new c.CombinedPolicy({acl_update_policy:e instanceof c.FolderPolicy?e.acl_update_policy:void 0,download_policy:e.download_policy||"allow",member_policy:e instanceof c.FolderPolicy?e.resolved_member_policy:void 0,viewer_info_policy:e.viewer_info_policy,shared_link_policy:e instanceof c.FolderPolicy?e.shared_link_policy:void 0,audience:t&&t.current_audience,access_level:t&&t.access_level,expiry:{status:t&&t.expiry?"on":"off",value:t&&t.expiry||""},password:{status:t&&t.password_protected?"on":"off"}})},t.combinedPolicyDiffToApi=function(e){var t={};if(!e)return t;null!=e.acl_update_policy&&(t.acl_update_policy=e.acl_update_policy),null!=e.download_policy&&(t.download_policy=e.download_policy),null!=e.member_policy&&(t.member_policy=e.member_policy),null!=e.viewer_info_policy&&(t.viewer_info_policy=e.viewer_info_policy),null!=e.shared_link_policy&&(t.shared_link_policy=e.shared_link_policy);var n={};if(null!=e.audience&&(n.audience=new s.UnionScalar(e.audience)),null!=e.access_level&&(n.access_level=new s.UnionScalar(e.access_level)),null!=e.expiry){var o=e.expiry;if("on"===o.status&&o.value)o.value.setHours(23),o.value.setMinutes(59),o.value.setSeconds(59),n.expiry=new s.UnionScalar("set_expiry",s.formatTimestamp(o.value)).toJSON();else{if("off"!==o.status)throw new Error("Bad expiry settings");n.expiry=new s.UnionScalar("remove_expiry").toJSON()}}if(null!=e.password){var i=e.password;"on"===i.status&&i.value?n.password=new s.UnionScalar("set_password",i.value).toJSON():"off"===i.status&&(n.password=new s.UnionScalar("remove_password").toJSON())}return r.keys(n).length>0&&(t.link_settings=n),t}}),function(){define("modules/clean/sharing/delete_link_modal",["modules/clean/ajax","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/constants","modules/constants/file_viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s){var a,l,c,u,p,d;return a=n.Modal,l=n.SimpleModal,c=r.i18n_default_project("sharing")._,u=function(){return c(i.MAESTRO_ENABLED?"Delete":"Delete link")},p=function(e){var n,r,p,d,h,_,m,f;return n=e.client,f=e.url,r=e.contentName,h=null!=(_=e.onDeleteLink)?_:null,d=null!=(m=e.onCancel)?m:null,r=t.em_snippet(r,o.SNIPPET_SIZES.FILENAME),p=function(){return n.revokeSharedLink({url:f}).then(function(){var e;return e=c("Deleted link to “%(name)s”").format({name:r}),s.success(e),a.close(),"function"==typeof h?h():void 0})},l.show({autoclose:!1,body_html:c("This link will no longer work for anyone who has it."),cancel_completed_callback:d,cancel_text:c("Cancel"),confirm_callback:p,confirm_text:u(),title_text:c("Delete link to “%(name)s”?").format({name:r}),style:i.MAESTRO_ENABLED?"default-maestro":void 0})},d=function(n){var r,p,d,h,_,m,f,v;return r=n.client,v=n.tkey,p=n.contentName,_=null!=(m=n.onDeleteLink)?m:null,h=null!=(f=n.onCancel)?f:null,p=t.em_snippet(p,o.SNIPPET_SIZES.FILENAME),d=function(){return e.WebRequest({url:"/sm/disable/"+v,type:"POST",data:{tkey:v},subject_user:r.userId,success:function(){var e;return e=c("Deleted link to “%(name)s”").format({name:p}),s.success(e),a.close(),"function"==typeof _?_():void 0}})},l.show({autoclose:!1,body_html:c("This link will no longer work for anyone who has it."),cancel_completed_callback:h,cancel_text:c("Cancel"),confirm_callback:d,confirm_text:u(),title_text:c("Delete link to “%(name)s”?").format({name:p}),style:i.MAESTRO_ENABLED?"default-maestro":void 0})},{deleteLinkWithConfirm:p,deleteLinkWithConfirmLegacy:d}})}.call(this),function(){define("modules/clean/sharing/link_info",[],function(){var e;return e=(function(){function e(e){this.expires=e.expires,this.isFolder=e.isFolder,this.name=e.name,this.teamId=e.teamId,this.teamName=e.teamName,this.url=e.url,this.visibility=e.visibility,this.isPackage=e.isPackage}return e})(),{LinkInfo:e}})}.call(this),function(){define("modules/clean/sharing/share_page/action_types",["modules/clean/flux/action_type"],function(e){var t,n;return n=e.withActionNamespace,t=n("share-page",{INITIALIZE:"initialize-store",EMAIL_UNVERIFIED:"email-unverified",SWITCH_TAB:"switch-tab",SWITCH_ROLE:"switch-role",SWITCH_USER:"switch-user",LOAD_FOLDER_DATA_REQUEST:"load-folder-data-request",LOAD_FOLDER_DATA_SUCCESS:"load-folder-data-success",LOAD_FOLDER_DATA_ERROR:"load-folder-data-error",LOAD_FILE_DATA_REQUEST:"load-file-data-request",LOAD_FILE_DATA_SUCCESS:"load-file-data-success",LOAD_FILE_DATA_ERROR:"load-file-data-error",MOUNT_FOLDER_REQUEST:"mount-folder-request",MOUNT_FOLDER_SUCCESS:"mount-folder-success",MOUNT_FOLDER_ERROR:"mount-folder-error",UNMOUNT_FOLDER_REQUEST:"unmount-folder-request",UNMOUNT_FOLDER_SUCCESS:"unmount-folder-success",UNMOUNT_FOLDER_ERROR:"unmount-folder-error",UNSHARE_FOLDER_REQUEST:"unshare-folder-request",UNSHARE_FOLDER_SUCCESS:"unshare-folder-success",UNSHARE_FOLDER_ERROR:"unshare-folder-error",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_TEAM_POLICY_ERROR:"fetch-team-policy-error",FETCH_FOLDER_POLICY_SUCCESS:"fetch-folder-policy-success",FETCH_METADATA_SUCCESS:"fetch-metadata-success",RELINQUISH_FOLDER_MEMBERSHIP_REQUEST:"relinquish-folder-membership-request",RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS:"relinquish-folder-membership-success",RELINQUISH_FOLDER_MEMBERSHIP_ERROR:"relinquish-folder-membership-error",RELINQUISH_FILE_MEMBERSHIP_REQUEST:"relinquish-file-membership-request",RELINQUISH_FILE_MEMBERSHIP_SUCCESS:"relinquish-file-membership-success",RELINQUISH_FILE_MEMBERSHIP_ERROR:"relinquish-file-membership-error"}),{SharePageActionTypes:t}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/signup_modal_proxy",[],function(){return new((function(){function t(){this.signup=e(this.signup,this),this._defaultModalSignupPromiseResolver=e(this._defaultModalSignupPromiseResolver,this),this.signupForDirectDownload=e(this.signupForDirectDownload,this),this._directDownloadSignupPromiseResolver=e(this._directDownloadSignupPromiseResolver,this),this.disconnectModal=e(this.disconnectModal,this),this.connectModal=e(this.connectModal,this),this._signupModal=null,this._directDownloadPromise=null,this._defaultModalPromise=null}return t.prototype.connectModal=function(e){return this._signupModal=e},t.prototype.disconnectModal=function(){return this._signupModal=null,this._directDownloadPromise=null,this._defaultModalPromise=null},t.prototype._directDownloadSignupPromiseResolver=function(e,t){var n,o;return o=(function(t){return function(){return t._directDownloadPromise=null,e()}})(this),n=(function(e){return function(){return e._directDownloadPromise=null,t()}})(this),this._signupModal.handle_direct_download(o),this._signupModal.handle_direct_download_cancel(n)},t.prototype.signupForDirectDownload=function(){var e;return null==this._signupModal?Promise.resolve():(null==this._directDownloadPromise&&(this._directDownloadPromise=new Promise(this._directDownloadSignupPromiseResolver)),e=this._directDownloadPromise,this._signupModal.on_request_direct_download(),e)},t.prototype._defaultModalSignupPromiseResolver=function(e,t){var n,o;return n=function(t){return e(t)},o=(function(e){return function(){return e._defaultModalPromise=null,t()}})(this),this._signupModal.handle_default_modal_authenticate(n),this._signupModal.handle_default_modal_cancel(o),this._signupModal.on_request_default_signup()},t.prototype.signup=function(){return null==this._signupModal?Promise.reject():(null==this._defaultModalPromise&&(this._defaultModalPromise=new Promise(this._defaultModalSignupPromiseResolver)),this._defaultModalPromise)},t})())})}.call(this),define("modules/clean/sharing/stores/sharing_info",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/sharing/action_types","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/stores/sharing_info_util","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/core/exception"],function(e,t,n,o,i,r,s,a,l,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(e,t){return t=String(t),t.startsWith("id:")||(t=t.toLowerCase()),e+"::"+t},_=(function(e){function t(){var t=e.call(this)||this;return t.sharingInfoMap={},t}return n.__extends(t,e),t.prototype.getSharingInfo=function(e,t){return t?this.sharingInfoMap[h(e,t)]:null},t.prototype.mapContentIdsToSharingInfo=function(e,t,n){for(var o=0,i=t;o<i.length;o++){var r=i[o];r&&(this.sharingInfoMap[h(e,r)]=n)}},t.prototype._new_payload=function(e){var t=this;if(e&&e.action&&e.action.type)switch(e.action.type){case s.SharingActionTypes.CLEAR_EVERYTHING:this.sharingInfoMap={};break;case s.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS:var n=e.action.user;e.action.data.forEach(function(e){t._new_payload_for_single_content(s.ShareModalActionTypes.FETCH_METADATA_SUCCESS,n,c.getContentIdsForMetadata(e),{metadata:e})}),this.emit_change();break;default:if(!e.action.contentIds)return;this._new_payload_for_single_content(e.action.type,e.action.user,e.action.contentIds,e.action.data),this.emit_change()}},t.prototype._new_payload_for_single_content=function(e,t,n,o){d.assert(Boolean(t.id),"valid user needed"),d.assert(n.length>0,"contentIds cannot be empty");for(var i=null,r=0,s=n;r<s.length;r++){var a=s[r],l=h(t.id,a);if(l in this.sharingInfoMap){i=this.sharingInfoMap[l];break}}return i||(i=new m(t)),this.mapContentIdsToSharingInfo(t.id,n,i),i._new_payload(e,o)},t})(r);t.sharingInfoStore=new _;var m=(function(){function e(e){this._areMembersFullyLoaded=!1,this._areSharingPrefsLoaded=!1,this._hasDisplayableMembers=!1,this._isLinkMetadataLoaded=!1,this._isTeamPolicyLoaded=!1,this._isUpdatingLinkAudience=!1,this._sharingPrefs=new a.SharingPrefs,this._sharingPaywallInfo=null,this._shouldBlockMemberListOnPassLoad=!0,this._user=e}return e.prototype._new_payload=function(e,n){switch(e){case s.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_REQUEST:var o=this._metadata;this._linkMetadata||(o=o.set("link_metadata",new a.SharedContentLinkMetadata)),o=o.setIn(["link_metadata","current_audience"],n.newAudience),this.setMetadata(o),this._isUpdatingLinkAudience=!0;break;case s.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_FAILURE:this._isUpdatingLinkAudience=!1,this.setMetadata(this._metadata.setIn(["link_metadata","current_audience"],n.prevAudience));break;case s.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SUCCESS:this._modalInfo.hasChangedLinkAudience=!0,this._isUpdatingLinkAudience=!1,this.setMetadata(n.metadata);break;case s.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE:var r=n.member;this._members=this._members.setIn([r.type(),r.memberKey(),"access_type"],n.prevAccess);break;case s.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST:var r=n.member;this._members=this._members.setIn([r.type(),r.memberKey(),"access_type"],n.newAccess);break;case s.ShareModalActionTypes.CHANGE_RECIPIENTS:this._modalInfo.recipientTokens=n.recipientTokens,this._modalInfo.recipientRawInput=n.recipientRawInput;var l=void 0;n.recipientTokens.length>0||n.recipientRawInput.length>0?this.uiMode()===p.MODES.MEMBERSHIP&&(l=p.MODES.SHARE):this.uiMode()===p.MODES.SHARE&&(l=p.MODES.MEMBERSHIP),l&&(this._modalInfo.uiMode=l);break;case s.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS:this._modalInfo.recipientAccess=n.newAccess;break;case s.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE:this._modalInfo.recipientMessage=n.message;break;case s.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:this._members=this._members.update("users",function(e){return e.map(function(e){return e.set("time_last_seen",null)})});break;case s.ShareModalActionTypes.CLEAR_UNSHARE_FROM_PAYWALL:this._sharingPaywallInfo.foldersToUnshare=[],this._sharingPaywallInfo.keepACopy=null;break;case s.ShareModalActionTypes.CREATE_LINK_SUCCESS:this._linkMetadata=n.linkMetadata;break;case s.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS:this._memberCounts=n.memberCounts;break;case s.ShareModalActionTypes.FETCH_METADATA_FAILURE:this._fetchingMetadataPromise=void 0,this._modalInfo&&(this._modalInfo.uiMode=p.MODES.LINK_ONLY,this._modalInfo.linkOnlyReason!==p.LINK_ONLY_REASON.LINKS_PAGE&&(this._modalInfo.linkOnlyReason=n.reason));break;case s.ShareModalActionTypes.FETCH_METADATA_REQUEST:this._fetchingMetadataPromise=n.promise;break;case s.ShareModalActionTypes.FETCH_METADATA_SUCCESS:this._fetchingMetadataPromise=void 0,this.setMetadata(n.metadata);break;case s.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST:this._areSharingPrefsLoaded=!1;break;case s.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS:this._areSharingPrefsLoaded=!0,this._sharingPrefs=n.sharingPrefs;break;case s.ShareModalActionTypes.FETCH_SHARING_PAYWALL_INFO_REQUEST:this._modalInfo.isSharingPaywallInfoLoaded=!1;break;case s.ShareModalActionTypes.FETCH_SHARING_PAYWALL_INFO_SUCCESS:this._modalInfo.isSharingPaywallInfoLoaded=!0,this._sharingPaywallInfo=n.sharingPaywallInfo;break;case s.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE:this._isLinkMetadataLoaded=!0,this._linkMetadata=void 0;break;case s.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS:this._isLinkMetadataLoaded=!0,this._linkMetadata=n.linkMetadata;break;case s.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST:this._fetchingMembersRequest={limitNonNull:n.limitNonNull,promise:n.promise,requestId:n.requestId};break;case s.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS:if(this._fetchingMembersRequest&&n.requestId!==this._fetchingMembersRequest.requestId)return!1;if(this._hasDisplayableMembers&&this._fetchingMembersRequest&&this._fetchingMembersRequest.limitNonNull<this._members.getMemberCount())return;this._hasDisplayableMembers=!0,n.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=void 0),this._members=n.members;break;case s.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:if(this._fetchingMembersRequest&&n.requestId!==this._fetchingMembersRequest.requestId)return!1;n.members.cursor||(this._areMembersFullyLoaded=!0,this._fetchingMembersRequest=void 0),this._members=this._members.mergeDeep(n.members);break;case s.ShareModalActionTypes.FETCH_TEAM_POLICY_REQUEST:this._isTeamPolicyLoaded=!1;break;case s.ShareModalActionTypes.FETCH_TEAM_POLICY_SUCCESS:this._isTeamPolicyLoaded=!0,this._teamPolicy=n.teamPolicy;case s.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS:this._memberCounts=new a.MemberCounts({total_unique_users:n.count,users_outside_team:0,exceeds_count:n.exceeds_limit});break;case s.ShareModalActionTypes.FETCH_UPSELL_EXPERIMENT_VARIANT:n.variant&&(this._expSubgrowthProOverquotaCreateSharedLink=n.variant);case s.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE:""===n.name?(this._modalInfo.contentNameMessage=p.CONTENT_NAME_EMPTY_TOOLTIP,this._modalInfo.contentNameMessageLevel=p.CONTENT_NAME_MESSAGE_LEVELS.INFO):(this._modalInfo.contentNameMessage=void 0,this._modalInfo.contentNameMessageLevel=p.CONTENT_NAME_MESSAGE_LEVELS.INFO);break;case s.ShareModalActionTypes.HANDLE_CONTENT_NAME_FOCUS_CHANGE:this._modalInfo.isContentNameFocused=n.focus;break;case s.ShareModalActionTypes.MEMBER_ACTION_COMPLETE:this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(n.member.memberKey());break;case s.ShareModalActionTypes.MEMBER_ACTION_PENDING:this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.add(n.member.memberKey());break;case s.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS:var r=n.member;this._members=this._members.setIn([r.type(),r.memberKey(),"access_type"],n.access),this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(r.memberKey());break;case s.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS:var r=n.member;this._members=this._members.deleteIn([r.type(),r.memberKey()]),this._modalInfo.pendingMemberAction=this._modalInfo.pendingMemberAction.delete(r.memberKey());break;case s.ShareModalActionTypes.SEND_SHARE_FAILURE:this._modalInfo.uiMode=p.MODES.SHARE;break;case s.ShareModalActionTypes.SEND_SHARE_REQUEST:this._modalInfo.uiMode=p.MODES.SHARE_SENDING;break;case s.ShareModalActionTypes.SEND_SHARE_SUCCESS:this._modalInfo.uiMode=p.MODES.SHARE;break;case s.ShareModalActionTypes.SET_COMMENT_CHECKBOX_PREF_REQUEST:this._sharingPrefs=this._sharingPrefs.set("add_message_as_comment_checked",n.checked);break;case s.ShareModalActionTypes.SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST:this._sharingPrefs=this._sharingPrefs.set("add_message_as_comment_help_shown",!1);break;case s.ShareModalActionTypes.PAYWALL_GRANDFATHER_MODAL_DISMISS:this._sharingPaywallInfo.grandfather_modal.show=!1;break;case s.ShareModalActionTypes.PAYWALL_GRANDFATHER_MODAL_LEARN_MORE:this._sharingPaywallInfo.grandfather_modal.learnMore=!0,this._sharingPaywallInfo.grandfather_modal.show=!0;break;case s.ShareModalActionTypes.SHARE_FOLDER_FAILURE:this._shareFolderPromise=void 0;break;case s.ShareModalActionTypes.SHARE_FOLDER_REQUEST:this._shareFolderPromise=n.promise;break;case s.ShareModalActionTypes.SHARE_FOLDER_SUCCESS:this.setMetadata(n.metadata),this._shareFolderPromise=void 0;break;case s.ShareModalActionTypes.SHARE_MODAL_CLOSE:this._modalInfo.initialRecipientTokens=n.tokens||[],this._modalInfo.initialRecipientRawInput=n.value||"";break;case s.ShareModalActionTypes.SHARE_MODAL_OPEN:this.handleShareModalOpen(n);break;case s.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS:this._metadata=void 0,this._isLinkMetadataLoaded=!1,this._hasDisplayableMembers=!1;break;case s.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:this._shouldBlockMemberListOnPassLoad=!1;break;case s.ShareModalActionTypes.UNSHARE_FROM_PAYWALL:this._sharingPaywallInfo.num_shared_folders_owned-=n.foldersToUnshare.size,this._sharingPaywallInfo.foldersToUnshare=n.foldersToUnshare,this._sharingPaywallInfo.keepACopy=n.keepACopy;break;case s.ShareModalActionTypes.UPDATE_BANNER:this._modalInfo.banner=n.banner;break;case s.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS:this._modalInfo&&(this._modalInfo.hasChangedSharingSettings=!0),this.setMetadata(n.metadata);break;case s.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR:this._modalInfo.contentNameMessage=n.errorMsg,this._modalInfo.contentNameMessageLevel=p.CONTENT_NAME_MESSAGE_LEVELS.ERROR;break;case s.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS:var c=i.parent_dir(this.fqPath()),d=u.getNewFolderPathFromContentName(n.contentName,c);this._modalInfo.contentInfo=this._modalInfo.contentInfo.setFQPath(d),t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,[d],this)}},e.prototype.handleShareModalOpen=function(e){this._modalInfo=new f(e.shareModalInfo.contentInfo),this._modalInfo.initialRecipientTokens=e.shareModalInfo.initialRecipientTokens||[],this._initialProps=e.initialProps,e.shareModalInfo.inLinksPage&&(this._modalInfo.uiMode=p.MODES.LINK_ONLY,this._modalInfo.linkOnlyReason=p.LINK_ONLY_REASON.LINKS_PAGE),this._modalInfo.icon=this.calcIcon(),this._areMembersFullyLoaded=!1,!e.shareModalInfo.contentInfo.pathExists()&&!e.initialProps.initialContentName&&(this._modalInfo.isContentNameFocused=!0,this._modalInfo.contentNameMessage=p.CONTENT_NAME_EMPTY_TOOLTIP)},e.prototype.calcIcon=function(){if(!this.isFolder())return i.file_icon(this.contentInfo().name())+"_32";if(!this.contentInfo().pathExists())return"folder_user_32";var e=this._metadata&&this._metadata.permissions.edit_contents&&this._metadata.permissions.edit_contents.allow===!1;return i.folder_icon({isTeamFolder:this.isTeamSharedFolder(),isShared:this.contentInfo().isSharedFolder(),isViewOnly:Boolean(e),isInTeamFolderTree:Boolean(this.isFolderInsideTeamFolderTree())})},e.prototype.setMetadata=function(e){l.TRUELINK.TRUELINK_UI[this._user.id]&&(this._isUpdatingLinkAudience&&(e=e.setIn(["link_metadata","current_audience"],this._linkMetadata.current_audience)),this._isLinkMetadataLoaded=!0,e.link_metadata&&(this._linkMetadata=e.link_metadata));var n=e.permissions||this._metadata&&this._metadata.permissions;this._metadata=e.set("permissions",n),this._modalInfo&&(e.shared_folder_id&&(this._modalInfo.contentInfo=this._modalInfo.contentInfo.setNsId(e.shared_folder_id)),this._modalInfo.icon=this.calcIcon()),t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,c.getContentIdsForMetadata(e),this)},e.prototype.isViewerNoCommentEnabled=function(){return this.isFolder()?this.isNoCommentEnabledForFolders():this.isNoCommentEnabledForLinks()},e.prototype.hasNonOwnerMembers=function(){var e=this._members&&this._members.getMemberCount();if(!e)return!1;if(1===e&&1===this._members.users.count()){return this._members.users.first().account_id!==this._user.account_id}return!0},e.prototype.memberCountWithRecipients=function(){return(this.memberCounts()&&this.memberCounts().total_unique_users||this.members()&&this.members().getMemberCount()||0)+u.getMemberCountForTokens(this.recipientTokens())},e.prototype.getInitialProps=function(){return this._initialProps},e.prototype.areMembersFullyLoaded=function(){return this._areMembersFullyLoaded},e.prototype.areSharingPrefsLoaded=function(){return this._areSharingPrefsLoaded},e.prototype.banner=function(){return this._modalInfo.banner},e.prototype.canChangeOptions=function(){return Boolean(this._metadata&&this._metadata.permissions.change_options&&this._metadata.permissions.change_options.allow)},e.prototype.canInviteEditor=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_editor&&this._metadata.permissions.invite_editor.allow)},e.prototype.canInviteViewer=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_viewer&&this._metadata.permissions.invite_viewer.allow)},e.prototype.canInviteViewerNoComment=function(){return Boolean(this._metadata&&this._metadata.permissions.invite_viewer_no_comment&&this._metadata.permissions.invite_viewer_no_comment.allow)},e.prototype.canMakeViewerNoComment=function(){return this.isViewerNoCommentEnabled()},e.prototype.canRelinquishMembership=function(){return Boolean(this._metadata&&this._metadata.permissions.relinquish_membership&&this._metadata.permissions.relinquish_membership.allow)},e.prototype.canShareLink=function(){return!this.isTeamSharedFolder()&&this.contentInfo().pathExists()&&this.contentInfo().isMounted()},e.prototype.canUnshareFile=function(){return Boolean(this._metadata&&this._metadata.permissions.unshare&&this._metadata.permissions.unshare.allow)},e.prototype.canUnshareFolder=function(){return Boolean(this._metadata&&this._metadata.permissions.unshare&&this._metadata.permissions.unshare.allow)},e.prototype.canUpdateConfidentiality=function(){return Boolean(this._metadata&&this._metadata.permissions.update_confidentiality&&this._metadata.permissions.update_confidentiality.allow)},e.prototype.contactsError=function(){return u.validateContacts(this.recipientTokens(),this._user,this.ownerTeam(),this.folderPolicy(),this.isTeamSharedFolder(),this.isFolderInsideTeamFolderTree(),this.memberCountWithRecipients())},e.prototype.contentId=function(){return this._modalInfo.contentInfo.id},e.prototype.contentInfo=function(){return this._modalInfo.contentInfo},e.prototype.contentNameMessage=function(){return this._modalInfo.contentNameMessage},e.prototype.contentNameMessageLevel=function(){return this._modalInfo.contentNameMessageLevel},e.prototype.expSubgrowthBizTeamsManageAccessInvite=function(){if(this.getInitialProps().experiments)return this.getInitialProps().experiments.expSubgrowthBizTeamsManageAccessInvite},e.prototype.expSubgrowthProOverquotaCreateSharedLink=function(){return this._expSubgrowthProOverquotaCreateSharedLink},e.prototype.fetchingMembersRequest=function(){return this._fetchingMembersRequest},e.prototype.fetchingMetadataPromise=function(){return this._fetchingMetadataPromise},e.prototype.filePolicy=function(){return this._metadata&&this._metadata.file_policy},e.prototype.folderPolicy=function(){return this._metadata&&this._metadata.policy},e.prototype.foldersToUnshare=function(){return this._sharingPaywallInfo&&this._sharingPaywallInfo.foldersToUnshare},e.prototype.fqPath=function(){return this._modalInfo.contentInfo.displayPath()},e.prototype.hasChangedLinkAudience=function(){return this._modalInfo&&this._modalInfo.hasChangedLinkAudience},e.prototype.hasChangedSharingSettings=function(){return this._modalInfo&&this._modalInfo.hasChangedSharingSettings},e.prototype.hasDisplayableMembers=function(){return this._hasDisplayableMembers},e.prototype.hasParentSharedFolder=function(){return this._metadata&&this._metadata.is_inside_team_folder},e.prototype.icon=function(){return this._modalInfo.icon},e.prototype.initialRecipientRawInput=function(){return this._modalInfo.initialRecipientRawInput},e.prototype.initialRecipientTokens=function(){return this._modalInfo.initialRecipientTokens},e.prototype.isAddMessageAsCommentChecked=function(){return Boolean(this._sharingPrefs.add_message_as_comment_checked)},e.prototype.isAddMessageAsCommentHelpShown=function(){return Boolean(this._sharingPrefs.add_message_as_comment_help_shown)},e.prototype.isNoCommentEnabledForFolders=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_shared_folders)},e.prototype.isNoCommentEnabledForLinks=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_content_links)},e.prototype.isNonUserRelativeContext=function(){return this.getInitialProps().isInContentManager},e.prototype.isFolder=function(){return this._modalInfo.contentInfo.isFolder()},e.prototype.isConfidentialFolder=function(){return Boolean(this._metadata&&this._metadata.is_confidential)},e.prototype.isContentNameFocused=function(){return this._modalInfo.isContentNameFocused},e.prototype.isFolderInsideTeamFolderTree=function(){return this._metadata&&this._metadata.is_inside_team_folder},e.prototype.isInsideSharedFolder=function(){return Boolean(this._metadata&&this._metadata.parent_shared_folder_id||this.contentInfo().isInSharedFolder())},e.prototype.isLinkMetadataLoaded=function(){return this._isLinkMetadataLoaded},e.prototype.isMetadataLoaded=function(){return Boolean(this._metadata)},e.prototype.isOwner=function(){return Boolean(this._metadata&&this._metadata.access_type===l.ACCESS_LEVEL.OWNER)},e.prototype.isPaywallOn=function(){return Boolean(this._sharingPaywallInfo&&this._sharingPaywallInfo.is_on)},e.prototype.isUserOnOwnerTeam=function(){return Boolean(this._metadata&&this._metadata.owner_team&&this._metadata.owner_team.id===this._user.team_dbtid)},e.prototype.isTeamPolicyLoaded=function(){return this._isTeamPolicyLoaded},e.prototype.isTeamSharedFolder=function(){return Boolean(this._metadata&&this._metadata.is_team_folder||this.contentInfo().isTeamSharedFolder())},e.prototype.isTokenizerEmpty=function(){return 0===this.recipientRawInput().length&&0===this.recipientTokens().length},e.prototype.isSharingPaywallInfoLoaded=function(){return this._modalInfo.isSharingPaywallInfoLoaded},e.prototype.isUpdatingLinkAudience=function(){return this._isUpdatingLinkAudience},e.prototype.linkMetadata=function(){return this._linkMetadata},e.prototype.linkOnlyReason=function(){return this._modalInfo.linkOnlyReason},e.prototype.memberCounts=function(){return this._memberCounts},e.prototype.members=function(){return this._members},e.prototype.metadata=function(){return this._metadata},e.prototype.ownerTeam=function(){return this._metadata&&this._metadata.owner_team},e.prototype.parentSharedFolderId=function(){return this._metadata&&this._metadata.parent_shared_folder_id},e.prototype.paywallKeepACopy=function(){return Boolean(this._sharingPaywallInfo&&this._sharingPaywallInfo.keepACopy)},e.prototype.paywallMax=function(){return this._sharingPaywallInfo&&this._sharingPaywallInfo.max_owned_shared_folders},e.prototype.paywallNumOwned=function(){return this._sharingPaywallInfo&&this._sharingPaywallInfo.num_shared_folders_owned},e.prototype.paywallGrandfatherModal=function(){return this._sharingPaywallInfo&&this._sharingPaywallInfo.grandfather_modal},e.prototype.pendingMemberAction=function(){return this._modalInfo.pendingMemberAction},e.prototype.permissions=function(){return this._metadata&&this._metadata.permissions},e.prototype.recipientAccess=function(){return this._modalInfo.recipientAccess},e.prototype.recipientMessage=function(){return this._modalInfo.recipientMessage},e.prototype.recipientRawInput=function(){return this._modalInfo.recipientRawInput},e.prototype.recipientTokens=function(){return this._modalInfo.recipientTokens},e.prototype.shareAsConfidential=function(){return Boolean(this.getInitialProps().shareAsConfidential)},e.prototype.shareFolderPromise=function(){return this._shareFolderPromise},e.prototype.shouldBlockMemberListOnPassLoad=function(){return this._shouldBlockMemberListOnPassLoad},e.prototype.teamPolicy=function(){return this._teamPolicy},e.prototype.uiMode=function(){return this._modalInfo.uiMode},e})();t.SharingInfo=m;var f=(function(){function e(e){this.banner=p.BANNERS.NO_MEMBERS,this.canRelinquishMembership=!1,this.contentNameMessageLevel=p.CONTENT_NAME_MESSAGE_LEVELS.INFO,this.hasChangedLinkAudience=!1,this.hasChangedSharingSettings=!1,this.initialRecipientRawInput="",this.initialRecipientTokens=[],this.isContentNameFocused=!1,this.isSharingPaywallInfoLoaded=!1,this.pendingMemberAction=o.Set(),this.recipientAccess=l.ACCESS_LEVEL.READER,this.recipientMessage="",this.recipientRawInput="",this.recipientTokens=[],this.shareAsConfidential=!1,this.uiMode=p.MODES.MEMBERSHIP,this.contentInfo=e,e.isFolder()&&(this.recipientAccess=l.ACCESS_LEVEL.WRITER)}return e})()}),define("modules/clean/sharing/stores/sharing_info_util",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContentIdsForMetadata=function(e){return[e.shared_folder_id,e.id,e.path_lower].filter(Boolean)},t.getContentIdsForContentInfo=function(e){var t=[]
;return e.isSharedFolder()?t.push(e.sharedFolderId()):(e.extras.fileId&&t.push(e.extras.fileId),e.extras.nsId&&e.extras.nsPath&&t.push("ns:"+e.nsId()+e.nsPath())),e.displayPath()&&t.push(e.displayPath()),t}}),function(){define("modules/clean/sharing/ui_util",["external/react","external/underscore","modules/clean/ajax","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/filepath","modules/clean/previews/util","modules/clean/react_format","modules/clean/react/pass/store","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/gating_util","modules/constants/python","modules/core/i18n","modules/core/notify","modules/core/uri","modules/core/user_i18n"],function(e,t,n,o,i,r,s,a,l,c,u,p,d,h,_,m,f,v,g){var y,E,S,b,w,C,T,A,I,P,R,O,N,L,M,k,F,x,D,U,B,H,V,W,q,z,j,K,G,Y,Q,Z,X,J,$,ee,te,ne,oe,ie;return I=o.ShareTibEventLogger,y=i.AppError,b=r.ContactTokenState,V=a.file_icon,q=a.folder_icon,T=a.ICON_SIZES,X=a.normalize,J=c.reactFormat,C=p.GroupMembershipInfo,d.ACCESS_LEVEL,O=d.TRUELINK,w=h.GoldenGate,R=_.TRADEMARK_PLUS,B=e.DOM,$=m.i18n_default_project("sharing"),N=$._,ne=$.ungettext,P={},A={SHARED_FILE:"shared-file",SHARED_FOLDER:"shared-folder",SHARED_LINK:"shared-link",LEGACY_TEAM_FOLDER:"team-folder",PUBLIC:"public",NO_SHARE:"no-share"},S={SINGLE_INVALID:N("The email address you entered is invalid"),SINGLE_OUT_OF_TEAM:N("This person isn’t on your Dropbox team"),SINGLE_TOO_MANY_MEMBERS:N("Can’t share with this many people"),GENERAL_INVALID:N("One or more names or email addresses you entered are invalid."),GENERAL_OUT_OF_TEAM:N("One or more invitees are outside your Dropbox team."),GENERAL_TOO_MANY_MEMBERS:J(N("This will put the folder over its %(member_limit)s-member limit. <a>Learn more.</a>",{comment:"member_limit will be a number greater than 200"}),{member_limit:w.SHARING_TOTAL_LIMIT,a:B.a({href:"/help/9292",target:"_blank",key:"help_center_article"})}),NONGROUP_INVITEE:N("Only groups can be added to team folders.")},E={ERROR:"error",WARN:"warn"},L=function(e,t){return t.displayName().toLowerCase()},M=function(e){return function(t,n){var o,i,r,s,a,l;return s=n.memberId()===t,i=n instanceof C?"0":"1",a=n.displayName().toLowerCase(),o=function(e){var t,n;return t=String(Number.MAX_SAFE_INTEGER-Number(e)),n=String(Number.MAX_SAFE_INTEGER).length,t.length<n&&(t=""+Array(n-t.length+1).join("0")+t),t},r=null!=n.account_id&&e.has(n.account_id),l=r&&s?"a":r?"b":null!=n.time_last_seen?"c"+o(n.time_last_seen):"d",""+i+l+a}},Z=function(e,t,n){var o;return o=n?M(t):L,function(t,n){var i,r;return i=o(e.account_id,t),r=o(e.account_id,n),i<r?-1:i===r?0:1}},ie=function(e,t,n,o,i,r,s){var a,l,c,u,p,d,h,_,m,f;for(l=null,c=null,f=0,u=0,p=e.length;u<p;u++){if(a=e[u],h=oe(a,t,n,o,i,r,0),m=h.state,d=h.msg,m===b.invalid){if(l=E.ERROR,d===S.SINGLE_INVALID){c=S.GENERAL_INVALID;break}d===S.SINGLE_OUT_OF_TEAM&&(c=S.GENERAL_OUT_OF_TEAM),d===S.NONGROUP_INVITEE&&(c=S.NONGROUP_INVITEE)}m===b.warn&&d===S.SINGLE_OUT_OF_TEAM&&(l||(l=E.WARN,c=S.GENERAL_OUT_OF_TEAM)),f+=null!=(_=a.group_size)?_:1}return ee(t,i,r)&&e.length>0&&l!==E.ERROR&&s>w.SHARING_TOTAL_LIMIT&&(l=E.ERROR,c=S.GENERAL_TOO_MANY_MEMBERS),{level:l,message:c}},oe=function(e,t,n,o,i,r,s){var a;if(a={state:b.ok},i&&!e.group_id)return{state:b.invalid,msg:S.NONGROUP_INVITEE};if(ee(t,i,r)&&s>w.SHARING_TOTAL_LIMIT)return{state:b.invalid,msg:S.SINGLE_TOO_MANY_MEMBERS};if(e.invalid)a={state:b.invalid,msg:S.SINGLE_INVALID};else{if(e.email===t.email)return a;null!=n&&t.is_team&&e.dbx_team_id!==n.id&&!e.group_id&&(a={msg:S.SINGLE_OUT_OF_TEAM},"team"===(null!=o?o.member_policy:void 0)||"team"===(null!=o?o.resolved_member_policy:void 0)?a.state=b.invalid:a.state=b.warn)}return a},ee=function(e,t,n){return!e.is_cdm_member&&(t||n)},k=function(e){switch(e){case"reader":return"viewer";case"writer":return"editor";case"owner":return"owner";default:return"default"}},U=function(e){var t,n,o;return t=e.displayName(),{access_type:k(e.access_type),display_name:t,initials:null!=(n=e.initials)?n:g.getInitials(t),photo_url:null!=(o=e.account)?o.profile_photo_url:void 0,user_id:e.memberId()}},x=function(e){return{access_type:k(e.access_type),gid:e.memberId(),is_automatic:"team"===e.group_type,name:e.displayName(),num_users:e.member_count}},D=function(e){return{access_type:k(e.access_type),invitation_id:e.memberId(),email_or_fbname:e.displayName()}},Q=function(e,n,o,i){return null==i&&(i={}),I.log(n,o,e.extras.origin,t.extend(i,{file_id:e.extras.fileId,fq_path:e.displayPath(),ns_id:e.isSharedFolder()?e.sharedFolderId():void 0,modal_session_id:e.extras.modalSessionId}))},F={access_error:N("You don’t have access to this content."),email_unverified:N("You haven’t verified your email. Check your email and try again."),bad_member:N("You entered an invalid name or email address."),cant_share_outside_team:N("Your team settings don’t allow sharing outside your team."),too_many_members:N("You’re sharing with too many people."),too_many_pending_invites:N("You’re sharing with too many people."),rate_limit:N("You’ve hit the limit of invites for today. Try again later."),insufficient_plan:N("You need a Dropbox %(trademark_plus)s or Business account to do this.").format({trademark_plus:R}),team_folder:N("You can’t add members to a team folder. Contact your team admin."),no_permission:N("You don’t have permission to do this. Contact the owner.")},z=function(e){return e.message?e.message:e instanceof y&&e.error[".tag"]&&F[e.error[".tag"]]?F[e.error[".tag"]]:N("There was a problem completing this request.")},K=function(e,t,n,o){var i,r,a,l,c,u,p,d;if(a=e.filter(function(e){var t;return(t=e.type)===s.EMAIL||t===s.DBX_ID}),i=e.filter(function(e){return e.type===s.NEW_STYLE_GROUP}),(n||o)&&(r=i.map(function(e){var t;return null!=(t=e.group_size)?t:1}),p=function(e,t){return e+t},d=r.reduce(p,0),d+=a.length,d>=w.SHARING_WARN_THRESHOLD))return N("This change may take a while.");if(l={content_name:t,group_name:null!=(c=i[0])?c.name:void 0,num_groups:i.length,num_people:a.length,recipient:null!=(u=a[0])?u.email:void 0},a.length>0&&0===i.length)return n?ne("Added %(recipient)s to “%(content_name)s”.","Added %(num_people)s people to “%(content_name)s”.",a.length).format(l):o?ne("Securely added %(recipient)s to “%(content_name)s”.","Securely added %(num_people)s people to “%(content_name)s”.",a.length).format(l):ne("Securely shared “%(content_name)s” with %(recipient)s.","Securely shared “%(content_name)s” with %(num_people)s people.",a.length).format(l);if(0===a.length&&i.length>0)return n?ne("Added %(group_name)s to “%(content_name)s”.","Added  %(num_groups)s groups to “%(content_name)s”.",i.length).format(l):o?ne("Securely added %(group_name)s to “%(content_name)s”.","Securely added  %(num_groups)s groups to “%(content_name)s”.",i.length).format(l):ne("Securely shared “%(content_name)s” with %(group_name)s.","Securely shared “%(content_name)s” with %(num_groups)s groups.",i.length).format(l);if(1===a.length&&i.length>0)return n?ne("Added %(recipient)s and 1 group to “%(content_name)s”.","Added %(recipient)s and %(num_groups)s groups to “%(content_name)s”.",i.length).format(l):o?ne("Securely added %(recipient)s and 1 group to “%(content_name)s”.","Securely added %(recipient)s and %(num_groups)s groups to “%(content_name)s”.",i.length).format(l):ne("Securely shared “%(content_name)s” with %(recipient)s and 1 group.","Securely shared “%(content_name)s” with %(recipient)s and %(num_groups)s groups.",i.length).format(l);if(a.length>1&&i.length>0)return n?N("Shared “%(content_name)s.”").format(l):N("Securely shared “%(content_name)s.”").format(l);throw"Logic error: There should be at least 1 recipient"},W=function(e){var t;return q({isShared:e.isSharedFolder(),isDeleted:null==e.path_lower,isInTeamFolderTree:null!=e.parent_shared_folder_id,isTeamFolder:e.is_team_folder,isViewOnly:null!=(null!=(t=e.permissions)?t.edit_contents:void 0)&&!e.permissions.edit_contents.allow})},H=function(e){return V(e.name,{size:T.LARGE})},j=function(e){var t,n,o,i,r,s;return i=e.isLimitedTeam,t=e.containingFolder,n=e.filenameToSelect,o=e.isCDM,i?v({path:"/preview_admin_console"}):(r=o?"content":"team_folders",t=X(t)||"",n&&(s=[t,n].join("/")),v({path:"/team/admin/"+r+"/home"+t,query:s?{select:s}:void 0}))},Y=function(e,t){var n;return n=X(t),[n,e].join("/")},G=function(e){return null==e?0:e.map(function(e){return e.group_size||1}).reduce(function(e,t){return e+t},0)},te=function(e,t){var n,o;return n=l.is_pass_ga_receive_enabled(e)&&(null!=(o=u.getPassPermissions(t))?o.canReadPresence:void 0),n||l.is_pass_enabled(e)||O.TRUELINK_UI[e.id]},{apiInviteeMemberToAvatarInfo:D,apiGroupMemberToAvatarInfo:x,apiUserMemberToAvatarInfo:U,CONTACT_ERROR_LEVEL:E,CONTACT_ERROR_MESSAGES:S,fileIconForMetadata:H,folderIconForMetadata:W,makeMemberSortCmp:Z,GoldenGate:w,SharingExperiments:P,SHARE_UI_TYPE:A,genAddMemberErrorMessage:z,genShareSuccessMessage:K,genContentManagerBridgeUri:j,getMemberCountForTokens:G,getNewFolderPathFromContentName:Y,logTiburonEvent:Q,shouldEnforceMemberLimits:ee,showFileSettings:te,validateContact:oe,validateContacts:ie}})}.call(this),define("modules/clean/sharing/views/constants",["require","exports","external/underscore","modules/core/i18n"],function(e,t,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o.i18n_default_project("sharing")._;t.MODES={LINK_ONLY:"link-only",LOADING:"loading",MEMBERSHIP:"membership",SHARE:"share",SHARE_SENDING:"share-sending"};var r;(function(e){e[e.NO_MEMBERS=0]="NO_MEMBERS",e[e.INPUT_CONTENT_NAME=1]="INPUT_CONTENT_NAME"})(r=t.BANNERS||(t.BANNERS={}));var s;(function(e){e[e.INFO=0]="INFO",e[e.ERROR=1]="ERROR"})(s=t.CONTENT_NAME_MESSAGE_LEVELS||(t.CONTENT_NAME_MESSAGE_LEVELS={})),t.LINK_ONLY_REASON={INSIDE_SHARED_FOLDER:"inside_shared_folder",CONTAINS_SHARED_FOLDER:"contains_shared_folder",LINKS_PAGE:"links_page"},t.CONTENT_NAME_EMPTY_TOOLTIP=i("Name your shared folder"),t.MODE_VALUES=n.values(t.MODES),t.BANNER_VALUES=n.values(r),t.CONTENT_NAME_MESSAGE_LEVEL_VALUES=n.values(s)}),function(){define("modules/clean/sharing/views/hover_close_button",["external/classnames","external/react","external/underscore","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i){var r,s,a;return r=i.i18n_default_project("sharing")._,s=t.createElement,a=t.DOM,t.createClass({displayName:"HoverCloseButton",propTypes:{className:t.PropTypes.string},getInitialState:function(){return{hover:!1}},render:function(){var t;return t={className:e("c-borderless-button",this.props.className),onMouseOver:(function(e){return function(){return e.setState({hover:!0})}})(this),onMouseOut:(function(e){return function(){return e.setState({hover:!1})}})(this)},a.button(n.extend(t,n.omit(this.props,Object.keys(t))),s(o,{group:"web",name:this.state.hover?"xclose":"xclose_light_gray",alt:r("Close Modal")}))}})})}.call(this),function(){define("modules/clean/teams/team_assume_user_personal_locked_modal",["external/react","modules/core/i18n","modules/clean/react/modal"],function(e,t,n){var o,i,r,s,a;return r=t._,i=n.Modal,a=e.DOM,s=e.createElement,o=e.createClass({displayName:"AssumePersonalLockedModal",statics:{show:function(e){return i.showInstance(s(o,e))}},propTypes:{displayName:e.PropTypes.string,teamName:e.PropTypes.string},_close:function(e){return e.preventDefault(),i.close()},_getModalProps:function(){return{title:r("Personal account not accessible"),acceptButtonText:r("Close"),dismissButtonText:null,onAccept:this._close}},render:function(){return s(i,this._getModalProps(),a.div({className:"team-assume-user-modal"},r("%(display_name)s’s personal account isn’t managed by the %(team_name)s team, so its contents aren’t accessible to admins.").format({display_name:this.props.displayName,team_name:this.props.teamName})))}}),{AssumePersonalLockedModal:o}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/tokenizer",["external/classnames","external/react","external/react-dom","jquery","external/underscore","modules/clean/keycode","modules/clean/typeahead"],function(t,n,o,i,r,s,a){var l,c,u,p,d;return l=s.KeyCode,p=a.TypeaheadSelector,d=n.DOM,c=n.createClass({displayName:"Token",propTypes:{className:n.PropTypes.string,data:n.PropTypes.any,onRemove:n.PropTypes.func},render:function(){var e;return e={"tokenizer-token":!0},e[this.props.className]=!0,d.a(i.extend({tabIndex:-1},this.props,{className:t(e)}),String(this.props.data),this._makeCloseButton())},_makeCloseButton:function(){return this.props.onRemove?d.span({className:"tokenizer-token-close",onClick:(function(e){return function(){return e.props.onRemove(),!1}})(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),u=n.createClass({displayName:"Tokenizer",propTypes:{customClass:n.PropTypes.string,dataSource:n.PropTypes.object.isRequired,initialInputText:n.PropTypes.string,logSearchBegin:n.PropTypes.func,logSearchComplete:n.PropTypes.func,logTokenChangeEvent:n.PropTypes.func,onContentsChange:n.PropTypes.func,onTokensAdd:n.PropTypes.func,onTokenRemove:n.PropTypes.func,placeholderText:n.PropTypes.string,populatedTokenData:n.PropTypes.array,renderToken:n.PropTypes.func.isRequired,renderTokenHover:n.PropTypes.func,renderInput:n.PropTypes.func.isRequired,renderSelector:n.PropTypes.func.isRequired,stringTokenizer:n.PropTypes.func.isRequired,tokenSpacing:n.PropTypes.number,focusOnMount:n.PropTypes.bool,tabIndex:n.PropTypes.number},getDefaultProps:function(){return{initialInputText:"",renderInput:function(){return d.input()},renderSelector:function(){return n.createElement(p,null)},renderToken:function(e){return n.createElement(c,{data:e})},stringTokenizer:function(e,t){var n,o;return n=e.split(","),o=t?"":n.pop(),{tokens:n,value:o}},tokenSpacing:3,focusOnMount:!1,logSearchBegin:null,logSearchComplete:null}},getInitialState:function(){return this.tokenData=[],this.queryResults=null,{queryResults:this.queryResults,tokenData:this.tokenData,selectedTokenIndex:null,inputWidth:150,numLines:1}},componentDidMount:function(){var e,t;if(setTimeout(this._resizeTokenizerInput,0),o.findDOMNode(this.refs.input).value=this.props.initialInputText,i(o.findDOMNode(this.refs.tokenizer_input)).on("keydown",this._proxyKeys),document.addEventListener("click",this._handleDocumentClick,!1),this.props.focusOnMount&&o.findDOMNode(this.refs.input).focus(),"function"==typeof(e=this.props.dataSource).registerForUpdates&&e.registerForUpdates(this._dataUpdatedCallback),(null!=(t=this.props.populatedTokenData)?t.length:void 0)>0)return this._addTokens(this.props.populatedTokenData,!1,null)},componentWillUnmount:function(){return i(o.findDOMNode(this.refs.tokenizer_input)).off("keydown",this._proxyKeys),document.removeEventListener("click",this._handleDocumentClick,!1)},componentDidUpdate:function(e,t){var n,o;return(null!=(n=this.props.populatedTokenData)?n.length:void 0)!==(null!=(o=e.populatedTokenData)?o.length:void 0)&&this._addTokens(this.props.populatedTokenData,!1,null),this._resizeTokenizerInput()},render:function(){var e,n;return e={"react-tokenizer":!0},null!=this.props.customClass&&(e[this.props.customClass]=null!=this.props.customClass),n={padding:this.props.tokenSpacing,paddingRight:0,maxHeight:this.props.tokenSpacing+3*(this.props.tokenSpacing+29)+14+2},this.state.numLines>3&&(n.overflowY="auto",n.overflowX="visible"),d.div({onClick:this._handleMyClick,className:t(e)},d.div({className:"tokenizer-input",ref:"tokenizer_input",style:n},d.div({className:"token-container",style:{marginLeft:-this.props.tokenSpacing,marginBottom:-this.props.tokenSpacing}},this._renderTokens(),this._renderInput())),this._renderSelector())},serializeInputData:function(){return{tokens:this.tokenData,value:o.findDOMNode(this.refs.input).value}},tokenizeAll:function(){var e,t;return e=o.findDOMNode(this.refs.input),t=this.props.stringTokenizer(e.value,!0).tokens,t.length>0&&this._addTokens(t,!1),e.value="",this.refs.selector.close()},addExternalTokens:function(e){this._addTokens(e,!1,null),this.refs.selector.close()},_getCurrentValue:function(){var e,t,n;return e=o.findDOMNode(this.refs.input),t=this.props.stringTokenizer(e.value),t.tokens,n=t.value,n},queryDataSource:function(t){var n,o,i;return o=(function(n){return function(o){var i,s;return t||(o=null),i=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},s=r.map(n.tokenData,i),o=null!=o?o.filter(function(t){var n;return n=i(t),e.call(s,n)<0}):null}})(this),i=(function(e){return function(n){var i;return n=o(n),e.queryResults=n,e.setState({queryResults:e.queryResults}),"function"==typeof(i=e.props).logSearchComplete?i.logSearchComplete(t,(null!=n?n.length:void 0)||0,!0):void 0}})(this),n=(function(e){return function(n){var i;return t===e._getCurrentValue()&&(n=o(n),n&&n.length&&(e.queryResults=e.queryResults?e.queryResults.concat(n):n,e.setState({queryResults:e.queryResults}))),"function"==typeof(i=e.props).logSearchComplete?i.logSearchComplete(t,(null!=n?n.length:void 0)||0,!1):void 0}})(this),this.props.dataSource.query(t,i,n)},_dataUpdatedCallback:function(){var e,t;if(this.isMounted())return e=Boolean(this.state.queryResults),null!=(t=this.refs.selector)&&"function"==typeof t.reset&&t.reset(),e&&o.findDOMNode(this.refs.input).focus(),this.queryDataSource(o.findDOMNode(this.refs.input).value)},_addTokens:function(t,n,i){var s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b;for(null==n&&(n=!1),null==i&&(i=null),u=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},b=r.map(this.tokenData,u),f=[],p=0,_=t.length;p<_;p++)S=t[p],h=u(S),e.call(b,h)<0&&(f.push(S),b.push(h));for(this.tokenData=this.tokenData.concat(f),this.setState({tokenData:this.tokenData}),"function"==typeof(s=this.props).onTokensAdd&&s.onTokensAdd(f,this),"function"==typeof(a=this.props).onContentsChange&&a.onContentsChange(this.tokenData,null!=(v=o.findDOMNode(this.refs.input))?v.value:void 0),c=n?{search_expr:i,selected_pos:(null!=(g=this.refs.selector)?g.state.selectionIndex:void 0)||0,num_query_results:null!=(y=this.state.queryResults)?y.length:void 0,did_select_suggestion:!0}:{did_select_suggestion:!1},E=[],d=0,m=f.length;d<m;d++)S=f[d],E.push("function"==typeof(l=this.props).logTokenChangeEvent?l.logTokenChangeEvent(S,!1,c):void 0);return E},_addToken:function(e,t,n){return null==t&&(t=!1),null==n&&(n=null),this._addTokens([e],t,n)},removeTokens:function(e){var t,n,i,r,s,a,l,c,u,p,d,h,_,m;for(m=this.state.selectedTokenIndex,_=[],a=0,u=e.length;a<u;a++)r=e[a],h=this.tokenData.indexOf(r),h!==-1&&(m===h?m=null:m>h&&(m-=1),this.tokenData.splice(h,1),_.push(r));for(s=o.findDOMNode(this.refs.input),s.focus(),this._setSelectedToken(m),this.queryResults=null,this.setState({tokenData:this.tokenData,queryResults:this.queryResults}),l=0,p=_.length;l<p;l++)r=_[l],"function"==typeof(t=this.props).onTokenRemove&&t.onTokenRemove(r);for(c=0,d=_.length;c<d;c++)r=_[c],"function"==typeof(n=this.props).logTokenChangeEvent&&n.logTokenChangeEvent(r,!0);return"function"==typeof(i=this.props).onContentsChange?i.onContentsChange(this.tokenData,s.value):void 0},removeToken:function(e){return this.removeTokens([e])},replaceTokens:function(e){var t,n,i,s;if(i=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},n=function(e){var t,n;return t=e[0],n=e[1],i(t)===i(n)},e.length!==this.tokenData.length||!r.every(r.zip(this.tokenData,e),n))return this.tokenData=e,this.setState({tokenData:e}),"function"==typeof(t=this.props).onContentsChange?t.onContentsChange(this.tokenData,null!=(s=o.findDOMNode(this.refs.input))?s.value:void 0):void 0},_renderTokens:function(){var e,o,i,r,s,a,l,c,u,p,d,h;for(p=[],l=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},u=this.state.tokenData,s=a=0,c=u.length;a<c;s=++a)i=u[s],h=this.props.renderToken(i),d=this.state.selectedTokenIndex===s,r="function"==typeof(e=this.props).renderTokenHover?e.renderTokenHover(i):void 0,o=[{selected:d,"c-title-bubble":null!=r,"c-title-bubble--s":null!=r}],p.push(n.cloneElement(h,{ref:"token"+s,key:"token"+l(i),style:{margin:"0 0 "+this.props.tokenSpacing+"px "+this.props.tokenSpacing+"px"},className:t(o,h.props.className),"data-title":r,onClick:this._setSelectedToken.bind(this,s),onRemove:this.removeToken.bind(this,i),tokenSpacing:this.props.tokenSpacing}));return p},_renderSelector:function(){return n.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._onSelect,onClose:this._clearResults})},_renderInput:function(){var e;return e=this.state.tokenData.length?"":this.props.placeholderText,n.cloneElement(this.props.renderInput(),{ref:"input",style:{width:this.state.inputWidth,marginLeft:this.props.tokenSpacing,marginBottom:this.props.tokenSpacing},onChange:this._textUpdated,placeholder:e,tabIndex:this.props.tabIndex,onClick:this._setSelectedToken.bind(this,null)})},_getTokenizerInput:function(){return this.refs.tokenizer_input},_getTokenComponents:function(){var e;return function(){var t,n,o;for(o=[],e=t=0,n=this.state.tokenData.length;0<=n?t<n:t>n;e=0<=n?++t:--t)o.push(this.refs["token"+e]);return o}.call(this).filter(function(e){return e})},_setSelectedToken:function(e){return null!=e?(o.findDOMNode(this.refs["token"+e]).focus(),this.refs.selector.close()):o.findDOMNode(this.refs.input).focus(),this.setState({selectedTokenIndex:e})},_resizeTokenizerInput:function(){var e,t,n,i,r,s,a,l,c,u,p,d,h,_;if(i=function(e){var t;return null!=(t=o.findDOMNode(e))?t.clientWidth:void 0},t=80,d=this._getTokenizerInput(),h=i(d),null!=h){for(n=this.props.tokenSpacing+2,e=this.props.tokenSpacing,l=0,_=this._getTokenComponents(),c=1,s=0,a=_.length;s<a;s++)u=_[s],p=i(u)+n,l+p+e>h&&(c+=1,l=0),l+=p;return r=h-l-e-2,r<t&&(c+=1,r=h-e),r!==this.state.inputWidth&&this.setState({inputWidth:r}),c!==this.state.numLines?this.setState({numLines:c}):void 0}},_onSelect:function(e){var t;return t=o.findDOMNode(this.refs.input),t.focus(),this._addToken(e,!0,t.value),t.value="",this.queryResults=null,this.setState({queryResults:this.queryResults})},_handleMyClick:function(e){var t;return"function"==typeof(t=e.nativeEvent).stopImmediatePropagation?t.stopImmediatePropagation():void 0},_handleDocumentClick:function(e){return this.refs.selector.close()},_proxyKeys:function(e){var t;if(this._shouldListenForTokenNavigation())switch(t=this.state.selectedTokenIndex,e.keyCode){case l.BACKSPACE:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):this.removeToken(this.state.tokenData[t]));case l.LEFT:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):t>0&&this._setSelectedToken(t-1));case l.RIGHT:if(null!==t)return void(t>=this.state.tokenData.length-1?this._setSelectedToken(null):this._setSelectedToken(t+1));break;case l.DELETE:if(null!==t)return void this.removeToken(this.state.tokenData[t])}if(this.refs.selector.onKeyDown(e),!e.isDefaultPrevented())return e.keyCode===l.TAB&&""!==o.findDOMNode(this.refs.input).value?(this.tokenizeAll(),e.preventDefault()):void 0},_shouldListenForTokenNavigation:function(){var e;return!!this.state.tokenData.length&&(e=o.findDOMNode(this.refs.input),0===e.selectionStart&&0===e.selectionEnd)},_textUpdated:function(){var e,t,n,i,r,s,a;return n=o.findDOMNode(this.refs.input),i=n.value,r=this.props.stringTokenizer(i),s=r.tokens,a=r.value,"function"==typeof(e=this.props).logSearchBegin&&e.logSearchBegin(a),a!==i&&(n.value=a,a||this.refs.selector.close()),s.length>0?this._addTokens(s,!1):"function"==typeof(t=this.props).onContentsChange&&t.onContentsChange(this.tokenData,a),this.queryDataSource(a)},_clearResults:function(){return this.queryResults=null,this.setState({queryResults:this.queryResults})}}),{Token:c,Tokenizer:u}})}.call(this),function(){define("modules/clean/typeahead",["external/classnames","external/react","external/react-dom","external/underscore","modules/clean/fuzzy","modules/clean/keycode","require"],function(e,t,n,o,i,r,s){var a,l,c,u,p,d;return c=r.KeyCode,d=t.DOM,l=(function(){function e(e){this.local=(null!=e?e:{}).local}return e.prototype.filterAndSort=function(e){return i.filter(e,this.local)},e.prototype.query=function(e,t){var n;return n=o.map(this.filterAndSort(e),function(e){return e.original}),t(n)},e})(),p={getInitialState:function(){return{selectionIndex:0}},getOptions:function(){var e;return this.props.queryOptions?(e=this.props.maxVisible||this.props.queryOptions.length,this.props.queryOptions.slice(0,e)):[]},renderOptions:function(){var n,o,i,r,s,a,l,c,u;for(u=[],c=this.getOptions(),s=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},r=i=0,a=c.length;i<a;r=++i)o=c[r],n={selected:this.state.selectionIndex===r,"typeahead-option":!0,"u-pad-xs":!0},l=this.renderOption(o),u.push(t.cloneElement(l,{className:e(n,l.props.className),key:"option"+s(o),onMouseEnter:this._hover.bind(this,r),onClick:this.onSelect.bind(this,o)}));return u},onSelect:function(e){return this.props.onSelect(e),this.reset()},renderOption:function(e){return this.props.renderQueryOption(e)},onKeyDown:function(e){switch(e.keyCode){case c.UP:return this._navigate(-1),e.preventDefault();case c.DOWN:return this._navigate(1),e.preventDefault();case c.ENTER:return this._selectSelectionIndex(e);case c.ESC:if(Boolean(this.props.queryOptions))return this.close(),e.preventDefault();break;case c.TAB:return this._selectSelectionIndex(e);default:return this.reset()}},_selectSelectionIndex:function(e){var t,n;if(n=this.getOptions(),n.length&&(t=this.state.selectionIndex,t!==-1))return this.onSelect(n[t]),e.preventDefault()},reset:function(){return this._changeSelectionIndex(0)},close:function(){var e;return"function"==typeof(e=this.props).onClose&&e.onClose(),this.reset()},_hover:function(e){return this._changeSelectionIndex(e)},_navigate:function(e){var t,n,o;if(n=this.getOptions().length)return t=this.state.selectionIndex+e,o=n+1,t<-1?t+=o:t>=n&&(t-=o),this._changeSelectionIndex(t)},_changeSelectionIndex:function(e){return e!==this.state.selectionIndex&&"function"==typeof this.onSelectionIndexChange&&this.onSelectionIndexChange(e),this.setState({selectionIndex:e})}},a=t.createClass({displayName:"Autocomplete",propTypes:{customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,dataSource:t.PropTypes.object.isRequired,onBlur:t.PropTypes.func,onSelect:t.PropTypes.func,onChange:t.PropTypes.func,placeholder:t.PropTypes.string,renderCompletionText:t.PropTypes.func.isRequired,renderInput:t.PropTypes.func.isRequired,renderSelector:t.PropTypes.func.isRequired,value:t.PropTypes.string,name:t.PropTypes.string,disabled:t.PropTypes.bool},getDefaultProps:function(){return{value:"",maxVisible:7,onBlur:function(){},onSelect:function(e){},onChange:function(e){},renderCompletionText:function(e){return String(e)},renderInput:function(){return d.input()},renderSelector:function(){return t.createElement(u)},disabled:!1}},getInitialState:function(){return{queryResults:null,value:this.props.value,focus:!1}},render:function(){var t;return t={},t[this.props.customClass]=null!=this.props.customClass,d.div({className:e(t),onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave},this._renderInput(),this._renderSelector())},_onMouseOver:function(){return this.setState({focus:!0})},_onMouseLeave:function(){return this.setState({focus:!1})},_onBlur:function(){if(this.props.onBlur(),!this.state.focus)return this._clearResults()},_onFocus:function(){return this._queryDataSource(this.state.value),this.refs.selector.reset()},_renderInput:function(){var e;return e=this.props.renderInput(),t.cloneElement(e,{ref:"input",onChange:(function(t){return function(n){return null!=e.props.onChange&&e.props.onChange(n),t._inputChanged(n)}})(this),onKeyDown:(function(t){return function(n){return null!=e.props.onKeyDown&&e.props.onKeyDown(n),t._proxyKeys(n)}})(this),onBlur:(function(t){return function(n){return null!=e.props.onBlur&&e.props.onBlur(n),t._onBlur(n)}})(this),onFocus:(function(t){return function(n){return null!=e.props.onFocus&&e.props.onFocus(n),t._onFocus(n)}})(this),placeholder:this.props.placeholder,value:this.state.value,name:this.props.name,autoComplete:"off",disabled:this.props.disabled})},_renderSelector:function(){return t.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._autocomplete,onClose:this._clearResults,maxVisible:this.props.maxVisible})},_inputChanged:function(e){var t;return t=e.target.value,this.setState({value:e.target.value}),this.props.onChange(t),this._queryDataSource(t),this.refs.selector.reset()},_getCurrentValue:function(){return n.findDOMNode(this.refs.input).value},_queryDataSource:function(e){var t,n;return n=(function(e){return function(t){return e.queryResults=t,e.setState({queryResults:e.queryResults})}})(this),t=(function(t){return function(o){var i;if(e===t._getCurrentValue()&&o&&o.length)return i=t.queryResults?t.queryResults.concat(o):o,n(i)}})(this),this.props.dataSource.query(e,n,t)},_proxyKeys:function(e){return this.refs.selector.onKeyDown(e)},_autocomplete:function(e){var t;return t=n.findDOMNode(this.refs.input),t.focus(),e=this.props.renderCompletionText(e),this.setState({value:e}),this.props.onSelect(e),this._clearResults()},_clearResults:function(){return this.queryResults=null,this.setState({queryResults:this.queryResults})},componentWillReceiveProps:function(e){return this.setState({value:e.value})}}),u=t.createClass({displayName:"TypeaheadSelector",mixins:[p],propTypes:{customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,onClose:t.PropTypes.func.isRequired,onSelect:t.PropTypes.func.isRequired,queryOptions:t.PropTypes.array,renderQueryOption:t.PropTypes.func.isRequired},getDefaultProps:function(){return{maxVisible:7,onClose:function(){},onSelect:function(e){},renderQueryOption:function(e){return d.li({},String(e))}}},render:function(){var t;return this.getOptions().length?(t={"typeahead-selector":!0},t[this.props.customClass]=null!=this.props.customClass,d.ul({className:e(t)},this.renderOptions())):d.div({})}}),{Autocomplete:a,DataSource:l,TypeaheadSelector:u,TypeaheadSelectorMixin:p}})}.call(this),function(){define("modules/clean/uuid",["modules/clean/crypto"],function(e){var t,n,o,i,r,s,a,l,c;return n=/generator isn't seeded/,i={},t=(function(){var e,t;for(t=[],a=e=0;e<=255;a=++e)t.push((a+256).toString(16).substr(1));return t})(),o=function(e){var n,o;return o=(function(){var o,i,r;for(r=[],o=0,i=e.length;o<i;o++)n=e[o],r.push(t[n]);return r})(),o.join("")},l=function(e){return 255&e},c=function(e){var t,n;return t=[e.slice(0,4),e.slice(4,6),e.slice(6,8),e.slice(8,10),e.slice(10,16)],n=(function(){var n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(o(e));return r})(),n.join("-")},s=function(t){var o,i,s;null==t&&(t={}),s=new Array(16);try{e.getRandomValues(s)}catch(e){if(o=e,!o.message.match(n)||!t.allowInsecure)throw o;r(s)}return(function(){var e,t,n;for(n=[],e=0,t=s.length;e<t;e++)i=s[e],n.push(l(i));return n})()},r=function(e){var t,n,o;for(o=Math.pow(2,8),a=t=0,n=e.length;0<=n?t<n:t>n;a=0<=n?++t:--t)e[a]=Math.floor(Math.random()*o);return e},i.v4=function(e){var t;return null==e&&(e={}),t=s({allowInsecure:e.allowInsecure}),t[6]=15&t[6]|64,t[8]=63&t[8]|128,c(t)},i})}.call(this),function(){define("modules/clean/zendesk_feedback",["jquery","external/classnames","external/react","external/react-dom","modules/core/i18n","modules/clean/ajax","modules/clean/react/modal","modules/clean/react/image","modules/clean/static_urls","modules/clean/react/css","modules/clean/react/select","modules/clean/sharing/views/hover_close_button","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,c,u,p,d){var h,_,m,f,v,g,y,E,S,b,w,C,T,A,I,P,R,O;return _=s.Modal,R=l.static_url,f=u.input,v=u.option,T=n.DOM,w=n.createElement,O=n.addons.update,y=i.i18n_default_project("sharing")._,S=n.createClass({displayName:"OpenFeedbackForm",propTypes:{defaultCategory:n.PropTypes.string},
getInitialState:function(){return{}},componentDidMount:function(){return o.findDOMNode(this.refs.textbox).focus()},render:function(){return w(_,{className:"zendesk-feedback-form",title:y("Send us your feedback"),acceptButtonDisabled:!this.state.message||this.state.isSending,acceptButtonText:y("Send feedback"),autoClose:!1,dismissButtonText:y("Cancel"),onAccept:(function(e){return function(){var t,n,o;return e.setState({isSending:!0}),o="truelink",e.refs.category.getValue(),t={categoryTag:e.state.message},n=o+"_feedback",A(n,t,function(){return e.setState({isSending:!1})})}})(this)},T.label({htmlFor:"feedback-category"},y("Category")),w(f,{ref:"category",className:"u-mar-bottom-m feedback-category",id:"feedback-category",defaultValue:this.props.defaultCategory},w(v,{value:"sender"},y("I have feedback about sharing links with others")),w(v,{value:"receiver"},y("I have feedback about accessing links shared with me")),w(v,{value:"settings"},y("I have feedback about changing sharing settings")),w(v,{value:"general"},y("I have general feedback")),w(v,{value:"bug"},y("I found a bug"))),T.label({htmlFor:"feedback-content"},y("What is your feedback?")),T.textarea({className:"zendesk-feedback-form__textbox",id:"feedback-content",onChange:(function(e){return function(t){return e.setState({message:t.target.value})}})(this),ref:"textbox"}))}}),b=n.createClass({displayName:"ZendeskQuantitativeForm",SCORES:{PASS:[{NAME:"seen_feature_score",PROMPT:y("Have you seen this feature at the top of Dropbox file previews?"),TYPE:"YESNO",HAS_IMAGE:!0,IMAGE_SRC:R("/static/images/pass/pass_feedback_feature_example-vflVrEgNf.png"),IMAGE_SRC_HI_RES:R("/static/images/pass/pass_feedback_feature_example@2x-vflEAv7uE.png"),IMAGE_ALT:y("An image of the presence and seen state feature")},{NAME:"knowledge_about_feature_score",PROMPT:y("Do you know that this feature has information about who has viewed this file?"),TYPE:"YESNO",HAS_IMAGE:!1},{NAME:"value_of_feature_score",PROMPT:y("How valuable has this feature been?"),ONE_LABEL:y("Not at all"),FIVE_LABEL:y("Very"),HIDDEN_ONE_LABEL:y("1 means not at all valuable"),HIDDEN_FIVE_LABEL:y("5 means very valuable"),TYPE:"SCALE"}]},propTypes:{title:n.PropTypes.string.isRequired,feedbackTag:n.PropTypes.string.isRequired,formType:n.PropTypes.string.isRequired},getInitialState:function(){return{message:"",scores:{}}},_renderScaleQuestion:function(e){var n;return T.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-xs",role:"radiogroup"},T.label({},e.PROMPT),function(){var o,i;for(i=[],n=o=1;o<6;n=++o)i.push(T.button({"aria-checked":this.state.scores[e.NAME]===n.toString(),onClick:(function(e){return function(t,n){return function(){var o;return o={},o[n.NAME]={$set:t.toString()},e.setState({scores:O(e.state.scores,o)})}}})(this)(n,e),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[e.NAME]===n.toString()})},n));return i}.call(this),T.div({},T.span({className:"zendesk-feedback-form__score-label"},e.ONE_LABEL),T.span({className:"ax-visually-hidden"},e.HIDDEN_ONE_LABEL),T.span({className:"zendesk-feedback-form__score-label"},e.FIVE_LABEL),T.span({className:"ax-visually-hidden"},e.HIDDEN_FIVE_LABEL)))},_renderYesNoQuestion:function(e){var n,o;return o=e.HAS_IMAGE?T.div({},w(a,{className:"zendesk-feedback-form__question-image",src:e.IMAGE_SRC,srcHiRes:e.IMAGE_SRC_HI_RES,alt:e.IMAGE_ALT})):void 0,T.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-xs",role:"radiogroup"},T.label({},e.PROMPT),o,function(){var o,i,r,s;for(r=[{key:"YES",answer_text:y("Yes")},{key:"NO",answer_text:y("No")}],s=[],o=0,i=r.length;o<i;o++)n=r[o],s.push(T.button({"aria-checked":this.state.scores[e.NAME]===n.key,onClick:(function(e){return function(t,n){return function(){var o;return o={},o[n.NAME]={$set:t.key},e.setState({scores:O(e.state.scores,o)})}}})(this)(n,e),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[e.NAME]===n.key})},n.answer_text));return s}.call(this))},_renderFreeResponseQuestion:function(){var e;return e=y("PASS"===this.props.formType?"Please describe one way that this feature has helped or hurt your productivity:":"What’s the main reason for your scores?"),T.div({},T.label({htmlFor:"feedback--main-reason"},e),T.textarea({className:"zendesk-feedback-form__textbox",id:"feedback--main-reason",onChange:(function(e){return function(t){return e.setState({message:t.target.value})}})(this)}))},render:function(){var t;return w(_,{className:"zendesk-feedback-form",title:this.props.title,acceptButtonDisabled:this.state.isSending||this.SCORES[this.props.formType].reduce((function(e){return function(t,n){return!e.state.scores[n.NAME]||t}})(this),!1),acceptButtonText:y("Send feedback"),autoClose:!1,dismissButtonText:y("Cancel"),onAccept:(function(t){return function(){var n;return t.setState({isSending:!0}),n=e.extend({},t.state.scores),n.free_response=t.state.message,A(t.props.feedbackTag,n,function(){return t.setState({isSending:!1})})}})(this)},function(){var e,n,o,i;for(o=this.SCORES[this.props.formType],i=[],e=0,n=o.length;e<n;e++)t=o[e],"SCALE"===t.TYPE?i.push(this._renderScaleQuestion(t)):"YESNO"===t.TYPE?i.push(this._renderYesNoQuestion(t)):i.push(void 0);return i}.call(this),this._renderFreeResponseQuestion())}}),E=n.createClass({displayName:"FeedbackFlyout",propTypes:{defaultCategory:n.PropTypes.string,onCloseClick:n.PropTypes.func},componentDidMount:function(){return o.findDOMNode(this.refs.mainButton).focus()},render:function(){return T.div({className:"zendesk-flyout"},T.div({className:"zendesk-flyout__header u-pad-left-l u-pad-bottom-m u-pad-top-m"},y("Have a moment?"),w(p,{className:"zendesk-flyout__x u-mar-right-m",onClick:(function(e){return function(){var t;return"function"==typeof(t=e.props).onCloseClick&&t.onCloseClick(),C()}})(this)})),T.div({className:"u-pad-left-l u-mar-bottom-m u-pad-top-m u-mar-right-m"},y("Help us make your Dropbox experience even better by sending us your feedback."),T.button({className:"c-btn c-btn--primary u-mar-top-m zendesk-flyout__main_button",onClick:(function(e){return function(){return C(),_.showInstance(w(m,e.props))}})(this),ref:"mainButton"},y("Give feedback"))))}}),h=c(E,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),m=c(S,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),g=c(b,["/static/css/zendesk_feedback-vflr6Jf-t.css"]),P=function(){return _.showInstance(w(g,{title:y("Send us your feedback"),feedbackTag:"pass_feedback",formType:"PASS"}))},I=function(t){var n;return n=function(){return r.BackgroundRequest({url:"/sharing/show_feedback_flyout",data:{dont_show_again:!0}})},r.WebRequest({url:"/sharing/show_feedback_flyout",success:function(i){var r;if(JSON.parse(i))return r=e("<div />").attr({class:"zendesk-flyout-container"}).prependTo("body")[0],o.render(w(h,{onCloseClick:n,defaultCategory:t}),r)}})},C=function(){return e(".zendesk-flyout-container").remove()},A=function(e,t,n){return r.WebRequest({url:"/log/file_collab_feedback",data:{feedback_tag:e,user_feedback:JSON.stringify(t)},success:function(){return d.success(y("Thanks for helping make Dropbox better!")),_.close()},error:n})},{showPASSFeedbackForm:P,showFeedbackFlyoutIfAllowed:I}})}.call(this),function(){"use strict";define("modules/core/type",["external/underscore"],function(e){var t,n,o,i,r,s,a;return i={},i.Type=t=(function(){function t(t,n){if(!e.isString(t)&&!e.isFunction(t))throw new TypeError("First parameter needs to be a string identifying the type");if(!e.isFunction(n))throw new TypeError("Second parameter needs to be a predicate defining the type");e.isFunction(t)?this.getTypeString=t:this.getTypeString=function(){return t},this.predicate=n}return t})(),o=function(n){var i,r;if(a(n))return!0;if(n instanceof t)return!0;if(e.isFunction(n))return!0;if(e.isArray(n)){if(1!==n.length)return!1;if(!o(n[0]))return!1}else{if(!(e.isObject(n)&&null==n.prototype&&n.constructor===Object&&e.keys(n).length>0))return!1;for(i in n)if(r=n[i],!o(r))return!1}return!0},n=(function(){var n,i,r,s,a,l,c;return c=new t("undefined",e.isUndefined),i=new t("null",e.isNull),n=new t("Boolean",e.isBoolean),r=new t("Number",e.isNumber),a=new t("String",e.isString),s=new t("Object",function(t){return e.isObject(t)&&!e.isFunction(t)&&!e.isArray(t)}),l=new t("Type",o),function(e){return void 0===e?c:null===e?i:e===Boolean?n:e===Number?r:e===String?a:e===Object?s:e===t?l:void 0}})(),i.isBasicType=a=function(e){return null!=n(e)},i.firstFailingKeypath=r=function(o,i,s){var l,c,u,p,d,h,_,m,f,v,g,y,E;if(null==s&&(s=[]),a(o)){if(!n(o).predicate(i))return s}else if(o instanceof t){if(!o.predicate(i))return s}else if(e.isFunction(o)){if(!(i instanceof o))return s}else if(e.isArray(o)){if(r(Array,i,s))return s;for(c=u=0,h=i.length;u<h;c=++u){if(l=i[c],s.push(c),r(o[0],l,s))return s;s.pop()}}else{if(r(Object,i,s))return s;for(y=e.keys(o),E=e.keys(i),v=e.difference(y,E),d=0,_=v.length;d<_;d++)if(p=v[d],r(o[p],void 0,s))return s;for(g=e.intersection(E,y),f=0,m=g.length;f<m;f++){if(p=g[f],s.push(p),r(o[p],i[p],s))return s;s.pop()}}},i.checkType=function(e,t){return null==r(e,t)},i.getTypeString=s=function(o){var i,r,l;if(a(o))return n(o).getTypeString();if(o instanceof t)return o.getTypeString();if(e.isFunction(o))return o.name;if(e.isArray(o))return"["+s(o[0])+"]";r=[];for(i in o)l=o[i],r.push(i+": "+s(l));return"{"+r.join(", ")+"}"},i})}.call(this),function(){"use strict";var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},o=[].slice;define("modules/core/types",["external/underscore","modules/constants/page_load","modules/core/type"],function(t,i,r){var s,a,l,c,u,p,d,h,_,m,f,v,g,y,E,S,b,w,C;return m=r.Type,f=r.checkType,E=r.getTypeString,y=r.firstFailingKeypath,S=r.isBasicType,d=(function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}})(),_=(function(t){function n(e){n.__super__.constructor.call(this,E.bind(null,e),f.bind(null,e))}return e(n,t),n})(m),c=(function(o){function i(e,n){null!=i.names?i.names.set(this,e):this.__name,null!=n&&t.extend(this,n)}e(i,o);try{i.names=new WeakMap}catch(e){i.names=null}return i.prototype.getTypeString=function(){return null!=i.names?i.names.get(this):this.__name},i.prototype.predicate=function(e){return n.call(t.values(this),e)>=0},i})(m),a=(function(t){function n(e){this.valType=e}return e(n,t),n.prototype.getTypeString=function(){return"Dict[string -> "+E(this.valType)+"]"},n.prototype.predicate=function(e){var t,n;return function(){var o;o=[];for(t in e)n=e[t],o.push(f(this.valType,n));return o}.call(this).every(function(e){return e})},n})(m),v=function(e,n){var i,r,s,a,l,c,u,p;if(S(e));else if(e instanceof m)null!=e.parameter_types&&t.isFunction(n)&&!n.isTypeChecked&&(n=C.apply(null,o.call(e.parameter_types).concat([n])));else if(t.isFunction(e));else if(t.isArray(e))for(s=a=0,c=n.length;a<c;s=++a)i=n[s],r=v(e[0],i),r!==i&&(n=n.slice(),n[s]=r);else for(l in e)u=e[l],p=v(u,n[l]),p!==n[l]&&(n=t.clone(n),n[l]=p);return n},b=function(e,n,o,i){var r,s,a,l;for(r=0,l=n.length;r<l;r++)s=n[r],i=i[s],o=t.isArray(o)?o[0]:o[s];return n.length>0&&(a=", key "+n.join(".")),a=null!=a?a:"","Argument "+e+a+": Value "+JSON.stringify(i,null,"  ")+" doesn't match type "+E(o)},C=function(){var e,n,i,r;return r=2<=arguments.length?o.call(arguments,0,n=arguments.length-1):(n=0,[]),e=arguments[n++],i=function(){var n,i,s,a,l,c,u,p,d,h,m,f;for(i=1<=arguments.length?o.call(arguments,0):[],n=r,p=t.find(r,function(e){return e instanceof _}),null!=p&&(d=t.indexOf(n,p),h=Math.max(i.length-n.length+1,0),m=[d,1],t.times(h,function(){return m.push(p)}),n=n.slice(),n.splice.apply(n,m)),a=l=0,c=n.length;l<c;a=++l){if(f=n[a],s=y(f,i[a]),null!=s)throw u=b(a,s,f,i[a]),new TypeError(u);i[a]=v(f,i[a])}return e.apply(this,i)},i.isTypeChecked=!0,i},w=function(e,t){var n;return n=function(){var n,i,r,s;if(n=1<=arguments.length?o.call(arguments,0):[],s=t.apply(this,n),i=y(e,s),null!=i)throw r=b(0,i,e,s),new TypeError(r);return s},t.isTypeChecked&&(n.isTypeChecked=!0),n},l=function(e,t){var n,o;return n=function(){return"("+E(e)+"|"+E(t)+")"},o=function(n){return f(e,n)||f(t,n)},new m(n,o)},p=function(e){var t,n,o;return e instanceof m&&e.isOptional||e instanceof _?e:(t=function(){return"?"+E(e)},n=function(t){return null==t||f(e,t)},o=new m(t,n),e instanceof m&&null!=e.parameter_types&&(o.parameter_types=e.parameter_types),o.isOptional=!0,o)},u=function(){var e,n,i,r;return r=1<=arguments.length?o.call(arguments,0):[],e=function(){return"function("+r.map(E).join(", ")+")"},n=t.isFunction,i=new m(e,n),i.parameter_types=r,i},h=function(e){return new _(e)},s=function(e){return new a(e)},g={},g.takes=w(Function,C(h(m),Function,C)),g.returns=w(Function,C(m,Function,w)),g.Type=m,g.Enum=c,g.Dict=w(m,C(m,s)),g.Either=w(m,C(m,m,l)),g.Maybe=w(m,C(m,p)),g.Splat=w(m,C(m,h)),g.Any=new m("Any",function(e){return!0}),g.Func=w(m,C(h(m),u)),g.inject=w(Object,C(Object,function(e){return t.extend(e,t.omit(g,"inject"))})),d||(g.takes=function(){var e;return 2<=arguments.length?o.call(arguments,0,e=arguments.length-1):(e=0,[]),arguments[e++]},g.returns=function(){var e;return 2<=arguments.length?o.call(arguments,0,e=arguments.length-1):(e=0,[]),arguments[e++]}),g})}.call(this);
//# sourceMappingURL=pkg-file_viewer.min.js-vflqkM9m6.map